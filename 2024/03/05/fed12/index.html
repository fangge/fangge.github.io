<!DOCTYPE html>
<html lang="zh-Hans">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="x5-fullscreen" content="true">
<meta name="full-screen" content="yes">
<meta name="theme-color" content="#317EFB" />
<meta content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=0" name="viewport">
<meta name="description" content="纯前端压缩方案的探讨">
<meta property="og:type" content="article">
<meta property="og:title" content="前端图片压缩方案">
<meta property="og:url" content="https://www.mrfangge.com/2024/03/05/fed12/index.html">
<meta property="og:site_name" content="MrFangge">
<meta property="og:description" content="纯前端压缩方案的探讨">
<meta property="og:locale">
<meta property="article:published_time" content="2024-03-05T15:25:50.000Z">
<meta property="article:modified_time" content="2025-08-08T03:16:52.923Z">
<meta property="article:author" content="Mrfangge">
<meta property="article:tag" content="前端开发">
<meta property="article:tag" content="Javascript">
<meta property="article:tag" content="图片压缩">
<meta property="article:tag" content="UPNG">
<meta property="article:tag" content="canvas">
<meta property="article:tag" content="input">
<meta name="twitter:card" content="summary">


<title >前端图片压缩方案</title>

<!-- Favicon -->

    <link href='/img/icon-16.ico?v=2.2.6' rel='icon' type='image/png' sizes='16x16' ></link>


    <link href='/img/icon.ico?v=2.2.6' rel='icon' type='image/png' sizes='32x32' ></link>


    <link href='/img/logo.png?v=2.2.6' rel='apple-touch-icon' sizes='180x180' ></link>



<!-- Plugin -->




    
<link rel="stylesheet" href="/css/plugins/bootstrap.row.css">

    
<link rel="stylesheet" href="https://unpkg.com/@fancyapps/ui@4.0/dist/fancybox.css">

    
    




<!-- Icon -->

    
<link rel="stylesheet" href="/css/plugins/font-awesome.min.css">




<!-- Variable -->
<script>window.ASYNC_CONFIG = {"hostname":"www.mrfangge.com","author":"Mrfangge","root":"/","typed_text":null,"theme_version":"2.2.6","theme":{"switch":true,"default":"style-light"},"favicon":{"logo":"/img/icon.jpg","icon16":"/img/icon-16.ico","icon32":"/img/icon.ico","apple_touch_icon":"/img/logo.png","webmanifest":null,"visibilitychange":true,"hidden":"/img/icon.jpg","show_text":"(/≧▽≦/)嘿！欢迎回来！","hide_text":"(●—●)喔哟，等你哦！"},"i18n":{"placeholder":"搜索文章...","empty":"找不到您查询的内容: ${query}","hits":"找到 ${hits} 条结果","hits_time":"找到 ${hits} 条结果（用时 ${time} 毫秒）","author":"本文作者：","copyright_link":"本文链接：","copyright_license_title":"版权声明：","copyright_license_content":"本博客所有文章除特别声明外，均默认采用 undefined 许可协议。","copy_success":"复制成功","copy_failure":"复制失败","open_read_mode":"进入阅读模式","exit_read_mode":"退出阅读模式","notice_outdate_message":"距离上次更新已经 undefined 天了, 文章内容可能已经过时。","sticky":"置顶","just":"刚刚","min":"分钟前","hour":"小时前","day":"天前","month":"个月前"},"swup":false,"plugin":{"flickr_justified_gallery":"https://unpkg.com/flickr-justified-gallery@latest/dist/fjGallery.min.js"},"icons":{"sun":"far fa-sun","moon":"far fa-moon","play":"fas fa-play","email":"far fa-envelope","next":"fas fa-arrow-right","calendar":"far fa-calendar-alt","clock":"far fa-clock","user":"far fa-user","back_top":"fas fa-arrow-up","close":"fas fa-times","search":"fas fa-search","reward":"fas fa-hand-holding-usd","toc_tag":"fas fa-th-list","read":"fas fa-book-reader","arrows":"fas fa-arrows-alt-h","double_arrows":"fas fa-angle-double-down","copy":"fas fa-copy"},"icontype":"font","highlight":{"plugin":"highlighjs","theme":true,"copy":true,"lang":true,"title":"default","height_limit":false},"toc":{"post_title":false},"live_time":{"start_time":"","prefix":"博客已萌萌哒运行 undefined 天"},"danmu":{"enable":false,"el":".trm-banner"}};</script>
<script id="async-page-config">window.PAGE_CONFIG = {"isPost":true,"isHome":false,"postUpdate":"2025-08-08 11:16:52"};</script>

<!-- Theme mode css -->
<link data-swup-theme rel="stylesheet" href="/css/index.css?v=2.2.6" id="trm-switch-style">
<script>
    let defaultMode = ASYNC_CONFIG.theme.default !=='auto' ?  ASYNC_CONFIG.theme.default : (window.matchMedia("(prefers-color-scheme: light)").matches ? 'style-light' : 'style-dark')
    let catchMode = localStorage.getItem('theme-mode') || defaultMode;
    let type = catchMode === 'style-dark' ? 'add' : 'remove';
    document.documentElement.classList[type]('dark')
</script>

<!-- CDN -->


    
    



<!-- Site Analytics -->


    
        <!-- Baidu Analytics -->
        <script defer>
            var _hmt = _hmt || [];
            (function() {
              var hm = document.createElement("script");
              hm.src = "https://hm.baidu.com/hm.js?e31b1a8efc9b56b8d770c960116c405c";
              var s = document.getElementsByTagName("script")[0]; 
              s.parentNode.insertBefore(hm, s);
            })();
        </script>
     

    

    
 
<meta name="generator" content="Hexo 7.3.0"></head>

<body>

  <!-- app wrapper -->
  <div class="trm-app-frame">

    <!-- page preloader -->
    <div class="trm-preloader">
    <div class="trm-holder">
        <div class="preloader">
            <div></div>
            <div></div>
            <div></div>
            <div></div>
            <div></div>
            <div></div>
            <div></div>
            <div></div>
            <div></div>
            <div></div>
        </div>
    </div>
</div>
    <!-- page preloader end -->

    <!-- change mode preloader -->
    <div class="trm-mode-swich-animation-frame">
    <div class="trm-mode-swich-animation">
        <i class="i-sun"><i class="iconfont far fa-sun"></i></i>
        <div class="trm-horizon"></div>
        <i class="i-moon"><i class="iconfont far fa-moon"></i></i>
    </div>
</div>
    <!-- change mode preloader end -->

      <!-- scroll container -->
      <div id="trm-dynamic-content" class="trm-swup-animation">
        <div id="trm-scroll-container" class="trm-scroll-container" style="opacity: 0">
            <!-- top bar -->
            <header class="trm-top-bar">
	<div class="container">
		<div class="trm-left-side">
			<!-- logo -->
<a href="/" class="trm-logo-frame trm-anima-link">
    
        <img alt="logo" src="/img/icon.jpg">
    
    
        <div class="trm-logo-text">
            Mr<span>Fangge</span>
        </div>
    
</a>
<!-- logo end -->
		</div>
		<div class="trm-right-side">
			<!-- menu -->
<div class="trm-menu">
    <nav>
        <ul>
            
            <li class="menu-item-has-children ">
                <a  href="/" target="">
                    首页
                </a>
                
            </li>
            
            <li class="menu-item-has-children ">
                <a  href="/archives/" target="">
                    归档
                </a>
                
            </li>
            
        </ul>
    </nav>
</div>
<!-- menu end -->
			
    <!-- mode switcher place -->
    <div class="trm-mode-switcher-place">
        <div class="trm-mode-switcher">
            <i class="iconfont far fa-sun"></i>
            <input class="tgl tgl-light" id="trm-swich" type="checkbox">
            <label class="trm-swich" for="trm-swich"></label>
            <i class="iconfont far fa-moon"></i>
        </div>
    </div>
    <!-- mode switcher place end -->

			
		</div>
		<div class="trm-menu-btn">
			<span></span>
		</div>
	</div>
</header>
            <!-- top bar end -->

            <!-- body -->
            
<div class="trm-content-start">
    <!-- banner -->
    <div class="trm-banner">
    
    <!-- banner cover -->
    <img style="object-position:top;object-fit:cover;" alt="banner" class="trm-banner-cover" src="/img/blog/fed11.jpg">
    <!-- banner cover end -->
    

    <!-- banner content -->
    <div class="trm-banner-content trm-overlay">
        <div class="container">
            <div class="row">
                
                <div class="col-lg-4"></div>
                
                <div class="col-lg-8">

                    <!-- banner title -->
                    <div class="trm-banner-text ">
                        <div class="trm-label trm-mb-20">
                            NEWS LETTER
                        </div>
                        <h1 class="trm-mb-30 trm-hsmb-font">
                            前端图片压缩方案
                        </h1>

                        
                            <ul class="trm-breadcrumbs trm-label">
                                <li>
                                    <a href="/" class="trm-anima-link">Home</a>
                                </li>
                                <li>
                                    <span>
                                        2024
                                    </span>
                                </li>
                            </ul>
                        
                    </div>
                    <!-- banner title end -->

                    <!-- scroll hint -->
                    <span id="scroll-triger" class="trm-scroll-hint-frame">
                        <div class="trm-scroll-hint"></div>
                        <span class="trm-label">Scroll down</span>
                    </span>
                    <!-- scroll hint end -->

                </div>
            </div>
        </div>
    </div>
    <!-- banner content end -->
</div>
    <!-- banner end -->
    <div class="container">
        <div class="row">
            
                <div class="trm-page-sidebar col-lg-4 hidden-sm">
                    <!-- main card -->
                    <div class="trm-main-card-frame trm-sidebar">
    <div class="trm-main-card"> 
        <!-- card header -->
<div class="trm-mc-header">
    <div class="trm-avatar-frame trm-mb-20">
        <img alt="Avatar" class="trm-avatar" src="/img/avatar.jpeg">
    </div>
    <h5 class="trm-name trm-mb-15">
        Mrfangge
    </h5>
    
</div>
<!-- card header end -->
        <!-- sidebar social -->

<div class="trm-divider trm-mb-40 trm-mt-40"></div>
<div class="trm-social">
    
        <a href="https://github.com/fangge" title="github" rel="nofollow" target="_blank">
            <i class="iconfont fab fa-github"></i>
        </a>
    
        <a href="https://www.xiaohongshu.com/user/profile/5837bc3a7fc5b806082907db" title="小红书" rel="nofollow" target="_blank">
            <i class="iconfont fas fa-camera-retro"></i>
        </a>
    
</div>

<!-- sidebar social end -->
        <!-- info -->
<div class="trm-divider trm-mb-40 trm-mt-40"></div>
<ul class="trm-table trm-mb-20">
    
        <li>
            <div class="trm-label">
                职业:
            </div>
            <div class="trm-label trm-label-light">
                前端开发工程师
            </div>
        </li>
    
        <li>
            <div class="trm-label">
                兴趣爱好:
            </div>
            <div class="trm-label trm-label-light">
                摄影
            </div>
        </li>
    
</ul>
<!-- info end -->

        
    <div class="trm-divider trm-mb-40 trm-mt-40"></div>
    <!-- action button -->
    <div class="text-center">
        <a href="mailto:fangge-sun@163.com" class="trm-btn">
            联系我
            <i class="iconfont far fa-envelope"></i>
        </a>
    </div>
    <!-- action button end -->

    </div>
</div>
                    <!-- main card end -->
                </div>
            
            <div class="trm-page-content col-lg-8">
                <div id="trm-content" class="trm-content">
                    <div class="trm-post-info row hidden-sm">
    <div class="col-sm-4">
        <div class="trm-card trm-label trm-label-light text-center">
            <i class="iconfont far fa-calendar-alt trm-icon"></i><br>
            03/05
        </div>
    </div>
    <div class="col-sm-4">
        <div class="trm-card trm-label trm-label-light text-center">
            <i class="iconfont far fa-clock trm-icon"></i><br>
            23:25
        </div>
    </div>
    <div class="col-sm-4">
        <div id="post-author" class="trm-card trm-label trm-label-light text-center">
            <i class="iconfont far fa-user trm-icon"></i><br>
            Mrfangge
        </div>
    </div>
</div>
<div class="trm-card ">
    <article id="article-container" class="trm-publication">
    <blockquote>
<p>文章灵感：感谢张鑫旭大大的<a target="_blank" rel="noopener" href="https://www.zhangxinxu.com/wordpress/2023/09/js-jpg-png-compress-tinyimg-mini/">【做了个纯前端 JPG&#x2F;PNG 尺寸缩放+压缩的在线工具】</a></p>
</blockquote>
<p>之前在公司业务中，发现低代码生成的页面里面的图片总是会尺寸超标，导致页面加载速度变慢，图片上传组件即使有硬性限制死图片的上传大小，但是也需要运营自行再去 tinypng 等等在线压缩网站再压缩一次才上传，极其不方便，刚好之前拜读了张鑫旭的纯前端压缩的介绍，所以就改造了一下公司的上传组件，下面介绍一下基本原理和代码实现</p>
<h2 id="压缩原理"><a href="#压缩原理" class="headerlink" title="压缩原理"></a>压缩原理</h2><h3 id="JPG-前端压缩"><a href="#JPG-前端压缩" class="headerlink" title="JPG 前端压缩"></a>JPG 前端压缩</h3><p>JPG 的压缩使用的是 canvas 的 toDataURL 方法。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">canvas.<span class="title function_">toDataURL</span>(mimeType, quality);</span><br></pre></td></tr></table></figure>

<p>其中 quality 就是图像的质量。</p>
<p>但是此方法只适合 image&#x2F;jpeg 或者 image&#x2F;webp，所以，PNG 的图像压缩无法使用此 API。</p>
<h3 id="PNG-前端压缩"><a href="#PNG-前端压缩" class="headerlink" title="PNG 前端压缩"></a>PNG 前端压缩</h3><p>PNG 的前端压缩使用的是 UPNG.js，项目地址：<a target="_blank" rel="noopener" href="https://github.com/photopea/UPNG.js">https://github.com/photopea/UPNG.js</a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">UPNG</span>.<span class="title function_">encode</span>(imgs, w, h, cnum, [dels]);</span><br></pre></td></tr></table></figure>
<p>其中的cnum就是用来设置PNG压缩损失的，0的话是无损。</p>
<h2 id="压缩流程"><a href="#压缩流程" class="headerlink" title="压缩流程"></a>压缩流程</h2><ol>
<li>input的file类型点击上传文件</li>
<li>利用<code>readAsDataURL</code>方法读取文件的URL格式（base64 编码）的字符串</li>
<li>判断文件类型，如果是jpg则走<code>canvas</code>进行压缩，返回base64</li>
<li>如果是png则走<code>UPNG</code>库进行压缩，返回base64</li>
<li>如果png压缩出现错误，则返回原有的base64</li>
<li>利用dataURItoBuffer或Uint8Array等方法将返回值转换回blob数据流</li>
<li>post提交数据给接口端</li>
</ol>
<h2 id="代码示例"><a href="#代码示例" class="headerlink" title="代码示例"></a>代码示例</h2><h2 id="UPNG代码"><a href="#UPNG代码" class="headerlink" title="UPNG代码"></a>UPNG代码</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">!(<span class="keyword">function</span>(<span class="params">t,e</span>)&#123;<span class="string">&#x27;object&#x27;</span>==<span class="keyword">typeof</span> <span class="built_in">exports</span>&amp;&amp;<span class="string">&#x27;undefined&#x27;</span>!=<span class="keyword">typeof</span> <span class="variable language_">module</span>?<span class="title function_">e</span>(<span class="built_in">exports</span>):<span class="string">&#x27;function&#x27;</span>==<span class="keyword">typeof</span> define&amp;&amp;define.<span class="property">amd</span>?<span class="title function_">define</span>([<span class="string">&#x27;exports&#x27;</span>],e):<span class="title function_">e</span>(((t=<span class="string">&#x27;undefined&#x27;</span>!=<span class="keyword">typeof</span> globalThis?<span class="attr">globalThis</span>:t||self).<span class="property">pako</span>=&#123;&#125;))&#125;)(<span class="variable language_">this</span>,<span class="keyword">function</span>(<span class="params">t</span>)&#123;<span class="string">&#x27;use strict&#x27;</span>;<span class="keyword">function</span> <span class="title function_">e</span>(<span class="params">t</span>)&#123;<span class="keyword">let</span> e=t.<span class="property">length</span>;<span class="keyword">for</span>(;--e&gt;=<span class="number">0</span>;)t[e]=<span class="number">0</span>&#125;<span class="keyword">const</span> a=<span class="number">256</span>,i=<span class="number">286</span>,n=<span class="number">30</span>,s=<span class="number">15</span>,r=<span class="keyword">new</span> <span class="title class_">Uint8Array</span>([<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">4</span>,<span class="number">4</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">5</span>,<span class="number">5</span>,<span class="number">5</span>,<span class="number">0</span>]),o=<span class="keyword">new</span> <span class="title class_">Uint8Array</span>([<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">11</span>,<span class="number">12</span>,<span class="number">12</span>,<span class="number">13</span>,<span class="number">13</span>]),l=<span class="keyword">new</span> <span class="title class_">Uint8Array</span>([<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">7</span>]),h=<span class="keyword">new</span> <span class="title class_">Uint8Array</span>([<span class="number">16</span>,<span class="number">17</span>,<span class="number">18</span>,<span class="number">0</span>,<span class="number">8</span>,<span class="number">7</span>,<span class="number">9</span>,<span class="number">6</span>,<span class="number">10</span>,<span class="number">5</span>,<span class="number">11</span>,<span class="number">4</span>,<span class="number">12</span>,<span class="number">3</span>,<span class="number">13</span>,<span class="number">2</span>,<span class="number">14</span>,<span class="number">1</span>,<span class="number">15</span>]),d=<span class="keyword">new</span> <span class="title class_">Array</span>(<span class="number">576</span>);<span class="title function_">e</span>(d);<span class="keyword">const</span> _=<span class="keyword">new</span> <span class="title class_">Array</span>(<span class="number">60</span>);<span class="title function_">e</span>(_);<span class="keyword">const</span> f=<span class="keyword">new</span> <span class="title class_">Array</span>(<span class="number">512</span>);<span class="title function_">e</span>(f);<span class="keyword">const</span> c=<span class="keyword">new</span> <span class="title class_">Array</span>(<span class="number">256</span>);<span class="title function_">e</span>(c);<span class="keyword">const</span> u=<span class="keyword">new</span> <span class="title class_">Array</span>(<span class="number">29</span>);<span class="title function_">e</span>(u);<span class="keyword">const</span> w=<span class="keyword">new</span> <span class="title class_">Array</span>(n);<span class="keyword">function</span> <span class="title function_">m</span>(<span class="params">t,e,a,i,n</span>)&#123;(<span class="variable language_">this</span>.<span class="property">static_tree</span>=t),(<span class="variable language_">this</span>.<span class="property">extra_bits</span>=e),(<span class="variable language_">this</span>.<span class="property">extra_base</span>=a),(<span class="variable language_">this</span>.<span class="property">elems</span>=i),(<span class="variable language_">this</span>.<span class="property">max_length</span>=n),(<span class="variable language_">this</span>.<span class="property">has_stree</span>=t&amp;&amp;t.<span class="property">length</span>)&#125;<span class="keyword">let</span> b,g,p;<span class="keyword">function</span> <span class="title function_">k</span>(<span class="params">t,e</span>)&#123;(<span class="variable language_">this</span>.<span class="property">dyn_tree</span>=t),(<span class="variable language_">this</span>.<span class="property">max_code</span>=<span class="number">0</span>),(<span class="variable language_">this</span>.<span class="property">stat_desc</span>=e)&#125;<span class="title function_">e</span>(w);<span class="keyword">const</span> <span class="title function_">v</span>=(<span class="params">t</span>)=&gt;(t&lt;<span class="number">256</span>?f[t]:f[<span class="number">256</span>+(t&gt;&gt;&gt;<span class="number">7</span>)]),y=<span class="function">(<span class="params">t,e</span>)=&gt;</span>&#123;(t.<span class="property">pending_buf</span>[t.<span class="property">pending</span>++]=<span class="number">255</span>&amp;e),(t.<span class="property">pending_buf</span>[t.<span class="property">pending</span>++]=(e&gt;&gt;&gt;<span class="number">8</span>)&amp;<span class="number">255</span>)&#125;,x=<span class="function">(<span class="params">t,e,a</span>)=&gt;</span>&#123;t.<span class="property">bi_valid</span>&gt;<span class="number">16</span>-a?((t.<span class="property">bi_buf</span>|=(e&lt;&lt;t.<span class="property">bi_valid</span>)&amp;<span class="number">65535</span>),<span class="title function_">y</span>(t,t.<span class="property">bi_buf</span>),(t.<span class="property">bi_buf</span>=e&gt;&gt;(<span class="number">16</span>-t.<span class="property">bi_valid</span>)),(t.<span class="property">bi_valid</span>+=a-<span class="number">16</span>)):((t.<span class="property">bi_buf</span>|=(e&lt;&lt;t.<span class="property">bi_valid</span>)&amp;<span class="number">65535</span>),(t.<span class="property">bi_valid</span>+=a))&#125;,z=<span class="function">(<span class="params">t,e,a</span>)=&gt;</span>&#123;<span class="title function_">x</span>(t,a[<span class="number">2</span>*e],a[<span class="number">2</span>*e+<span class="number">1</span>])&#125;,A=<span class="function">(<span class="params">t,e</span>)=&gt;</span>&#123;<span class="keyword">let</span> a=<span class="number">0</span>;<span class="keyword">do</span>&#123;(a|=<span class="number">1</span>&amp;t),(t&gt;&gt;&gt;=<span class="number">1</span>),(a&lt;&lt;=<span class="number">1</span>)&#125;<span class="keyword">while</span>(--e&gt;<span class="number">0</span>);<span class="keyword">return</span> a&gt;&gt;&gt;<span class="number">1</span>&#125;,E=<span class="function">(<span class="params">t,e,a</span>)=&gt;</span>&#123;<span class="keyword">const</span> i=<span class="keyword">new</span> <span class="title class_">Array</span>(<span class="number">16</span>);<span class="keyword">let</span> n,r,o=<span class="number">0</span>;<span class="keyword">for</span>(n=<span class="number">1</span>;n&lt;=s;n++)(o=(o+a[n-<span class="number">1</span>])&lt;&lt;<span class="number">1</span>),(i[n]=o);<span class="keyword">for</span>(r=<span class="number">0</span>;r&lt;=e;r++)&#123;<span class="keyword">let</span> e=t[<span class="number">2</span>*r+<span class="number">1</span>];<span class="number">0</span>!==e&amp;&amp;(t[<span class="number">2</span>*r]=<span class="title function_">A</span>(i[e]++,e))&#125;&#125;,R=<span class="function">(<span class="params">t</span>)=&gt;</span>&#123;<span class="keyword">let</span> e;<span class="keyword">for</span>(e=<span class="number">0</span>;e&lt;i;e++)t.<span class="property">dyn_ltree</span>[<span class="number">2</span>*e]=<span class="number">0</span>;<span class="keyword">for</span>(e=<span class="number">0</span>;e&lt;n;e++)t.<span class="property">dyn_dtree</span>[<span class="number">2</span>*e]=<span class="number">0</span>;<span class="keyword">for</span>(e=<span class="number">0</span>;e&lt;<span class="number">19</span>;e++)t.<span class="property">bl_tree</span>[<span class="number">2</span>*e]=<span class="number">0</span>;(t.<span class="property">dyn_ltree</span>[<span class="number">512</span>]=<span class="number">1</span>),(t.<span class="property">opt_len</span>=t.<span class="property">static_len</span>=<span class="number">0</span>),(t.<span class="property">sym_next</span>=t.<span class="property">matches</span>=<span class="number">0</span>)&#125;,Z=<span class="function">(<span class="params">t</span>)=&gt;</span>&#123;t.<span class="property">bi_valid</span>&gt;<span class="number">8</span>?<span class="title function_">y</span>(t,t.<span class="property">bi_buf</span>):t.<span class="property">bi_valid</span>&gt;<span class="number">0</span>&amp;&amp;(t.<span class="property">pending_buf</span>[t.<span class="property">pending</span>++]=t.<span class="property">bi_buf</span>),(t.<span class="property">bi_buf</span>=<span class="number">0</span>),(t.<span class="property">bi_valid</span>=<span class="number">0</span>)&#125;,U=<span class="function">(<span class="params">t,e,a,i</span>)=&gt;</span>&#123;<span class="keyword">const</span> n=<span class="number">2</span>*e,s=<span class="number">2</span>*a;<span class="keyword">return</span> t[n]&lt;t[s]||(t[n]===t[s]&amp;&amp;i[e]&lt;=i[a])&#125;,S=<span class="function">(<span class="params">t,e,a</span>)=&gt;</span>&#123;<span class="keyword">const</span> i=t.<span class="property">heap</span>[a];<span class="keyword">let</span> n=a&lt;&lt;<span class="number">1</span>;<span class="keyword">for</span>(;n&lt;=t.<span class="property">heap_len</span>&amp;&amp;(n&lt;t.<span class="property">heap_len</span>&amp;&amp;<span class="title function_">U</span>(e,t.<span class="property">heap</span>[n+<span class="number">1</span>],t.<span class="property">heap</span>[n],t.<span class="property">depth</span>)&amp;&amp;n++,!<span class="title function_">U</span>(e,i,t.<span class="property">heap</span>[n],t.<span class="property">depth</span>));)(t.<span class="property">heap</span>[a]=t.<span class="property">heap</span>[n]),(a=n),(n&lt;&lt;=<span class="number">1</span>);t.<span class="property">heap</span>[a]=i&#125;,D=<span class="function">(<span class="params">t,e,i</span>)=&gt;</span>&#123;<span class="keyword">let</span> n,s,l,h,d=<span class="number">0</span>;<span class="keyword">if</span>(<span class="number">0</span>!==t.<span class="property">sym_next</span>)<span class="keyword">do</span>&#123;(n=<span class="number">255</span>&amp;t.<span class="property">pending_buf</span>[t.<span class="property">sym_buf</span>+d++]),(n+=(<span class="number">255</span>&amp;t.<span class="property">pending_buf</span>[t.<span class="property">sym_buf</span>+d++])&lt;&lt;<span class="number">8</span>),(s=t.<span class="property">pending_buf</span>[t.<span class="property">sym_buf</span>+d++]),<span class="number">0</span>===n?<span class="title function_">z</span>(t,s,e):((l=c[s]),<span class="title function_">z</span>(t,l+a+<span class="number">1</span>,e),(h=r[l]),<span class="number">0</span>!==h&amp;&amp;((s-=u[l]),<span class="title function_">x</span>(t,s,h)),n--,(l=<span class="title function_">v</span>(n)),<span class="title function_">z</span>(t,l,i),(h=o[l]),<span class="number">0</span>!==h&amp;&amp;((n-=w[l]),<span class="title function_">x</span>(t,n,h)))&#125;<span class="keyword">while</span>(d&lt;t.<span class="property">sym_next</span>);<span class="title function_">z</span>(t,<span class="number">256</span>,e)&#125;,T=<span class="function">(<span class="params">t,e</span>)=&gt;</span>&#123;<span class="keyword">const</span> a=e.<span class="property">dyn_tree</span>,i=e.<span class="property">stat_desc</span>.<span class="property">static_tree</span>,n=e.<span class="property">stat_desc</span>.<span class="property">has_stree</span>,r=e.<span class="property">stat_desc</span>.<span class="property">elems</span>;<span class="keyword">let</span> o,l,h,d=-<span class="number">1</span>;<span class="keyword">for</span>(t.<span class="property">heap_len</span>=<span class="number">0</span>,t.<span class="property">heap_max</span>=<span class="number">573</span>,o=<span class="number">0</span>;o&lt;r;o++)<span class="number">0</span>!==a[<span class="number">2</span>*o]?((t.<span class="property">heap</span>[++t.<span class="property">heap_len</span>]=d=o),(t.<span class="property">depth</span>[o]=<span class="number">0</span>)):(a[<span class="number">2</span>*o+<span class="number">1</span>]=<span class="number">0</span>);<span class="keyword">for</span>(;t.<span class="property">heap_len</span>&lt;<span class="number">2</span>;)(h=t.<span class="property">heap</span>[++t.<span class="property">heap_len</span>]=d&lt;<span class="number">2</span>?++<span class="attr">d</span>:<span class="number">0</span>),(a[<span class="number">2</span>*h]=<span class="number">1</span>),(t.<span class="property">depth</span>[h]=<span class="number">0</span>),t.<span class="property">opt_len</span>--,n&amp;&amp;(t.<span class="property">static_len</span>-=i[<span class="number">2</span>*h+<span class="number">1</span>]);<span class="keyword">for</span>(e.<span class="property">max_code</span>=d,o=t.<span class="property">heap_len</span>&gt;&gt;<span class="number">1</span>;o&gt;=<span class="number">1</span>;o--)<span class="title function_">S</span>(t,a,o);h=r;<span class="keyword">do</span>&#123;(o=t.<span class="property">heap</span>[<span class="number">1</span>]),(t.<span class="property">heap</span>[<span class="number">1</span>]=t.<span class="property">heap</span>[t.<span class="property">heap_len</span>--]),<span class="title function_">S</span>(t,a,<span class="number">1</span>),(l=t.<span class="property">heap</span>[<span class="number">1</span>]),(t.<span class="property">heap</span>[--t.<span class="property">heap_max</span>]=o),(t.<span class="property">heap</span>[--t.<span class="property">heap_max</span>]=l),(a[<span class="number">2</span>*h]=a[<span class="number">2</span>*o]+a[<span class="number">2</span>*l]),(t.<span class="property">depth</span>[h]=(t.<span class="property">depth</span>[o]&gt;=t.<span class="property">depth</span>[l]?t.<span class="property">depth</span>[o]:t.<span class="property">depth</span>[l])+<span class="number">1</span>),(a[<span class="number">2</span>*o+<span class="number">1</span>]=a[<span class="number">2</span>*l+<span class="number">1</span>]=h),(t.<span class="property">heap</span>[<span class="number">1</span>]=h++),<span class="title function_">S</span>(t,a,<span class="number">1</span>)&#125;<span class="keyword">while</span>(t.<span class="property">heap_len</span>&gt;=<span class="number">2</span>);(t.<span class="property">heap</span>[--t.<span class="property">heap_max</span>]=t.<span class="property">heap</span>[<span class="number">1</span>]),(<span class="function">(<span class="params">t,e</span>)=&gt;</span>&#123;<span class="keyword">const</span> a=e.<span class="property">dyn_tree</span>,i=e.<span class="property">max_code</span>,n=e.<span class="property">stat_desc</span>.<span class="property">static_tree</span>,r=e.<span class="property">stat_desc</span>.<span class="property">has_stree</span>,o=e.<span class="property">stat_desc</span>.<span class="property">extra_bits</span>,l=e.<span class="property">stat_desc</span>.<span class="property">extra_base</span>,h=e.<span class="property">stat_desc</span>.<span class="property">max_length</span>;<span class="keyword">let</span> d,_,f,c,u,w,m=<span class="number">0</span>;<span class="keyword">for</span>(c=<span class="number">0</span>;c&lt;=s;c++)t.<span class="property">bl_count</span>[c]=<span class="number">0</span>;<span class="keyword">for</span>(a[<span class="number">2</span>*t.<span class="property">heap</span>[t.<span class="property">heap_max</span>]+<span class="number">1</span>]=<span class="number">0</span>,d=t.<span class="property">heap_max</span>+<span class="number">1</span>;d&lt;<span class="number">573</span>;d++)(_=t.<span class="property">heap</span>[d]),(c=a[<span class="number">2</span>*a[<span class="number">2</span>*_+<span class="number">1</span>]+<span class="number">1</span>]+<span class="number">1</span>),c&gt;h&amp;&amp;((c=h),m++),(a[<span class="number">2</span>*_+<span class="number">1</span>]=c),_&gt;i||(t.<span class="property">bl_count</span>[c]++,(u=<span class="number">0</span>),_&gt;=l&amp;&amp;(u=o[_-l]),(w=a[<span class="number">2</span>*_]),(t.<span class="property">opt_len</span>+=w*(c+u)),r&amp;&amp;(t.<span class="property">static_len</span>+=w*(n[<span class="number">2</span>*_+<span class="number">1</span>]+u)));<span class="keyword">if</span>(<span class="number">0</span>!==m)&#123;<span class="keyword">do</span>&#123;<span class="keyword">for</span>(c=h-<span class="number">1</span>;<span class="number">0</span>===t.<span class="property">bl_count</span>[c];)c--;t.<span class="property">bl_count</span>[c]--,(t.<span class="property">bl_count</span>[c+<span class="number">1</span>]+=<span class="number">2</span>),t.<span class="property">bl_count</span>[h]--,(m-=<span class="number">2</span>)&#125;<span class="keyword">while</span>(m&gt;<span class="number">0</span>);<span class="keyword">for</span>(c=h;<span class="number">0</span>!==c;c--)<span class="keyword">for</span>(_=t.<span class="property">bl_count</span>[c];<span class="number">0</span>!==_;)(f=t.<span class="property">heap</span>[--d]),f&gt;i||(a[<span class="number">2</span>*f+<span class="number">1</span>]!==c&amp;&amp;((t.<span class="property">opt_len</span>+=(c-a[<span class="number">2</span>*f+<span class="number">1</span>])*a[<span class="number">2</span>*f]),(a[<span class="number">2</span>*f+<span class="number">1</span>]=c)),_--)&#125;&#125;)(t,e),<span class="title function_">E</span>(a,d,t.<span class="property">bl_count</span>)&#125;,O=<span class="function">(<span class="params">t,e,a</span>)=&gt;</span>&#123;<span class="keyword">let</span> i,n,s=-<span class="number">1</span>,r=e[<span class="number">1</span>],o=<span class="number">0</span>,l=<span class="number">7</span>,h=<span class="number">4</span>;<span class="keyword">for</span>(<span class="number">0</span>===r&amp;&amp;((l=<span class="number">138</span>),(h=<span class="number">3</span>)),e[<span class="number">2</span>*(a+<span class="number">1</span>)+<span class="number">1</span>]=<span class="number">65535</span>,i=<span class="number">0</span>;i&lt;=a;i++)(n=r),(r=e[<span class="number">2</span>*(i+<span class="number">1</span>)+<span class="number">1</span>]),(++o&lt;l&amp;&amp;n===r)||(o&lt;h?(t.<span class="property">bl_tree</span>[<span class="number">2</span>*n]+=o):<span class="number">0</span>!==n?(n!==s&amp;&amp;t.<span class="property">bl_tree</span>[<span class="number">2</span>*n]++,t.<span class="property">bl_tree</span>[<span class="number">32</span>]++):o&lt;=<span class="number">10</span>?t.<span class="property">bl_tree</span>[<span class="number">34</span>]++:t.<span class="property">bl_tree</span>[<span class="number">36</span>]++,(o=<span class="number">0</span>),(s=n),<span class="number">0</span>===r?((l=<span class="number">138</span>),(h=<span class="number">3</span>)):n===r?((l=<span class="number">6</span>),(h=<span class="number">3</span>)):((l=<span class="number">7</span>),(h=<span class="number">4</span>)))&#125;,I=<span class="function">(<span class="params">t,e,a</span>)=&gt;</span>&#123;<span class="keyword">let</span> i,n,s=-<span class="number">1</span>,r=e[<span class="number">1</span>],o=<span class="number">0</span>,l=<span class="number">7</span>,h=<span class="number">4</span>;<span class="keyword">for</span>(<span class="number">0</span>===r&amp;&amp;((l=<span class="number">138</span>),(h=<span class="number">3</span>)),i=<span class="number">0</span>;i&lt;=a;i++)<span class="keyword">if</span>(((n=r),(r=e[<span class="number">2</span>*(i+<span class="number">1</span>)+<span class="number">1</span>]),!(++o&lt;l&amp;&amp;n===r)))&#123;<span class="keyword">if</span>(o&lt;h)<span class="keyword">do</span>&#123;<span class="title function_">z</span>(t,n,t.<span class="property">bl_tree</span>)&#125;<span class="keyword">while</span>(<span class="number">0</span>!=--o);<span class="keyword">else</span> <span class="number">0</span>!==n?(n!==s&amp;&amp;(<span class="title function_">z</span>(t,n,t.<span class="property">bl_tree</span>),o--),<span class="title function_">z</span>(t,<span class="number">16</span>,t.<span class="property">bl_tree</span>),<span class="title function_">x</span>(t,o-<span class="number">3</span>,<span class="number">2</span>)):o&lt;=<span class="number">10</span>?(<span class="title function_">z</span>(t,<span class="number">17</span>,t.<span class="property">bl_tree</span>),<span class="title function_">x</span>(t,o-<span class="number">3</span>,<span class="number">3</span>)):(<span class="title function_">z</span>(t,<span class="number">18</span>,t.<span class="property">bl_tree</span>),<span class="title function_">x</span>(t,o-<span class="number">11</span>,<span class="number">7</span>));(o=<span class="number">0</span>),(s=n),<span class="number">0</span>===r?((l=<span class="number">138</span>),(h=<span class="number">3</span>)):n===r?((l=<span class="number">6</span>),(h=<span class="number">3</span>)):((l=<span class="number">7</span>),(h=<span class="number">4</span>))&#125;&#125;;<span class="keyword">let</span> F=!<span class="number">1</span>;<span class="keyword">const</span> <span class="title function_">L</span>=(<span class="params">t,e,a,i</span>)=&gt;&#123;<span class="title function_">x</span>(t,<span class="number">0</span>+(i?<span class="number">1</span>:<span class="number">0</span>),<span class="number">3</span>),<span class="title function_">Z</span>(t),<span class="title function_">y</span>(t,a),<span class="title function_">y</span>(t,~a),a&amp;&amp;t.<span class="property">pending_buf</span>.<span class="title function_">set</span>(t.<span class="property">window</span>.<span class="title function_">subarray</span>(e,e+a),t.<span class="property">pending</span>),(t.<span class="property">pending</span>+=a)&#125;;<span class="keyword">var</span> <span class="title function_">N</span>=(<span class="params">t,e,i,n</span>)=&gt;&#123;<span class="keyword">let</span> s,r,o=<span class="number">0</span>;t.<span class="property">level</span>&gt;<span class="number">0</span>?(<span class="number">2</span>===t.<span class="property">strm</span>.<span class="property">data_type</span>&amp;&amp;(t.<span class="property">strm</span>.<span class="property">data_type</span>=(<span class="function">(<span class="params">t</span>)=&gt;</span>&#123;<span class="keyword">let</span> e,i=<span class="number">4093624447</span>;<span class="keyword">for</span>(e=<span class="number">0</span>;e&lt;=<span class="number">31</span>;e++,i&gt;&gt;&gt;=<span class="number">1</span>)<span class="keyword">if</span>(<span class="number">1</span>&amp;i&amp;&amp;<span class="number">0</span>!==t.<span class="property">dyn_ltree</span>[<span class="number">2</span>*e])<span class="keyword">return</span> <span class="number">0</span>;<span class="keyword">if</span>(<span class="number">0</span>!==t.<span class="property">dyn_ltree</span>[<span class="number">18</span>]||<span class="number">0</span>!==t.<span class="property">dyn_ltree</span>[<span class="number">20</span>]||<span class="number">0</span>!==t.<span class="property">dyn_ltree</span>[<span class="number">26</span>])<span class="keyword">return</span> <span class="number">1</span>;<span class="keyword">for</span>(e=<span class="number">32</span>;e&lt;a;e++)<span class="keyword">if</span>(<span class="number">0</span>!==t.<span class="property">dyn_ltree</span>[<span class="number">2</span>*e])<span class="keyword">return</span> <span class="number">1</span>;<span class="keyword">return</span> <span class="number">0</span>&#125;)(t)),<span class="title function_">T</span>(t,t.<span class="property">l_desc</span>),<span class="title function_">T</span>(t,t.<span class="property">d_desc</span>),(o=(<span class="function">(<span class="params">t</span>)=&gt;</span>&#123;<span class="keyword">let</span> e;<span class="keyword">for</span>(<span class="title function_">O</span>(t,t.<span class="property">dyn_ltree</span>,t.<span class="property">l_desc</span>.<span class="property">max_code</span>),<span class="title function_">O</span>(t,t.<span class="property">dyn_dtree</span>,t.<span class="property">d_desc</span>.<span class="property">max_code</span>),<span class="title function_">T</span>(t,t.<span class="property">bl_desc</span>),e=<span class="number">18</span>;e&gt;=<span class="number">3</span>&amp;&amp;<span class="number">0</span>===t.<span class="property">bl_tree</span>[<span class="number">2</span>*h[e]+<span class="number">1</span>];e--);<span class="keyword">return</span>(t.<span class="property">opt_len</span>+=<span class="number">3</span>*(e+<span class="number">1</span>)+<span class="number">5</span>+<span class="number">5</span>+<span class="number">4</span>),e&#125;)(t)),(s=(t.<span class="property">opt_len</span>+<span class="number">3</span>+<span class="number">7</span>)&gt;&gt;&gt;<span class="number">3</span>),(r=(t.<span class="property">static_len</span>+<span class="number">3</span>+<span class="number">7</span>)&gt;&gt;&gt;<span class="number">3</span>),r&lt;=s&amp;&amp;(s=r)):(s=r=i+<span class="number">5</span>),i+<span class="number">4</span>&lt;=s&amp;&amp;-<span class="number">1</span>!==e?<span class="title function_">L</span>(t,e,i,n):<span class="number">4</span>===t.<span class="property">strategy</span>||r===s?(<span class="title function_">x</span>(t,<span class="number">2</span>+(n?<span class="number">1</span>:<span class="number">0</span>),<span class="number">3</span>),<span class="title function_">D</span>(t,d,_)):(<span class="title function_">x</span>(t,<span class="number">4</span>+(n?<span class="number">1</span>:<span class="number">0</span>),<span class="number">3</span>),(<span class="function">(<span class="params">t,e,a,i</span>)=&gt;</span>&#123;<span class="keyword">let</span> n;<span class="keyword">for</span>(<span class="title function_">x</span>(t,e-<span class="number">257</span>,<span class="number">5</span>),<span class="title function_">x</span>(t,a-<span class="number">1</span>,<span class="number">5</span>),<span class="title function_">x</span>(t,i-<span class="number">4</span>,<span class="number">4</span>),n=<span class="number">0</span>;n&lt;i;n++)<span class="title function_">x</span>(t,t.<span class="property">bl_tree</span>[<span class="number">2</span>*h[n]+<span class="number">1</span>],<span class="number">3</span>);<span class="title function_">I</span>(t,t.<span class="property">dyn_ltree</span>,e-<span class="number">1</span>),<span class="title function_">I</span>(t,t.<span class="property">dyn_dtree</span>,a-<span class="number">1</span>)&#125;)(t,t.<span class="property">l_desc</span>.<span class="property">max_code</span>+<span class="number">1</span>,t.<span class="property">d_desc</span>.<span class="property">max_code</span>+<span class="number">1</span>,o+<span class="number">1</span>),<span class="title function_">D</span>(t,t.<span class="property">dyn_ltree</span>,t.<span class="property">dyn_dtree</span>)),<span class="title function_">R</span>(t),n&amp;&amp;<span class="title function_">Z</span>(t)&#125;,B=&#123;<span class="attr">_tr_init</span>:<span class="function">(<span class="params">t</span>)=&gt;</span>&#123;F||((<span class="function">()=&gt;</span>&#123;<span class="keyword">let</span> t,e,a,h,k;<span class="keyword">const</span> v=<span class="keyword">new</span> <span class="title class_">Array</span>(<span class="number">16</span>);<span class="keyword">for</span>(a=<span class="number">0</span>,h=<span class="number">0</span>;h&lt;<span class="number">28</span>;h++)<span class="keyword">for</span>(u[h]=a,t=<span class="number">0</span>;t&lt;<span class="number">1</span>&lt;&lt;r[h];t++)c[a++]=h;<span class="keyword">for</span>(c[a-<span class="number">1</span>]=h,k=<span class="number">0</span>,h=<span class="number">0</span>;h&lt;<span class="number">16</span>;h++)<span class="keyword">for</span>(w[h]=k,t=<span class="number">0</span>;t&lt;<span class="number">1</span>&lt;&lt;o[h];t++)f[k++]=h;<span class="keyword">for</span>(k&gt;&gt;=<span class="number">7</span>;h&lt;n;h++)<span class="keyword">for</span>(w[h]=k&lt;&lt;<span class="number">7</span>,t=<span class="number">0</span>;t&lt;<span class="number">1</span>&lt;&lt;(o[h]-<span class="number">7</span>);t++)f[<span class="number">256</span>+k++]=h;<span class="keyword">for</span>(e=<span class="number">0</span>;e&lt;=s;e++)v[e]=<span class="number">0</span>;<span class="keyword">for</span>(t=<span class="number">0</span>;t&lt;=<span class="number">143</span>;)(d[<span class="number">2</span>*t+<span class="number">1</span>]=<span class="number">8</span>),t++,v[<span class="number">8</span>]++;<span class="keyword">for</span>(;t&lt;=<span class="number">255</span>;)(d[<span class="number">2</span>*t+<span class="number">1</span>]=<span class="number">9</span>),t++,v[<span class="number">9</span>]++;<span class="keyword">for</span>(;t&lt;=<span class="number">279</span>;)(d[<span class="number">2</span>*t+<span class="number">1</span>]=<span class="number">7</span>),t++,v[<span class="number">7</span>]++;<span class="keyword">for</span>(;t&lt;=<span class="number">287</span>;)(d[<span class="number">2</span>*t+<span class="number">1</span>]=<span class="number">8</span>),t++,v[<span class="number">8</span>]++;<span class="keyword">for</span>(<span class="title function_">E</span>(d,<span class="number">287</span>,v),t=<span class="number">0</span>;t&lt;n;t++)(_[<span class="number">2</span>*t+<span class="number">1</span>]=<span class="number">5</span>),(_[<span class="number">2</span>*t]=<span class="title function_">A</span>(t,<span class="number">5</span>));(b=<span class="keyword">new</span> <span class="title function_">m</span>(d,r,<span class="number">257</span>,i,s)),(g=<span class="keyword">new</span> <span class="title function_">m</span>(_,o,<span class="number">0</span>,n,s)),(p=<span class="keyword">new</span> <span class="title function_">m</span>(<span class="keyword">new</span> <span class="title class_">Array</span>(<span class="number">0</span>),l,<span class="number">0</span>,<span class="number">19</span>,<span class="number">7</span>))&#125;)(),(F=!<span class="number">0</span>)),(t.<span class="property">l_desc</span>=<span class="keyword">new</span> <span class="title function_">k</span>(t.<span class="property">dyn_ltree</span>,b)),(t.<span class="property">d_desc</span>=<span class="keyword">new</span> <span class="title function_">k</span>(t.<span class="property">dyn_dtree</span>,g)),(t.<span class="property">bl_desc</span>=<span class="keyword">new</span> <span class="title function_">k</span>(t.<span class="property">bl_tree</span>,p)),(t.<span class="property">bi_buf</span>=<span class="number">0</span>),(t.<span class="property">bi_valid</span>=<span class="number">0</span>),<span class="title function_">R</span>(t)&#125;,<span class="attr">_tr_stored_block</span>:L,<span class="attr">_tr_flush_block</span>:N,<span class="attr">_tr_tally</span>:<span class="function">(<span class="params">t,e,i</span>)=&gt;</span>((t.<span class="property">pending_buf</span>[t.<span class="property">sym_buf</span>+t.<span class="property">sym_next</span>++]=e),(t.<span class="property">pending_buf</span>[t.<span class="property">sym_buf</span>+t.<span class="property">sym_next</span>++]=e&gt;&gt;<span class="number">8</span>),(t.<span class="property">pending_buf</span>[t.<span class="property">sym_buf</span>+t.<span class="property">sym_next</span>++]=i),<span class="number">0</span>===e?t.<span class="property">dyn_ltree</span>[<span class="number">2</span>*i]++:(t.<span class="property">matches</span>++,e--,t.<span class="property">dyn_ltree</span>[<span class="number">2</span>*(c[i]+a+<span class="number">1</span>)]++,t.<span class="property">dyn_dtree</span>[<span class="number">2</span>*<span class="title function_">v</span>(e)]++),t.<span class="property">sym_next</span>===t.<span class="property">sym_end</span>),<span class="attr">_tr_align</span>:<span class="function">(<span class="params">t</span>)=&gt;</span>&#123;<span class="title function_">x</span>(t,<span class="number">2</span>,<span class="number">3</span>),<span class="title function_">z</span>(t,<span class="number">256</span>,d),(<span class="function">(<span class="params">t</span>)=&gt;</span>&#123;<span class="number">16</span>===t.<span class="property">bi_valid</span>?(<span class="title function_">y</span>(t,t.<span class="property">bi_buf</span>),(t.<span class="property">bi_buf</span>=<span class="number">0</span>),(t.<span class="property">bi_valid</span>=<span class="number">0</span>)):t.<span class="property">bi_valid</span>&gt;=<span class="number">8</span>&amp;&amp;((t.<span class="property">pending_buf</span>[t.<span class="property">pending</span>++]=<span class="number">255</span>&amp;t.<span class="property">bi_buf</span>),(t.<span class="property">bi_buf</span>&gt;&gt;=<span class="number">8</span>),(t.<span class="property">bi_valid</span>-=<span class="number">8</span>))&#125;)(t)&#125;&#125;;<span class="keyword">var</span> <span class="title function_">C</span>=(<span class="params">t,e,a,i</span>)=&gt;&#123;<span class="keyword">let</span> n=(<span class="number">65535</span>&amp;t)|<span class="number">0</span>,s=((t&gt;&gt;&gt;<span class="number">16</span>)&amp;<span class="number">65535</span>)|<span class="number">0</span>,r=<span class="number">0</span>;<span class="keyword">for</span>(;<span class="number">0</span>!==a;)&#123;(r=a&gt;<span class="number">2e3</span>?<span class="number">2e3</span>:a),(a-=r);<span class="keyword">do</span>&#123;(n=(n+e[i++])|<span class="number">0</span>),(s=(s+n)|<span class="number">0</span>)&#125;<span class="keyword">while</span>(--r);(n%=<span class="number">65521</span>),(s%=<span class="number">65521</span>)&#125;<span class="keyword">return</span> n|(s&lt;&lt;<span class="number">16</span>)|<span class="number">0</span>&#125;;<span class="keyword">const</span> M=<span class="keyword">new</span> <span class="title class_">Uint32Array</span>((<span class="function">()=&gt;</span>&#123;<span class="keyword">let</span> t,e=[];<span class="keyword">for</span>(<span class="keyword">var</span> a=<span class="number">0</span>;a&lt;<span class="number">256</span>;a++)&#123;t=a;<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;<span class="number">8</span>;i++)t=<span class="number">1</span>&amp;t?<span class="number">3988292384</span>^(t&gt;&gt;&gt;<span class="number">1</span>):t&gt;&gt;&gt;<span class="number">1</span>;e[a]=t&#125;<span class="keyword">return</span> e&#125;)());<span class="keyword">var</span> <span class="title function_">H</span>=(<span class="params">t,e,a,i</span>)=&gt;&#123;<span class="keyword">const</span> n=M,s=i+a;t^=-<span class="number">1</span>;<span class="keyword">for</span>(<span class="keyword">let</span> a=i;a&lt;s;a++)t=(t&gt;&gt;&gt;<span class="number">8</span>)^n[<span class="number">255</span>&amp;(t^e[a])];<span class="keyword">return</span>-<span class="number">1</span>^t&#125;,j=&#123;<span class="number">2</span>:<span class="string">&#x27;need dictionary&#x27;</span>,<span class="number">1</span>:<span class="string">&#x27;stream end&#x27;</span>,<span class="number">0</span>:<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;-1&#x27;</span>:<span class="string">&#x27;file error&#x27;</span>,<span class="string">&#x27;-2&#x27;</span>:<span class="string">&#x27;stream error&#x27;</span>,<span class="string">&#x27;-3&#x27;</span>:<span class="string">&#x27;data error&#x27;</span>,<span class="string">&#x27;-4&#x27;</span>:<span class="string">&#x27;insufficient memory&#x27;</span>,<span class="string">&#x27;-5&#x27;</span>:<span class="string">&#x27;buffer error&#x27;</span>,<span class="string">&#x27;-6&#x27;</span>:<span class="string">&#x27;incompatible version&#x27;</span>&#125;,K=&#123;<span class="attr">Z_NO_FLUSH</span>:<span class="number">0</span>,<span class="attr">Z_PARTIAL_FLUSH</span>:<span class="number">1</span>,<span class="attr">Z_SYNC_FLUSH</span>:<span class="number">2</span>,<span class="attr">Z_FULL_FLUSH</span>:<span class="number">3</span>,<span class="attr">Z_FINISH</span>:<span class="number">4</span>,<span class="attr">Z_BLOCK</span>:<span class="number">5</span>,<span class="attr">Z_TREES</span>:<span class="number">6</span>,<span class="attr">Z_OK</span>:<span class="number">0</span>,<span class="attr">Z_STREAM_END</span>:<span class="number">1</span>,<span class="attr">Z_NEED_DICT</span>:<span class="number">2</span>,<span class="attr">Z_ERRNO</span>:-<span class="number">1</span>,<span class="attr">Z_STREAM_ERROR</span>:-<span class="number">2</span>,<span class="attr">Z_DATA_ERROR</span>:-<span class="number">3</span>,<span class="attr">Z_MEM_ERROR</span>:-<span class="number">4</span>,<span class="attr">Z_BUF_ERROR</span>:-<span class="number">5</span>,<span class="attr">Z_NO_COMPRESSION</span>:<span class="number">0</span>,<span class="attr">Z_BEST_SPEED</span>:<span class="number">1</span>,<span class="attr">Z_BEST_COMPRESSION</span>:<span class="number">9</span>,<span class="attr">Z_DEFAULT_COMPRESSION</span>:-<span class="number">1</span>,<span class="attr">Z_FILTERED</span>:<span class="number">1</span>,<span class="attr">Z_HUFFMAN_ONLY</span>:<span class="number">2</span>,<span class="attr">Z_RLE</span>:<span class="number">3</span>,<span class="attr">Z_FIXED</span>:<span class="number">4</span>,<span class="attr">Z_DEFAULT_STRATEGY</span>:<span class="number">0</span>,<span class="attr">Z_BINARY</span>:<span class="number">0</span>,<span class="attr">Z_TEXT</span>:<span class="number">1</span>,<span class="attr">Z_UNKNOWN</span>:<span class="number">2</span>,<span class="attr">Z_DEFLATED</span>:<span class="number">8</span>&#125;;<span class="keyword">const</span>&#123;<span class="attr">_tr_init</span>:P,<span class="attr">_tr_stored_block</span>:Y,<span class="attr">_tr_flush_block</span>:G,<span class="attr">_tr_tally</span>:X,<span class="attr">_tr_align</span>:W&#125;=B,&#123;<span class="attr">Z_NO_FLUSH</span>:q,<span class="attr">Z_PARTIAL_FLUSH</span>:J,<span class="attr">Z_FULL_FLUSH</span>:Q,<span class="attr">Z_FINISH</span>:V,<span class="attr">Z_BLOCK</span>:$,<span class="attr">Z_OK</span>:tt,<span class="attr">Z_STREAM_END</span>:et,<span class="attr">Z_STREAM_ERROR</span>:at,<span class="attr">Z_DATA_ERROR</span>:it,<span class="attr">Z_BUF_ERROR</span>:nt,<span class="attr">Z_DEFAULT_COMPRESSION</span>:st,<span class="attr">Z_FILTERED</span>:rt,<span class="attr">Z_HUFFMAN_ONLY</span>:ot,<span class="attr">Z_RLE</span>:lt,<span class="attr">Z_FIXED</span>:ht,<span class="attr">Z_DEFAULT_STRATEGY</span>:dt,<span class="attr">Z_UNKNOWN</span>:_t,<span class="attr">Z_DEFLATED</span>:ft&#125;=K,ct=<span class="number">258</span>,ut=<span class="number">262</span>,wt=<span class="number">42</span>,mt=<span class="number">113</span>,bt=<span class="number">666</span>,gt=<span class="function">(<span class="params">t,e</span>)=&gt;</span>((t.<span class="property">msg</span>=j[e]),e),pt=<span class="function">(<span class="params">t</span>)=&gt;</span><span class="number">2</span>*t-(t&gt;<span class="number">4</span>?<span class="number">9</span>:<span class="number">0</span>),kt=<span class="function">(<span class="params">t</span>)=&gt;</span>&#123;<span class="keyword">let</span> e=t.<span class="property">length</span>;<span class="keyword">for</span>(;--e&gt;=<span class="number">0</span>;)t[e]=<span class="number">0</span>&#125;,vt=<span class="function">(<span class="params">t</span>)=&gt;</span>&#123;<span class="keyword">let</span> e,a,i,n=t.<span class="property">w_size</span>;(e=t.<span class="property">hash_size</span>),(i=e);<span class="keyword">do</span>&#123;(a=t.<span class="property">head</span>[--i]),(t.<span class="property">head</span>[i]=a&gt;=n?a-<span class="attr">n</span>:<span class="number">0</span>)&#125;<span class="keyword">while</span>(--e);(e=n),(i=e);<span class="keyword">do</span>&#123;(a=t.<span class="property">prev</span>[--i]),(t.<span class="property">prev</span>[i]=a&gt;=n?a-<span class="attr">n</span>:<span class="number">0</span>)&#125;<span class="keyword">while</span>(--e)&#125;;<span class="keyword">let</span> <span class="title function_">yt</span>=(<span class="params">t,e,a</span>)=&gt;((e&lt;&lt;t.<span class="property">hash_shift</span>)^a)&amp;t.<span class="property">hash_mask</span>;<span class="keyword">const</span> <span class="title function_">xt</span>=(<span class="params">t</span>)=&gt;&#123;<span class="keyword">const</span> e=t.<span class="property">state</span>;<span class="keyword">let</span> a=e.<span class="property">pending</span>;a&gt;t.<span class="property">avail_out</span>&amp;&amp;(a=t.<span class="property">avail_out</span>),<span class="number">0</span>!==a&amp;&amp;(t.<span class="property">output</span>.<span class="title function_">set</span>(e.<span class="property">pending_buf</span>.<span class="title function_">subarray</span>(e.<span class="property">pending_out</span>,e.<span class="property">pending_out</span>+a),t.<span class="property">next_out</span>),(t.<span class="property">next_out</span>+=a),(e.<span class="property">pending_out</span>+=a),(t.<span class="property">total_out</span>+=a),(t.<span class="property">avail_out</span>-=a),(e.<span class="property">pending</span>-=a),<span class="number">0</span>===e.<span class="property">pending</span>&amp;&amp;(e.<span class="property">pending_out</span>=<span class="number">0</span>))&#125;,zt=<span class="function">(<span class="params">t,e</span>)=&gt;</span>&#123;<span class="title function_">G</span>(t,t.<span class="property">block_start</span>&gt;=<span class="number">0</span>?t.<span class="property">block_start</span>:-<span class="number">1</span>,t.<span class="property">strstart</span>-t.<span class="property">block_start</span>,e),(t.<span class="property">block_start</span>=t.<span class="property">strstart</span>),<span class="title function_">xt</span>(t.<span class="property">strm</span>)&#125;,<span class="title class_">At</span>=<span class="function">(<span class="params">t,e</span>)=&gt;</span>&#123;t.<span class="property">pending_buf</span>[t.<span class="property">pending</span>++]=e&#125;,<span class="title class_">Et</span>=<span class="function">(<span class="params">t,e</span>)=&gt;</span>&#123;(t.<span class="property">pending_buf</span>[t.<span class="property">pending</span>++]=(e&gt;&gt;&gt;<span class="number">8</span>)&amp;<span class="number">255</span>),(t.<span class="property">pending_buf</span>[t.<span class="property">pending</span>++]=<span class="number">255</span>&amp;e)&#125;,<span class="title class_">Rt</span>=<span class="function">(<span class="params">t,e,a,i</span>)=&gt;</span>&#123;<span class="keyword">let</span> n=t.<span class="property">avail_in</span>;<span class="keyword">return</span>(n&gt;i&amp;&amp;(n=i),<span class="number">0</span>===n?<span class="number">0</span>:((t.<span class="property">avail_in</span>-=n),e.<span class="title function_">set</span>(t.<span class="property">input</span>.<span class="title function_">subarray</span>(t.<span class="property">next_in</span>,t.<span class="property">next_in</span>+n),a),<span class="number">1</span>===t.<span class="property">state</span>.<span class="property">wrap</span>?(t.<span class="property">adler</span>=<span class="title function_">C</span>(t.<span class="property">adler</span>,e,n,a)):<span class="number">2</span>===t.<span class="property">state</span>.<span class="property">wrap</span>&amp;&amp;(t.<span class="property">adler</span>=<span class="title function_">H</span>(t.<span class="property">adler</span>,e,n,a)),(t.<span class="property">next_in</span>+=n),(t.<span class="property">total_in</span>+=n),n))&#125;,<span class="title class_">Zt</span>=<span class="function">(<span class="params">t,e</span>)=&gt;</span>&#123;<span class="keyword">let</span> a,i,n=t.<span class="property">max_chain_length</span>,s=t.<span class="property">strstart</span>,r=t.<span class="property">prev_length</span>,o=t.<span class="property">nice_match</span>;<span class="keyword">const</span> l=t.<span class="property">strstart</span>&gt;t.<span class="property">w_size</span>-ut?t.<span class="property">strstart</span>-(t.<span class="property">w_size</span>-ut):<span class="number">0</span>,h=t.<span class="property">window</span>,d=t.<span class="property">w_mask</span>,_=t.<span class="property">prev</span>,f=t.<span class="property">strstart</span>+ct;<span class="keyword">let</span> c=h[s+r-<span class="number">1</span>],u=h[s+r];t.<span class="property">prev_length</span>&gt;=t.<span class="property">good_match</span>&amp;&amp;(n&gt;&gt;=<span class="number">2</span>),o&gt;t.<span class="property">lookahead</span>&amp;&amp;(o=t.<span class="property">lookahead</span>);<span class="keyword">do</span>&#123;<span class="keyword">if</span>(((a=e),h[a+r]===u&amp;&amp;h[a+r-<span class="number">1</span>]===c&amp;&amp;h[a]===h[s]&amp;&amp;h[++a]===h[s+<span class="number">1</span>]))&#123;(s+=<span class="number">2</span>),a++;<span class="keyword">do</span>&#123;&#125;<span class="keyword">while</span>(h[++s]===h[++a]&amp;&amp;h[++s]===h[++a]&amp;&amp;h[++s]===h[++a]&amp;&amp;h[++s]===h[++a]&amp;&amp;h[++s]===h[++a]&amp;&amp;h[++s]===h[++a]&amp;&amp;h[++s]===h[++a]&amp;&amp;h[++s]===h[++a]&amp;&amp;s&lt;f);<span class="keyword">if</span>(((i=ct-(f-s)),(s=f-ct),i&gt;r))&#123;<span class="keyword">if</span>(((t.<span class="property">match_start</span>=e),(r=i),i&gt;=o))<span class="keyword">break</span>;(c=h[s+r-<span class="number">1</span>]),(u=h[s+r])&#125;&#125;&#125;<span class="keyword">while</span>((e=_[e&amp;d])&gt;l&amp;&amp;<span class="number">0</span>!=--n);<span class="keyword">return</span> r&lt;=t.<span class="property">lookahead</span>?<span class="attr">r</span>:t.<span class="property">lookahead</span>&#125;,<span class="title class_">Ut</span>=<span class="function">(<span class="params">t</span>)=&gt;</span>&#123;<span class="keyword">const</span> e=t.<span class="property">w_size</span>;<span class="keyword">let</span> a,i,n;<span class="keyword">do</span>&#123;<span class="keyword">if</span>(((i=t.<span class="property">window_size</span>-t.<span class="property">lookahead</span>-t.<span class="property">strstart</span>),t.<span class="property">strstart</span>&gt;=e+(e-ut)&amp;&amp;(t.<span class="property">window</span>.<span class="title function_">set</span>(t.<span class="property">window</span>.<span class="title function_">subarray</span>(e,e+e-i),<span class="number">0</span>),(t.<span class="property">match_start</span>-=e),(t.<span class="property">strstart</span>-=e),(t.<span class="property">block_start</span>-=e),t.<span class="property">insert</span>&gt;t.<span class="property">strstart</span>&amp;&amp;(t.<span class="property">insert</span>=t.<span class="property">strstart</span>),<span class="title function_">vt</span>(t),(i+=e)),<span class="number">0</span>===t.<span class="property">strm</span>.<span class="property">avail_in</span>))<span class="keyword">break</span>;<span class="keyword">if</span>(((a=<span class="title class_">Rt</span>(t.<span class="property">strm</span>,t.<span class="property">window</span>,t.<span class="property">strstart</span>+t.<span class="property">lookahead</span>,i)),(t.<span class="property">lookahead</span>+=a),t.<span class="property">lookahead</span>+t.<span class="property">insert</span>&gt;=<span class="number">3</span>))<span class="keyword">for</span>(n=t.<span class="property">strstart</span>-t.<span class="property">insert</span>,t.<span class="property">ins_h</span>=t.<span class="property">window</span>[n],t.<span class="property">ins_h</span>=<span class="title function_">yt</span>(t,t.<span class="property">ins_h</span>,t.<span class="property">window</span>[n+<span class="number">1</span>]);t.<span class="property">insert</span>&amp;&amp;((t.<span class="property">ins_h</span>=<span class="title function_">yt</span>(t,t.<span class="property">ins_h</span>,t.<span class="property">window</span>[n+<span class="number">3</span>-<span class="number">1</span>])),(t.<span class="property">prev</span>[n&amp;t.<span class="property">w_mask</span>]=t.<span class="property">head</span>[t.<span class="property">ins_h</span>]),(t.<span class="property">head</span>[t.<span class="property">ins_h</span>]=n),n++,t.<span class="property">insert</span>--,!(t.<span class="property">lookahead</span>+t.<span class="property">insert</span>&lt;<span class="number">3</span>));)&#125;<span class="keyword">while</span>(t.<span class="property">lookahead</span>&lt;ut&amp;&amp;<span class="number">0</span>!==t.<span class="property">strm</span>.<span class="property">avail_in</span>)&#125;,<span class="title class_">St</span>=<span class="function">(<span class="params">t,e</span>)=&gt;</span>&#123;<span class="keyword">let</span> a,i,n,s=t.<span class="property">pending_buf_size</span>-<span class="number">5</span>&gt;t.<span class="property">w_size</span>?t.<span class="property">w_size</span>:t.<span class="property">pending_buf_size</span>-<span class="number">5</span>,r=<span class="number">0</span>,o=t.<span class="property">strm</span>.<span class="property">avail_in</span>;<span class="keyword">do</span>&#123;<span class="keyword">if</span>(((a=<span class="number">65535</span>),(n=(t.<span class="property">bi_valid</span>+<span class="number">42</span>)&gt;&gt;<span class="number">3</span>),t.<span class="property">strm</span>.<span class="property">avail_out</span>&lt;n))<span class="keyword">break</span>;<span class="keyword">if</span>(((n=t.<span class="property">strm</span>.<span class="property">avail_out</span>-n),(i=t.<span class="property">strstart</span>-t.<span class="property">block_start</span>),a&gt;i+t.<span class="property">strm</span>.<span class="property">avail_in</span>&amp;&amp;(a=i+t.<span class="property">strm</span>.<span class="property">avail_in</span>),a&gt;n&amp;&amp;(a=n),a&lt;s&amp;&amp;((<span class="number">0</span>===a&amp;&amp;e!==V)||e===q||a!==i+t.<span class="property">strm</span>.<span class="property">avail_in</span>)))<span class="keyword">break</span>;(r=e===V&amp;&amp;a===i+t.<span class="property">strm</span>.<span class="property">avail_in</span>?<span class="number">1</span>:<span class="number">0</span>),<span class="title function_">Y</span>(t,<span class="number">0</span>,<span class="number">0</span>,r),(t.<span class="property">pending_buf</span>[t.<span class="property">pending</span>-<span class="number">4</span>]=a),(t.<span class="property">pending_buf</span>[t.<span class="property">pending</span>-<span class="number">3</span>]=a&gt;&gt;<span class="number">8</span>),(t.<span class="property">pending_buf</span>[t.<span class="property">pending</span>-<span class="number">2</span>]=~a),(t.<span class="property">pending_buf</span>[t.<span class="property">pending</span>-<span class="number">1</span>]=~a&gt;&gt;<span class="number">8</span>),<span class="title function_">xt</span>(t.<span class="property">strm</span>),i&amp;&amp;(i&gt;a&amp;&amp;(i=a),t.<span class="property">strm</span>.<span class="property">output</span>.<span class="title function_">set</span>(t.<span class="property">window</span>.<span class="title function_">subarray</span>(t.<span class="property">block_start</span>,t.<span class="property">block_start</span>+i),t.<span class="property">strm</span>.<span class="property">next_out</span>),(t.<span class="property">strm</span>.<span class="property">next_out</span>+=i),(t.<span class="property">strm</span>.<span class="property">avail_out</span>-=i),(t.<span class="property">strm</span>.<span class="property">total_out</span>+=i),(t.<span class="property">block_start</span>+=i),(a-=i)),a&amp;&amp;(<span class="title class_">Rt</span>(t.<span class="property">strm</span>,t.<span class="property">strm</span>.<span class="property">output</span>,t.<span class="property">strm</span>.<span class="property">next_out</span>,a),(t.<span class="property">strm</span>.<span class="property">next_out</span>+=a),(t.<span class="property">strm</span>.<span class="property">avail_out</span>-=a),(t.<span class="property">strm</span>.<span class="property">total_out</span>+=a))&#125;<span class="keyword">while</span>(<span class="number">0</span>===r);<span class="keyword">return</span>((o-=t.<span class="property">strm</span>.<span class="property">avail_in</span>),o&amp;&amp;(o&gt;=t.<span class="property">w_size</span>?((t.<span class="property">matches</span>=<span class="number">2</span>),t.<span class="property">window</span>.<span class="title function_">set</span>(t.<span class="property">strm</span>.<span class="property">input</span>.<span class="title function_">subarray</span>(t.<span class="property">strm</span>.<span class="property">next_in</span>-t.<span class="property">w_size</span>,t.<span class="property">strm</span>.<span class="property">next_in</span>),<span class="number">0</span>),(t.<span class="property">strstart</span>=t.<span class="property">w_size</span>),(t.<span class="property">insert</span>=t.<span class="property">strstart</span>)):(t.<span class="property">window_size</span>-t.<span class="property">strstart</span>&lt;=o&amp;&amp;((t.<span class="property">strstart</span>-=t.<span class="property">w_size</span>),t.<span class="property">window</span>.<span class="title function_">set</span>(t.<span class="property">window</span>.<span class="title function_">subarray</span>(t.<span class="property">w_size</span>,t.<span class="property">w_size</span>+t.<span class="property">strstart</span>),<span class="number">0</span>),t.<span class="property">matches</span>&lt;<span class="number">2</span>&amp;&amp;t.<span class="property">matches</span>++,t.<span class="property">insert</span>&gt;t.<span class="property">strstart</span>&amp;&amp;(t.<span class="property">insert</span>=t.<span class="property">strstart</span>)),t.<span class="property">window</span>.<span class="title function_">set</span>(t.<span class="property">strm</span>.<span class="property">input</span>.<span class="title function_">subarray</span>(t.<span class="property">strm</span>.<span class="property">next_in</span>-o,t.<span class="property">strm</span>.<span class="property">next_in</span>),t.<span class="property">strstart</span>),(t.<span class="property">strstart</span>+=o),(t.<span class="property">insert</span>+=o&gt;t.<span class="property">w_size</span>-t.<span class="property">insert</span>?t.<span class="property">w_size</span>-t.<span class="property">insert</span>:o)),(t.<span class="property">block_start</span>=t.<span class="property">strstart</span>)),t.<span class="property">high_water</span>&lt;t.<span class="property">strstart</span>&amp;&amp;(t.<span class="property">high_water</span>=t.<span class="property">strstart</span>),r?<span class="number">4</span>:e!==q&amp;&amp;e!==V&amp;&amp;<span class="number">0</span>===t.<span class="property">strm</span>.<span class="property">avail_in</span>&amp;&amp;t.<span class="property">strstart</span>===t.<span class="property">block_start</span>?<span class="number">2</span>:((n=t.<span class="property">window_size</span>-t.<span class="property">strstart</span>),t.<span class="property">strm</span>.<span class="property">avail_in</span>&gt;n&amp;&amp;t.<span class="property">block_start</span>&gt;=t.<span class="property">w_size</span>&amp;&amp;((t.<span class="property">block_start</span>-=t.<span class="property">w_size</span>),(t.<span class="property">strstart</span>-=t.<span class="property">w_size</span>),t.<span class="property">window</span>.<span class="title function_">set</span>(t.<span class="property">window</span>.<span class="title function_">subarray</span>(t.<span class="property">w_size</span>,t.<span class="property">w_size</span>+t.<span class="property">strstart</span>),<span class="number">0</span>),t.<span class="property">matches</span>&lt;<span class="number">2</span>&amp;&amp;t.<span class="property">matches</span>++,(n+=t.<span class="property">w_size</span>),t.<span class="property">insert</span>&gt;t.<span class="property">strstart</span>&amp;&amp;(t.<span class="property">insert</span>=t.<span class="property">strstart</span>)),n&gt;t.<span class="property">strm</span>.<span class="property">avail_in</span>&amp;&amp;(n=t.<span class="property">strm</span>.<span class="property">avail_in</span>),n&amp;&amp;(<span class="title class_">Rt</span>(t.<span class="property">strm</span>,t.<span class="property">window</span>,t.<span class="property">strstart</span>,n),(t.<span class="property">strstart</span>+=n),(t.<span class="property">insert</span>+=n&gt;t.<span class="property">w_size</span>-t.<span class="property">insert</span>?t.<span class="property">w_size</span>-t.<span class="property">insert</span>:n)),t.<span class="property">high_water</span>&lt;t.<span class="property">strstart</span>&amp;&amp;(t.<span class="property">high_water</span>=t.<span class="property">strstart</span>),(n=(t.<span class="property">bi_valid</span>+<span class="number">42</span>)&gt;&gt;<span class="number">3</span>),(n=t.<span class="property">pending_buf_size</span>-n&gt;<span class="number">65535</span>?<span class="number">65535</span>:t.<span class="property">pending_buf_size</span>-n),(s=n&gt;t.<span class="property">w_size</span>?t.<span class="property">w_size</span>:n),(i=t.<span class="property">strstart</span>-t.<span class="property">block_start</span>),(i&gt;=s||((i||e===V)&amp;&amp;e!==q&amp;&amp;<span class="number">0</span>===t.<span class="property">strm</span>.<span class="property">avail_in</span>&amp;&amp;i&lt;=n))&amp;&amp;((a=i&gt;n?<span class="attr">n</span>:i),(r=e===V&amp;&amp;<span class="number">0</span>===t.<span class="property">strm</span>.<span class="property">avail_in</span>&amp;&amp;a===i?<span class="number">1</span>:<span class="number">0</span>),<span class="title function_">Y</span>(t,t.<span class="property">block_start</span>,a,r),(t.<span class="property">block_start</span>+=a),<span class="title function_">xt</span>(t.<span class="property">strm</span>)),r?<span class="number">3</span>:<span class="number">1</span>))&#125;,<span class="title class_">Dt</span>=<span class="function">(<span class="params">t,e</span>)=&gt;</span>&#123;<span class="keyword">let</span> a,i;<span class="keyword">for</span>(;;)&#123;<span class="keyword">if</span>(t.<span class="property">lookahead</span>&lt;ut)&#123;<span class="keyword">if</span>((<span class="title class_">Ut</span>(t),t.<span class="property">lookahead</span>&lt;ut&amp;&amp;e===q))<span class="keyword">return</span> <span class="number">1</span>;<span class="keyword">if</span>(<span class="number">0</span>===t.<span class="property">lookahead</span>)<span class="keyword">break</span>&#125;<span class="keyword">if</span>(((a=<span class="number">0</span>),t.<span class="property">lookahead</span>&gt;=<span class="number">3</span>&amp;&amp;((t.<span class="property">ins_h</span>=<span class="title function_">yt</span>(t,t.<span class="property">ins_h</span>,t.<span class="property">window</span>[t.<span class="property">strstart</span>+<span class="number">3</span>-<span class="number">1</span>])),(a=t.<span class="property">prev</span>[t.<span class="property">strstart</span>&amp;t.<span class="property">w_mask</span>]=t.<span class="property">head</span>[t.<span class="property">ins_h</span>]),(t.<span class="property">head</span>[t.<span class="property">ins_h</span>]=t.<span class="property">strstart</span>)),<span class="number">0</span>!==a&amp;&amp;t.<span class="property">strstart</span>-a&lt;=t.<span class="property">w_size</span>-ut&amp;&amp;(t.<span class="property">match_length</span>=<span class="title class_">Zt</span>(t,a)),t.<span class="property">match_length</span>&gt;=<span class="number">3</span>))<span class="keyword">if</span>(((i=<span class="title function_">X</span>(t,t.<span class="property">strstart</span>-t.<span class="property">match_start</span>,t.<span class="property">match_length</span>-<span class="number">3</span>)),(t.<span class="property">lookahead</span>-=t.<span class="property">match_length</span>),t.<span class="property">match_length</span>&lt;=t.<span class="property">max_lazy_match</span>&amp;&amp;t.<span class="property">lookahead</span>&gt;=<span class="number">3</span>))&#123;t.<span class="property">match_length</span>--;<span class="keyword">do</span>&#123;t.<span class="property">strstart</span>++,(t.<span class="property">ins_h</span>=<span class="title function_">yt</span>(t,t.<span class="property">ins_h</span>,t.<span class="property">window</span>[t.<span class="property">strstart</span>+<span class="number">3</span>-<span class="number">1</span>])),(a=t.<span class="property">prev</span>[t.<span class="property">strstart</span>&amp;t.<span class="property">w_mask</span>]=t.<span class="property">head</span>[t.<span class="property">ins_h</span>]),(t.<span class="property">head</span>[t.<span class="property">ins_h</span>]=t.<span class="property">strstart</span>)&#125;<span class="keyword">while</span>(<span class="number">0</span>!=--t.<span class="property">match_length</span>);t.<span class="property">strstart</span>++&#125;<span class="title function_">else</span>(t.<span class="property">strstart</span>+=t.<span class="property">match_length</span>),(t.<span class="property">match_length</span>=<span class="number">0</span>),(t.<span class="property">ins_h</span>=t.<span class="property">window</span>[t.<span class="property">strstart</span>]),(t.<span class="property">ins_h</span>=<span class="title function_">yt</span>(t,t.<span class="property">ins_h</span>,t.<span class="property">window</span>[t.<span class="property">strstart</span>+<span class="number">1</span>]));<span class="title function_">else</span>(i=<span class="title function_">X</span>(t,<span class="number">0</span>,t.<span class="property">window</span>[t.<span class="property">strstart</span>])),t.<span class="property">lookahead</span>--,t.<span class="property">strstart</span>++;<span class="keyword">if</span>(i&amp;&amp;(<span class="title function_">zt</span>(t,!<span class="number">1</span>),<span class="number">0</span>===t.<span class="property">strm</span>.<span class="property">avail_out</span>))<span class="keyword">return</span> <span class="number">1</span>&#125;<span class="keyword">return</span>((t.<span class="property">insert</span>=t.<span class="property">strstart</span>&lt;<span class="number">2</span>?t.<span class="property">strstart</span>:<span class="number">2</span>),e===V?(<span class="title function_">zt</span>(t,!<span class="number">0</span>),<span class="number">0</span>===t.<span class="property">strm</span>.<span class="property">avail_out</span>?<span class="number">3</span>:<span class="number">4</span>):t.<span class="property">sym_next</span>&amp;&amp;(<span class="title function_">zt</span>(t,!<span class="number">1</span>),<span class="number">0</span>===t.<span class="property">strm</span>.<span class="property">avail_out</span>)?<span class="number">1</span>:<span class="number">2</span>)&#125;,<span class="title class_">Tt</span>=<span class="function">(<span class="params">t,e</span>)=&gt;</span>&#123;<span class="keyword">let</span> a,i,n;<span class="keyword">for</span>(;;)&#123;<span class="keyword">if</span>(t.<span class="property">lookahead</span>&lt;ut)&#123;<span class="keyword">if</span>((<span class="title class_">Ut</span>(t),t.<span class="property">lookahead</span>&lt;ut&amp;&amp;e===q))<span class="keyword">return</span> <span class="number">1</span>;<span class="keyword">if</span>(<span class="number">0</span>===t.<span class="property">lookahead</span>)<span class="keyword">break</span>&#125;<span class="keyword">if</span>(((a=<span class="number">0</span>),t.<span class="property">lookahead</span>&gt;=<span class="number">3</span>&amp;&amp;((t.<span class="property">ins_h</span>=<span class="title function_">yt</span>(t,t.<span class="property">ins_h</span>,t.<span class="property">window</span>[t.<span class="property">strstart</span>+<span class="number">3</span>-<span class="number">1</span>])),(a=t.<span class="property">prev</span>[t.<span class="property">strstart</span>&amp;t.<span class="property">w_mask</span>]=t.<span class="property">head</span>[t.<span class="property">ins_h</span>]),(t.<span class="property">head</span>[t.<span class="property">ins_h</span>]=t.<span class="property">strstart</span>)),(t.<span class="property">prev_length</span>=t.<span class="property">match_length</span>),(t.<span class="property">prev_match</span>=t.<span class="property">match_start</span>),(t.<span class="property">match_length</span>=<span class="number">2</span>),<span class="number">0</span>!==a&amp;&amp;t.<span class="property">prev_length</span>&lt;t.<span class="property">max_lazy_match</span>&amp;&amp;t.<span class="property">strstart</span>-a&lt;=t.<span class="property">w_size</span>-ut&amp;&amp;((t.<span class="property">match_length</span>=<span class="title class_">Zt</span>(t,a)),t.<span class="property">match_length</span>&lt;=<span class="number">5</span>&amp;&amp;(t.<span class="property">strategy</span>===rt||(<span class="number">3</span>===t.<span class="property">match_length</span>&amp;&amp;t.<span class="property">strstart</span>-t.<span class="property">match_start</span>&gt;<span class="number">4096</span>))&amp;&amp;(t.<span class="property">match_length</span>=<span class="number">2</span>)),t.<span class="property">prev_length</span>&gt;=<span class="number">3</span>&amp;&amp;t.<span class="property">match_length</span>&lt;=t.<span class="property">prev_length</span>))&#123;(n=t.<span class="property">strstart</span>+t.<span class="property">lookahead</span>-<span class="number">3</span>),(i=<span class="title function_">X</span>(t,t.<span class="property">strstart</span>-<span class="number">1</span>-t.<span class="property">prev_match</span>,t.<span class="property">prev_length</span>-<span class="number">3</span>)),(t.<span class="property">lookahead</span>-=t.<span class="property">prev_length</span>-<span class="number">1</span>),(t.<span class="property">prev_length</span>-=<span class="number">2</span>);<span class="keyword">do</span>&#123;++t.<span class="property">strstart</span>&lt;=n&amp;&amp;((t.<span class="property">ins_h</span>=<span class="title function_">yt</span>(t,t.<span class="property">ins_h</span>,t.<span class="property">window</span>[t.<span class="property">strstart</span>+<span class="number">3</span>-<span class="number">1</span>])),(a=t.<span class="property">prev</span>[t.<span class="property">strstart</span>&amp;t.<span class="property">w_mask</span>]=t.<span class="property">head</span>[t.<span class="property">ins_h</span>]),(t.<span class="property">head</span>[t.<span class="property">ins_h</span>]=t.<span class="property">strstart</span>))&#125;<span class="keyword">while</span>(<span class="number">0</span>!=--t.<span class="property">prev_length</span>);<span class="keyword">if</span>(((t.<span class="property">match_available</span>=<span class="number">0</span>),(t.<span class="property">match_length</span>=<span class="number">2</span>),t.<span class="property">strstart</span>++,i&amp;&amp;(<span class="title function_">zt</span>(t,!<span class="number">1</span>),<span class="number">0</span>===t.<span class="property">strm</span>.<span class="property">avail_out</span>)))<span class="keyword">return</span> <span class="number">1</span>&#125;<span class="keyword">else</span> <span class="keyword">if</span>(t.<span class="property">match_available</span>)&#123;<span class="keyword">if</span>(((i=<span class="title function_">X</span>(t,<span class="number">0</span>,t.<span class="property">window</span>[t.<span class="property">strstart</span>-<span class="number">1</span>])),i&amp;&amp;<span class="title function_">zt</span>(t,!<span class="number">1</span>),t.<span class="property">strstart</span>++,t.<span class="property">lookahead</span>--,<span class="number">0</span>===t.<span class="property">strm</span>.<span class="property">avail_out</span>))<span class="keyword">return</span> <span class="number">1</span>&#125;<span class="title function_">else</span>(t.<span class="property">match_available</span>=<span class="number">1</span>),t.<span class="property">strstart</span>++,t.<span class="property">lookahead</span>--&#125;<span class="keyword">return</span>(t.<span class="property">match_available</span>&amp;&amp;((i=<span class="title function_">X</span>(t,<span class="number">0</span>,t.<span class="property">window</span>[t.<span class="property">strstart</span>-<span class="number">1</span>])),(t.<span class="property">match_available</span>=<span class="number">0</span>)),(t.<span class="property">insert</span>=t.<span class="property">strstart</span>&lt;<span class="number">2</span>?t.<span class="property">strstart</span>:<span class="number">2</span>),e===V?(<span class="title function_">zt</span>(t,!<span class="number">0</span>),<span class="number">0</span>===t.<span class="property">strm</span>.<span class="property">avail_out</span>?<span class="number">3</span>:<span class="number">4</span>):t.<span class="property">sym_next</span>&amp;&amp;(<span class="title function_">zt</span>(t,!<span class="number">1</span>),<span class="number">0</span>===t.<span class="property">strm</span>.<span class="property">avail_out</span>)?<span class="number">1</span>:<span class="number">2</span>)&#125;;<span class="keyword">function</span> <span class="title function_">Ot</span>(<span class="params">t,e,a,i,n</span>)&#123;(<span class="variable language_">this</span>.<span class="property">good_length</span>=t),(<span class="variable language_">this</span>.<span class="property">max_lazy</span>=e),(<span class="variable language_">this</span>.<span class="property">nice_length</span>=a),(<span class="variable language_">this</span>.<span class="property">max_chain</span>=i),(<span class="variable language_">this</span>.<span class="property">func</span>=n)&#125;<span class="keyword">const</span> <span class="title class_">It</span>=[<span class="keyword">new</span> <span class="title class_">Ot</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="title class_">St</span>),<span class="keyword">new</span> <span class="title class_">Ot</span>(<span class="number">4</span>,<span class="number">4</span>,<span class="number">8</span>,<span class="number">4</span>,<span class="title class_">Dt</span>),<span class="keyword">new</span> <span class="title class_">Ot</span>(<span class="number">4</span>,<span class="number">5</span>,<span class="number">16</span>,<span class="number">8</span>,<span class="title class_">Dt</span>),<span class="keyword">new</span> <span class="title class_">Ot</span>(<span class="number">4</span>,<span class="number">6</span>,<span class="number">32</span>,<span class="number">32</span>,<span class="title class_">Dt</span>),<span class="keyword">new</span> <span class="title class_">Ot</span>(<span class="number">4</span>,<span class="number">4</span>,<span class="number">16</span>,<span class="number">16</span>,<span class="title class_">Tt</span>),<span class="keyword">new</span> <span class="title class_">Ot</span>(<span class="number">8</span>,<span class="number">16</span>,<span class="number">32</span>,<span class="number">32</span>,<span class="title class_">Tt</span>),<span class="keyword">new</span> <span class="title class_">Ot</span>(<span class="number">8</span>,<span class="number">16</span>,<span class="number">128</span>,<span class="number">128</span>,<span class="title class_">Tt</span>),<span class="keyword">new</span> <span class="title class_">Ot</span>(<span class="number">8</span>,<span class="number">32</span>,<span class="number">128</span>,<span class="number">256</span>,<span class="title class_">Tt</span>),<span class="keyword">new</span> <span class="title class_">Ot</span>(<span class="number">32</span>,<span class="number">128</span>,<span class="number">258</span>,<span class="number">1024</span>,<span class="title class_">Tt</span>),<span class="keyword">new</span> <span class="title class_">Ot</span>(<span class="number">32</span>,<span class="number">258</span>,<span class="number">258</span>,<span class="number">4096</span>,<span class="title class_">Tt</span>)];<span class="keyword">function</span> <span class="title function_">Ft</span>(<span class="params"></span>)&#123;(<span class="variable language_">this</span>.<span class="property">strm</span>=<span class="literal">null</span>),(<span class="variable language_">this</span>.<span class="property">status</span>=<span class="number">0</span>),(<span class="variable language_">this</span>.<span class="property">pending_buf</span>=<span class="literal">null</span>),(<span class="variable language_">this</span>.<span class="property">pending_buf_size</span>=<span class="number">0</span>),(<span class="variable language_">this</span>.<span class="property">pending_out</span>=<span class="number">0</span>),(<span class="variable language_">this</span>.<span class="property">pending</span>=<span class="number">0</span>),(<span class="variable language_">this</span>.<span class="property">wrap</span>=<span class="number">0</span>),(<span class="variable language_">this</span>.<span class="property">gzhead</span>=<span class="literal">null</span>),(<span class="variable language_">this</span>.<span class="property">gzindex</span>=<span class="number">0</span>),(<span class="variable language_">this</span>.<span class="property">method</span>=ft),(<span class="variable language_">this</span>.<span class="property">last_flush</span>=-<span class="number">1</span>),(<span class="variable language_">this</span>.<span class="property">w_size</span>=<span class="number">0</span>),(<span class="variable language_">this</span>.<span class="property">w_bits</span>=<span class="number">0</span>),(<span class="variable language_">this</span>.<span class="property">w_mask</span>=<span class="number">0</span>),(<span class="variable language_">this</span>.<span class="property">window</span>=<span class="literal">null</span>),(<span class="variable language_">this</span>.<span class="property">window_size</span>=<span class="number">0</span>),(<span class="variable language_">this</span>.<span class="property">prev</span>=<span class="literal">null</span>),(<span class="variable language_">this</span>.<span class="property">head</span>=<span class="literal">null</span>),(<span class="variable language_">this</span>.<span class="property">ins_h</span>=<span class="number">0</span>),(<span class="variable language_">this</span>.<span class="property">hash_size</span>=<span class="number">0</span>),(<span class="variable language_">this</span>.<span class="property">hash_bits</span>=<span class="number">0</span>),(<span class="variable language_">this</span>.<span class="property">hash_mask</span>=<span class="number">0</span>),(<span class="variable language_">this</span>.<span class="property">hash_shift</span>=<span class="number">0</span>),(<span class="variable language_">this</span>.<span class="property">block_start</span>=<span class="number">0</span>),(<span class="variable language_">this</span>.<span class="property">match_length</span>=<span class="number">0</span>),(<span class="variable language_">this</span>.<span class="property">prev_match</span>=<span class="number">0</span>),(<span class="variable language_">this</span>.<span class="property">match_available</span>=<span class="number">0</span>),(<span class="variable language_">this</span>.<span class="property">strstart</span>=<span class="number">0</span>),(<span class="variable language_">this</span>.<span class="property">match_start</span>=<span class="number">0</span>),(<span class="variable language_">this</span>.<span class="property">lookahead</span>=<span class="number">0</span>),(<span class="variable language_">this</span>.<span class="property">prev_length</span>=<span class="number">0</span>),(<span class="variable language_">this</span>.<span class="property">max_chain_length</span>=<span class="number">0</span>),(<span class="variable language_">this</span>.<span class="property">max_lazy_match</span>=<span class="number">0</span>),(<span class="variable language_">this</span>.<span class="property">level</span>=<span class="number">0</span>),(<span class="variable language_">this</span>.<span class="property">strategy</span>=<span class="number">0</span>),(<span class="variable language_">this</span>.<span class="property">good_match</span>=<span class="number">0</span>),(<span class="variable language_">this</span>.<span class="property">nice_match</span>=<span class="number">0</span>),(<span class="variable language_">this</span>.<span class="property">dyn_ltree</span>=<span class="keyword">new</span> <span class="title class_">Uint16Array</span>(<span class="number">1146</span>)),(<span class="variable language_">this</span>.<span class="property">dyn_dtree</span>=<span class="keyword">new</span> <span class="title class_">Uint16Array</span>(<span class="number">122</span>)),(<span class="variable language_">this</span>.<span class="property">bl_tree</span>=<span class="keyword">new</span> <span class="title class_">Uint16Array</span>(<span class="number">78</span>)),<span class="title function_">kt</span>(<span class="variable language_">this</span>.<span class="property">dyn_ltree</span>),<span class="title function_">kt</span>(<span class="variable language_">this</span>.<span class="property">dyn_dtree</span>),<span class="title function_">kt</span>(<span class="variable language_">this</span>.<span class="property">bl_tree</span>),(<span class="variable language_">this</span>.<span class="property">l_desc</span>=<span class="literal">null</span>),(<span class="variable language_">this</span>.<span class="property">d_desc</span>=<span class="literal">null</span>),(<span class="variable language_">this</span>.<span class="property">bl_desc</span>=<span class="literal">null</span>),(<span class="variable language_">this</span>.<span class="property">bl_count</span>=<span class="keyword">new</span> <span class="title class_">Uint16Array</span>(<span class="number">16</span>)),(<span class="variable language_">this</span>.<span class="property">heap</span>=<span class="keyword">new</span> <span class="title class_">Uint16Array</span>(<span class="number">573</span>)),<span class="title function_">kt</span>(<span class="variable language_">this</span>.<span class="property">heap</span>),(<span class="variable language_">this</span>.<span class="property">heap_len</span>=<span class="number">0</span>),(<span class="variable language_">this</span>.<span class="property">heap_max</span>=<span class="number">0</span>),(<span class="variable language_">this</span>.<span class="property">depth</span>=<span class="keyword">new</span> <span class="title class_">Uint16Array</span>(<span class="number">573</span>)),<span class="title function_">kt</span>(<span class="variable language_">this</span>.<span class="property">depth</span>),(<span class="variable language_">this</span>.<span class="property">sym_buf</span>=<span class="number">0</span>),(<span class="variable language_">this</span>.<span class="property">lit_bufsize</span>=<span class="number">0</span>),(<span class="variable language_">this</span>.<span class="property">sym_next</span>=<span class="number">0</span>),(<span class="variable language_">this</span>.<span class="property">sym_end</span>=<span class="number">0</span>),(<span class="variable language_">this</span>.<span class="property">opt_len</span>=<span class="number">0</span>),(<span class="variable language_">this</span>.<span class="property">static_len</span>=<span class="number">0</span>),(<span class="variable language_">this</span>.<span class="property">matches</span>=<span class="number">0</span>),(<span class="variable language_">this</span>.<span class="property">insert</span>=<span class="number">0</span>),(<span class="variable language_">this</span>.<span class="property">bi_buf</span>=<span class="number">0</span>),(<span class="variable language_">this</span>.<span class="property">bi_valid</span>=<span class="number">0</span>)&#125;<span class="keyword">const</span> <span class="title function_">Lt</span>=(<span class="params">t</span>)=&gt;&#123;<span class="keyword">if</span>(!t)<span class="keyword">return</span> <span class="number">1</span>;<span class="keyword">const</span> e=t.<span class="property">state</span>;<span class="keyword">return</span>!e||e.<span class="property">strm</span>!==t||(e.<span class="property">status</span>!==wt&amp;&amp;<span class="number">57</span>!==e.<span class="property">status</span>&amp;&amp;<span class="number">69</span>!==e.<span class="property">status</span>&amp;&amp;<span class="number">73</span>!==e.<span class="property">status</span>&amp;&amp;<span class="number">91</span>!==e.<span class="property">status</span>&amp;&amp;<span class="number">103</span>!==e.<span class="property">status</span>&amp;&amp;e.<span class="property">status</span>!==mt&amp;&amp;e.<span class="property">status</span>!==bt)?<span class="number">1</span>:<span class="number">0</span>&#125;,<span class="title class_">Nt</span>=<span class="function">(<span class="params">t</span>)=&gt;</span>&#123;<span class="keyword">if</span>(<span class="title class_">Lt</span>(t))<span class="keyword">return</span> <span class="title function_">gt</span>(t,at);(t.<span class="property">total_in</span>=t.<span class="property">total_out</span>=<span class="number">0</span>),(t.<span class="property">data_type</span>=_t);<span class="keyword">const</span> e=t.<span class="property">state</span>;<span class="keyword">return</span>((e.<span class="property">pending</span>=<span class="number">0</span>),(e.<span class="property">pending_out</span>=<span class="number">0</span>),e.<span class="property">wrap</span>&lt;<span class="number">0</span>&amp;&amp;(e.<span class="property">wrap</span>=-e.<span class="property">wrap</span>),(e.<span class="property">status</span>=<span class="number">2</span>===e.<span class="property">wrap</span>?<span class="number">57</span>:e.<span class="property">wrap</span>?<span class="attr">wt</span>:mt),(t.<span class="property">adler</span>=<span class="number">2</span>===e.<span class="property">wrap</span>?<span class="number">0</span>:<span class="number">1</span>),(e.<span class="property">last_flush</span>=-<span class="number">2</span>),<span class="title function_">P</span>(e),tt)&#125;,<span class="title class_">Bt</span>=<span class="function">(<span class="params">t</span>)=&gt;</span>&#123;<span class="keyword">const</span> e=<span class="title class_">Nt</span>(t);<span class="keyword">var</span> a;<span class="keyword">return</span>(e===tt&amp;&amp;(((a=t.<span class="property">state</span>).<span class="property">window_size</span>=<span class="number">2</span>*a.<span class="property">w_size</span>),<span class="title function_">kt</span>(a.<span class="property">head</span>),(a.<span class="property">max_lazy_match</span>=<span class="title class_">It</span>[a.<span class="property">level</span>].<span class="property">max_lazy</span>),(a.<span class="property">good_match</span>=<span class="title class_">It</span>[a.<span class="property">level</span>].<span class="property">good_length</span>),(a.<span class="property">nice_match</span>=<span class="title class_">It</span>[a.<span class="property">level</span>].<span class="property">nice_length</span>),(a.<span class="property">max_chain_length</span>=<span class="title class_">It</span>[a.<span class="property">level</span>].<span class="property">max_chain</span>),(a.<span class="property">strstart</span>=<span class="number">0</span>),(a.<span class="property">block_start</span>=<span class="number">0</span>),(a.<span class="property">lookahead</span>=<span class="number">0</span>),(a.<span class="property">insert</span>=<span class="number">0</span>),(a.<span class="property">match_length</span>=a.<span class="property">prev_length</span>=<span class="number">2</span>),(a.<span class="property">match_available</span>=<span class="number">0</span>),(a.<span class="property">ins_h</span>=<span class="number">0</span>)),e)&#125;,<span class="title class_">Ct</span>=<span class="function">(<span class="params">t,e,a,i,n,s</span>)=&gt;</span>&#123;<span class="keyword">if</span>(!t)<span class="keyword">return</span> at;<span class="keyword">let</span> r=<span class="number">1</span>;<span class="keyword">if</span>((e===st&amp;&amp;(e=<span class="number">6</span>),i&lt;<span class="number">0</span>?((r=<span class="number">0</span>),(i=-i)):i&gt;<span class="number">15</span>&amp;&amp;((r=<span class="number">2</span>),(i-=<span class="number">16</span>)),n&lt;<span class="number">1</span>||n&gt;<span class="number">9</span>||a!==ft||i&lt;<span class="number">8</span>||i&gt;<span class="number">15</span>||e&lt;<span class="number">0</span>||e&gt;<span class="number">9</span>||s&lt;<span class="number">0</span>||s&gt;ht||(<span class="number">8</span>===i&amp;&amp;<span class="number">1</span>!==r)))<span class="keyword">return</span> <span class="title function_">gt</span>(t,at);<span class="number">8</span>===i&amp;&amp;(i=<span class="number">9</span>);<span class="keyword">const</span> o=<span class="keyword">new</span> <span class="title class_">Ft</span>();<span class="keyword">return</span>((t.<span class="property">state</span>=o),(o.<span class="property">strm</span>=t),(o.<span class="property">status</span>=wt),(o.<span class="property">wrap</span>=r),(o.<span class="property">gzhead</span>=<span class="literal">null</span>),(o.<span class="property">w_bits</span>=i),(o.<span class="property">w_size</span>=<span class="number">1</span>&lt;&lt;o.<span class="property">w_bits</span>),(o.<span class="property">w_mask</span>=o.<span class="property">w_size</span>-<span class="number">1</span>),(o.<span class="property">hash_bits</span>=n+<span class="number">7</span>),(o.<span class="property">hash_size</span>=<span class="number">1</span>&lt;&lt;o.<span class="property">hash_bits</span>),(o.<span class="property">hash_mask</span>=o.<span class="property">hash_size</span>-<span class="number">1</span>),(o.<span class="property">hash_shift</span>=~~((o.<span class="property">hash_bits</span>+<span class="number">3</span>-<span class="number">1</span>)/<span class="number">3</span>)),(o.<span class="property">window</span>=<span class="keyword">new</span> <span class="title class_">Uint8Array</span>(<span class="number">2</span>*o.<span class="property">w_size</span>)),(o.<span class="property">head</span>=<span class="keyword">new</span> <span class="title class_">Uint16Array</span>(o.<span class="property">hash_size</span>)),(o.<span class="property">prev</span>=<span class="keyword">new</span> <span class="title class_">Uint16Array</span>(o.<span class="property">w_size</span>)),(o.<span class="property">lit_bufsize</span>=<span class="number">1</span>&lt;&lt;(n+<span class="number">6</span>)),(o.<span class="property">pending_buf_size</span>=<span class="number">4</span>*o.<span class="property">lit_bufsize</span>),(o.<span class="property">pending_buf</span>=<span class="keyword">new</span> <span class="title class_">Uint8Array</span>(o.<span class="property">pending_buf_size</span>)),(o.<span class="property">sym_buf</span>=o.<span class="property">lit_bufsize</span>),(o.<span class="property">sym_end</span>=<span class="number">3</span>*(o.<span class="property">lit_bufsize</span>-<span class="number">1</span>)),(o.<span class="property">level</span>=e),(o.<span class="property">strategy</span>=s),(o.<span class="property">method</span>=a),<span class="title class_">Bt</span>(t))&#125;;<span class="keyword">var</span> <span class="title class_">Mt</span>=&#123;<span class="attr">deflateInit</span>:<span class="function">(<span class="params">t,e</span>)=&gt;</span><span class="title class_">Ct</span>(t,e,ft,<span class="number">15</span>,<span class="number">8</span>,dt),<span class="attr">deflateInit2</span>:<span class="title class_">Ct</span>,<span class="attr">deflateReset</span>:<span class="title class_">Bt</span>,<span class="attr">deflateResetKeep</span>:<span class="title class_">Nt</span>,<span class="attr">deflateSetHeader</span>:<span class="function">(<span class="params">t,e</span>)=&gt;</span><span class="title class_">Lt</span>(t)||<span class="number">2</span>!==t.<span class="property">state</span>.<span class="property">wrap</span>?<span class="attr">at</span>:((t.<span class="property">state</span>.<span class="property">gzhead</span>=e),tt),<span class="attr">deflate</span>:<span class="function">(<span class="params">t,e</span>)=&gt;</span>&#123;<span class="keyword">if</span>(<span class="title class_">Lt</span>(t)||e&gt;$||e&lt;<span class="number">0</span>)<span class="keyword">return</span> t?<span class="title function_">gt</span>(t,at):at;<span class="keyword">const</span> a=t.<span class="property">state</span>;<span class="keyword">if</span>(!t.<span class="property">output</span>||(<span class="number">0</span>!==t.<span class="property">avail_in</span>&amp;&amp;!t.<span class="property">input</span>)||(a.<span class="property">status</span>===bt&amp;&amp;e!==V))<span class="keyword">return</span> <span class="title function_">gt</span>(t,<span class="number">0</span>===t.<span class="property">avail_out</span>?<span class="attr">nt</span>:at);<span class="keyword">const</span> i=a.<span class="property">last_flush</span>;<span class="keyword">if</span>(((a.<span class="property">last_flush</span>=e),<span class="number">0</span>!==a.<span class="property">pending</span>))&#123;<span class="keyword">if</span>((<span class="title function_">xt</span>(t),<span class="number">0</span>===t.<span class="property">avail_out</span>))<span class="keyword">return</span>(a.<span class="property">last_flush</span>=-<span class="number">1</span>),tt&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="number">0</span>===t.<span class="property">avail_in</span>&amp;&amp;<span class="title function_">pt</span>(e)&lt;=<span class="title function_">pt</span>(i)&amp;&amp;e!==V)<span class="keyword">return</span> <span class="title function_">gt</span>(t,nt);<span class="keyword">if</span>(a.<span class="property">status</span>===bt&amp;&amp;<span class="number">0</span>!==t.<span class="property">avail_in</span>)<span class="keyword">return</span> <span class="title function_">gt</span>(t,nt);<span class="keyword">if</span>((a.<span class="property">status</span>===wt&amp;&amp;<span class="number">0</span>===a.<span class="property">wrap</span>&amp;&amp;(a.<span class="property">status</span>=mt),a.<span class="property">status</span>===wt))&#123;<span class="keyword">let</span> e=(ft+((a.<span class="property">w_bits</span>-<span class="number">8</span>)&lt;&lt;<span class="number">4</span>))&lt;&lt;<span class="number">8</span>,i=-<span class="number">1</span>;<span class="keyword">if</span>(((i=a.<span class="property">strategy</span>&gt;=ot||a.<span class="property">level</span>&lt;<span class="number">2</span>?<span class="number">0</span>:a.<span class="property">level</span>&lt;<span class="number">6</span>?<span class="number">1</span>:<span class="number">6</span>===a.<span class="property">level</span>?<span class="number">2</span>:<span class="number">3</span>),(e|=i&lt;&lt;<span class="number">6</span>),<span class="number">0</span>!==a.<span class="property">strstart</span>&amp;&amp;(e|=<span class="number">32</span>),(e+=<span class="number">31</span>-(e%<span class="number">31</span>)),<span class="title class_">Et</span>(a,e),<span class="number">0</span>!==a.<span class="property">strstart</span>&amp;&amp;(<span class="title class_">Et</span>(a,t.<span class="property">adler</span>&gt;&gt;&gt;<span class="number">16</span>),<span class="title class_">Et</span>(a,<span class="number">65535</span>&amp;t.<span class="property">adler</span>)),(t.<span class="property">adler</span>=<span class="number">1</span>),(a.<span class="property">status</span>=mt),<span class="title function_">xt</span>(t),<span class="number">0</span>!==a.<span class="property">pending</span>))<span class="keyword">return</span>(a.<span class="property">last_flush</span>=-<span class="number">1</span>),tt&#125;<span class="keyword">if</span>(<span class="number">57</span>===a.<span class="property">status</span>)<span class="keyword">if</span>(((t.<span class="property">adler</span>=<span class="number">0</span>),<span class="title class_">At</span>(a,<span class="number">31</span>),<span class="title class_">At</span>(a,<span class="number">139</span>),<span class="title class_">At</span>(a,<span class="number">8</span>),a.<span class="property">gzhead</span>))<span class="title class_">At</span>(a,(a.<span class="property">gzhead</span>.<span class="property">text</span>?<span class="number">1</span>:<span class="number">0</span>)+(a.<span class="property">gzhead</span>.<span class="property">hcrc</span>?<span class="number">2</span>:<span class="number">0</span>)+(a.<span class="property">gzhead</span>.<span class="property">extra</span>?<span class="number">4</span>:<span class="number">0</span>)+(a.<span class="property">gzhead</span>.<span class="property">name</span>?<span class="number">8</span>:<span class="number">0</span>)+(a.<span class="property">gzhead</span>.<span class="property">comment</span>?<span class="number">16</span>:<span class="number">0</span>)),<span class="title class_">At</span>(a,<span class="number">255</span>&amp;a.<span class="property">gzhead</span>.<span class="property">time</span>),<span class="title class_">At</span>(a,(a.<span class="property">gzhead</span>.<span class="property">time</span>&gt;&gt;<span class="number">8</span>)&amp;<span class="number">255</span>),<span class="title class_">At</span>(a,(a.<span class="property">gzhead</span>.<span class="property">time</span>&gt;&gt;<span class="number">16</span>)&amp;<span class="number">255</span>),<span class="title class_">At</span>(a,(a.<span class="property">gzhead</span>.<span class="property">time</span>&gt;&gt;<span class="number">24</span>)&amp;<span class="number">255</span>),<span class="title class_">At</span>(a,<span class="number">9</span>===a.<span class="property">level</span>?<span class="number">2</span>:a.<span class="property">strategy</span>&gt;=ot||a.<span class="property">level</span>&lt;<span class="number">2</span>?<span class="number">4</span>:<span class="number">0</span>),<span class="title class_">At</span>(a,<span class="number">255</span>&amp;a.<span class="property">gzhead</span>.<span class="property">os</span>),a.<span class="property">gzhead</span>.<span class="property">extra</span>&amp;&amp;a.<span class="property">gzhead</span>.<span class="property">extra</span>.<span class="property">length</span>&amp;&amp;(<span class="title class_">At</span>(a,<span class="number">255</span>&amp;a.<span class="property">gzhead</span>.<span class="property">extra</span>.<span class="property">length</span>),<span class="title class_">At</span>(a,(a.<span class="property">gzhead</span>.<span class="property">extra</span>.<span class="property">length</span>&gt;&gt;<span class="number">8</span>)&amp;<span class="number">255</span>)),a.<span class="property">gzhead</span>.<span class="property">hcrc</span>&amp;&amp;(t.<span class="property">adler</span>=<span class="title function_">H</span>(t.<span class="property">adler</span>,a.<span class="property">pending_buf</span>,a.<span class="property">pending</span>,<span class="number">0</span>)),(a.<span class="property">gzindex</span>=<span class="number">0</span>),(a.<span class="property">status</span>=<span class="number">69</span>);<span class="keyword">else</span> <span class="keyword">if</span>((<span class="title class_">At</span>(a,<span class="number">0</span>),<span class="title class_">At</span>(a,<span class="number">0</span>),<span class="title class_">At</span>(a,<span class="number">0</span>),<span class="title class_">At</span>(a,<span class="number">0</span>),<span class="title class_">At</span>(a,<span class="number">0</span>),<span class="title class_">At</span>(a,<span class="number">9</span>===a.<span class="property">level</span>?<span class="number">2</span>:a.<span class="property">strategy</span>&gt;=ot||a.<span class="property">level</span>&lt;<span class="number">2</span>?<span class="number">4</span>:<span class="number">0</span>),<span class="title class_">At</span>(a,<span class="number">3</span>),(a.<span class="property">status</span>=mt),<span class="title function_">xt</span>(t),<span class="number">0</span>!==a.<span class="property">pending</span>))<span class="keyword">return</span>(a.<span class="property">last_flush</span>=-<span class="number">1</span>),tt;<span class="keyword">if</span>(<span class="number">69</span>===a.<span class="property">status</span>)&#123;<span class="keyword">if</span>(a.<span class="property">gzhead</span>.<span class="property">extra</span>)&#123;<span class="keyword">let</span> e=a.<span class="property">pending</span>,i=(<span class="number">65535</span>&amp;a.<span class="property">gzhead</span>.<span class="property">extra</span>.<span class="property">length</span>)-a.<span class="property">gzindex</span>;<span class="keyword">for</span>(;a.<span class="property">pending</span>+i&gt;a.<span class="property">pending_buf_size</span>;)&#123;<span class="keyword">let</span> n=a.<span class="property">pending_buf_size</span>-a.<span class="property">pending</span>;<span class="keyword">if</span>((a.<span class="property">pending_buf</span>.<span class="title function_">set</span>(a.<span class="property">gzhead</span>.<span class="property">extra</span>.<span class="title function_">subarray</span>(a.<span class="property">gzindex</span>,a.<span class="property">gzindex</span>+n),a.<span class="property">pending</span>),(a.<span class="property">pending</span>=a.<span class="property">pending_buf_size</span>),a.<span class="property">gzhead</span>.<span class="property">hcrc</span>&amp;&amp;a.<span class="property">pending</span>&gt;e&amp;&amp;(t.<span class="property">adler</span>=<span class="title function_">H</span>(t.<span class="property">adler</span>,a.<span class="property">pending_buf</span>,a.<span class="property">pending</span>-e,e)),(a.<span class="property">gzindex</span>+=n),<span class="title function_">xt</span>(t),<span class="number">0</span>!==a.<span class="property">pending</span>))<span class="keyword">return</span>(a.<span class="property">last_flush</span>=-<span class="number">1</span>),tt;(e=<span class="number">0</span>),(i-=n)&#125;<span class="keyword">let</span> n=<span class="keyword">new</span> <span class="title class_">Uint8Array</span>(a.<span class="property">gzhead</span>.<span class="property">extra</span>);a.<span class="property">pending_buf</span>.<span class="title function_">set</span>(n.<span class="title function_">subarray</span>(a.<span class="property">gzindex</span>,a.<span class="property">gzindex</span>+i),a.<span class="property">pending</span>),(a.<span class="property">pending</span>+=i),a.<span class="property">gzhead</span>.<span class="property">hcrc</span>&amp;&amp;a.<span class="property">pending</span>&gt;e&amp;&amp;(t.<span class="property">adler</span>=<span class="title function_">H</span>(t.<span class="property">adler</span>,a.<span class="property">pending_buf</span>,a.<span class="property">pending</span>-e,e)),(a.<span class="property">gzindex</span>=<span class="number">0</span>)&#125;a.<span class="property">status</span>=<span class="number">73</span>&#125;<span class="keyword">if</span>(<span class="number">73</span>===a.<span class="property">status</span>)&#123;<span class="keyword">if</span>(a.<span class="property">gzhead</span>.<span class="property">name</span>)&#123;<span class="keyword">let</span> e,i=a.<span class="property">pending</span>;<span class="keyword">do</span>&#123;<span class="keyword">if</span>(a.<span class="property">pending</span>===a.<span class="property">pending_buf_size</span>)&#123;<span class="keyword">if</span>((a.<span class="property">gzhead</span>.<span class="property">hcrc</span>&amp;&amp;a.<span class="property">pending</span>&gt;i&amp;&amp;(t.<span class="property">adler</span>=<span class="title function_">H</span>(t.<span class="property">adler</span>,a.<span class="property">pending_buf</span>,a.<span class="property">pending</span>-i,i)),<span class="title function_">xt</span>(t),<span class="number">0</span>!==a.<span class="property">pending</span>))<span class="keyword">return</span>(a.<span class="property">last_flush</span>=-<span class="number">1</span>),tt;i=<span class="number">0</span>&#125;(e=a.<span class="property">gzindex</span>&lt;a.<span class="property">gzhead</span>.<span class="property">name</span>.<span class="property">length</span>?<span class="number">255</span>&amp;a.<span class="property">gzhead</span>.<span class="property">name</span>.<span class="title function_">charCodeAt</span>(a.<span class="property">gzindex</span>++):<span class="number">0</span>),<span class="title class_">At</span>(a,e)&#125;<span class="keyword">while</span>(<span class="number">0</span>!==e);a.<span class="property">gzhead</span>.<span class="property">hcrc</span>&amp;&amp;a.<span class="property">pending</span>&gt;i&amp;&amp;(t.<span class="property">adler</span>=<span class="title function_">H</span>(t.<span class="property">adler</span>,a.<span class="property">pending_buf</span>,a.<span class="property">pending</span>-i,i)),(a.<span class="property">gzindex</span>=<span class="number">0</span>)&#125;a.<span class="property">status</span>=<span class="number">91</span>&#125;<span class="keyword">if</span>(<span class="number">91</span>===a.<span class="property">status</span>)&#123;<span class="keyword">if</span>(a.<span class="property">gzhead</span>.<span class="property">comment</span>)&#123;<span class="keyword">let</span> e,i=a.<span class="property">pending</span>;<span class="keyword">do</span>&#123;<span class="keyword">if</span>(a.<span class="property">pending</span>===a.<span class="property">pending_buf_size</span>)&#123;<span class="keyword">if</span>((a.<span class="property">gzhead</span>.<span class="property">hcrc</span>&amp;&amp;a.<span class="property">pending</span>&gt;i&amp;&amp;(t.<span class="property">adler</span>=<span class="title function_">H</span>(t.<span class="property">adler</span>,a.<span class="property">pending_buf</span>,a.<span class="property">pending</span>-i,i)),<span class="title function_">xt</span>(t),<span class="number">0</span>!==a.<span class="property">pending</span>))<span class="keyword">return</span>(a.<span class="property">last_flush</span>=-<span class="number">1</span>),tt;i=<span class="number">0</span>&#125;(e=a.<span class="property">gzindex</span>&lt;a.<span class="property">gzhead</span>.<span class="property">comment</span>.<span class="property">length</span>?<span class="number">255</span>&amp;a.<span class="property">gzhead</span>.<span class="property">comment</span>.<span class="title function_">charCodeAt</span>(a.<span class="property">gzindex</span>++):<span class="number">0</span>),<span class="title class_">At</span>(a,e)&#125;<span class="keyword">while</span>(<span class="number">0</span>!==e);a.<span class="property">gzhead</span>.<span class="property">hcrc</span>&amp;&amp;a.<span class="property">pending</span>&gt;i&amp;&amp;(t.<span class="property">adler</span>=<span class="title function_">H</span>(t.<span class="property">adler</span>,a.<span class="property">pending_buf</span>,a.<span class="property">pending</span>-i,i))&#125;a.<span class="property">status</span>=<span class="number">103</span>&#125;<span class="keyword">if</span>(<span class="number">103</span>===a.<span class="property">status</span>)&#123;<span class="keyword">if</span>(a.<span class="property">gzhead</span>.<span class="property">hcrc</span>)&#123;<span class="keyword">if</span>(a.<span class="property">pending</span>+<span class="number">2</span>&gt;a.<span class="property">pending_buf_size</span>&amp;&amp;(<span class="title function_">xt</span>(t),<span class="number">0</span>!==a.<span class="property">pending</span>))<span class="keyword">return</span>(a.<span class="property">last_flush</span>=-<span class="number">1</span>),tt;<span class="title class_">At</span>(a,<span class="number">255</span>&amp;t.<span class="property">adler</span>),<span class="title class_">At</span>(a,(t.<span class="property">adler</span>&gt;&gt;<span class="number">8</span>)&amp;<span class="number">255</span>),(t.<span class="property">adler</span>=<span class="number">0</span>)&#125;<span class="keyword">if</span>(((a.<span class="property">status</span>=mt),<span class="title function_">xt</span>(t),<span class="number">0</span>!==a.<span class="property">pending</span>))<span class="keyword">return</span>(a.<span class="property">last_flush</span>=-<span class="number">1</span>),tt&#125;<span class="keyword">if</span>(<span class="number">0</span>!==t.<span class="property">avail_in</span>||<span class="number">0</span>!==a.<span class="property">lookahead</span>||(e!==q&amp;&amp;a.<span class="property">status</span>!==bt))&#123;<span class="keyword">let</span> i=<span class="number">0</span>===a.<span class="property">level</span>?<span class="title class_">St</span>(a,e):a.<span class="property">strategy</span>===ot?(<span class="function">(<span class="params">t,e</span>)=&gt;</span>&#123;<span class="keyword">let</span> a;<span class="keyword">for</span>(;;)&#123;<span class="keyword">if</span>(<span class="number">0</span>===t.<span class="property">lookahead</span>&amp;&amp;(<span class="title class_">Ut</span>(t),<span class="number">0</span>===t.<span class="property">lookahead</span>))&#123;<span class="keyword">if</span>(e===q)<span class="keyword">return</span> <span class="number">1</span>;<span class="keyword">break</span>&#125;<span class="keyword">if</span>(((t.<span class="property">match_length</span>=<span class="number">0</span>),(a=<span class="title function_">X</span>(t,<span class="number">0</span>,t.<span class="property">window</span>[t.<span class="property">strstart</span>])),t.<span class="property">lookahead</span>--,t.<span class="property">strstart</span>++,a&amp;&amp;(<span class="title function_">zt</span>(t,!<span class="number">1</span>),<span class="number">0</span>===t.<span class="property">strm</span>.<span class="property">avail_out</span>)))<span class="keyword">return</span> <span class="number">1</span>&#125;<span class="keyword">return</span>((t.<span class="property">insert</span>=<span class="number">0</span>),e===V?(<span class="title function_">zt</span>(t,!<span class="number">0</span>),<span class="number">0</span>===t.<span class="property">strm</span>.<span class="property">avail_out</span>?<span class="number">3</span>:<span class="number">4</span>):t.<span class="property">sym_next</span>&amp;&amp;(<span class="title function_">zt</span>(t,!<span class="number">1</span>),<span class="number">0</span>===t.<span class="property">strm</span>.<span class="property">avail_out</span>)?<span class="number">1</span>:<span class="number">2</span>)&#125;)(a,e):a.<span class="property">strategy</span>===lt?(<span class="function">(<span class="params">t,e</span>)=&gt;</span>&#123;<span class="keyword">let</span> a,i,n,s;<span class="keyword">const</span> r=t.<span class="property">window</span>;<span class="keyword">for</span>(;;)&#123;<span class="keyword">if</span>(t.<span class="property">lookahead</span>&lt;=ct)&#123;<span class="keyword">if</span>((<span class="title class_">Ut</span>(t),t.<span class="property">lookahead</span>&lt;=ct&amp;&amp;e===q))<span class="keyword">return</span> <span class="number">1</span>;<span class="keyword">if</span>(<span class="number">0</span>===t.<span class="property">lookahead</span>)<span class="keyword">break</span>&#125;<span class="keyword">if</span>(((t.<span class="property">match_length</span>=<span class="number">0</span>),t.<span class="property">lookahead</span>&gt;=<span class="number">3</span>&amp;&amp;t.<span class="property">strstart</span>&gt;<span class="number">0</span>&amp;&amp;((n=t.<span class="property">strstart</span>-<span class="number">1</span>),(i=r[n]),i===r[++n]&amp;&amp;i===r[++n]&amp;&amp;i===r[++n])))&#123;s=t.<span class="property">strstart</span>+ct;<span class="keyword">do</span>&#123;&#125;<span class="keyword">while</span>(i===r[++n]&amp;&amp;i===r[++n]&amp;&amp;i===r[++n]&amp;&amp;i===r[++n]&amp;&amp;i===r[++n]&amp;&amp;i===r[++n]&amp;&amp;i===r[++n]&amp;&amp;i===r[++n]&amp;&amp;n&lt;s);(t.<span class="property">match_length</span>=ct-(s-n)),t.<span class="property">match_length</span>&gt;t.<span class="property">lookahead</span>&amp;&amp;(t.<span class="property">match_length</span>=t.<span class="property">lookahead</span>)&#125;<span class="keyword">if</span>((t.<span class="property">match_length</span>&gt;=<span class="number">3</span>?((a=<span class="title function_">X</span>(t,<span class="number">1</span>,t.<span class="property">match_length</span>-<span class="number">3</span>)),(t.<span class="property">lookahead</span>-=t.<span class="property">match_length</span>),(t.<span class="property">strstart</span>+=t.<span class="property">match_length</span>),(t.<span class="property">match_length</span>=<span class="number">0</span>)):((a=<span class="title function_">X</span>(t,<span class="number">0</span>,t.<span class="property">window</span>[t.<span class="property">strstart</span>])),t.<span class="property">lookahead</span>--,t.<span class="property">strstart</span>++),a&amp;&amp;(<span class="title function_">zt</span>(t,!<span class="number">1</span>),<span class="number">0</span>===t.<span class="property">strm</span>.<span class="property">avail_out</span>)))<span class="keyword">return</span> <span class="number">1</span>&#125;<span class="keyword">return</span>((t.<span class="property">insert</span>=<span class="number">0</span>),e===V?(<span class="title function_">zt</span>(t,!<span class="number">0</span>),<span class="number">0</span>===t.<span class="property">strm</span>.<span class="property">avail_out</span>?<span class="number">3</span>:<span class="number">4</span>):t.<span class="property">sym_next</span>&amp;&amp;(<span class="title function_">zt</span>(t,!<span class="number">1</span>),<span class="number">0</span>===t.<span class="property">strm</span>.<span class="property">avail_out</span>)?<span class="number">1</span>:<span class="number">2</span>)&#125;)(a,e):<span class="title class_">It</span>[a.<span class="property">level</span>].<span class="title function_">func</span>(a,e);<span class="keyword">if</span>(((<span class="number">3</span>!==i&amp;&amp;<span class="number">4</span>!==i)||(a.<span class="property">status</span>=bt),<span class="number">1</span>===i||<span class="number">3</span>===i))<span class="keyword">return</span> <span class="number">0</span>===t.<span class="property">avail_out</span>&amp;&amp;(a.<span class="property">last_flush</span>=-<span class="number">1</span>),tt;<span class="keyword">if</span>(<span class="number">2</span>===i&amp;&amp;(e===J?<span class="title function_">W</span>(a):e!==$&amp;&amp;(<span class="title function_">Y</span>(a,<span class="number">0</span>,<span class="number">0</span>,!<span class="number">1</span>),e===Q&amp;&amp;(<span class="title function_">kt</span>(a.<span class="property">head</span>),<span class="number">0</span>===a.<span class="property">lookahead</span>&amp;&amp;((a.<span class="property">strstart</span>=<span class="number">0</span>),(a.<span class="property">block_start</span>=<span class="number">0</span>),(a.<span class="property">insert</span>=<span class="number">0</span>)))),<span class="title function_">xt</span>(t),<span class="number">0</span>===t.<span class="property">avail_out</span>))<span class="keyword">return</span>(a.<span class="property">last_flush</span>=-<span class="number">1</span>),tt&#125;<span class="keyword">return</span> e!==V?<span class="attr">tt</span>:a.<span class="property">wrap</span>&lt;=<span class="number">0</span>?<span class="attr">et</span>:(<span class="number">2</span>===a.<span class="property">wrap</span>?(<span class="title class_">At</span>(a,<span class="number">255</span>&amp;t.<span class="property">adler</span>),<span class="title class_">At</span>(a,(t.<span class="property">adler</span>&gt;&gt;<span class="number">8</span>)&amp;<span class="number">255</span>),<span class="title class_">At</span>(a,(t.<span class="property">adler</span>&gt;&gt;<span class="number">16</span>)&amp;<span class="number">255</span>),<span class="title class_">At</span>(a,(t.<span class="property">adler</span>&gt;&gt;<span class="number">24</span>)&amp;<span class="number">255</span>),<span class="title class_">At</span>(a,<span class="number">255</span>&amp;t.<span class="property">total_in</span>),<span class="title class_">At</span>(a,(t.<span class="property">total_in</span>&gt;&gt;<span class="number">8</span>)&amp;<span class="number">255</span>),<span class="title class_">At</span>(a,(t.<span class="property">total_in</span>&gt;&gt;<span class="number">16</span>)&amp;<span class="number">255</span>),<span class="title class_">At</span>(a,(t.<span class="property">total_in</span>&gt;&gt;<span class="number">24</span>)&amp;<span class="number">255</span>)):(<span class="title class_">Et</span>(a,t.<span class="property">adler</span>&gt;&gt;&gt;<span class="number">16</span>),<span class="title class_">Et</span>(a,<span class="number">65535</span>&amp;t.<span class="property">adler</span>)),<span class="title function_">xt</span>(t),a.<span class="property">wrap</span>&gt;<span class="number">0</span>&amp;&amp;(a.<span class="property">wrap</span>=-a.<span class="property">wrap</span>),<span class="number">0</span>!==a.<span class="property">pending</span>?<span class="attr">tt</span>:et)&#125;,<span class="attr">deflateEnd</span>:<span class="function">(<span class="params">t</span>)=&gt;</span>&#123;<span class="keyword">if</span>(<span class="title class_">Lt</span>(t))<span class="keyword">return</span> at;<span class="keyword">const</span> e=t.<span class="property">state</span>.<span class="property">status</span>;<span class="keyword">return</span>(t.<span class="property">state</span>=<span class="literal">null</span>),e===mt?<span class="title function_">gt</span>(t,it):tt&#125;,<span class="attr">deflateSetDictionary</span>:<span class="function">(<span class="params">t,e</span>)=&gt;</span>&#123;<span class="keyword">let</span> a=e.<span class="property">length</span>;<span class="keyword">if</span>(<span class="title class_">Lt</span>(t))<span class="keyword">return</span> at;<span class="keyword">const</span> i=t.<span class="property">state</span>,n=i.<span class="property">wrap</span>;<span class="keyword">if</span>(<span class="number">2</span>===n||(<span class="number">1</span>===n&amp;&amp;i.<span class="property">status</span>!==wt)||i.<span class="property">lookahead</span>)<span class="keyword">return</span> at;<span class="keyword">if</span>((<span class="number">1</span>===n&amp;&amp;(t.<span class="property">adler</span>=<span class="title function_">C</span>(t.<span class="property">adler</span>,e,a,<span class="number">0</span>)),(i.<span class="property">wrap</span>=<span class="number">0</span>),a&gt;=i.<span class="property">w_size</span>))&#123;<span class="number">0</span>===n&amp;&amp;(<span class="title function_">kt</span>(i.<span class="property">head</span>),(i.<span class="property">strstart</span>=<span class="number">0</span>),(i.<span class="property">block_start</span>=<span class="number">0</span>),(i.<span class="property">insert</span>=<span class="number">0</span>));<span class="keyword">let</span> t=<span class="keyword">new</span> <span class="title class_">Uint8Array</span>(i.<span class="property">w_size</span>);t.<span class="title function_">set</span>(e.<span class="title function_">subarray</span>(a-i.<span class="property">w_size</span>,a),<span class="number">0</span>),(e=t),(a=i.<span class="property">w_size</span>)&#125;<span class="keyword">const</span> s=t.<span class="property">avail_in</span>,r=t.<span class="property">next_in</span>,o=t.<span class="property">input</span>;<span class="keyword">for</span>(t.<span class="property">avail_in</span>=a,t.<span class="property">next_in</span>=<span class="number">0</span>,t.<span class="property">input</span>=e,<span class="title class_">Ut</span>(i);i.<span class="property">lookahead</span>&gt;=<span class="number">3</span>;)&#123;<span class="keyword">let</span> t=i.<span class="property">strstart</span>,e=i.<span class="property">lookahead</span>-<span class="number">2</span>;<span class="keyword">do</span>&#123;(i.<span class="property">ins_h</span>=<span class="title function_">yt</span>(i,i.<span class="property">ins_h</span>,i.<span class="property">window</span>[t+<span class="number">3</span>-<span class="number">1</span>])),(i.<span class="property">prev</span>[t&amp;i.<span class="property">w_mask</span>]=i.<span class="property">head</span>[i.<span class="property">ins_h</span>]),(i.<span class="property">head</span>[i.<span class="property">ins_h</span>]=t),t++&#125;<span class="keyword">while</span>(--e);(i.<span class="property">strstart</span>=t),(i.<span class="property">lookahead</span>=<span class="number">2</span>),<span class="title class_">Ut</span>(i)&#125;<span class="keyword">return</span>((i.<span class="property">strstart</span>+=i.<span class="property">lookahead</span>),(i.<span class="property">block_start</span>=i.<span class="property">strstart</span>),(i.<span class="property">insert</span>=i.<span class="property">lookahead</span>),(i.<span class="property">lookahead</span>=<span class="number">0</span>),(i.<span class="property">match_length</span>=i.<span class="property">prev_length</span>=<span class="number">2</span>),(i.<span class="property">match_available</span>=<span class="number">0</span>),(t.<span class="property">next_in</span>=r),(t.<span class="property">input</span>=o),(t.<span class="property">avail_in</span>=s),(i.<span class="property">wrap</span>=n),tt)&#125;,<span class="attr">deflateInfo</span>:<span class="string">&#x27;pako deflate (from Nodeca project)&#x27;</span>&#125;;<span class="keyword">const</span> <span class="title function_">Ht</span>=(<span class="params">t,e</span>)=&gt;<span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">hasOwnProperty</span>.<span class="title function_">call</span>(t,e);<span class="keyword">var</span> jt=<span class="keyword">function</span>(<span class="params">t</span>)&#123;<span class="keyword">const</span> e=<span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">slice</span>.<span class="title function_">call</span>(<span class="variable language_">arguments</span>,<span class="number">1</span>);<span class="keyword">for</span>(;e.<span class="property">length</span>;)&#123;<span class="keyword">const</span> a=e.<span class="title function_">shift</span>();<span class="keyword">if</span>(a)&#123;<span class="keyword">if</span>(<span class="string">&#x27;object&#x27;</span>!=<span class="keyword">typeof</span> a)<span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>(a+<span class="string">&#x27;must be non-object&#x27;</span>);<span class="keyword">for</span>(<span class="keyword">const</span> e <span class="keyword">in</span> a)<span class="title class_">Ht</span>(a,e)&amp;&amp;(t[e]=a[e])&#125;&#125;<span class="keyword">return</span> t&#125;,<span class="title class_">Kt</span>=<span class="function">(<span class="params">t</span>)=&gt;</span>&#123;<span class="keyword">let</span> e=<span class="number">0</span>;<span class="keyword">for</span>(<span class="keyword">let</span> a=<span class="number">0</span>,i=t.<span class="property">length</span>;a&lt;i;a++)e+=t[a].<span class="property">length</span>;<span class="keyword">const</span> a=<span class="keyword">new</span> <span class="title class_">Uint8Array</span>(e);<span class="keyword">for</span>(<span class="keyword">let</span> e=<span class="number">0</span>,i=<span class="number">0</span>,n=t.<span class="property">length</span>;e&lt;n;e++)&#123;<span class="keyword">let</span> n=t[e];a.<span class="title function_">set</span>(n,i),(i+=n.<span class="property">length</span>)&#125;<span class="keyword">return</span> a&#125;;<span class="keyword">let</span> <span class="title class_">Pt</span>=!<span class="number">0</span>;<span class="keyword">try</span>&#123;<span class="title class_">String</span>.<span class="property">fromCharCode</span>.<span class="title function_">apply</span>(<span class="literal">null</span>,<span class="keyword">new</span> <span class="title class_">Uint8Array</span>(<span class="number">1</span>))&#125;<span class="keyword">catch</span>(t)&#123;<span class="title class_">Pt</span>=!<span class="number">1</span>&#125;<span class="keyword">const</span> <span class="title class_">Yt</span>=<span class="keyword">new</span> <span class="title class_">Uint8Array</span>(<span class="number">256</span>);<span class="keyword">for</span>(<span class="keyword">let</span> t=<span class="number">0</span>;t&lt;<span class="number">256</span>;t++)<span class="title class_">Yt</span>[t]=t&gt;=<span class="number">252</span>?<span class="number">6</span>:t&gt;=<span class="number">248</span>?<span class="number">5</span>:t&gt;=<span class="number">240</span>?<span class="number">4</span>:t&gt;=<span class="number">224</span>?<span class="number">3</span>:t&gt;=<span class="number">192</span>?<span class="number">2</span>:<span class="number">1</span>;<span class="title class_">Yt</span>[<span class="number">254</span>]=<span class="title class_">Yt</span>[<span class="number">254</span>]=<span class="number">1</span>;<span class="keyword">var</span> <span class="title function_">Gt</span>=(<span class="params">t</span>)=&gt;&#123;<span class="keyword">if</span>(<span class="string">&#x27;function&#x27;</span>==<span class="keyword">typeof</span> <span class="title class_">TextEncoder</span>&amp;&amp;<span class="title class_">TextEncoder</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">encode</span>)<span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">TextEncoder</span>().<span class="title function_">encode</span>(t);<span class="keyword">let</span> e,a,i,n,s,r=t.<span class="property">length</span>,o=<span class="number">0</span>;<span class="keyword">for</span>(n=<span class="number">0</span>;n&lt;r;n++)(a=t.<span class="title function_">charCodeAt</span>(n)),<span class="number">55296</span>==(<span class="number">64512</span>&amp;a)&amp;&amp;n+<span class="number">1</span>&lt;r&amp;&amp;((i=t.<span class="title function_">charCodeAt</span>(n+<span class="number">1</span>)),<span class="number">56320</span>==(<span class="number">64512</span>&amp;i)&amp;&amp;((a=<span class="number">65536</span>+((a-<span class="number">55296</span>)&lt;&lt;<span class="number">10</span>)+(i-<span class="number">56320</span>)),n++)),(o+=a&lt;<span class="number">128</span>?<span class="number">1</span>:a&lt;<span class="number">2048</span>?<span class="number">2</span>:a&lt;<span class="number">65536</span>?<span class="number">3</span>:<span class="number">4</span>);<span class="keyword">for</span>(e=<span class="keyword">new</span> <span class="title class_">Uint8Array</span>(o),s=<span class="number">0</span>,n=<span class="number">0</span>;s&lt;o;n++)(a=t.<span class="title function_">charCodeAt</span>(n)),<span class="number">55296</span>==(<span class="number">64512</span>&amp;a)&amp;&amp;n+<span class="number">1</span>&lt;r&amp;&amp;((i=t.<span class="title function_">charCodeAt</span>(n+<span class="number">1</span>)),<span class="number">56320</span>==(<span class="number">64512</span>&amp;i)&amp;&amp;((a=<span class="number">65536</span>+((a-<span class="number">55296</span>)&lt;&lt;<span class="number">10</span>)+(i-<span class="number">56320</span>)),n++)),a&lt;<span class="number">128</span>?(e[s++]=a):a&lt;<span class="number">2048</span>?((e[s++]=<span class="number">192</span>|(a&gt;&gt;&gt;<span class="number">6</span>)),(e[s++]=<span class="number">128</span>|(<span class="number">63</span>&amp;a))):a&lt;<span class="number">65536</span>?((e[s++]=<span class="number">224</span>|(a&gt;&gt;&gt;<span class="number">12</span>)),(e[s++]=<span class="number">128</span>|((a&gt;&gt;&gt;<span class="number">6</span>)&amp;<span class="number">63</span>)),(e[s++]=<span class="number">128</span>|(<span class="number">63</span>&amp;a))):((e[s++]=<span class="number">240</span>|(a&gt;&gt;&gt;<span class="number">18</span>)),(e[s++]=<span class="number">128</span>|((a&gt;&gt;&gt;<span class="number">12</span>)&amp;<span class="number">63</span>)),(e[s++]=<span class="number">128</span>|((a&gt;&gt;&gt;<span class="number">6</span>)&amp;<span class="number">63</span>)),(e[s++]=<span class="number">128</span>|(<span class="number">63</span>&amp;a)));<span class="keyword">return</span> e&#125;,<span class="title class_">Xt</span>=<span class="function">(<span class="params">t,e</span>)=&gt;</span>&#123;<span class="keyword">const</span> a=e||t.<span class="property">length</span>;<span class="keyword">if</span>(<span class="string">&#x27;function&#x27;</span>==<span class="keyword">typeof</span> <span class="title class_">TextDecoder</span>&amp;&amp;<span class="title class_">TextDecoder</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">decode</span>)<span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">TextDecoder</span>().<span class="title function_">decode</span>(t.<span class="title function_">subarray</span>(<span class="number">0</span>,e));<span class="keyword">let</span> i,n;<span class="keyword">const</span> s=<span class="keyword">new</span> <span class="title class_">Array</span>(<span class="number">2</span>*a);<span class="keyword">for</span>(n=<span class="number">0</span>,i=<span class="number">0</span>;i&lt;a;)&#123;<span class="keyword">let</span> e=t[i++];<span class="keyword">if</span>(e&lt;<span class="number">128</span>)&#123;s[n++]=e;<span class="keyword">continue</span>&#125;<span class="keyword">let</span> r=<span class="title class_">Yt</span>[e];<span class="keyword">if</span>(r&gt;<span class="number">4</span>)(s[n++]=<span class="number">65533</span>),(i+=r-<span class="number">1</span>);<span class="keyword">else</span>&#123;<span class="keyword">for</span>(e&amp;=<span class="number">2</span>===r?<span class="number">31</span>:<span class="number">3</span>===r?<span class="number">15</span>:<span class="number">7</span>;r&gt;<span class="number">1</span>&amp;&amp;i&lt;a;)(e=(e&lt;&lt;<span class="number">6</span>)|(<span class="number">63</span>&amp;t[i++])),r--;r&gt;<span class="number">1</span>?(s[n++]=<span class="number">65533</span>):e&lt;<span class="number">65536</span>?(s[n++]=e):((e-=<span class="number">65536</span>),(s[n++]=<span class="number">55296</span>|((e&gt;&gt;<span class="number">10</span>)&amp;<span class="number">1023</span>)),(s[n++]=<span class="number">56320</span>|(<span class="number">1023</span>&amp;e)))&#125;&#125;<span class="keyword">return</span>(<span class="function">(<span class="params">t,e</span>)=&gt;</span>&#123;<span class="keyword">if</span>(e&lt;<span class="number">65534</span>&amp;&amp;t.<span class="property">subarray</span>&amp;&amp;<span class="title class_">Pt</span>)<span class="keyword">return</span> <span class="title class_">String</span>.<span class="property">fromCharCode</span>.<span class="title function_">apply</span>(<span class="literal">null</span>,t.<span class="property">length</span>===e?<span class="attr">t</span>:t.<span class="title function_">subarray</span>(<span class="number">0</span>,e));<span class="keyword">let</span> a=<span class="string">&#x27;&#x27;</span>;<span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">0</span>;i&lt;e;i++)a+=<span class="title class_">String</span>.<span class="title function_">fromCharCode</span>(t[i]);<span class="keyword">return</span> a&#125;)(s,n)&#125;,<span class="title class_">Wt</span>=<span class="function">(<span class="params">t,e</span>)=&gt;</span>&#123;(e=e||t.<span class="property">length</span>)&gt;t.<span class="property">length</span>&amp;&amp;(e=t.<span class="property">length</span>);<span class="keyword">let</span> a=e-<span class="number">1</span>;<span class="keyword">for</span>(;a&gt;=<span class="number">0</span>&amp;&amp;<span class="number">128</span>==(<span class="number">192</span>&amp;t[a]);)a--;<span class="keyword">return</span> a&lt;<span class="number">0</span>||<span class="number">0</span>===a?<span class="attr">e</span>:a+<span class="title class_">Yt</span>[t[a]]&gt;e?<span class="attr">a</span>:e&#125;;<span class="keyword">var</span> qt=<span class="keyword">function</span>(<span class="params"></span>)&#123;(<span class="variable language_">this</span>.<span class="property">input</span>=<span class="literal">null</span>),(<span class="variable language_">this</span>.<span class="property">next_in</span>=<span class="number">0</span>),(<span class="variable language_">this</span>.<span class="property">avail_in</span>=<span class="number">0</span>),(<span class="variable language_">this</span>.<span class="property">total_in</span>=<span class="number">0</span>),(<span class="variable language_">this</span>.<span class="property">output</span>=<span class="literal">null</span>),(<span class="variable language_">this</span>.<span class="property">next_out</span>=<span class="number">0</span>),(<span class="variable language_">this</span>.<span class="property">avail_out</span>=<span class="number">0</span>),(<span class="variable language_">this</span>.<span class="property">total_out</span>=<span class="number">0</span>),(<span class="variable language_">this</span>.<span class="property">msg</span>=<span class="string">&#x27;&#x27;</span>),(<span class="variable language_">this</span>.<span class="property">state</span>=<span class="literal">null</span>),(<span class="variable language_">this</span>.<span class="property">data_type</span>=<span class="number">2</span>),(<span class="variable language_">this</span>.<span class="property">adler</span>=<span class="number">0</span>)&#125;;<span class="keyword">const</span> <span class="title class_">Jt</span>=<span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>,&#123;<span class="attr">Z_NO_FLUSH</span>:<span class="title class_">Qt</span>,<span class="attr">Z_SYNC_FLUSH</span>:<span class="title class_">Vt</span>,<span class="attr">Z_FULL_FLUSH</span>:$t,<span class="attr">Z_FINISH</span>:te,<span class="attr">Z_OK</span>:ee,<span class="attr">Z_STREAM_END</span>:ae,<span class="attr">Z_DEFAULT_COMPRESSION</span>:ie,<span class="attr">Z_DEFAULT_STRATEGY</span>:ne,<span class="attr">Z_DEFLATED</span>:se&#125;=K;<span class="keyword">function</span> <span class="title function_">re</span>(<span class="params">t</span>)&#123;<span class="variable language_">this</span>.<span class="property">options</span>=<span class="title function_">jt</span>(&#123;<span class="attr">level</span>:ie,<span class="attr">method</span>:se,<span class="attr">chunkSize</span>:<span class="number">16384</span>,<span class="attr">windowBits</span>:<span class="number">15</span>,<span class="attr">memLevel</span>:<span class="number">8</span>,<span class="attr">strategy</span>:ne&#125;,t||&#123;&#125;);<span class="keyword">let</span> e=<span class="variable language_">this</span>.<span class="property">options</span>;e.<span class="property">raw</span>&amp;&amp;e.<span class="property">windowBits</span>&gt;<span class="number">0</span>?(e.<span class="property">windowBits</span>=-e.<span class="property">windowBits</span>):e.<span class="property">gzip</span>&amp;&amp;e.<span class="property">windowBits</span>&gt;<span class="number">0</span>&amp;&amp;e.<span class="property">windowBits</span>&lt;<span class="number">16</span>&amp;&amp;(e.<span class="property">windowBits</span>+=<span class="number">16</span>),(<span class="variable language_">this</span>.<span class="property">err</span>=<span class="number">0</span>),(<span class="variable language_">this</span>.<span class="property">msg</span>=<span class="string">&#x27;&#x27;</span>),(<span class="variable language_">this</span>.<span class="property">ended</span>=!<span class="number">1</span>),(<span class="variable language_">this</span>.<span class="property">chunks</span>=[]),(<span class="variable language_">this</span>.<span class="property">strm</span>=<span class="keyword">new</span> <span class="title function_">qt</span>()),(<span class="variable language_">this</span>.<span class="property">strm</span>.<span class="property">avail_out</span>=<span class="number">0</span>);<span class="keyword">let</span> a=<span class="title class_">Mt</span>.<span class="title function_">deflateInit2</span>(<span class="variable language_">this</span>.<span class="property">strm</span>,e.<span class="property">level</span>,e.<span class="property">method</span>,e.<span class="property">windowBits</span>,e.<span class="property">memLevel</span>,e.<span class="property">strategy</span>);<span class="keyword">if</span>(a!==ee)<span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(j[a]);<span class="keyword">if</span>((e.<span class="property">header</span>&amp;&amp;<span class="title class_">Mt</span>.<span class="title function_">deflateSetHeader</span>(<span class="variable language_">this</span>.<span class="property">strm</span>,e.<span class="property">header</span>),e.<span class="property">dictionary</span>))&#123;<span class="keyword">let</span> t;<span class="keyword">if</span>(((t=<span class="string">&#x27;string&#x27;</span>==<span class="keyword">typeof</span> e.<span class="property">dictionary</span>?<span class="title class_">Gt</span>(e.<span class="property">dictionary</span>):<span class="string">&#x27;[object ArrayBuffer]&#x27;</span>===<span class="title class_">Jt</span>.<span class="title function_">call</span>(e.<span class="property">dictionary</span>)?<span class="keyword">new</span> <span class="title class_">Uint8Array</span>(e.<span class="property">dictionary</span>):e.<span class="property">dictionary</span>),(a=<span class="title class_">Mt</span>.<span class="title function_">deflateSetDictionary</span>(<span class="variable language_">this</span>.<span class="property">strm</span>,t)),a!==ee))<span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(j[a]);<span class="variable language_">this</span>.<span class="property">_dict_set</span>=!<span class="number">0</span>&#125;&#125;<span class="keyword">function</span> <span class="title function_">oe</span>(<span class="params">t,e</span>)&#123;<span class="keyword">const</span> a=<span class="keyword">new</span> <span class="title function_">re</span>(e);<span class="keyword">if</span>((a.<span class="title function_">push</span>(t,!<span class="number">0</span>),a.<span class="property">err</span>))<span class="keyword">throw</span> a.<span class="property">msg</span>||j[a.<span class="property">err</span>];<span class="keyword">return</span> a.<span class="property">result</span>&#125;(re.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">push</span>=<span class="keyword">function</span>(<span class="params">t,e</span>)&#123;<span class="keyword">const</span> a=<span class="variable language_">this</span>.<span class="property">strm</span>,i=<span class="variable language_">this</span>.<span class="property">options</span>.<span class="property">chunkSize</span>;<span class="keyword">let</span> n,s;<span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">ended</span>)<span class="keyword">return</span>!<span class="number">1</span>;<span class="keyword">for</span>(s=e===~~e?<span class="attr">e</span>:!<span class="number">0</span>===e?<span class="attr">te</span>:<span class="title class_">Qt</span>,<span class="string">&#x27;string&#x27;</span>==<span class="keyword">typeof</span> t?(a.<span class="property">input</span>=<span class="title class_">Gt</span>(t)):<span class="string">&#x27;[object ArrayBuffer]&#x27;</span>===<span class="title class_">Jt</span>.<span class="title function_">call</span>(t)?(a.<span class="property">input</span>=<span class="keyword">new</span> <span class="title class_">Uint8Array</span>(t)):(a.<span class="property">input</span>=t),a.<span class="property">next_in</span>=<span class="number">0</span>,a.<span class="property">avail_in</span>=a.<span class="property">input</span>.<span class="property">length</span>;)<span class="keyword">if</span>((<span class="number">0</span>===a.<span class="property">avail_out</span>&amp;&amp;((a.<span class="property">output</span>=<span class="keyword">new</span> <span class="title class_">Uint8Array</span>(i)),(a.<span class="property">next_out</span>=<span class="number">0</span>),(a.<span class="property">avail_out</span>=i)),(s===<span class="title class_">Vt</span>||s===$t)&amp;&amp;a.<span class="property">avail_out</span>&lt;=<span class="number">6</span>))<span class="variable language_">this</span>.<span class="title function_">onData</span>(a.<span class="property">output</span>.<span class="title function_">subarray</span>(<span class="number">0</span>,a.<span class="property">next_out</span>)),(a.<span class="property">avail_out</span>=<span class="number">0</span>);<span class="keyword">else</span>&#123;<span class="keyword">if</span>(((n=<span class="title class_">Mt</span>.<span class="title function_">deflate</span>(a,s)),n===ae))<span class="keyword">return</span>(a.<span class="property">next_out</span>&gt;<span class="number">0</span>&amp;&amp;<span class="variable language_">this</span>.<span class="title function_">onData</span>(a.<span class="property">output</span>.<span class="title function_">subarray</span>(<span class="number">0</span>,a.<span class="property">next_out</span>)),(n=<span class="title class_">Mt</span>.<span class="title function_">deflateEnd</span>(<span class="variable language_">this</span>.<span class="property">strm</span>)),<span class="variable language_">this</span>.<span class="title function_">onEnd</span>(n),(<span class="variable language_">this</span>.<span class="property">ended</span>=!<span class="number">0</span>),n===ee);<span class="keyword">if</span>(<span class="number">0</span>!==a.<span class="property">avail_out</span>)&#123;<span class="keyword">if</span>(s&gt;<span class="number">0</span>&amp;&amp;a.<span class="property">next_out</span>&gt;<span class="number">0</span>)<span class="variable language_">this</span>.<span class="title function_">onData</span>(a.<span class="property">output</span>.<span class="title function_">subarray</span>(<span class="number">0</span>,a.<span class="property">next_out</span>)),(a.<span class="property">avail_out</span>=<span class="number">0</span>);<span class="keyword">else</span> <span class="keyword">if</span>(<span class="number">0</span>===a.<span class="property">avail_in</span>)<span class="keyword">break</span>&#125;<span class="keyword">else</span> <span class="variable language_">this</span>.<span class="title function_">onData</span>(a.<span class="property">output</span>)&#125;<span class="keyword">return</span>!<span class="number">0</span>&#125;),(re.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">onData</span>=<span class="keyword">function</span>(<span class="params">t</span>)&#123;<span class="variable language_">this</span>.<span class="property">chunks</span>.<span class="title function_">push</span>(t)&#125;),(re.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">onEnd</span>=<span class="keyword">function</span>(<span class="params">t</span>)&#123;t===ee&amp;&amp;(<span class="variable language_">this</span>.<span class="property">result</span>=<span class="title class_">Kt</span>(<span class="variable language_">this</span>.<span class="property">chunks</span>)),(<span class="variable language_">this</span>.<span class="property">chunks</span>=[]),(<span class="variable language_">this</span>.<span class="property">err</span>=t),(<span class="variable language_">this</span>.<span class="property">msg</span>=<span class="variable language_">this</span>.<span class="property">strm</span>.<span class="property">msg</span>)&#125;);<span class="keyword">var</span> le=&#123;<span class="title class_">Deflate</span>:re,<span class="attr">deflate</span>:oe,<span class="attr">deflateRaw</span>:<span class="keyword">function</span>(<span class="params">t,e</span>)&#123;<span class="keyword">return</span>((e=e||&#123;&#125;).<span class="property">raw</span>=!<span class="number">0</span>),<span class="title function_">oe</span>(t,e)&#125;,<span class="attr">gzip</span>:<span class="keyword">function</span>(<span class="params">t,e</span>)&#123;<span class="keyword">return</span>((e=e||&#123;&#125;).<span class="property">gzip</span>=!<span class="number">0</span>),<span class="title function_">oe</span>(t,e)&#125;,<span class="attr">constants</span>:K&#125;;<span class="keyword">const</span> he=<span class="number">16209</span>;<span class="keyword">var</span> de=<span class="keyword">function</span>(<span class="params">t,e</span>)&#123;<span class="keyword">let</span> a,i,n,s,r,o,l,h,d,_,f,c,u,w,m,b,g,p,k,v,y,x,z,A;<span class="keyword">const</span> E=t.<span class="property">state</span>;(a=t.<span class="property">next_in</span>),(z=t.<span class="property">input</span>),(i=a+(t.<span class="property">avail_in</span>-<span class="number">5</span>)),(n=t.<span class="property">next_out</span>),(A=t.<span class="property">output</span>),(s=n-(e-t.<span class="property">avail_out</span>)),(r=n+(t.<span class="property">avail_out</span>-<span class="number">257</span>)),(o=E.<span class="property">dmax</span>),(l=E.<span class="property">wsize</span>),(h=E.<span class="property">whave</span>),(d=E.<span class="property">wnext</span>),(_=E.<span class="property">window</span>),(f=E.<span class="property">hold</span>),(c=E.<span class="property">bits</span>),(u=E.<span class="property">lencode</span>),(w=E.<span class="property">distcode</span>),(m=(<span class="number">1</span>&lt;&lt;E.<span class="property">lenbits</span>)-<span class="number">1</span>),(b=(<span class="number">1</span>&lt;&lt;E.<span class="property">distbits</span>)-<span class="number">1</span>);<span class="attr">t</span>:<span class="keyword">do</span>&#123;c&lt;<span class="number">15</span>&amp;&amp;((f+=z[a++]&lt;&lt;c),(c+=<span class="number">8</span>),(f+=z[a++]&lt;&lt;c),(c+=<span class="number">8</span>)),(g=u[f&amp;m]);<span class="attr">e</span>:<span class="keyword">for</span>(;;)&#123;<span class="keyword">if</span>(((p=g&gt;&gt;&gt;<span class="number">24</span>),(f&gt;&gt;&gt;=p),(c-=p),(p=(g&gt;&gt;&gt;<span class="number">16</span>)&amp;<span class="number">255</span>),<span class="number">0</span>===p))A[n++]=<span class="number">65535</span>&amp;g;<span class="keyword">else</span>&#123;<span class="keyword">if</span>(!(<span class="number">16</span>&amp;p))&#123;<span class="keyword">if</span>(<span class="number">0</span>==(<span class="number">64</span>&amp;p))&#123;g=u[(<span class="number">65535</span>&amp;g)+(f&amp;((<span class="number">1</span>&lt;&lt;p)-<span class="number">1</span>))];<span class="keyword">continue</span> e&#125;<span class="keyword">if</span>(<span class="number">32</span>&amp;p)&#123;E.<span class="property">mode</span>=<span class="number">16191</span>;<span class="keyword">break</span> t&#125;(t.<span class="property">msg</span>=<span class="string">&#x27;invalid literal/length code&#x27;</span>),(E.<span class="property">mode</span>=he);<span class="keyword">break</span> t&#125;(k=<span class="number">65535</span>&amp;g),(p&amp;=<span class="number">15</span>),p&amp;&amp;(c&lt;p&amp;&amp;((f+=z[a++]&lt;&lt;c),(c+=<span class="number">8</span>)),(k+=f&amp;((<span class="number">1</span>&lt;&lt;p)-<span class="number">1</span>)),(f&gt;&gt;&gt;=p),(c-=p)),c&lt;<span class="number">15</span>&amp;&amp;((f+=z[a++]&lt;&lt;c),(c+=<span class="number">8</span>),(f+=z[a++]&lt;&lt;c),(c+=<span class="number">8</span>)),(g=w[f&amp;b]);<span class="attr">a</span>:<span class="keyword">for</span>(;;)&#123;<span class="keyword">if</span>(((p=g&gt;&gt;&gt;<span class="number">24</span>),(f&gt;&gt;&gt;=p),(c-=p),(p=(g&gt;&gt;&gt;<span class="number">16</span>)&amp;<span class="number">255</span>),!(<span class="number">16</span>&amp;p)))&#123;<span class="keyword">if</span>(<span class="number">0</span>==(<span class="number">64</span>&amp;p))&#123;g=w[(<span class="number">65535</span>&amp;g)+(f&amp;((<span class="number">1</span>&lt;&lt;p)-<span class="number">1</span>))];<span class="keyword">continue</span> a&#125;(t.<span class="property">msg</span>=<span class="string">&#x27;invalid distance code&#x27;</span>),(E.<span class="property">mode</span>=he);<span class="keyword">break</span> t&#125;<span class="keyword">if</span>(((v=<span class="number">65535</span>&amp;g),(p&amp;=<span class="number">15</span>),c&lt;p&amp;&amp;((f+=z[a++]&lt;&lt;c),(c+=<span class="number">8</span>),c&lt;p&amp;&amp;((f+=z[a++]&lt;&lt;c),(c+=<span class="number">8</span>))),(v+=f&amp;((<span class="number">1</span>&lt;&lt;p)-<span class="number">1</span>)),v&gt;o))&#123;(t.<span class="property">msg</span>=<span class="string">&#x27;invalid distance too far back&#x27;</span>),(E.<span class="property">mode</span>=he);<span class="keyword">break</span> t&#125;<span class="keyword">if</span>(((f&gt;&gt;&gt;=p),(c-=p),(p=n-s),v&gt;p))&#123;<span class="keyword">if</span>(((p=v-p),p&gt;h&amp;&amp;E.<span class="property">sane</span>))&#123;(t.<span class="property">msg</span>=<span class="string">&#x27;invalid distance too far back&#x27;</span>),(E.<span class="property">mode</span>=he);<span class="keyword">break</span> t&#125;<span class="keyword">if</span>(((y=<span class="number">0</span>),(x=_),<span class="number">0</span>===d))&#123;<span class="keyword">if</span>(((y+=l-p),p&lt;k))&#123;k-=p;<span class="keyword">do</span>&#123;A[n++]=_[y++]&#125;<span class="keyword">while</span>(--p);(y=n-v),(x=A)&#125;&#125;<span class="keyword">else</span> <span class="keyword">if</span>(d&lt;p)&#123;<span class="keyword">if</span>(((y+=l+d-p),(p-=d),p&lt;k))&#123;k-=p;<span class="keyword">do</span>&#123;A[n++]=_[y++]&#125;<span class="keyword">while</span>(--p);<span class="keyword">if</span>(((y=<span class="number">0</span>),d&lt;k))&#123;(p=d),(k-=p);<span class="keyword">do</span>&#123;A[n++]=_[y++]&#125;<span class="keyword">while</span>(--p);(y=n-v),(x=A)&#125;&#125;&#125;<span class="keyword">else</span> <span class="keyword">if</span>(((y+=d-p),p&lt;k))&#123;k-=p;<span class="keyword">do</span>&#123;A[n++]=_[y++]&#125;<span class="keyword">while</span>(--p);(y=n-v),(x=A)&#125;<span class="keyword">for</span>(;k&gt;<span class="number">2</span>;)(A[n++]=x[y++]),(A[n++]=x[y++]),(A[n++]=x[y++]),(k-=<span class="number">3</span>);k&amp;&amp;((A[n++]=x[y++]),k&gt;<span class="number">1</span>&amp;&amp;(A[n++]=x[y++]))&#125;<span class="keyword">else</span>&#123;y=n-v;<span class="keyword">do</span>&#123;(A[n++]=A[y++]),(A[n++]=A[y++]),(A[n++]=A[y++]),(k-=<span class="number">3</span>)&#125;<span class="keyword">while</span>(k&gt;<span class="number">2</span>);k&amp;&amp;((A[n++]=A[y++]),k&gt;<span class="number">1</span>&amp;&amp;(A[n++]=A[y++]))&#125;<span class="keyword">break</span>&#125;&#125;<span class="keyword">break</span>&#125;&#125;<span class="keyword">while</span>(a&lt;i&amp;&amp;n&lt;r);(k=c&gt;&gt;<span class="number">3</span>),(a-=k),(c-=k&lt;&lt;<span class="number">3</span>),(f&amp;=(<span class="number">1</span>&lt;&lt;c)-<span class="number">1</span>),(t.<span class="property">next_in</span>=a),(t.<span class="property">next_out</span>=n),(t.<span class="property">avail_in</span>=a&lt;i?i-a+<span class="number">5</span>:<span class="number">5</span>-(a-i)),(t.<span class="property">avail_out</span>=n&lt;r?r-n+<span class="number">257</span>:<span class="number">257</span>-(n-r)),(E.<span class="property">hold</span>=f),(E.<span class="property">bits</span>=c)&#125;;<span class="keyword">const</span> _e=<span class="number">15</span>,fe=<span class="keyword">new</span> <span class="title class_">Uint16Array</span>([<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">13</span>,<span class="number">15</span>,<span class="number">17</span>,<span class="number">19</span>,<span class="number">23</span>,<span class="number">27</span>,<span class="number">31</span>,<span class="number">35</span>,<span class="number">43</span>,<span class="number">51</span>,<span class="number">59</span>,<span class="number">67</span>,<span class="number">83</span>,<span class="number">99</span>,<span class="number">115</span>,<span class="number">131</span>,<span class="number">163</span>,<span class="number">195</span>,<span class="number">227</span>,<span class="number">258</span>,<span class="number">0</span>,<span class="number">0</span>]),ce=<span class="keyword">new</span> <span class="title class_">Uint8Array</span>([<span class="number">16</span>,<span class="number">16</span>,<span class="number">16</span>,<span class="number">16</span>,<span class="number">16</span>,<span class="number">16</span>,<span class="number">16</span>,<span class="number">16</span>,<span class="number">17</span>,<span class="number">17</span>,<span class="number">17</span>,<span class="number">17</span>,<span class="number">18</span>,<span class="number">18</span>,<span class="number">18</span>,<span class="number">18</span>,<span class="number">19</span>,<span class="number">19</span>,<span class="number">19</span>,<span class="number">19</span>,<span class="number">20</span>,<span class="number">20</span>,<span class="number">20</span>,<span class="number">20</span>,<span class="number">21</span>,<span class="number">21</span>,<span class="number">21</span>,<span class="number">21</span>,<span class="number">16</span>,<span class="number">72</span>,<span class="number">78</span>]),ue=<span class="keyword">new</span> <span class="title class_">Uint16Array</span>([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">7</span>,<span class="number">9</span>,<span class="number">13</span>,<span class="number">17</span>,<span class="number">25</span>,<span class="number">33</span>,<span class="number">49</span>,<span class="number">65</span>,<span class="number">97</span>,<span class="number">129</span>,<span class="number">193</span>,<span class="number">257</span>,<span class="number">385</span>,<span class="number">513</span>,<span class="number">769</span>,<span class="number">1025</span>,<span class="number">1537</span>,<span class="number">2049</span>,<span class="number">3073</span>,<span class="number">4097</span>,<span class="number">6145</span>,<span class="number">8193</span>,<span class="number">12289</span>,<span class="number">16385</span>,<span class="number">24577</span>,<span class="number">0</span>,<span class="number">0</span>]),we=<span class="keyword">new</span> <span class="title class_">Uint8Array</span>([<span class="number">16</span>,<span class="number">16</span>,<span class="number">16</span>,<span class="number">16</span>,<span class="number">17</span>,<span class="number">17</span>,<span class="number">18</span>,<span class="number">18</span>,<span class="number">19</span>,<span class="number">19</span>,<span class="number">20</span>,<span class="number">20</span>,<span class="number">21</span>,<span class="number">21</span>,<span class="number">22</span>,<span class="number">22</span>,<span class="number">23</span>,<span class="number">23</span>,<span class="number">24</span>,<span class="number">24</span>,<span class="number">25</span>,<span class="number">25</span>,<span class="number">26</span>,<span class="number">26</span>,<span class="number">27</span>,<span class="number">27</span>,<span class="number">28</span>,<span class="number">28</span>,<span class="number">29</span>,<span class="number">29</span>,<span class="number">64</span>,<span class="number">64</span>]);<span class="keyword">var</span> <span class="title function_">me</span>=(<span class="params">t,e,a,i,n,s,r,o</span>)=&gt;&#123;<span class="keyword">const</span> l=o.<span class="property">bits</span>;<span class="keyword">let</span> h,d,_,f,c,u,w=<span class="number">0</span>,m=<span class="number">0</span>,b=<span class="number">0</span>,g=<span class="number">0</span>,p=<span class="number">0</span>,k=<span class="number">0</span>,v=<span class="number">0</span>,y=<span class="number">0</span>,x=<span class="number">0</span>,z=<span class="number">0</span>,A=<span class="literal">null</span>;<span class="keyword">const</span> E=<span class="keyword">new</span> <span class="title class_">Uint16Array</span>(<span class="number">16</span>),R=<span class="keyword">new</span> <span class="title class_">Uint16Array</span>(<span class="number">16</span>);<span class="keyword">let</span> Z,U,S,D=<span class="literal">null</span>;<span class="keyword">for</span>(w=<span class="number">0</span>;w&lt;=_e;w++)E[w]=<span class="number">0</span>;<span class="keyword">for</span>(m=<span class="number">0</span>;m&lt;i;m++)E[e[a+m]]++;<span class="keyword">for</span>(p=l,g=_e;g&gt;=<span class="number">1</span>&amp;&amp;<span class="number">0</span>===E[g];g--);<span class="keyword">if</span>((p&gt;g&amp;&amp;(p=g),<span class="number">0</span>===g))<span class="keyword">return</span>(n[s++]=<span class="number">20971520</span>),(n[s++]=<span class="number">20971520</span>),(o.<span class="property">bits</span>=<span class="number">1</span>),<span class="number">0</span>;<span class="keyword">for</span>(b=<span class="number">1</span>;b&lt;g&amp;&amp;<span class="number">0</span>===E[b];b++);<span class="keyword">for</span>(p&lt;b&amp;&amp;(p=b),y=<span class="number">1</span>,w=<span class="number">1</span>;w&lt;=_e;w++)<span class="keyword">if</span>(((y&lt;&lt;=<span class="number">1</span>),(y-=E[w]),y&lt;<span class="number">0</span>))<span class="keyword">return</span>-<span class="number">1</span>;<span class="keyword">if</span>(y&gt;<span class="number">0</span>&amp;&amp;(<span class="number">0</span>===t||<span class="number">1</span>!==g))<span class="keyword">return</span>-<span class="number">1</span>;<span class="keyword">for</span>(R[<span class="number">1</span>]=<span class="number">0</span>,w=<span class="number">1</span>;w&lt;_e;w++)R[w+<span class="number">1</span>]=R[w]+E[w];<span class="keyword">for</span>(m=<span class="number">0</span>;m&lt;i;m++)<span class="number">0</span>!==e[a+m]&amp;&amp;(r[R[e[a+m]]++]=m);<span class="keyword">if</span>((<span class="number">0</span>===t?((A=D=r),(u=<span class="number">20</span>)):<span class="number">1</span>===t?((A=fe),(D=ce),(u=<span class="number">257</span>)):((A=ue),(D=we),(u=<span class="number">0</span>)),(z=<span class="number">0</span>),(m=<span class="number">0</span>),(w=b),(c=s),(k=p),(v=<span class="number">0</span>),(_=-<span class="number">1</span>),(x=<span class="number">1</span>&lt;&lt;p),(f=x-<span class="number">1</span>),(<span class="number">1</span>===t&amp;&amp;x&gt;<span class="number">852</span>)||(<span class="number">2</span>===t&amp;&amp;x&gt;<span class="number">592</span>)))<span class="keyword">return</span> <span class="number">1</span>;<span class="keyword">for</span>(;;)&#123;(Z=w-v),r[m]+<span class="number">1</span>&lt;u?((U=<span class="number">0</span>),(S=r[m])):r[m]&gt;=u?((U=D[r[m]-u]),(S=A[r[m]-u])):((U=<span class="number">96</span>),(S=<span class="number">0</span>)),(h=<span class="number">1</span>&lt;&lt;(w-v)),(d=<span class="number">1</span>&lt;&lt;k),(b=d);<span class="keyword">do</span>&#123;(d-=h),(n[c+(z&gt;&gt;v)+d]=(Z&lt;&lt;<span class="number">24</span>)|(U&lt;&lt;<span class="number">16</span>)|S|<span class="number">0</span>)&#125;<span class="keyword">while</span>(<span class="number">0</span>!==d);<span class="keyword">for</span>(h=<span class="number">1</span>&lt;&lt;(w-<span class="number">1</span>);z&amp;h;)h&gt;&gt;=<span class="number">1</span>;<span class="keyword">if</span>((<span class="number">0</span>!==h?((z&amp;=h-<span class="number">1</span>),(z+=h)):(z=<span class="number">0</span>),m++,<span class="number">0</span>==--E[w]))&#123;<span class="keyword">if</span>(w===g)<span class="keyword">break</span>;w=e[a+r[m]]&#125;<span class="keyword">if</span>(w&gt;p&amp;&amp;(z&amp;f)!==_)&#123;<span class="keyword">for</span>(<span class="number">0</span>===v&amp;&amp;(v=p),c+=b,k=w-v,y=<span class="number">1</span>&lt;&lt;k;k+v&lt;g&amp;&amp;((y-=E[k+v]),!(y&lt;=<span class="number">0</span>));)k++,(y&lt;&lt;=<span class="number">1</span>);<span class="keyword">if</span>(((x+=<span class="number">1</span>&lt;&lt;k),(<span class="number">1</span>===t&amp;&amp;x&gt;<span class="number">852</span>)||(<span class="number">2</span>===t&amp;&amp;x&gt;<span class="number">592</span>)))<span class="keyword">return</span> <span class="number">1</span>;(_=z&amp;f),(n[_]=(p&lt;&lt;<span class="number">24</span>)|(k&lt;&lt;<span class="number">16</span>)|(c-s)|<span class="number">0</span>)&#125;&#125;<span class="keyword">return</span>(<span class="number">0</span>!==z&amp;&amp;(n[c+z]=((w-v)&lt;&lt;<span class="number">24</span>)|(<span class="number">64</span>&lt;&lt;<span class="number">16</span>)|<span class="number">0</span>),(o.<span class="property">bits</span>=p),<span class="number">0</span>)&#125;;<span class="keyword">const</span>&#123;<span class="attr">Z_FINISH</span>:be,<span class="attr">Z_BLOCK</span>:ge,<span class="attr">Z_TREES</span>:pe,<span class="attr">Z_OK</span>:ke,<span class="attr">Z_STREAM_END</span>:ve,<span class="attr">Z_NEED_DICT</span>:ye,<span class="attr">Z_STREAM_ERROR</span>:xe,<span class="attr">Z_DATA_ERROR</span>:ze,<span class="attr">Z_MEM_ERROR</span>:<span class="title class_">Ae</span>,<span class="attr">Z_BUF_ERROR</span>:<span class="title class_">Ee</span>,<span class="attr">Z_DEFLATED</span>:<span class="title class_">Re</span>&#125;=K,<span class="title class_">Ze</span>=<span class="number">16180</span>,<span class="title class_">Ue</span>=<span class="number">16190</span>,<span class="title class_">Se</span>=<span class="number">16191</span>,<span class="title class_">De</span>=<span class="number">16192</span>,<span class="title class_">Te</span>=<span class="number">16194</span>,<span class="title class_">Oe</span>=<span class="number">16199</span>,<span class="title class_">Ie</span>=<span class="number">16200</span>,<span class="title class_">Fe</span>=<span class="number">16206</span>,<span class="title class_">Le</span>=<span class="number">16209</span>,<span class="title class_">Ne</span>=<span class="function">(<span class="params">t</span>)=&gt;</span>((t&gt;&gt;&gt;<span class="number">24</span>)&amp;<span class="number">255</span>)+((t&gt;&gt;&gt;<span class="number">8</span>)&amp;<span class="number">65280</span>)+((<span class="number">65280</span>&amp;t)&lt;&lt;<span class="number">8</span>)+((<span class="number">255</span>&amp;t)&lt;&lt;<span class="number">24</span>);<span class="keyword">function</span> <span class="title function_">Be</span>(<span class="params"></span>)&#123;(<span class="variable language_">this</span>.<span class="property">strm</span>=<span class="literal">null</span>),(<span class="variable language_">this</span>.<span class="property">mode</span>=<span class="number">0</span>),(<span class="variable language_">this</span>.<span class="property">last</span>=!<span class="number">1</span>),(<span class="variable language_">this</span>.<span class="property">wrap</span>=<span class="number">0</span>),(<span class="variable language_">this</span>.<span class="property">havedict</span>=!<span class="number">1</span>),(<span class="variable language_">this</span>.<span class="property">flags</span>=<span class="number">0</span>),(<span class="variable language_">this</span>.<span class="property">dmax</span>=<span class="number">0</span>),(<span class="variable language_">this</span>.<span class="property">check</span>=<span class="number">0</span>),(<span class="variable language_">this</span>.<span class="property">total</span>=<span class="number">0</span>),(<span class="variable language_">this</span>.<span class="property">head</span>=<span class="literal">null</span>),(<span class="variable language_">this</span>.<span class="property">wbits</span>=<span class="number">0</span>),(<span class="variable language_">this</span>.<span class="property">wsize</span>=<span class="number">0</span>),(<span class="variable language_">this</span>.<span class="property">whave</span>=<span class="number">0</span>),(<span class="variable language_">this</span>.<span class="property">wnext</span>=<span class="number">0</span>),(<span class="variable language_">this</span>.<span class="property">window</span>=<span class="literal">null</span>),(<span class="variable language_">this</span>.<span class="property">hold</span>=<span class="number">0</span>),(<span class="variable language_">this</span>.<span class="property">bits</span>=<span class="number">0</span>),(<span class="variable language_">this</span>.<span class="property">length</span>=<span class="number">0</span>),(<span class="variable language_">this</span>.<span class="property">offset</span>=<span class="number">0</span>),(<span class="variable language_">this</span>.<span class="property">extra</span>=<span class="number">0</span>),(<span class="variable language_">this</span>.<span class="property">lencode</span>=<span class="literal">null</span>),(<span class="variable language_">this</span>.<span class="property">distcode</span>=<span class="literal">null</span>),(<span class="variable language_">this</span>.<span class="property">lenbits</span>=<span class="number">0</span>),(<span class="variable language_">this</span>.<span class="property">distbits</span>=<span class="number">0</span>),(<span class="variable language_">this</span>.<span class="property">ncode</span>=<span class="number">0</span>),(<span class="variable language_">this</span>.<span class="property">nlen</span>=<span class="number">0</span>),(<span class="variable language_">this</span>.<span class="property">ndist</span>=<span class="number">0</span>),(<span class="variable language_">this</span>.<span class="property">have</span>=<span class="number">0</span>),(<span class="variable language_">this</span>.<span class="property">next</span>=<span class="literal">null</span>),(<span class="variable language_">this</span>.<span class="property">lens</span>=<span class="keyword">new</span> <span class="title class_">Uint16Array</span>(<span class="number">320</span>)),(<span class="variable language_">this</span>.<span class="property">work</span>=<span class="keyword">new</span> <span class="title class_">Uint16Array</span>(<span class="number">288</span>)),(<span class="variable language_">this</span>.<span class="property">lendyn</span>=<span class="literal">null</span>),(<span class="variable language_">this</span>.<span class="property">distdyn</span>=<span class="literal">null</span>),(<span class="variable language_">this</span>.<span class="property">sane</span>=<span class="number">0</span>),(<span class="variable language_">this</span>.<span class="property">back</span>=<span class="number">0</span>),(<span class="variable language_">this</span>.<span class="property">was</span>=<span class="number">0</span>)&#125;<span class="keyword">const</span> <span class="title function_">Ce</span>=(<span class="params">t</span>)=&gt;&#123;<span class="keyword">if</span>(!t)<span class="keyword">return</span> <span class="number">1</span>;<span class="keyword">const</span> e=t.<span class="property">state</span>;<span class="keyword">return</span>!e||e.<span class="property">strm</span>!==t||e.<span class="property">mode</span>&lt;<span class="title class_">Ze</span>||e.<span class="property">mode</span>&gt;<span class="number">16211</span>?<span class="number">1</span>:<span class="number">0</span>&#125;,<span class="title class_">Me</span>=<span class="function">(<span class="params">t</span>)=&gt;</span>&#123;<span class="keyword">if</span>(<span class="title class_">Ce</span>(t))<span class="keyword">return</span> xe;<span class="keyword">const</span> e=t.<span class="property">state</span>;<span class="keyword">return</span>((t.<span class="property">total_in</span>=t.<span class="property">total_out</span>=e.<span class="property">total</span>=<span class="number">0</span>),(t.<span class="property">msg</span>=<span class="string">&#x27;&#x27;</span>),e.<span class="property">wrap</span>&amp;&amp;(t.<span class="property">adler</span>=<span class="number">1</span>&amp;e.<span class="property">wrap</span>),(e.<span class="property">mode</span>=<span class="title class_">Ze</span>),(e.<span class="property">last</span>=<span class="number">0</span>),(e.<span class="property">havedict</span>=<span class="number">0</span>),(e.<span class="property">flags</span>=-<span class="number">1</span>),(e.<span class="property">dmax</span>=<span class="number">32768</span>),(e.<span class="property">head</span>=<span class="literal">null</span>),(e.<span class="property">hold</span>=<span class="number">0</span>),(e.<span class="property">bits</span>=<span class="number">0</span>),(e.<span class="property">lencode</span>=e.<span class="property">lendyn</span>=<span class="keyword">new</span> <span class="title class_">Int32Array</span>(<span class="number">852</span>)),(e.<span class="property">distcode</span>=e.<span class="property">distdyn</span>=<span class="keyword">new</span> <span class="title class_">Int32Array</span>(<span class="number">592</span>)),(e.<span class="property">sane</span>=<span class="number">1</span>),(e.<span class="property">back</span>=-<span class="number">1</span>),ke)&#125;,<span class="title class_">He</span>=<span class="function">(<span class="params">t</span>)=&gt;</span>&#123;<span class="keyword">if</span>(<span class="title class_">Ce</span>(t))<span class="keyword">return</span> xe;<span class="keyword">const</span> e=t.<span class="property">state</span>;<span class="keyword">return</span>(e.<span class="property">wsize</span>=<span class="number">0</span>),(e.<span class="property">whave</span>=<span class="number">0</span>),(e.<span class="property">wnext</span>=<span class="number">0</span>),<span class="title class_">Me</span>(t)&#125;,je=<span class="function">(<span class="params">t,e</span>)=&gt;</span>&#123;<span class="keyword">let</span> a;<span class="keyword">if</span>(<span class="title class_">Ce</span>(t))<span class="keyword">return</span> xe;<span class="keyword">const</span> i=t.<span class="property">state</span>;<span class="keyword">return</span>(e&lt;<span class="number">0</span>?((a=<span class="number">0</span>),(e=-e)):((a=<span class="number">5</span>+(e&gt;&gt;<span class="number">4</span>)),e&lt;<span class="number">48</span>&amp;&amp;(e&amp;=<span class="number">15</span>)),e&amp;&amp;(e&lt;<span class="number">8</span>||e&gt;<span class="number">15</span>)?<span class="attr">xe</span>:(<span class="literal">null</span>!==i.<span class="property">window</span>&amp;&amp;i.<span class="property">wbits</span>!==e&amp;&amp;(i.<span class="property">window</span>=<span class="literal">null</span>),(i.<span class="property">wrap</span>=a),(i.<span class="property">wbits</span>=e),<span class="title class_">He</span>(t)))&#125;,<span class="title class_">Ke</span>=<span class="function">(<span class="params">t,e</span>)=&gt;</span>&#123;<span class="keyword">if</span>(!t)<span class="keyword">return</span> xe;<span class="keyword">const</span> a=<span class="keyword">new</span> <span class="title class_">Be</span>();(t.<span class="property">state</span>=a),(a.<span class="property">strm</span>=t),(a.<span class="property">window</span>=<span class="literal">null</span>),(a.<span class="property">mode</span>=<span class="title class_">Ze</span>);<span class="keyword">const</span> i=<span class="title function_">je</span>(t,e);<span class="keyword">return</span> i!==ke&amp;&amp;(t.<span class="property">state</span>=<span class="literal">null</span>),i&#125;;<span class="keyword">let</span> <span class="title class_">Pe</span>,<span class="title class_">Ye</span>,<span class="title class_">Ge</span>=!<span class="number">0</span>;<span class="keyword">const</span> <span class="title function_">Xe</span>=(<span class="params">t</span>)=&gt;&#123;<span class="keyword">if</span>(<span class="title class_">Ge</span>)&#123;(<span class="title class_">Pe</span>=<span class="keyword">new</span> <span class="title class_">Int32Array</span>(<span class="number">512</span>)),(<span class="title class_">Ye</span>=<span class="keyword">new</span> <span class="title class_">Int32Array</span>(<span class="number">32</span>));<span class="keyword">let</span> e=<span class="number">0</span>;<span class="keyword">for</span>(;e&lt;<span class="number">144</span>;)t.<span class="property">lens</span>[e++]=<span class="number">8</span>;<span class="keyword">for</span>(;e&lt;<span class="number">256</span>;)t.<span class="property">lens</span>[e++]=<span class="number">9</span>;<span class="keyword">for</span>(;e&lt;<span class="number">280</span>;)t.<span class="property">lens</span>[e++]=<span class="number">7</span>;<span class="keyword">for</span>(;e&lt;<span class="number">288</span>;)t.<span class="property">lens</span>[e++]=<span class="number">8</span>;<span class="keyword">for</span>(<span class="title function_">me</span>(<span class="number">1</span>,t.<span class="property">lens</span>,<span class="number">0</span>,<span class="number">288</span>,<span class="title class_">Pe</span>,<span class="number">0</span>,t.<span class="property">work</span>,&#123;<span class="attr">bits</span>:<span class="number">9</span>&#125;),e=<span class="number">0</span>;e&lt;<span class="number">32</span>;)t.<span class="property">lens</span>[e++]=<span class="number">5</span>;<span class="title function_">me</span>(<span class="number">2</span>,t.<span class="property">lens</span>,<span class="number">0</span>,<span class="number">32</span>,<span class="title class_">Ye</span>,<span class="number">0</span>,t.<span class="property">work</span>,&#123;<span class="attr">bits</span>:<span class="number">5</span>&#125;),(<span class="title class_">Ge</span>=!<span class="number">1</span>)&#125;(t.<span class="property">lencode</span>=<span class="title class_">Pe</span>),(t.<span class="property">lenbits</span>=<span class="number">9</span>),(t.<span class="property">distcode</span>=<span class="title class_">Ye</span>),(t.<span class="property">distbits</span>=<span class="number">5</span>)&#125;,<span class="title class_">We</span>=<span class="function">(<span class="params">t,e,a,i</span>)=&gt;</span>&#123;<span class="keyword">let</span> n;<span class="keyword">const</span> s=t.<span class="property">state</span>;<span class="keyword">return</span>(<span class="literal">null</span>===s.<span class="property">window</span>&amp;&amp;((s.<span class="property">wsize</span>=<span class="number">1</span>&lt;&lt;s.<span class="property">wbits</span>),(s.<span class="property">wnext</span>=<span class="number">0</span>),(s.<span class="property">whave</span>=<span class="number">0</span>),(s.<span class="property">window</span>=<span class="keyword">new</span> <span class="title class_">Uint8Array</span>(s.<span class="property">wsize</span>))),i&gt;=s.<span class="property">wsize</span>?(s.<span class="property">window</span>.<span class="title function_">set</span>(e.<span class="title function_">subarray</span>(a-s.<span class="property">wsize</span>,a),<span class="number">0</span>),(s.<span class="property">wnext</span>=<span class="number">0</span>),(s.<span class="property">whave</span>=s.<span class="property">wsize</span>)):((n=s.<span class="property">wsize</span>-s.<span class="property">wnext</span>),n&gt;i&amp;&amp;(n=i),s.<span class="property">window</span>.<span class="title function_">set</span>(e.<span class="title function_">subarray</span>(a-i,a-i+n),s.<span class="property">wnext</span>),(i-=n)?(s.<span class="property">window</span>.<span class="title function_">set</span>(e.<span class="title function_">subarray</span>(a-i,a),<span class="number">0</span>),(s.<span class="property">wnext</span>=i),(s.<span class="property">whave</span>=s.<span class="property">wsize</span>)):((s.<span class="property">wnext</span>+=n),s.<span class="property">wnext</span>===s.<span class="property">wsize</span>&amp;&amp;(s.<span class="property">wnext</span>=<span class="number">0</span>),s.<span class="property">whave</span>&lt;s.<span class="property">wsize</span>&amp;&amp;(s.<span class="property">whave</span>+=n))),<span class="number">0</span>)&#125;;<span class="keyword">var</span> qe=&#123;<span class="attr">inflateReset</span>:<span class="title class_">He</span>,<span class="attr">inflateReset2</span>:je,<span class="attr">inflateResetKeep</span>:<span class="title class_">Me</span>,<span class="attr">inflateInit</span>:<span class="function">(<span class="params">t</span>)=&gt;</span><span class="title class_">Ke</span>(t,<span class="number">15</span>),<span class="attr">inflateInit2</span>:<span class="title class_">Ke</span>,<span class="attr">inflate</span>:<span class="function">(<span class="params">t,e</span>)=&gt;</span>&#123;<span class="keyword">let</span> a,i,n,s,r,o,l,h,d,_,f,c,u,w,m,b,g,p,k,v,y,x,z=<span class="number">0</span>;<span class="keyword">const</span> A=<span class="keyword">new</span> <span class="title class_">Uint8Array</span>(<span class="number">4</span>);<span class="keyword">let</span> E,R;<span class="keyword">const</span> Z=<span class="keyword">new</span> <span class="title class_">Uint8Array</span>([<span class="number">16</span>,<span class="number">17</span>,<span class="number">18</span>,<span class="number">0</span>,<span class="number">8</span>,<span class="number">7</span>,<span class="number">9</span>,<span class="number">6</span>,<span class="number">10</span>,<span class="number">5</span>,<span class="number">11</span>,<span class="number">4</span>,<span class="number">12</span>,<span class="number">3</span>,<span class="number">13</span>,<span class="number">2</span>,<span class="number">14</span>,<span class="number">1</span>,<span class="number">15</span>]);<span class="keyword">if</span>(<span class="title class_">Ce</span>(t)||!t.<span class="property">output</span>||(!t.<span class="property">input</span>&amp;&amp;<span class="number">0</span>!==t.<span class="property">avail_in</span>))<span class="keyword">return</span> xe;(a=t.<span class="property">state</span>),a.<span class="property">mode</span>===<span class="title class_">Se</span>&amp;&amp;(a.<span class="property">mode</span>=<span class="title class_">De</span>),(r=t.<span class="property">next_out</span>),(n=t.<span class="property">output</span>),(l=t.<span class="property">avail_out</span>),(s=t.<span class="property">next_in</span>),(i=t.<span class="property">input</span>),(o=t.<span class="property">avail_in</span>),(h=a.<span class="property">hold</span>),(d=a.<span class="property">bits</span>),(_=o),(f=l),(x=ke);<span class="attr">t</span>:<span class="keyword">for</span>(;;)<span class="keyword">switch</span>(a.<span class="property">mode</span>)&#123;<span class="keyword">case</span> <span class="title class_">Ze</span>:<span class="keyword">if</span>(<span class="number">0</span>===a.<span class="property">wrap</span>)&#123;a.<span class="property">mode</span>=<span class="title class_">De</span>;<span class="keyword">break</span>&#125;<span class="keyword">for</span>(;d&lt;<span class="number">16</span>;)&#123;<span class="keyword">if</span>(<span class="number">0</span>===o)<span class="keyword">break</span> t;o--,(h+=i[s++]&lt;&lt;d),(d+=<span class="number">8</span>)&#125;<span class="keyword">if</span>(<span class="number">2</span>&amp;a.<span class="property">wrap</span>&amp;&amp;<span class="number">35615</span>===h)&#123;<span class="number">0</span>===a.<span class="property">wbits</span>&amp;&amp;(a.<span class="property">wbits</span>=<span class="number">15</span>),(a.<span class="property">check</span>=<span class="number">0</span>),(A[<span class="number">0</span>]=<span class="number">255</span>&amp;h),(A[<span class="number">1</span>]=(h&gt;&gt;&gt;<span class="number">8</span>)&amp;<span class="number">255</span>),(a.<span class="property">check</span>=<span class="title function_">H</span>(a.<span class="property">check</span>,A,<span class="number">2</span>,<span class="number">0</span>)),(h=<span class="number">0</span>),(d=<span class="number">0</span>),(a.<span class="property">mode</span>=<span class="number">16181</span>);<span class="keyword">break</span>&#125;<span class="keyword">if</span>((a.<span class="property">head</span>&amp;&amp;(a.<span class="property">head</span>.<span class="property">done</span>=!<span class="number">1</span>),!(<span class="number">1</span>&amp;a.<span class="property">wrap</span>)||(((<span class="number">255</span>&amp;h)&lt;&lt;<span class="number">8</span>)+(h&gt;&gt;<span class="number">8</span>))%<span class="number">31</span>))&#123;(t.<span class="property">msg</span>=<span class="string">&#x27;incorrect header check&#x27;</span>),(a.<span class="property">mode</span>=<span class="title class_">Le</span>);<span class="keyword">break</span>&#125;<span class="keyword">if</span>((<span class="number">15</span>&amp;h)!==<span class="title class_">Re</span>)&#123;(t.<span class="property">msg</span>=<span class="string">&#x27;unknown compression method&#x27;</span>),(a.<span class="property">mode</span>=<span class="title class_">Le</span>);<span class="keyword">break</span>&#125;<span class="keyword">if</span>(((h&gt;&gt;&gt;=<span class="number">4</span>),(d-=<span class="number">4</span>),(y=<span class="number">8</span>+(<span class="number">15</span>&amp;h)),<span class="number">0</span>===a.<span class="property">wbits</span>&amp;&amp;(a.<span class="property">wbits</span>=y),y&gt;<span class="number">15</span>||y&gt;a.<span class="property">wbits</span>))&#123;(t.<span class="property">msg</span>=<span class="string">&#x27;invalid window size&#x27;</span>),(a.<span class="property">mode</span>=<span class="title class_">Le</span>);<span class="keyword">break</span>&#125;(a.<span class="property">dmax</span>=<span class="number">1</span>&lt;&lt;a.<span class="property">wbits</span>),(a.<span class="property">flags</span>=<span class="number">0</span>),(t.<span class="property">adler</span>=a.<span class="property">check</span>=<span class="number">1</span>),(a.<span class="property">mode</span>=<span class="number">512</span>&amp;h?<span class="number">16189</span>:<span class="title class_">Se</span>),(h=<span class="number">0</span>),(d=<span class="number">0</span>);<span class="keyword">break</span>;<span class="keyword">case</span> <span class="number">16181</span>:<span class="keyword">for</span>(;d&lt;<span class="number">16</span>;)&#123;<span class="keyword">if</span>(<span class="number">0</span>===o)<span class="keyword">break</span> t;o--,(h+=i[s++]&lt;&lt;d),(d+=<span class="number">8</span>)&#125;<span class="keyword">if</span>(((a.<span class="property">flags</span>=h),(<span class="number">255</span>&amp;a.<span class="property">flags</span>)!==<span class="title class_">Re</span>))&#123;(t.<span class="property">msg</span>=<span class="string">&#x27;unknown compression method&#x27;</span>),(a.<span class="property">mode</span>=<span class="title class_">Le</span>);<span class="keyword">break</span>&#125;<span class="keyword">if</span>(<span class="number">57344</span>&amp;a.<span class="property">flags</span>)&#123;(t.<span class="property">msg</span>=<span class="string">&#x27;unknown header flags set&#x27;</span>),(a.<span class="property">mode</span>=<span class="title class_">Le</span>);<span class="keyword">break</span>&#125;a.<span class="property">head</span>&amp;&amp;(a.<span class="property">head</span>.<span class="property">text</span>=(h&gt;&gt;<span class="number">8</span>)&amp;<span class="number">1</span>),<span class="number">512</span>&amp;a.<span class="property">flags</span>&amp;&amp;<span class="number">4</span>&amp;a.<span class="property">wrap</span>&amp;&amp;((A[<span class="number">0</span>]=<span class="number">255</span>&amp;h),(A[<span class="number">1</span>]=(h&gt;&gt;&gt;<span class="number">8</span>)&amp;<span class="number">255</span>),(a.<span class="property">check</span>=<span class="title function_">H</span>(a.<span class="property">check</span>,A,<span class="number">2</span>,<span class="number">0</span>))),(h=<span class="number">0</span>),(d=<span class="number">0</span>),(a.<span class="property">mode</span>=<span class="number">16182</span>);<span class="keyword">case</span> <span class="number">16182</span>:<span class="keyword">for</span>(;d&lt;<span class="number">32</span>;)&#123;<span class="keyword">if</span>(<span class="number">0</span>===o)<span class="keyword">break</span> t;o--,(h+=i[s++]&lt;&lt;d),(d+=<span class="number">8</span>)&#125;a.<span class="property">head</span>&amp;&amp;(a.<span class="property">head</span>.<span class="property">time</span>=h),<span class="number">512</span>&amp;a.<span class="property">flags</span>&amp;&amp;<span class="number">4</span>&amp;a.<span class="property">wrap</span>&amp;&amp;((A[<span class="number">0</span>]=<span class="number">255</span>&amp;h),(A[<span class="number">1</span>]=(h&gt;&gt;&gt;<span class="number">8</span>)&amp;<span class="number">255</span>),(A[<span class="number">2</span>]=(h&gt;&gt;&gt;<span class="number">16</span>)&amp;<span class="number">255</span>),(A[<span class="number">3</span>]=(h&gt;&gt;&gt;<span class="number">24</span>)&amp;<span class="number">255</span>),(a.<span class="property">check</span>=<span class="title function_">H</span>(a.<span class="property">check</span>,A,<span class="number">4</span>,<span class="number">0</span>))),(h=<span class="number">0</span>),(d=<span class="number">0</span>),(a.<span class="property">mode</span>=<span class="number">16183</span>);<span class="keyword">case</span> <span class="number">16183</span>:<span class="keyword">for</span>(;d&lt;<span class="number">16</span>;)&#123;<span class="keyword">if</span>(<span class="number">0</span>===o)<span class="keyword">break</span> t;o--,(h+=i[s++]&lt;&lt;d),(d+=<span class="number">8</span>)&#125;a.<span class="property">head</span>&amp;&amp;((a.<span class="property">head</span>.<span class="property">xflags</span>=<span class="number">255</span>&amp;h),(a.<span class="property">head</span>.<span class="property">os</span>=h&gt;&gt;<span class="number">8</span>)),<span class="number">512</span>&amp;a.<span class="property">flags</span>&amp;&amp;<span class="number">4</span>&amp;a.<span class="property">wrap</span>&amp;&amp;((A[<span class="number">0</span>]=<span class="number">255</span>&amp;h),(A[<span class="number">1</span>]=(h&gt;&gt;&gt;<span class="number">8</span>)&amp;<span class="number">255</span>),(a.<span class="property">check</span>=<span class="title function_">H</span>(a.<span class="property">check</span>,A,<span class="number">2</span>,<span class="number">0</span>))),(h=<span class="number">0</span>),(d=<span class="number">0</span>),(a.<span class="property">mode</span>=<span class="number">16184</span>);<span class="keyword">case</span> <span class="number">16184</span>:<span class="keyword">if</span>(<span class="number">1024</span>&amp;a.<span class="property">flags</span>)&#123;<span class="keyword">for</span>(;d&lt;<span class="number">16</span>;)&#123;<span class="keyword">if</span>(<span class="number">0</span>===o)<span class="keyword">break</span> t;o--,(h+=i[s++]&lt;&lt;d),(d+=<span class="number">8</span>)&#125;(a.<span class="property">length</span>=h),a.<span class="property">head</span>&amp;&amp;(a.<span class="property">head</span>.<span class="property">extra_len</span>=h),<span class="number">512</span>&amp;a.<span class="property">flags</span>&amp;&amp;<span class="number">4</span>&amp;a.<span class="property">wrap</span>&amp;&amp;((A[<span class="number">0</span>]=<span class="number">255</span>&amp;h),(A[<span class="number">1</span>]=(h&gt;&gt;&gt;<span class="number">8</span>)&amp;<span class="number">255</span>),(a.<span class="property">check</span>=<span class="title function_">H</span>(a.<span class="property">check</span>,A,<span class="number">2</span>,<span class="number">0</span>))),(h=<span class="number">0</span>),(d=<span class="number">0</span>)&#125;<span class="keyword">else</span> a.<span class="property">head</span>&amp;&amp;(a.<span class="property">head</span>.<span class="property">extra</span>=<span class="literal">null</span>);a.<span class="property">mode</span>=<span class="number">16185</span>;<span class="keyword">case</span> <span class="number">16185</span>:<span class="keyword">if</span>(<span class="number">1024</span>&amp;a.<span class="property">flags</span>&amp;&amp;((c=a.<span class="property">length</span>),c&gt;o&amp;&amp;(c=o),c&amp;&amp;(a.<span class="property">head</span>&amp;&amp;((y=a.<span class="property">head</span>.<span class="property">extra_len</span>-a.<span class="property">length</span>),a.<span class="property">head</span>.<span class="property">extra</span>||(a.<span class="property">head</span>.<span class="property">extra</span>=<span class="keyword">new</span> <span class="title class_">Uint8Array</span>(a.<span class="property">head</span>.<span class="property">extra_len</span>)),a.<span class="property">head</span>.<span class="property">extra</span>.<span class="title function_">set</span>(i.<span class="title function_">subarray</span>(s,s+c),y)),<span class="number">512</span>&amp;a.<span class="property">flags</span>&amp;&amp;<span class="number">4</span>&amp;a.<span class="property">wrap</span>&amp;&amp;(a.<span class="property">check</span>=<span class="title function_">H</span>(a.<span class="property">check</span>,i,c,s)),(o-=c),(s+=c),(a.<span class="property">length</span>-=c)),a.<span class="property">length</span>))<span class="keyword">break</span> t;(a.<span class="property">length</span>=<span class="number">0</span>),(a.<span class="property">mode</span>=<span class="number">16186</span>);<span class="keyword">case</span> <span class="number">16186</span>:<span class="keyword">if</span>(<span class="number">2048</span>&amp;a.<span class="property">flags</span>)&#123;<span class="keyword">if</span>(<span class="number">0</span>===o)<span class="keyword">break</span> t;c=<span class="number">0</span>;<span class="keyword">do</span>&#123;(y=i[s+c++]),a.<span class="property">head</span>&amp;&amp;y&amp;&amp;a.<span class="property">length</span>&lt;<span class="number">65536</span>&amp;&amp;(a.<span class="property">head</span>.<span class="property">name</span>+=<span class="title class_">String</span>.<span class="title function_">fromCharCode</span>(y))&#125;<span class="keyword">while</span>(y&amp;&amp;c&lt;o);<span class="keyword">if</span>((<span class="number">512</span>&amp;a.<span class="property">flags</span>&amp;&amp;<span class="number">4</span>&amp;a.<span class="property">wrap</span>&amp;&amp;(a.<span class="property">check</span>=<span class="title function_">H</span>(a.<span class="property">check</span>,i,c,s)),(o-=c),(s+=c),y))<span class="keyword">break</span> t&#125;<span class="keyword">else</span> a.<span class="property">head</span>&amp;&amp;(a.<span class="property">head</span>.<span class="property">name</span>=<span class="literal">null</span>);(a.<span class="property">length</span>=<span class="number">0</span>),(a.<span class="property">mode</span>=<span class="number">16187</span>);<span class="keyword">case</span> <span class="number">16187</span>:<span class="keyword">if</span>(<span class="number">4096</span>&amp;a.<span class="property">flags</span>)&#123;<span class="keyword">if</span>(<span class="number">0</span>===o)<span class="keyword">break</span> t;c=<span class="number">0</span>;<span class="keyword">do</span>&#123;(y=i[s+c++]),a.<span class="property">head</span>&amp;&amp;y&amp;&amp;a.<span class="property">length</span>&lt;<span class="number">65536</span>&amp;&amp;(a.<span class="property">head</span>.<span class="property">comment</span>+=<span class="title class_">String</span>.<span class="title function_">fromCharCode</span>(y))&#125;<span class="keyword">while</span>(y&amp;&amp;c&lt;o);<span class="keyword">if</span>((<span class="number">512</span>&amp;a.<span class="property">flags</span>&amp;&amp;<span class="number">4</span>&amp;a.<span class="property">wrap</span>&amp;&amp;(a.<span class="property">check</span>=<span class="title function_">H</span>(a.<span class="property">check</span>,i,c,s)),(o-=c),(s+=c),y))<span class="keyword">break</span> t&#125;<span class="keyword">else</span> a.<span class="property">head</span>&amp;&amp;(a.<span class="property">head</span>.<span class="property">comment</span>=<span class="literal">null</span>);a.<span class="property">mode</span>=<span class="number">16188</span>;<span class="keyword">case</span> <span class="number">16188</span>:<span class="keyword">if</span>(<span class="number">512</span>&amp;a.<span class="property">flags</span>)&#123;<span class="keyword">for</span>(;d&lt;<span class="number">16</span>;)&#123;<span class="keyword">if</span>(<span class="number">0</span>===o)<span class="keyword">break</span> t;o--,(h+=i[s++]&lt;&lt;d),(d+=<span class="number">8</span>)&#125;<span class="keyword">if</span>(<span class="number">4</span>&amp;a.<span class="property">wrap</span>&amp;&amp;h!==(<span class="number">65535</span>&amp;a.<span class="property">check</span>))&#123;(t.<span class="property">msg</span>=<span class="string">&#x27;header crc mismatch&#x27;</span>),(a.<span class="property">mode</span>=<span class="title class_">Le</span>);<span class="keyword">break</span>&#125;(h=<span class="number">0</span>),(d=<span class="number">0</span>)&#125;a.<span class="property">head</span>&amp;&amp;((a.<span class="property">head</span>.<span class="property">hcrc</span>=(a.<span class="property">flags</span>&gt;&gt;<span class="number">9</span>)&amp;<span class="number">1</span>),(a.<span class="property">head</span>.<span class="property">done</span>=!<span class="number">0</span>)),(t.<span class="property">adler</span>=a.<span class="property">check</span>=<span class="number">0</span>),(a.<span class="property">mode</span>=<span class="title class_">Se</span>);<span class="keyword">break</span>;<span class="keyword">case</span> <span class="number">16189</span>:<span class="keyword">for</span>(;d&lt;<span class="number">32</span>;)&#123;<span class="keyword">if</span>(<span class="number">0</span>===o)<span class="keyword">break</span> t;o--,(h+=i[s++]&lt;&lt;d),(d+=<span class="number">8</span>)&#125;(t.<span class="property">adler</span>=a.<span class="property">check</span>=<span class="title class_">Ne</span>(h)),(h=<span class="number">0</span>),(d=<span class="number">0</span>),(a.<span class="property">mode</span>=<span class="title class_">Ue</span>);<span class="keyword">case</span> <span class="title class_">Ue</span>:<span class="keyword">if</span>(<span class="number">0</span>===a.<span class="property">havedict</span>)<span class="keyword">return</span>((t.<span class="property">next_out</span>=r),(t.<span class="property">avail_out</span>=l),(t.<span class="property">next_in</span>=s),(t.<span class="property">avail_in</span>=o),(a.<span class="property">hold</span>=h),(a.<span class="property">bits</span>=d),ye);(t.<span class="property">adler</span>=a.<span class="property">check</span>=<span class="number">1</span>),(a.<span class="property">mode</span>=<span class="title class_">Se</span>);<span class="keyword">case</span> <span class="title class_">Se</span>:<span class="keyword">if</span>(e===ge||e===pe)<span class="keyword">break</span> t;<span class="keyword">case</span> <span class="title class_">De</span>:<span class="keyword">if</span>(a.<span class="property">last</span>)&#123;(h&gt;&gt;&gt;=<span class="number">7</span>&amp;d),(d-=<span class="number">7</span>&amp;d),(a.<span class="property">mode</span>=<span class="title class_">Fe</span>);<span class="keyword">break</span>&#125;<span class="keyword">for</span>(;d&lt;<span class="number">3</span>;)&#123;<span class="keyword">if</span>(<span class="number">0</span>===o)<span class="keyword">break</span> t;o--,(h+=i[s++]&lt;&lt;d),(d+=<span class="number">8</span>)&#125;<span class="keyword">switch</span>(((a.<span class="property">last</span>=<span class="number">1</span>&amp;h),(h&gt;&gt;&gt;=<span class="number">1</span>),(d-=<span class="number">1</span>),<span class="number">3</span>&amp;h))&#123;<span class="keyword">case</span> <span class="number">0</span>:a.<span class="property">mode</span>=<span class="number">16193</span>;<span class="keyword">break</span>;<span class="keyword">case</span> <span class="number">1</span>:<span class="keyword">if</span>((<span class="title class_">Xe</span>(a),(a.<span class="property">mode</span>=<span class="title class_">Oe</span>),e===pe))&#123;(h&gt;&gt;&gt;=<span class="number">2</span>),(d-=<span class="number">2</span>);<span class="keyword">break</span> t&#125;<span class="keyword">break</span>;<span class="keyword">case</span> <span class="number">2</span>:a.<span class="property">mode</span>=<span class="number">16196</span>;<span class="keyword">break</span>;<span class="keyword">case</span> <span class="number">3</span>:(t.<span class="property">msg</span>=<span class="string">&#x27;invalid block type&#x27;</span>),(a.<span class="property">mode</span>=<span class="title class_">Le</span>)&#125;(h&gt;&gt;&gt;=<span class="number">2</span>),(d-=<span class="number">2</span>);<span class="keyword">break</span>;<span class="keyword">case</span> <span class="number">16193</span>:<span class="keyword">for</span>(h&gt;&gt;&gt;=<span class="number">7</span>&amp;d,d-=<span class="number">7</span>&amp;d;d&lt;<span class="number">32</span>;)&#123;<span class="keyword">if</span>(<span class="number">0</span>===o)<span class="keyword">break</span> t;o--,(h+=i[s++]&lt;&lt;d),(d+=<span class="number">8</span>)&#125;<span class="keyword">if</span>((<span class="number">65535</span>&amp;h)!=((h&gt;&gt;&gt;<span class="number">16</span>)^<span class="number">65535</span>))&#123;(t.<span class="property">msg</span>=<span class="string">&#x27;invalid stored block lengths&#x27;</span>),(a.<span class="property">mode</span>=<span class="title class_">Le</span>);<span class="keyword">break</span>&#125;<span class="keyword">if</span>(((a.<span class="property">length</span>=<span class="number">65535</span>&amp;h),(h=<span class="number">0</span>),(d=<span class="number">0</span>),(a.<span class="property">mode</span>=<span class="title class_">Te</span>),e===pe))<span class="keyword">break</span> t;<span class="keyword">case</span> <span class="title class_">Te</span>:a.<span class="property">mode</span>=<span class="number">16195</span>;<span class="keyword">case</span> <span class="number">16195</span>:<span class="keyword">if</span>(((c=a.<span class="property">length</span>),c))&#123;<span class="keyword">if</span>((c&gt;o&amp;&amp;(c=o),c&gt;l&amp;&amp;(c=l),<span class="number">0</span>===c))<span class="keyword">break</span> t;n.<span class="title function_">set</span>(i.<span class="title function_">subarray</span>(s,s+c),r),(o-=c),(s+=c),(l-=c),(r+=c),(a.<span class="property">length</span>-=c);<span class="keyword">break</span>&#125;a.<span class="property">mode</span>=<span class="title class_">Se</span>;<span class="keyword">break</span>;<span class="keyword">case</span> <span class="number">16196</span>:<span class="keyword">for</span>(;d&lt;<span class="number">14</span>;)&#123;<span class="keyword">if</span>(<span class="number">0</span>===o)<span class="keyword">break</span> t;o--,(h+=i[s++]&lt;&lt;d),(d+=<span class="number">8</span>)&#125;<span class="keyword">if</span>(((a.<span class="property">nlen</span>=<span class="number">257</span>+(<span class="number">31</span>&amp;h)),(h&gt;&gt;&gt;=<span class="number">5</span>),(d-=<span class="number">5</span>),(a.<span class="property">ndist</span>=<span class="number">1</span>+(<span class="number">31</span>&amp;h)),(h&gt;&gt;&gt;=<span class="number">5</span>),(d-=<span class="number">5</span>),(a.<span class="property">ncode</span>=<span class="number">4</span>+(<span class="number">15</span>&amp;h)),(h&gt;&gt;&gt;=<span class="number">4</span>),(d-=<span class="number">4</span>),a.<span class="property">nlen</span>&gt;<span class="number">286</span>||a.<span class="property">ndist</span>&gt;<span class="number">30</span>))&#123;(t.<span class="property">msg</span>=<span class="string">&#x27;too many length or distance symbols&#x27;</span>),(a.<span class="property">mode</span>=<span class="title class_">Le</span>);<span class="keyword">break</span>&#125;(a.<span class="property">have</span>=<span class="number">0</span>),(a.<span class="property">mode</span>=<span class="number">16197</span>);<span class="keyword">case</span> <span class="number">16197</span>:<span class="keyword">for</span>(;a.<span class="property">have</span>&lt;a.<span class="property">ncode</span>;)&#123;<span class="keyword">for</span>(;d&lt;<span class="number">3</span>;)&#123;<span class="keyword">if</span>(<span class="number">0</span>===o)<span class="keyword">break</span> t;o--,(h+=i[s++]&lt;&lt;d),(d+=<span class="number">8</span>)&#125;(a.<span class="property">lens</span>[Z[a.<span class="property">have</span>++]]=<span class="number">7</span>&amp;h),(h&gt;&gt;&gt;=<span class="number">3</span>),(d-=<span class="number">3</span>)&#125;<span class="keyword">for</span>(;a.<span class="property">have</span>&lt;<span class="number">19</span>;)a.<span class="property">lens</span>[Z[a.<span class="property">have</span>++]]=<span class="number">0</span>;<span class="keyword">if</span>(((a.<span class="property">lencode</span>=a.<span class="property">lendyn</span>),(a.<span class="property">lenbits</span>=<span class="number">7</span>),(E=&#123;<span class="attr">bits</span>:a.<span class="property">lenbits</span>&#125;),(x=<span class="title function_">me</span>(<span class="number">0</span>,a.<span class="property">lens</span>,<span class="number">0</span>,<span class="number">19</span>,a.<span class="property">lencode</span>,<span class="number">0</span>,a.<span class="property">work</span>,E)),(a.<span class="property">lenbits</span>=E.<span class="property">bits</span>),x))&#123;(t.<span class="property">msg</span>=<span class="string">&#x27;invalid code lengths set&#x27;</span>),(a.<span class="property">mode</span>=<span class="title class_">Le</span>);<span class="keyword">break</span>&#125;(a.<span class="property">have</span>=<span class="number">0</span>),(a.<span class="property">mode</span>=<span class="number">16198</span>);<span class="keyword">case</span> <span class="number">16198</span>:<span class="keyword">for</span>(;a.<span class="property">have</span>&lt;a.<span class="property">nlen</span>+a.<span class="property">ndist</span>;)&#123;<span class="keyword">for</span>(;(z=a.<span class="property">lencode</span>[h&amp;((<span class="number">1</span>&lt;&lt;a.<span class="property">lenbits</span>)-<span class="number">1</span>)]),(m=z&gt;&gt;&gt;<span class="number">24</span>),(b=(z&gt;&gt;&gt;<span class="number">16</span>)&amp;<span class="number">255</span>),(g=<span class="number">65535</span>&amp;z),!(m&lt;=d);)&#123;<span class="keyword">if</span>(<span class="number">0</span>===o)<span class="keyword">break</span> t;o--,(h+=i[s++]&lt;&lt;d),(d+=<span class="number">8</span>)&#125;<span class="keyword">if</span>(g&lt;<span class="number">16</span>)(h&gt;&gt;&gt;=m),(d-=m),(a.<span class="property">lens</span>[a.<span class="property">have</span>++]=g);<span class="keyword">else</span>&#123;<span class="keyword">if</span>(<span class="number">16</span>===g)&#123;<span class="keyword">for</span>(R=m+<span class="number">2</span>;d&lt;R;)&#123;<span class="keyword">if</span>(<span class="number">0</span>===o)<span class="keyword">break</span> t;o--,(h+=i[s++]&lt;&lt;d),(d+=<span class="number">8</span>)&#125;<span class="keyword">if</span>(((h&gt;&gt;&gt;=m),(d-=m),<span class="number">0</span>===a.<span class="property">have</span>))&#123;(t.<span class="property">msg</span>=<span class="string">&#x27;invalid bit length repeat&#x27;</span>),(a.<span class="property">mode</span>=<span class="title class_">Le</span>);<span class="keyword">break</span>&#125;(y=a.<span class="property">lens</span>[a.<span class="property">have</span>-<span class="number">1</span>]),(c=<span class="number">3</span>+(<span class="number">3</span>&amp;h)),(h&gt;&gt;&gt;=<span class="number">2</span>),(d-=<span class="number">2</span>)&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="number">17</span>===g)&#123;<span class="keyword">for</span>(R=m+<span class="number">3</span>;d&lt;R;)&#123;<span class="keyword">if</span>(<span class="number">0</span>===o)<span class="keyword">break</span> t;o--,(h+=i[s++]&lt;&lt;d),(d+=<span class="number">8</span>)&#125;(h&gt;&gt;&gt;=m),(d-=m),(y=<span class="number">0</span>),(c=<span class="number">3</span>+(<span class="number">7</span>&amp;h)),(h&gt;&gt;&gt;=<span class="number">3</span>),(d-=<span class="number">3</span>)&#125;<span class="keyword">else</span>&#123;<span class="keyword">for</span>(R=m+<span class="number">7</span>;d&lt;R;)&#123;<span class="keyword">if</span>(<span class="number">0</span>===o)<span class="keyword">break</span> t;o--,(h+=i[s++]&lt;&lt;d),(d+=<span class="number">8</span>)&#125;(h&gt;&gt;&gt;=m),(d-=m),(y=<span class="number">0</span>),(c=<span class="number">11</span>+(<span class="number">127</span>&amp;h)),(h&gt;&gt;&gt;=<span class="number">7</span>),(d-=<span class="number">7</span>)&#125;<span class="keyword">if</span>(a.<span class="property">have</span>+c&gt;a.<span class="property">nlen</span>+a.<span class="property">ndist</span>)&#123;(t.<span class="property">msg</span>=<span class="string">&#x27;invalid bit length repeat&#x27;</span>),(a.<span class="property">mode</span>=<span class="title class_">Le</span>);<span class="keyword">break</span>&#125;<span class="keyword">for</span>(;c--;)a.<span class="property">lens</span>[a.<span class="property">have</span>++]=y&#125;&#125;<span class="keyword">if</span>(a.<span class="property">mode</span>===<span class="title class_">Le</span>)<span class="keyword">break</span>;<span class="keyword">if</span>(<span class="number">0</span>===a.<span class="property">lens</span>[<span class="number">256</span>])&#123;(t.<span class="property">msg</span>=<span class="string">&#x27;invalid code -- missing end-of-block&#x27;</span>),(a.<span class="property">mode</span>=<span class="title class_">Le</span>);<span class="keyword">break</span>&#125;<span class="keyword">if</span>(((a.<span class="property">lenbits</span>=<span class="number">9</span>),(E=&#123;<span class="attr">bits</span>:a.<span class="property">lenbits</span>&#125;),(x=<span class="title function_">me</span>(<span class="number">1</span>,a.<span class="property">lens</span>,<span class="number">0</span>,a.<span class="property">nlen</span>,a.<span class="property">lencode</span>,<span class="number">0</span>,a.<span class="property">work</span>,E)),(a.<span class="property">lenbits</span>=E.<span class="property">bits</span>),x))&#123;(t.<span class="property">msg</span>=<span class="string">&#x27;invalid literal/lengths set&#x27;</span>),(a.<span class="property">mode</span>=<span class="title class_">Le</span>);<span class="keyword">break</span>&#125;<span class="keyword">if</span>(((a.<span class="property">distbits</span>=<span class="number">6</span>),(a.<span class="property">distcode</span>=a.<span class="property">distdyn</span>),(E=&#123;<span class="attr">bits</span>:a.<span class="property">distbits</span>&#125;),(x=<span class="title function_">me</span>(<span class="number">2</span>,a.<span class="property">lens</span>,a.<span class="property">nlen</span>,a.<span class="property">ndist</span>,a.<span class="property">distcode</span>,<span class="number">0</span>,a.<span class="property">work</span>,E)),(a.<span class="property">distbits</span>=E.<span class="property">bits</span>),x))&#123;(t.<span class="property">msg</span>=<span class="string">&#x27;invalid distances set&#x27;</span>),(a.<span class="property">mode</span>=<span class="title class_">Le</span>);<span class="keyword">break</span>&#125;<span class="keyword">if</span>(((a.<span class="property">mode</span>=<span class="title class_">Oe</span>),e===pe))<span class="keyword">break</span> t;<span class="keyword">case</span> <span class="title class_">Oe</span>:a.<span class="property">mode</span>=<span class="title class_">Ie</span>;<span class="keyword">case</span> <span class="title class_">Ie</span>:<span class="keyword">if</span>(o&gt;=<span class="number">6</span>&amp;&amp;l&gt;=<span class="number">258</span>)&#123;(t.<span class="property">next_out</span>=r),(t.<span class="property">avail_out</span>=l),(t.<span class="property">next_in</span>=s),(t.<span class="property">avail_in</span>=o),(a.<span class="property">hold</span>=h),(a.<span class="property">bits</span>=d),<span class="title function_">de</span>(t,f),(r=t.<span class="property">next_out</span>),(n=t.<span class="property">output</span>),(l=t.<span class="property">avail_out</span>),(s=t.<span class="property">next_in</span>),(i=t.<span class="property">input</span>),(o=t.<span class="property">avail_in</span>),(h=a.<span class="property">hold</span>),(d=a.<span class="property">bits</span>),a.<span class="property">mode</span>===<span class="title class_">Se</span>&amp;&amp;(a.<span class="property">back</span>=-<span class="number">1</span>);<span class="keyword">break</span>&#125;<span class="keyword">for</span>(a.<span class="property">back</span>=<span class="number">0</span>;(z=a.<span class="property">lencode</span>[h&amp;((<span class="number">1</span>&lt;&lt;a.<span class="property">lenbits</span>)-<span class="number">1</span>)]),(m=z&gt;&gt;&gt;<span class="number">24</span>),(b=(z&gt;&gt;&gt;<span class="number">16</span>)&amp;<span class="number">255</span>),(g=<span class="number">65535</span>&amp;z),!(m&lt;=d);)&#123;<span class="keyword">if</span>(<span class="number">0</span>===o)<span class="keyword">break</span> t;o--,(h+=i[s++]&lt;&lt;d),(d+=<span class="number">8</span>)&#125;<span class="keyword">if</span>(b&amp;&amp;<span class="number">0</span>==(<span class="number">240</span>&amp;b))&#123;<span class="keyword">for</span>(p=m,k=b,v=g;(z=a.<span class="property">lencode</span>[v+((h&amp;((<span class="number">1</span>&lt;&lt;(p+k))-<span class="number">1</span>))&gt;&gt;p)]),(m=z&gt;&gt;&gt;<span class="number">24</span>),(b=(z&gt;&gt;&gt;<span class="number">16</span>)&amp;<span class="number">255</span>),(g=<span class="number">65535</span>&amp;z),!(p+m&lt;=d);)&#123;<span class="keyword">if</span>(<span class="number">0</span>===o)<span class="keyword">break</span> t;o--,(h+=i[s++]&lt;&lt;d),(d+=<span class="number">8</span>)&#125;(h&gt;&gt;&gt;=p),(d-=p),(a.<span class="property">back</span>+=p)&#125;<span class="keyword">if</span>(((h&gt;&gt;&gt;=m),(d-=m),(a.<span class="property">back</span>+=m),(a.<span class="property">length</span>=g),<span class="number">0</span>===b))&#123;a.<span class="property">mode</span>=<span class="number">16205</span>;<span class="keyword">break</span>&#125;<span class="keyword">if</span>(<span class="number">32</span>&amp;b)&#123;(a.<span class="property">back</span>=-<span class="number">1</span>),(a.<span class="property">mode</span>=<span class="title class_">Se</span>);<span class="keyword">break</span>&#125;<span class="keyword">if</span>(<span class="number">64</span>&amp;b)&#123;(t.<span class="property">msg</span>=<span class="string">&#x27;invalid literal/length code&#x27;</span>),(a.<span class="property">mode</span>=<span class="title class_">Le</span>);<span class="keyword">break</span>&#125;(a.<span class="property">extra</span>=<span class="number">15</span>&amp;b),(a.<span class="property">mode</span>=<span class="number">16201</span>);<span class="keyword">case</span> <span class="number">16201</span>:<span class="keyword">if</span>(a.<span class="property">extra</span>)&#123;<span class="keyword">for</span>(R=a.<span class="property">extra</span>;d&lt;R;)&#123;<span class="keyword">if</span>(<span class="number">0</span>===o)<span class="keyword">break</span> t;o--,(h+=i[s++]&lt;&lt;d),(d+=<span class="number">8</span>)&#125;(a.<span class="property">length</span>+=h&amp;((<span class="number">1</span>&lt;&lt;a.<span class="property">extra</span>)-<span class="number">1</span>)),(h&gt;&gt;&gt;=a.<span class="property">extra</span>),(d-=a.<span class="property">extra</span>),(a.<span class="property">back</span>+=a.<span class="property">extra</span>)&#125;(a.<span class="property">was</span>=a.<span class="property">length</span>),(a.<span class="property">mode</span>=<span class="number">16202</span>);<span class="keyword">case</span> <span class="number">16202</span>:<span class="keyword">for</span>(;(z=a.<span class="property">distcode</span>[h&amp;((<span class="number">1</span>&lt;&lt;a.<span class="property">distbits</span>)-<span class="number">1</span>)]),(m=z&gt;&gt;&gt;<span class="number">24</span>),(b=(z&gt;&gt;&gt;<span class="number">16</span>)&amp;<span class="number">255</span>),(g=<span class="number">65535</span>&amp;z),!(m&lt;=d);)&#123;<span class="keyword">if</span>(<span class="number">0</span>===o)<span class="keyword">break</span> t;o--,(h+=i[s++]&lt;&lt;d),(d+=<span class="number">8</span>)&#125;<span class="keyword">if</span>(<span class="number">0</span>==(<span class="number">240</span>&amp;b))&#123;<span class="keyword">for</span>(p=m,k=b,v=g;(z=a.<span class="property">distcode</span>[v+((h&amp;((<span class="number">1</span>&lt;&lt;(p+k))-<span class="number">1</span>))&gt;&gt;p)]),(m=z&gt;&gt;&gt;<span class="number">24</span>),(b=(z&gt;&gt;&gt;<span class="number">16</span>)&amp;<span class="number">255</span>),(g=<span class="number">65535</span>&amp;z),!(p+m&lt;=d);)&#123;<span class="keyword">if</span>(<span class="number">0</span>===o)<span class="keyword">break</span> t;o--,(h+=i[s++]&lt;&lt;d),(d+=<span class="number">8</span>)&#125;(h&gt;&gt;&gt;=p),(d-=p),(a.<span class="property">back</span>+=p)&#125;<span class="keyword">if</span>(((h&gt;&gt;&gt;=m),(d-=m),(a.<span class="property">back</span>+=m),<span class="number">64</span>&amp;b))&#123;(t.<span class="property">msg</span>=<span class="string">&#x27;invalid distance code&#x27;</span>),(a.<span class="property">mode</span>=<span class="title class_">Le</span>);<span class="keyword">break</span>&#125;(a.<span class="property">offset</span>=g),(a.<span class="property">extra</span>=<span class="number">15</span>&amp;b),(a.<span class="property">mode</span>=<span class="number">16203</span>);<span class="keyword">case</span> <span class="number">16203</span>:<span class="keyword">if</span>(a.<span class="property">extra</span>)&#123;<span class="keyword">for</span>(R=a.<span class="property">extra</span>;d&lt;R;)&#123;<span class="keyword">if</span>(<span class="number">0</span>===o)<span class="keyword">break</span> t;o--,(h+=i[s++]&lt;&lt;d),(d+=<span class="number">8</span>)&#125;(a.<span class="property">offset</span>+=h&amp;((<span class="number">1</span>&lt;&lt;a.<span class="property">extra</span>)-<span class="number">1</span>)),(h&gt;&gt;&gt;=a.<span class="property">extra</span>),(d-=a.<span class="property">extra</span>),(a.<span class="property">back</span>+=a.<span class="property">extra</span>)&#125;<span class="keyword">if</span>(a.<span class="property">offset</span>&gt;a.<span class="property">dmax</span>)&#123;(t.<span class="property">msg</span>=<span class="string">&#x27;invalid distance too far back&#x27;</span>),(a.<span class="property">mode</span>=<span class="title class_">Le</span>);<span class="keyword">break</span>&#125;a.<span class="property">mode</span>=<span class="number">16204</span>;<span class="keyword">case</span> <span class="number">16204</span>:<span class="keyword">if</span>(<span class="number">0</span>===l)<span class="keyword">break</span> t;<span class="keyword">if</span>(((c=f-l),a.<span class="property">offset</span>&gt;c))&#123;<span class="keyword">if</span>(((c=a.<span class="property">offset</span>-c),c&gt;a.<span class="property">whave</span>&amp;&amp;a.<span class="property">sane</span>))&#123;(t.<span class="property">msg</span>=<span class="string">&#x27;invalid distance too far back&#x27;</span>),(a.<span class="property">mode</span>=<span class="title class_">Le</span>);<span class="keyword">break</span>&#125;c&gt;a.<span class="property">wnext</span>?((c-=a.<span class="property">wnext</span>),(u=a.<span class="property">wsize</span>-c)):(u=a.<span class="property">wnext</span>-c),c&gt;a.<span class="property">length</span>&amp;&amp;(c=a.<span class="property">length</span>),(w=a.<span class="property">window</span>)&#125;<span class="title function_">else</span>(w=n),(u=r-a.<span class="property">offset</span>),(c=a.<span class="property">length</span>);c&gt;l&amp;&amp;(c=l),(l-=c),(a.<span class="property">length</span>-=c);<span class="keyword">do</span>&#123;n[r++]=w[u++]&#125;<span class="keyword">while</span>(--c);<span class="number">0</span>===a.<span class="property">length</span>&amp;&amp;(a.<span class="property">mode</span>=<span class="title class_">Ie</span>);<span class="keyword">break</span>;<span class="keyword">case</span> <span class="number">16205</span>:<span class="keyword">if</span>(<span class="number">0</span>===l)<span class="keyword">break</span> t;(n[r++]=a.<span class="property">length</span>),l--,(a.<span class="property">mode</span>=<span class="title class_">Ie</span>);<span class="keyword">break</span>;<span class="keyword">case</span> <span class="title class_">Fe</span>:<span class="keyword">if</span>(a.<span class="property">wrap</span>)&#123;<span class="keyword">for</span>(;d&lt;<span class="number">32</span>;)&#123;<span class="keyword">if</span>(<span class="number">0</span>===o)<span class="keyword">break</span> t;o--,(h|=i[s++]&lt;&lt;d),(d+=<span class="number">8</span>)&#125;<span class="keyword">if</span>(((f-=l),(t.<span class="property">total_out</span>+=f),(a.<span class="property">total</span>+=f),<span class="number">4</span>&amp;a.<span class="property">wrap</span>&amp;&amp;f&amp;&amp;(t.<span class="property">adler</span>=a.<span class="property">check</span>=a.<span class="property">flags</span>?<span class="title function_">H</span>(a.<span class="property">check</span>,n,f,r-f):<span class="title function_">C</span>(a.<span class="property">check</span>,n,f,r-f)),(f=l),<span class="number">4</span>&amp;a.<span class="property">wrap</span>&amp;&amp;(a.<span class="property">flags</span>?<span class="attr">h</span>:<span class="title class_">Ne</span>(h))!==a.<span class="property">check</span>))&#123;(t.<span class="property">msg</span>=<span class="string">&#x27;incorrect data check&#x27;</span>),(a.<span class="property">mode</span>=<span class="title class_">Le</span>);<span class="keyword">break</span>&#125;(h=<span class="number">0</span>),(d=<span class="number">0</span>)&#125;a.<span class="property">mode</span>=<span class="number">16207</span>;<span class="keyword">case</span> <span class="number">16207</span>:<span class="keyword">if</span>(a.<span class="property">wrap</span>&amp;&amp;a.<span class="property">flags</span>)&#123;<span class="keyword">for</span>(;d&lt;<span class="number">32</span>;)&#123;<span class="keyword">if</span>(<span class="number">0</span>===o)<span class="keyword">break</span> t;o--,(h+=i[s++]&lt;&lt;d),(d+=<span class="number">8</span>)&#125;<span class="keyword">if</span>(<span class="number">4</span>&amp;a.<span class="property">wrap</span>&amp;&amp;h!==(<span class="number">4294967295</span>&amp;a.<span class="property">total</span>))&#123;(t.<span class="property">msg</span>=<span class="string">&#x27;incorrect length check&#x27;</span>),(a.<span class="property">mode</span>=<span class="title class_">Le</span>);<span class="keyword">break</span>&#125;(h=<span class="number">0</span>),(d=<span class="number">0</span>)&#125;a.<span class="property">mode</span>=<span class="number">16208</span>;<span class="keyword">case</span> <span class="number">16208</span>:x=ve;<span class="keyword">break</span> t;<span class="keyword">case</span> <span class="title class_">Le</span>:x=ze;<span class="keyword">break</span> t;<span class="keyword">case</span> <span class="number">16210</span>:<span class="keyword">return</span> <span class="title class_">Ae</span>;<span class="attr">default</span>:<span class="keyword">return</span> xe&#125;<span class="keyword">return</span>((t.<span class="property">next_out</span>=r),(t.<span class="property">avail_out</span>=l),(t.<span class="property">next_in</span>=s),(t.<span class="property">avail_in</span>=o),(a.<span class="property">hold</span>=h),(a.<span class="property">bits</span>=d),(a.<span class="property">wsize</span>||(f!==t.<span class="property">avail_out</span>&amp;&amp;a.<span class="property">mode</span>&lt;<span class="title class_">Le</span>&amp;&amp;(a.<span class="property">mode</span>&lt;<span class="title class_">Fe</span>||e!==be)))&amp;&amp;<span class="title class_">We</span>(t,t.<span class="property">output</span>,t.<span class="property">next_out</span>,f-t.<span class="property">avail_out</span>),(_-=t.<span class="property">avail_in</span>),(f-=t.<span class="property">avail_out</span>),(t.<span class="property">total_in</span>+=_),(t.<span class="property">total_out</span>+=f),(a.<span class="property">total</span>+=f),<span class="number">4</span>&amp;a.<span class="property">wrap</span>&amp;&amp;f&amp;&amp;(t.<span class="property">adler</span>=a.<span class="property">check</span>=a.<span class="property">flags</span>?<span class="title function_">H</span>(a.<span class="property">check</span>,n,f,t.<span class="property">next_out</span>-f):<span class="title function_">C</span>(a.<span class="property">check</span>,n,f,t.<span class="property">next_out</span>-f)),(t.<span class="property">data_type</span>=a.<span class="property">bits</span>+(a.<span class="property">last</span>?<span class="number">64</span>:<span class="number">0</span>)+(a.<span class="property">mode</span>===<span class="title class_">Se</span>?<span class="number">128</span>:<span class="number">0</span>)+(a.<span class="property">mode</span>===<span class="title class_">Oe</span>||a.<span class="property">mode</span>===<span class="title class_">Te</span>?<span class="number">256</span>:<span class="number">0</span>)),((<span class="number">0</span>===_&amp;&amp;<span class="number">0</span>===f)||e===be)&amp;&amp;x===ke&amp;&amp;(x=<span class="title class_">Ee</span>),x)&#125;,<span class="attr">inflateEnd</span>:<span class="function">(<span class="params">t</span>)=&gt;</span>&#123;<span class="keyword">if</span>(<span class="title class_">Ce</span>(t))<span class="keyword">return</span> xe;<span class="keyword">let</span> e=t.<span class="property">state</span>;<span class="keyword">return</span> e.<span class="property">window</span>&amp;&amp;(e.<span class="property">window</span>=<span class="literal">null</span>),(t.<span class="property">state</span>=<span class="literal">null</span>),ke&#125;,<span class="attr">inflateGetHeader</span>:<span class="function">(<span class="params">t,e</span>)=&gt;</span>&#123;<span class="keyword">if</span>(<span class="title class_">Ce</span>(t))<span class="keyword">return</span> xe;<span class="keyword">const</span> a=t.<span class="property">state</span>;<span class="keyword">return</span> <span class="number">0</span>==(<span class="number">2</span>&amp;a.<span class="property">wrap</span>)?<span class="attr">xe</span>:((a.<span class="property">head</span>=e),(e.<span class="property">done</span>=!<span class="number">1</span>),ke)&#125;,<span class="attr">inflateSetDictionary</span>:<span class="function">(<span class="params">t,e</span>)=&gt;</span>&#123;<span class="keyword">const</span> a=e.<span class="property">length</span>;<span class="keyword">let</span> i,n,s;<span class="keyword">return</span> <span class="title class_">Ce</span>(t)?<span class="attr">xe</span>:((i=t.<span class="property">state</span>),<span class="number">0</span>!==i.<span class="property">wrap</span>&amp;&amp;i.<span class="property">mode</span>!==<span class="title class_">Ue</span>?<span class="attr">xe</span>:i.<span class="property">mode</span>===<span class="title class_">Ue</span>&amp;&amp;((n=<span class="number">1</span>),(n=<span class="title function_">C</span>(n,e,a,<span class="number">0</span>)),n!==i.<span class="property">check</span>)?<span class="attr">ze</span>:((s=<span class="title class_">We</span>(t,e,a,a)),s?((i.<span class="property">mode</span>=<span class="number">16210</span>),<span class="title class_">Ae</span>):((i.<span class="property">havedict</span>=<span class="number">1</span>),ke)))&#125;,<span class="attr">inflateInfo</span>:<span class="string">&#x27;pako inflate (from Nodeca project)&#x27;</span>&#125;;<span class="keyword">var</span> <span class="title class_">Je</span>=<span class="keyword">function</span>(<span class="params"></span>)&#123;(<span class="variable language_">this</span>.<span class="property">text</span>=<span class="number">0</span>),(<span class="variable language_">this</span>.<span class="property">time</span>=<span class="number">0</span>),(<span class="variable language_">this</span>.<span class="property">xflags</span>=<span class="number">0</span>),(<span class="variable language_">this</span>.<span class="property">os</span>=<span class="number">0</span>),(<span class="variable language_">this</span>.<span class="property">extra</span>=<span class="literal">null</span>),(<span class="variable language_">this</span>.<span class="property">extra_len</span>=<span class="number">0</span>),(<span class="variable language_">this</span>.<span class="property">name</span>=<span class="string">&#x27;&#x27;</span>),(<span class="variable language_">this</span>.<span class="property">comment</span>=<span class="string">&#x27;&#x27;</span>),(<span class="variable language_">this</span>.<span class="property">hcrc</span>=<span class="number">0</span>),(<span class="variable language_">this</span>.<span class="property">done</span>=!<span class="number">1</span>)&#125;;<span class="keyword">const</span> <span class="title class_">Qe</span>=<span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>,&#123;<span class="attr">Z_NO_FLUSH</span>:<span class="title class_">Ve</span>,<span class="attr">Z_FINISH</span>:$e,<span class="attr">Z_OK</span>:ta,<span class="attr">Z_STREAM_END</span>:ea,<span class="attr">Z_NEED_DICT</span>:aa,<span class="attr">Z_STREAM_ERROR</span>:ia,<span class="attr">Z_DATA_ERROR</span>:na,<span class="attr">Z_MEM_ERROR</span>:sa&#125;=K;<span class="keyword">function</span> <span class="title function_">ra</span>(<span class="params">t</span>)&#123;<span class="variable language_">this</span>.<span class="property">options</span>=<span class="title function_">jt</span>(&#123;<span class="attr">chunkSize</span>:<span class="number">65536</span>,<span class="attr">windowBits</span>:<span class="number">15</span>,<span class="attr">to</span>:<span class="string">&#x27;&#x27;</span>&#125;,t||&#123;&#125;);<span class="keyword">const</span> e=<span class="variable language_">this</span>.<span class="property">options</span>;e.<span class="property">raw</span>&amp;&amp;e.<span class="property">windowBits</span>&gt;=<span class="number">0</span>&amp;&amp;e.<span class="property">windowBits</span>&lt;<span class="number">16</span>&amp;&amp;((e.<span class="property">windowBits</span>=-e.<span class="property">windowBits</span>),<span class="number">0</span>===e.<span class="property">windowBits</span>&amp;&amp;(e.<span class="property">windowBits</span>=-<span class="number">15</span>)),!(e.<span class="property">windowBits</span>&gt;=<span class="number">0</span>&amp;&amp;e.<span class="property">windowBits</span>&lt;<span class="number">16</span>)||(t&amp;&amp;t.<span class="property">windowBits</span>)||(e.<span class="property">windowBits</span>+=<span class="number">32</span>),e.<span class="property">windowBits</span>&gt;<span class="number">15</span>&amp;&amp;e.<span class="property">windowBits</span>&lt;<span class="number">48</span>&amp;&amp;<span class="number">0</span>==(<span class="number">15</span>&amp;e.<span class="property">windowBits</span>)&amp;&amp;(e.<span class="property">windowBits</span>|=<span class="number">15</span>),(<span class="variable language_">this</span>.<span class="property">err</span>=<span class="number">0</span>),(<span class="variable language_">this</span>.<span class="property">msg</span>=<span class="string">&#x27;&#x27;</span>),(<span class="variable language_">this</span>.<span class="property">ended</span>=!<span class="number">1</span>),(<span class="variable language_">this</span>.<span class="property">chunks</span>=[]),(<span class="variable language_">this</span>.<span class="property">strm</span>=<span class="keyword">new</span> <span class="title function_">qt</span>()),(<span class="variable language_">this</span>.<span class="property">strm</span>.<span class="property">avail_out</span>=<span class="number">0</span>);<span class="keyword">let</span> a=qe.<span class="title function_">inflateInit2</span>(<span class="variable language_">this</span>.<span class="property">strm</span>,e.<span class="property">windowBits</span>);<span class="keyword">if</span>(a!==ta)<span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(j[a]);<span class="keyword">if</span>(((<span class="variable language_">this</span>.<span class="property">header</span>=<span class="keyword">new</span> <span class="title class_">Je</span>()),qe.<span class="title function_">inflateGetHeader</span>(<span class="variable language_">this</span>.<span class="property">strm</span>,<span class="variable language_">this</span>.<span class="property">header</span>),e.<span class="property">dictionary</span>&amp;&amp;(<span class="string">&#x27;string&#x27;</span>==<span class="keyword">typeof</span> e.<span class="property">dictionary</span>?(e.<span class="property">dictionary</span>=<span class="title class_">Gt</span>(e.<span class="property">dictionary</span>)):<span class="string">&#x27;[object ArrayBuffer]&#x27;</span>===<span class="title class_">Qe</span>.<span class="title function_">call</span>(e.<span class="property">dictionary</span>)&amp;&amp;(e.<span class="property">dictionary</span>=<span class="keyword">new</span> <span class="title class_">Uint8Array</span>(e.<span class="property">dictionary</span>)),e.<span class="property">raw</span>&amp;&amp;((a=qe.<span class="title function_">inflateSetDictionary</span>(<span class="variable language_">this</span>.<span class="property">strm</span>,e.<span class="property">dictionary</span>)),a!==ta))))<span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(j[a]);&#125;<span class="keyword">function</span> <span class="title function_">oa</span>(<span class="params">t,e</span>)&#123;<span class="keyword">const</span> a=<span class="keyword">new</span> <span class="title function_">ra</span>(e);<span class="keyword">if</span>((a.<span class="title function_">push</span>(t),a.<span class="property">err</span>))<span class="keyword">throw</span> a.<span class="property">msg</span>||j[a.<span class="property">err</span>];<span class="keyword">return</span> a.<span class="property">result</span>&#125;(ra.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">push</span>=<span class="keyword">function</span>(<span class="params">t,e</span>)&#123;<span class="keyword">const</span> a=<span class="variable language_">this</span>.<span class="property">strm</span>,i=<span class="variable language_">this</span>.<span class="property">options</span>.<span class="property">chunkSize</span>,n=<span class="variable language_">this</span>.<span class="property">options</span>.<span class="property">dictionary</span>;<span class="keyword">let</span> s,r,o;<span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">ended</span>)<span class="keyword">return</span>!<span class="number">1</span>;<span class="keyword">for</span>(r=e===~~e?<span class="attr">e</span>:!<span class="number">0</span>===e?<span class="attr">$e</span>:<span class="title class_">Ve</span>,<span class="string">&#x27;[object ArrayBuffer]&#x27;</span>===<span class="title class_">Qe</span>.<span class="title function_">call</span>(t)?(a.<span class="property">input</span>=<span class="keyword">new</span> <span class="title class_">Uint8Array</span>(t)):(a.<span class="property">input</span>=t),a.<span class="property">next_in</span>=<span class="number">0</span>,a.<span class="property">avail_in</span>=a.<span class="property">input</span>.<span class="property">length</span>;)&#123;<span class="keyword">for</span>(<span class="number">0</span>===a.<span class="property">avail_out</span>&amp;&amp;((a.<span class="property">output</span>=<span class="keyword">new</span> <span class="title class_">Uint8Array</span>(i)),(a.<span class="property">next_out</span>=<span class="number">0</span>),(a.<span class="property">avail_out</span>=i)),s=qe.<span class="title function_">inflate</span>(a,r),s===aa&amp;&amp;n&amp;&amp;((s=qe.<span class="title function_">inflateSetDictionary</span>(a,n)),s===ta?(s=qe.<span class="title function_">inflate</span>(a,r)):s===na&amp;&amp;(s=aa));a.<span class="property">avail_in</span>&gt;<span class="number">0</span>&amp;&amp;s===ea&amp;&amp;a.<span class="property">state</span>.<span class="property">wrap</span>&gt;<span class="number">0</span>&amp;&amp;<span class="number">0</span>!==t[a.<span class="property">next_in</span>];)qe.<span class="title function_">inflateReset</span>(a),(s=qe.<span class="title function_">inflate</span>(a,r));<span class="keyword">switch</span>(s)&#123;<span class="keyword">case</span> <span class="attr">ia</span>:<span class="keyword">case</span> <span class="attr">na</span>:<span class="keyword">case</span> <span class="attr">aa</span>:<span class="keyword">case</span> <span class="attr">sa</span>:<span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">onEnd</span>(s),(<span class="variable language_">this</span>.<span class="property">ended</span>=!<span class="number">0</span>),!<span class="number">1</span>&#125;<span class="keyword">if</span>(((o=a.<span class="property">avail_out</span>),a.<span class="property">next_out</span>&amp;&amp;(<span class="number">0</span>===a.<span class="property">avail_out</span>||s===ea)))<span class="keyword">if</span>(<span class="string">&#x27;string&#x27;</span>===<span class="variable language_">this</span>.<span class="property">options</span>.<span class="property">to</span>)&#123;<span class="keyword">let</span> t=<span class="title class_">Wt</span>(a.<span class="property">output</span>,a.<span class="property">next_out</span>),e=a.<span class="property">next_out</span>-t,n=<span class="title class_">Xt</span>(a.<span class="property">output</span>,t);(a.<span class="property">next_out</span>=e),(a.<span class="property">avail_out</span>=i-e),e&amp;&amp;a.<span class="property">output</span>.<span class="title function_">set</span>(a.<span class="property">output</span>.<span class="title function_">subarray</span>(t,t+e),<span class="number">0</span>),<span class="variable language_">this</span>.<span class="title function_">onData</span>(n)&#125;<span class="keyword">else</span> <span class="variable language_">this</span>.<span class="title function_">onData</span>(a.<span class="property">output</span>.<span class="property">length</span>===a.<span class="property">next_out</span>?a.<span class="property">output</span>:a.<span class="property">output</span>.<span class="title function_">subarray</span>(<span class="number">0</span>,a.<span class="property">next_out</span>));<span class="keyword">if</span>(s!==ta||<span class="number">0</span>!==o)&#123;<span class="keyword">if</span>(s===ea)<span class="keyword">return</span>((s=qe.<span class="title function_">inflateEnd</span>(<span class="variable language_">this</span>.<span class="property">strm</span>)),<span class="variable language_">this</span>.<span class="title function_">onEnd</span>(s),(<span class="variable language_">this</span>.<span class="property">ended</span>=!<span class="number">0</span>),!<span class="number">0</span>);<span class="keyword">if</span>(<span class="number">0</span>===a.<span class="property">avail_in</span>)<span class="keyword">break</span>&#125;&#125;<span class="keyword">return</span>!<span class="number">0</span>&#125;),(ra.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">onData</span>=<span class="keyword">function</span>(<span class="params">t</span>)&#123;<span class="variable language_">this</span>.<span class="property">chunks</span>.<span class="title function_">push</span>(t)&#125;),(ra.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">onEnd</span>=<span class="keyword">function</span>(<span class="params">t</span>)&#123;t===ta&amp;&amp;(<span class="string">&#x27;string&#x27;</span>===<span class="variable language_">this</span>.<span class="property">options</span>.<span class="property">to</span>?(<span class="variable language_">this</span>.<span class="property">result</span>=<span class="variable language_">this</span>.<span class="property">chunks</span>.<span class="title function_">join</span>(<span class="string">&#x27;&#x27;</span>)):(<span class="variable language_">this</span>.<span class="property">result</span>=<span class="title class_">Kt</span>(<span class="variable language_">this</span>.<span class="property">chunks</span>))),(<span class="variable language_">this</span>.<span class="property">chunks</span>=[]),(<span class="variable language_">this</span>.<span class="property">err</span>=t),(<span class="variable language_">this</span>.<span class="property">msg</span>=<span class="variable language_">this</span>.<span class="property">strm</span>.<span class="property">msg</span>)&#125;);<span class="keyword">var</span> la=&#123;<span class="title class_">Inflate</span>:ra,<span class="attr">inflate</span>:oa,<span class="attr">inflateRaw</span>:<span class="keyword">function</span>(<span class="params">t,e</span>)&#123;<span class="keyword">return</span>((e=e||&#123;&#125;).<span class="property">raw</span>=!<span class="number">0</span>),<span class="title function_">oa</span>(t,e)&#125;,<span class="attr">ungzip</span>:oa,<span class="attr">constants</span>:K&#125;;<span class="keyword">const</span>&#123;<span class="title class_">Deflate</span>:ha,<span class="attr">deflate</span>:da,<span class="attr">deflateRaw</span>:_a,<span class="attr">gzip</span>:fa&#125;=le,&#123;<span class="title class_">Inflate</span>:ca,<span class="attr">inflate</span>:ua,<span class="attr">inflateRaw</span>:wa,<span class="attr">ungzip</span>:ma&#125;=la;<span class="keyword">var</span> ba=ha,ga=da,pa=_a,ka=fa,va=ca,ya=ua,xa=wa,za=ma,<span class="title class_">Aa</span>=K,<span class="title class_">Ea</span>=&#123;<span class="title class_">Deflate</span>:ba,<span class="attr">deflate</span>:ga,<span class="attr">deflateRaw</span>:pa,<span class="attr">gzip</span>:ka,<span class="title class_">Inflate</span>:va,<span class="attr">inflate</span>:ya,<span class="attr">inflateRaw</span>:xa,<span class="attr">ungzip</span>:za,<span class="attr">constants</span>:<span class="title class_">Aa</span>&#125;;(t.<span class="property">Deflate</span>=ba),(t.<span class="property">Inflate</span>=va),(t.<span class="property">constants</span>=<span class="title class_">Aa</span>),(t.<span class="property">default</span>=<span class="title class_">Ea</span>),(t.<span class="property">deflate</span>=ga),(t.<span class="property">deflateRaw</span>=pa),(t.<span class="property">gzip</span>=ka),(t.<span class="property">inflate</span>=ya),(t.<span class="property">inflateRaw</span>=xa),(t.<span class="property">ungzip</span>=za),<span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(t,<span class="string">&#x27;__esModule&#x27;</span>,&#123;<span class="attr">value</span>:!<span class="number">0</span>&#125;)&#125;);<span class="keyword">var</span> <span class="variable constant_">UPNG</span>=(<span class="keyword">function</span>(<span class="params"></span>)&#123;<span class="keyword">var</span> _bin=&#123;<span class="attr">nextZero</span>:<span class="keyword">function</span>(<span class="params">data,p</span>)&#123;<span class="keyword">while</span>(data[p]!=<span class="number">0</span>)p++;<span class="keyword">return</span> p&#125;,<span class="attr">readUshort</span>:<span class="keyword">function</span>(<span class="params">buff,p</span>)&#123;<span class="keyword">return</span>(buff[p]&lt;&lt;<span class="number">8</span>)|buff[p+<span class="number">1</span>]&#125;,<span class="attr">writeUshort</span>:<span class="keyword">function</span>(<span class="params">buff,p,n</span>)&#123;buff[p]=(n&gt;&gt;<span class="number">8</span>)&amp;<span class="number">255</span>;buff[p+<span class="number">1</span>]=n&amp;<span class="number">255</span>&#125;,<span class="attr">readUint</span>:<span class="keyword">function</span>(<span class="params">buff,p</span>)&#123;<span class="keyword">return</span>(buff[p]*(<span class="number">256</span>*<span class="number">256</span>*<span class="number">256</span>)+((buff[p+<span class="number">1</span>]&lt;&lt;<span class="number">16</span>)|(buff[p+<span class="number">2</span>]&lt;&lt;<span class="number">8</span>)|buff[p+<span class="number">3</span>]))&#125;,<span class="attr">writeUint</span>:<span class="keyword">function</span>(<span class="params">buff,p,n</span>)&#123;buff[p]=(n&gt;&gt;<span class="number">24</span>)&amp;<span class="number">255</span>;buff[p+<span class="number">1</span>]=(n&gt;&gt;<span class="number">16</span>)&amp;<span class="number">255</span>;buff[p+<span class="number">2</span>]=(n&gt;&gt;<span class="number">8</span>)&amp;<span class="number">255</span>;buff[p+<span class="number">3</span>]=n&amp;<span class="number">255</span>&#125;,<span class="attr">readASCII</span>:<span class="keyword">function</span>(<span class="params">buff,p,l</span>)&#123;<span class="keyword">var</span> s=<span class="string">&#x27;&#x27;</span>;<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;l;i++)s+=<span class="title class_">String</span>.<span class="title function_">fromCharCode</span>(buff[p+i]);<span class="keyword">return</span> s&#125;,<span class="attr">writeASCII</span>:<span class="keyword">function</span>(<span class="params">data,p,s</span>)&#123;<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;s.<span class="property">length</span>;i++)data[p+i]=s.<span class="title function_">charCodeAt</span>(i)&#125;,<span class="attr">readBytes</span>:<span class="keyword">function</span>(<span class="params">buff,p,l</span>)&#123;<span class="keyword">var</span> arr=[];<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;l;i++)arr.<span class="title function_">push</span>(buff[p+i]);<span class="keyword">return</span> arr&#125;,<span class="attr">pad</span>:<span class="keyword">function</span>(<span class="params">n</span>)&#123;<span class="keyword">return</span> n.<span class="property">length</span>&lt;<span class="number">2</span>?<span class="string">&#x27;0&#x27;</span>+<span class="attr">n</span>:n&#125;,<span class="attr">readUTF8</span>:<span class="keyword">function</span>(<span class="params">buff,p,l</span>)&#123;<span class="keyword">var</span> s=<span class="string">&#x27;&#x27;</span>,ns;<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;l;i++)s+=<span class="string">&#x27;%&#x27;</span>+_bin.<span class="title function_">pad</span>(buff[p+i].<span class="title function_">toString</span>(<span class="number">16</span>));<span class="keyword">try</span>&#123;ns=<span class="built_in">decodeURIComponent</span>(s)&#125;<span class="keyword">catch</span>(e)&#123;<span class="keyword">return</span> _bin.<span class="title function_">readASCII</span>(buff,p,l)&#125;<span class="keyword">return</span> ns&#125;&#125;;<span class="keyword">function</span> <span class="title function_">toRGBA8</span>(<span class="params">out</span>)&#123;<span class="keyword">var</span> w=out.<span class="property">width</span>,h=out.<span class="property">height</span>;<span class="keyword">if</span>(out.<span class="property">tabs</span>.<span class="property">acTL</span>==<span class="literal">null</span>)<span class="keyword">return</span>[<span class="title function_">decodeImage</span>(out.<span class="property">data</span>,w,h,out).<span class="property">buffer</span>];<span class="keyword">var</span> frms=[];<span class="keyword">if</span>(out.<span class="property">frames</span>[<span class="number">0</span>].<span class="property">data</span>==<span class="literal">null</span>)out.<span class="property">frames</span>[<span class="number">0</span>].<span class="property">data</span>=out.<span class="property">data</span>;<span class="keyword">var</span> len=w*h*<span class="number">4</span>,img=<span class="keyword">new</span> <span class="title class_">Uint8Array</span>(len),empty=<span class="keyword">new</span> <span class="title class_">Uint8Array</span>(len),prev=<span class="keyword">new</span> <span class="title class_">Uint8Array</span>(len);<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;out.<span class="property">frames</span>.<span class="property">length</span>;i++)&#123;<span class="keyword">var</span> frm=out.<span class="property">frames</span>[i];<span class="keyword">var</span> fx=frm.<span class="property">rect</span>.<span class="property">x</span>,fy=frm.<span class="property">rect</span>.<span class="property">y</span>,fw=frm.<span class="property">rect</span>.<span class="property">width</span>,fh=frm.<span class="property">rect</span>.<span class="property">height</span>;<span class="keyword">var</span> fdata=<span class="title function_">decodeImage</span>(frm.<span class="property">data</span>,fw,fh,out);<span class="keyword">if</span>(i!=<span class="number">0</span>)<span class="keyword">for</span>(<span class="keyword">var</span> j=<span class="number">0</span>;j&lt;len;j++)prev[j]=img[j];<span class="keyword">if</span>(frm.<span class="property">blend</span>==<span class="number">0</span>)<span class="title function_">_copyTile</span>(fdata,fw,fh,img,w,h,fx,fy,<span class="number">0</span>);<span class="keyword">else</span> <span class="keyword">if</span>(frm.<span class="property">blend</span>==<span class="number">1</span>)<span class="title function_">_copyTile</span>(fdata,fw,fh,img,w,h,fx,fy,<span class="number">1</span>);frms.<span class="title function_">push</span>(img.<span class="property">buffer</span>.<span class="title function_">slice</span>(<span class="number">0</span>));<span class="keyword">if</span>(frm.<span class="property">dispose</span>==<span class="number">0</span>)&#123;&#125;<span class="keyword">else</span> <span class="keyword">if</span>(frm.<span class="property">dispose</span>==<span class="number">1</span>)<span class="title function_">_copyTile</span>(empty,fw,fh,img,w,h,fx,fy,<span class="number">0</span>);<span class="keyword">else</span> <span class="keyword">if</span>(frm.<span class="property">dispose</span>==<span class="number">2</span>)<span class="keyword">for</span>(<span class="keyword">var</span> j=<span class="number">0</span>;j&lt;len;j++)img[j]=prev[j]&#125;<span class="keyword">return</span> frms&#125;<span class="keyword">function</span> <span class="title function_">decodeImage</span>(<span class="params">data,w,h,out</span>)&#123;<span class="keyword">var</span> area=w*h,bpp=<span class="title function_">_getBPP</span>(out);<span class="keyword">var</span> bpl=<span class="title class_">Math</span>.<span class="title function_">ceil</span>((w*bpp)/<span class="number">8</span>);<span class="keyword">var</span> bf=<span class="keyword">new</span> <span class="title class_">Uint8Array</span>(area*<span class="number">4</span>),bf32=<span class="keyword">new</span> <span class="title class_">Uint32Array</span>(bf.<span class="property">buffer</span>);<span class="keyword">var</span> ctype=out.<span class="property">ctype</span>,depth=out.<span class="property">depth</span>;<span class="keyword">var</span> rs=_bin.<span class="property">readUshort</span>;<span class="keyword">var</span> time=<span class="title class_">Date</span>.<span class="title function_">now</span>();<span class="keyword">if</span>(ctype==<span class="number">6</span>)&#123;<span class="keyword">var</span> qarea=area&lt;&lt;<span class="number">2</span>;<span class="keyword">if</span>(depth==<span class="number">8</span>)<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;qarea;i+=<span class="number">4</span>)&#123;bf[i]=data[i];bf[i+<span class="number">1</span>]=data[i+<span class="number">1</span>];bf[i+<span class="number">2</span>]=data[i+<span class="number">2</span>];bf[i+<span class="number">3</span>]=data[i+<span class="number">3</span>]&#125;<span class="keyword">if</span>(depth==<span class="number">16</span>)<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;qarea;i++)&#123;bf[i]=data[i&lt;&lt;<span class="number">1</span>]&#125;&#125;<span class="keyword">else</span> <span class="keyword">if</span>(ctype==<span class="number">2</span>)&#123;<span class="keyword">var</span> ts=out.<span class="property">tabs</span>[<span class="string">&#x27;tRNS&#x27;</span>];<span class="keyword">if</span>(ts==<span class="literal">null</span>)&#123;<span class="keyword">if</span>(depth==<span class="number">8</span>)<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;area;i++)&#123;<span class="keyword">var</span> ti=i*<span class="number">3</span>;bf32[i]=(<span class="number">255</span>&lt;&lt;<span class="number">24</span>)|(data[ti+<span class="number">2</span>]&lt;&lt;<span class="number">16</span>)|(data[ti+<span class="number">1</span>]&lt;&lt;<span class="number">8</span>)|data[ti]&#125;<span class="keyword">if</span>(depth==<span class="number">16</span>)<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;area;i++)&#123;<span class="keyword">var</span> ti=i*<span class="number">6</span>;bf32[i]=(<span class="number">255</span>&lt;&lt;<span class="number">24</span>)|(data[ti+<span class="number">4</span>]&lt;&lt;<span class="number">16</span>)|(data[ti+<span class="number">2</span>]&lt;&lt;<span class="number">8</span>)|data[ti]&#125;&#125;<span class="keyword">else</span>&#123;<span class="keyword">var</span> tr=ts[<span class="number">0</span>],tg=ts[<span class="number">1</span>],tb=ts[<span class="number">2</span>];<span class="keyword">if</span>(depth==<span class="number">8</span>)<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;area;i++)&#123;<span class="keyword">var</span> qi=i&lt;&lt;<span class="number">2</span>,ti=i*<span class="number">3</span>;bf32[i]=(<span class="number">255</span>&lt;&lt;<span class="number">24</span>)|(data[ti+<span class="number">2</span>]&lt;&lt;<span class="number">16</span>)|(data[ti+<span class="number">1</span>]&lt;&lt;<span class="number">8</span>)|data[ti];<span class="keyword">if</span>(data[ti]==tr&amp;&amp;data[ti+<span class="number">1</span>]==tg&amp;&amp;data[ti+<span class="number">2</span>]==tb)bf[qi+<span class="number">3</span>]=<span class="number">0</span>&#125;<span class="keyword">if</span>(depth==<span class="number">16</span>)<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;area;i++)&#123;<span class="keyword">var</span> qi=i&lt;&lt;<span class="number">2</span>,ti=i*<span class="number">6</span>;bf32[i]=(<span class="number">255</span>&lt;&lt;<span class="number">24</span>)|(data[ti+<span class="number">4</span>]&lt;&lt;<span class="number">16</span>)|(data[ti+<span class="number">2</span>]&lt;&lt;<span class="number">8</span>)|data[ti];<span class="keyword">if</span>(<span class="title function_">rs</span>(data,ti)==tr&amp;&amp;<span class="title function_">rs</span>(data,ti+<span class="number">2</span>)==tg&amp;&amp;<span class="title function_">rs</span>(data,ti+<span class="number">4</span>)==tb)bf[qi+<span class="number">3</span>]=<span class="number">0</span>&#125;&#125;&#125;<span class="keyword">else</span> <span class="keyword">if</span>(ctype==<span class="number">3</span>)&#123;<span class="keyword">var</span> p=out.<span class="property">tabs</span>[<span class="string">&#x27;PLTE&#x27;</span>],ap=out.<span class="property">tabs</span>[<span class="string">&#x27;tRNS&#x27;</span>],tl=ap?ap.<span class="property">length</span>:<span class="number">0</span>;<span class="keyword">if</span>(depth==<span class="number">1</span>)<span class="keyword">for</span>(<span class="keyword">var</span> y=<span class="number">0</span>;y&lt;h;y++)&#123;<span class="keyword">var</span> s0=y*bpl,t0=y*w;<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;w;i++)&#123;<span class="keyword">var</span> qi=(t0+i)&lt;&lt;<span class="number">2</span>,j=(data[s0+(i&gt;&gt;<span class="number">3</span>)]&gt;&gt;(<span class="number">7</span>-((i&amp;<span class="number">7</span>)&lt;&lt;<span class="number">0</span>)))&amp;<span class="number">1</span>,cj=<span class="number">3</span>*j;bf[qi]=p[cj];bf[qi+<span class="number">1</span>]=p[cj+<span class="number">1</span>];bf[qi+<span class="number">2</span>]=p[cj+<span class="number">2</span>];bf[qi+<span class="number">3</span>]=j&lt;tl?ap[j]:<span class="number">255</span>&#125;&#125;<span class="keyword">if</span>(depth==<span class="number">2</span>)<span class="keyword">for</span>(<span class="keyword">var</span> y=<span class="number">0</span>;y&lt;h;y++)&#123;<span class="keyword">var</span> s0=y*bpl,t0=y*w;<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;w;i++)&#123;<span class="keyword">var</span> qi=(t0+i)&lt;&lt;<span class="number">2</span>,j=(data[s0+(i&gt;&gt;<span class="number">2</span>)]&gt;&gt;(<span class="number">6</span>-((i&amp;<span class="number">3</span>)&lt;&lt;<span class="number">1</span>)))&amp;<span class="number">3</span>,cj=<span class="number">3</span>*j;bf[qi]=p[cj];bf[qi+<span class="number">1</span>]=p[cj+<span class="number">1</span>];bf[qi+<span class="number">2</span>]=p[cj+<span class="number">2</span>];bf[qi+<span class="number">3</span>]=j&lt;tl?ap[j]:<span class="number">255</span>&#125;&#125;<span class="keyword">if</span>(depth==<span class="number">4</span>)<span class="keyword">for</span>(<span class="keyword">var</span> y=<span class="number">0</span>;y&lt;h;y++)&#123;<span class="keyword">var</span> s0=y*bpl,t0=y*w;<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;w;i++)&#123;<span class="keyword">var</span> qi=(t0+i)&lt;&lt;<span class="number">2</span>,j=(data[s0+(i&gt;&gt;<span class="number">1</span>)]&gt;&gt;(<span class="number">4</span>-((i&amp;<span class="number">1</span>)&lt;&lt;<span class="number">2</span>)))&amp;<span class="number">15</span>,cj=<span class="number">3</span>*j;bf[qi]=p[cj];bf[qi+<span class="number">1</span>]=p[cj+<span class="number">1</span>];bf[qi+<span class="number">2</span>]=p[cj+<span class="number">2</span>];bf[qi+<span class="number">3</span>]=j&lt;tl?ap[j]:<span class="number">255</span>&#125;&#125;<span class="keyword">if</span>(depth==<span class="number">8</span>)<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;area;i++)&#123;<span class="keyword">var</span> qi=i&lt;&lt;<span class="number">2</span>,j=data[i],cj=<span class="number">3</span>*j;bf[qi]=p[cj];bf[qi+<span class="number">1</span>]=p[cj+<span class="number">1</span>];bf[qi+<span class="number">2</span>]=p[cj+<span class="number">2</span>];bf[qi+<span class="number">3</span>]=j&lt;tl?ap[j]:<span class="number">255</span>&#125;&#125;<span class="keyword">else</span> <span class="keyword">if</span>(ctype==<span class="number">4</span>)&#123;<span class="keyword">if</span>(depth==<span class="number">8</span>)<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;area;i++)&#123;<span class="keyword">var</span> qi=i&lt;&lt;<span class="number">2</span>,di=i&lt;&lt;<span class="number">1</span>,gr=data[di];bf[qi]=gr;bf[qi+<span class="number">1</span>]=gr;bf[qi+<span class="number">2</span>]=gr;bf[qi+<span class="number">3</span>]=data[di+<span class="number">1</span>]&#125;<span class="keyword">if</span>(depth==<span class="number">16</span>)<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;area;i++)&#123;<span class="keyword">var</span> qi=i&lt;&lt;<span class="number">2</span>,di=i&lt;&lt;<span class="number">2</span>,gr=data[di];bf[qi]=gr;bf[qi+<span class="number">1</span>]=gr;bf[qi+<span class="number">2</span>]=gr;bf[qi+<span class="number">3</span>]=data[di+<span class="number">2</span>]&#125;&#125;<span class="keyword">else</span> <span class="keyword">if</span>(ctype==<span class="number">0</span>)&#123;<span class="keyword">var</span> tr=out.<span class="property">tabs</span>[<span class="string">&#x27;tRNS&#x27;</span>]?out.<span class="property">tabs</span>[<span class="string">&#x27;tRNS&#x27;</span>]:-<span class="number">1</span>;<span class="keyword">for</span>(<span class="keyword">var</span> y=<span class="number">0</span>;y&lt;h;y++)&#123;<span class="keyword">var</span> off=y*bpl,to=y*w;<span class="keyword">if</span>(depth==<span class="number">1</span>)<span class="keyword">for</span>(<span class="keyword">var</span> x=<span class="number">0</span>;x&lt;w;x++)&#123;<span class="keyword">var</span> gr=<span class="number">255</span>*((data[off+(x&gt;&gt;&gt;<span class="number">3</span>)]&gt;&gt;&gt;(<span class="number">7</span>-(x&amp;<span class="number">7</span>)))&amp;<span class="number">1</span>),al=gr==tr*<span class="number">255</span>?<span class="number">0</span>:<span class="number">255</span>;bf32[to+x]=(al&lt;&lt;<span class="number">24</span>)|(gr&lt;&lt;<span class="number">16</span>)|(gr&lt;&lt;<span class="number">8</span>)|gr&#125;<span class="keyword">else</span> <span class="keyword">if</span>(depth==<span class="number">2</span>)<span class="keyword">for</span>(<span class="keyword">var</span> x=<span class="number">0</span>;x&lt;w;x++)&#123;<span class="keyword">var</span> gr=<span class="number">85</span>*((data[off+(x&gt;&gt;&gt;<span class="number">2</span>)]&gt;&gt;&gt;(<span class="number">6</span>-((x&amp;<span class="number">3</span>)&lt;&lt;<span class="number">1</span>)))&amp;<span class="number">3</span>),al=gr==tr*<span class="number">85</span>?<span class="number">0</span>:<span class="number">255</span>;bf32[to+x]=(al&lt;&lt;<span class="number">24</span>)|(gr&lt;&lt;<span class="number">16</span>)|(gr&lt;&lt;<span class="number">8</span>)|gr&#125;<span class="keyword">else</span> <span class="keyword">if</span>(depth==<span class="number">4</span>)<span class="keyword">for</span>(<span class="keyword">var</span> x=<span class="number">0</span>;x&lt;w;x++)&#123;<span class="keyword">var</span> gr=<span class="number">17</span>*((data[off+(x&gt;&gt;&gt;<span class="number">1</span>)]&gt;&gt;&gt;(<span class="number">4</span>-((x&amp;<span class="number">1</span>)&lt;&lt;<span class="number">2</span>)))&amp;<span class="number">15</span>),al=gr==tr*<span class="number">17</span>?<span class="number">0</span>:<span class="number">255</span>;bf32[to+x]=(al&lt;&lt;<span class="number">24</span>)|(gr&lt;&lt;<span class="number">16</span>)|(gr&lt;&lt;<span class="number">8</span>)|gr&#125;<span class="keyword">else</span> <span class="keyword">if</span>(depth==<span class="number">8</span>)<span class="keyword">for</span>(<span class="keyword">var</span> x=<span class="number">0</span>;x&lt;w;x++)&#123;<span class="keyword">var</span> gr=data[off+x],al=gr==tr?<span class="number">0</span>:<span class="number">255</span>;bf32[to+x]=(al&lt;&lt;<span class="number">24</span>)|(gr&lt;&lt;<span class="number">16</span>)|(gr&lt;&lt;<span class="number">8</span>)|gr&#125;<span class="keyword">else</span> <span class="keyword">if</span>(depth==<span class="number">16</span>)<span class="keyword">for</span>(<span class="keyword">var</span> x=<span class="number">0</span>;x&lt;w;x++)&#123;<span class="keyword">var</span> gr=data[off+(x&lt;&lt;<span class="number">1</span>)],al=<span class="title function_">rs</span>(data,off+(x&lt;&lt;<span class="number">1</span>))==tr?<span class="number">0</span>:<span class="number">255</span>;bf32[to+x]=(al&lt;&lt;<span class="number">24</span>)|(gr&lt;&lt;<span class="number">16</span>)|(gr&lt;&lt;<span class="number">8</span>)|gr&#125;&#125;&#125;<span class="keyword">return</span> bf&#125;<span class="keyword">function</span> <span class="title function_">decode</span>(<span class="params">buff</span>)&#123;<span class="keyword">var</span> data=<span class="keyword">new</span> <span class="title class_">Uint8Array</span>(buff),offset=<span class="number">8</span>,bin=_bin,rUs=bin.<span class="property">readUshort</span>,rUi=bin.<span class="property">readUint</span>;<span class="keyword">var</span> out=&#123;<span class="attr">tabs</span>:&#123;&#125;,<span class="attr">frames</span>:[]&#125;;<span class="keyword">var</span> dd=<span class="keyword">new</span> <span class="title class_">Uint8Array</span>(data.<span class="property">length</span>),doff=<span class="number">0</span>;<span class="keyword">var</span> fd,foff=<span class="number">0</span>;<span class="keyword">var</span> mgck=[<span class="number">0x89</span>,<span class="number">0x50</span>,<span class="number">0x4e</span>,<span class="number">0x47</span>,<span class="number">0x0d</span>,<span class="number">0x0a</span>,<span class="number">0x1a</span>,<span class="number">0x0a</span>];<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;<span class="number">8</span>;i++)<span class="keyword">if</span>(data[i]!=mgck[i])<span class="keyword">throw</span><span class="string">&#x27;The input is not a PNG file!&#x27;</span>;<span class="keyword">while</span>(offset&lt;data.<span class="property">length</span>)&#123;<span class="keyword">var</span> len=bin.<span class="title function_">readUint</span>(data,offset);offset+=<span class="number">4</span>;<span class="keyword">var</span> type=bin.<span class="title function_">readASCII</span>(data,offset,<span class="number">4</span>);offset+=<span class="number">4</span>;<span class="keyword">if</span>(type==<span class="string">&#x27;IHDR&#x27;</span>)&#123;<span class="title function_">_IHDR</span>(data,offset,out)&#125;<span class="keyword">else</span> <span class="keyword">if</span>(type==<span class="string">&#x27;iCCP&#x27;</span>)&#123;<span class="keyword">var</span> off=offset;<span class="keyword">while</span>(data[off]!=<span class="number">0</span>)off++;<span class="keyword">var</span> nam=bin.<span class="title function_">readASCII</span>(data,offset,off-offset);<span class="keyword">var</span> cpr=data[off+<span class="number">1</span>];<span class="keyword">var</span> fil=data.<span class="title function_">slice</span>(off+<span class="number">2</span>,offset+len);<span class="keyword">var</span> res=<span class="literal">null</span>;<span class="keyword">try</span>&#123;res=<span class="title function_">_inflate</span>(fil)&#125;<span class="keyword">catch</span>(e)&#123;res=<span class="title function_">inflateRaw</span>(fil)&#125;out.<span class="property">tabs</span>[type]=res&#125;<span class="keyword">else</span> <span class="keyword">if</span>(type==<span class="string">&#x27;CgBI&#x27;</span>)&#123;out.<span class="property">tabs</span>[type]=data.<span class="title function_">slice</span>(offset,offset+<span class="number">4</span>)&#125;<span class="keyword">else</span> <span class="keyword">if</span>(type==<span class="string">&#x27;IDAT&#x27;</span>)&#123;<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;len;i++)dd[doff+i]=data[offset+i];doff+=len&#125;<span class="keyword">else</span> <span class="keyword">if</span>(type==<span class="string">&#x27;acTL&#x27;</span>)&#123;out.<span class="property">tabs</span>[type]=&#123;<span class="attr">num_frames</span>:<span class="title function_">rUi</span>(data,offset),<span class="attr">num_plays</span>:<span class="title function_">rUi</span>(data,offset+<span class="number">4</span>)&#125;;fd=<span class="keyword">new</span> <span class="title class_">Uint8Array</span>(data.<span class="property">length</span>)&#125;<span class="keyword">else</span> <span class="keyword">if</span>(type==<span class="string">&#x27;fcTL&#x27;</span>)&#123;<span class="keyword">if</span>(foff!=<span class="number">0</span>)&#123;<span class="keyword">var</span> fr=out.<span class="property">frames</span>[out.<span class="property">frames</span>.<span class="property">length</span>-<span class="number">1</span>];fr.<span class="property">data</span>=<span class="title function_">_decompress</span>(out,fd.<span class="title function_">slice</span>(<span class="number">0</span>,foff),fr.<span class="property">rect</span>.<span class="property">width</span>,fr.<span class="property">rect</span>.<span class="property">height</span>);foff=<span class="number">0</span>&#125;<span class="keyword">var</span> rct=&#123;<span class="attr">x</span>:<span class="title function_">rUi</span>(data,offset+<span class="number">12</span>),<span class="attr">y</span>:<span class="title function_">rUi</span>(data,offset+<span class="number">16</span>),<span class="attr">width</span>:<span class="title function_">rUi</span>(data,offset+<span class="number">4</span>),<span class="attr">height</span>:<span class="title function_">rUi</span>(data,offset+<span class="number">8</span>)&#125;;<span class="keyword">var</span> del=<span class="title function_">rUs</span>(data,offset+<span class="number">22</span>);del=<span class="title function_">rUs</span>(data,offset+<span class="number">20</span>)/(del==<span class="number">0</span>?<span class="number">100</span>:del);<span class="keyword">var</span> frm=&#123;<span class="attr">rect</span>:rct,<span class="attr">delay</span>:<span class="title class_">Math</span>.<span class="title function_">round</span>(del*<span class="number">1000</span>),<span class="attr">dispose</span>:data[offset+<span class="number">24</span>],<span class="attr">blend</span>:data[offset+<span class="number">25</span>]&#125;;out.<span class="property">frames</span>.<span class="title function_">push</span>(frm)&#125;<span class="keyword">else</span> <span class="keyword">if</span>(type==<span class="string">&#x27;fdAT&#x27;</span>)&#123;<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;len-<span class="number">4</span>;i++)fd[foff+i]=data[offset+i+<span class="number">4</span>];foff+=len-<span class="number">4</span>&#125;<span class="keyword">else</span> <span class="keyword">if</span>(type==<span class="string">&#x27;pHYs&#x27;</span>)&#123;out.<span class="property">tabs</span>[type]=[bin.<span class="title function_">readUint</span>(data,offset),bin.<span class="title function_">readUint</span>(data,offset+<span class="number">4</span>),data[offset+<span class="number">8</span>]]&#125;<span class="keyword">else</span> <span class="keyword">if</span>(type==<span class="string">&#x27;cHRM&#x27;</span>)&#123;out.<span class="property">tabs</span>[type]=[];<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;<span class="number">8</span>;i++)out.<span class="property">tabs</span>[type].<span class="title function_">push</span>(bin.<span class="title function_">readUint</span>(data,offset+i*<span class="number">4</span>))&#125;<span class="keyword">else</span> <span class="keyword">if</span>(type==<span class="string">&#x27;tEXt&#x27;</span>||type==<span class="string">&#x27;zTXt&#x27;</span>)&#123;<span class="keyword">if</span>(out.<span class="property">tabs</span>[type]==<span class="literal">null</span>)out.<span class="property">tabs</span>[type]=&#123;&#125;;<span class="keyword">var</span> nz=bin.<span class="title function_">nextZero</span>(data,offset);<span class="keyword">var</span> keyw=bin.<span class="title function_">readASCII</span>(data,offset,nz-offset);<span class="keyword">var</span> text,tl=offset+len-nz-<span class="number">1</span>;<span class="keyword">if</span>(type==<span class="string">&#x27;tEXt&#x27;</span>)text=bin.<span class="title function_">readASCII</span>(data,nz+<span class="number">1</span>,tl);<span class="keyword">else</span>&#123;<span class="keyword">var</span> bfr=<span class="title function_">_inflate</span>(data.<span class="title function_">slice</span>(nz+<span class="number">2</span>,nz+<span class="number">2</span>+tl));text=bin.<span class="title function_">readUTF8</span>(bfr,<span class="number">0</span>,bfr.<span class="property">length</span>)&#125;out.<span class="property">tabs</span>[type][keyw]=text&#125;<span class="keyword">else</span> <span class="keyword">if</span>(type==<span class="string">&#x27;iTXt&#x27;</span>)&#123;<span class="keyword">if</span>(out.<span class="property">tabs</span>[type]==<span class="literal">null</span>)out.<span class="property">tabs</span>[type]=&#123;&#125;;<span class="keyword">var</span> nz=<span class="number">0</span>,off=offset;nz=bin.<span class="title function_">nextZero</span>(data,off);<span class="keyword">var</span> keyw=bin.<span class="title function_">readASCII</span>(data,off,nz-off);off=nz+<span class="number">1</span>;<span class="keyword">var</span> cflag=data[off],cmeth=data[off+<span class="number">1</span>];off+=<span class="number">2</span>;nz=bin.<span class="title function_">nextZero</span>(data,off);<span class="keyword">var</span> ltag=bin.<span class="title function_">readASCII</span>(data,off,nz-off);off=nz+<span class="number">1</span>;nz=bin.<span class="title function_">nextZero</span>(data,off);<span class="keyword">var</span> tkeyw=bin.<span class="title function_">readUTF8</span>(data,off,nz-off);off=nz+<span class="number">1</span>;<span class="keyword">var</span> text,tl=len-(off-offset);<span class="keyword">if</span>(cflag==<span class="number">0</span>)text=bin.<span class="title function_">readUTF8</span>(data,off,tl);<span class="keyword">else</span>&#123;<span class="keyword">var</span> bfr=<span class="title function_">_inflate</span>(data.<span class="title function_">slice</span>(off,off+tl));text=bin.<span class="title function_">readUTF8</span>(bfr,<span class="number">0</span>,bfr.<span class="property">length</span>)&#125;out.<span class="property">tabs</span>[type][keyw]=text&#125;<span class="keyword">else</span> <span class="keyword">if</span>(type==<span class="string">&#x27;PLTE&#x27;</span>)&#123;out.<span class="property">tabs</span>[type]=bin.<span class="title function_">readBytes</span>(data,offset,len)&#125;<span class="keyword">else</span> <span class="keyword">if</span>(type==<span class="string">&#x27;hIST&#x27;</span>)&#123;<span class="keyword">var</span> pl=out.<span class="property">tabs</span>[<span class="string">&#x27;PLTE&#x27;</span>].<span class="property">length</span>/<span class="number">3</span>;out.<span class="property">tabs</span>[type]=[];<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;pl;i++)out.<span class="property">tabs</span>[type].<span class="title function_">push</span>(<span class="title function_">rUs</span>(data,offset+i*<span class="number">2</span>))&#125;<span class="keyword">else</span> <span class="keyword">if</span>(type==<span class="string">&#x27;tRNS&#x27;</span>)&#123;<span class="keyword">if</span>(out.<span class="property">ctype</span>==<span class="number">3</span>)out.<span class="property">tabs</span>[type]=bin.<span class="title function_">readBytes</span>(data,offset,len);<span class="keyword">else</span> <span class="keyword">if</span>(out.<span class="property">ctype</span>==<span class="number">0</span>)out.<span class="property">tabs</span>[type]=<span class="title function_">rUs</span>(data,offset);<span class="keyword">else</span> <span class="keyword">if</span>(out.<span class="property">ctype</span>==<span class="number">2</span>)out.<span class="property">tabs</span>[type]=[<span class="title function_">rUs</span>(data,offset),<span class="title function_">rUs</span>(data,offset+<span class="number">2</span>),<span class="title function_">rUs</span>(data,offset+<span class="number">4</span>)]&#125;<span class="keyword">else</span> <span class="keyword">if</span>(type==<span class="string">&#x27;gAMA&#x27;</span>)out.<span class="property">tabs</span>[type]=bin.<span class="title function_">readUint</span>(data,offset)/<span class="number">100000</span>;<span class="keyword">else</span> <span class="keyword">if</span>(type==<span class="string">&#x27;sRGB&#x27;</span>)out.<span class="property">tabs</span>[type]=data[offset];<span class="keyword">else</span> <span class="keyword">if</span>(type==<span class="string">&#x27;bKGD&#x27;</span>)&#123;<span class="keyword">if</span>(out.<span class="property">ctype</span>==<span class="number">0</span>||out.<span class="property">ctype</span>==<span class="number">4</span>)out.<span class="property">tabs</span>[type]=[<span class="title function_">rUs</span>(data,offset)];<span class="keyword">else</span> <span class="keyword">if</span>(out.<span class="property">ctype</span>==<span class="number">2</span>||out.<span class="property">ctype</span>==<span class="number">6</span>)out.<span class="property">tabs</span>[type]=[<span class="title function_">rUs</span>(data,offset),<span class="title function_">rUs</span>(data,offset+<span class="number">2</span>),<span class="title function_">rUs</span>(data,offset+<span class="number">4</span>)];<span class="keyword">else</span> <span class="keyword">if</span>(out.<span class="property">ctype</span>==<span class="number">3</span>)out.<span class="property">tabs</span>[type]=data[offset]&#125;<span class="keyword">else</span> <span class="keyword">if</span>(type==<span class="string">&#x27;IEND&#x27;</span>)&#123;<span class="keyword">break</span>&#125;offset+=len;<span class="keyword">var</span> crc=bin.<span class="title function_">readUint</span>(data,offset);offset+=<span class="number">4</span>&#125;<span class="keyword">if</span>(foff!=<span class="number">0</span>)&#123;<span class="keyword">var</span> fr=out.<span class="property">frames</span>[out.<span class="property">frames</span>.<span class="property">length</span>-<span class="number">1</span>];fr.<span class="property">data</span>=<span class="title function_">_decompress</span>(out,fd.<span class="title function_">slice</span>(<span class="number">0</span>,foff),fr.<span class="property">rect</span>.<span class="property">width</span>,fr.<span class="property">rect</span>.<span class="property">height</span>)&#125;out.<span class="property">data</span>=<span class="title function_">_decompress</span>(out,dd,out.<span class="property">width</span>,out.<span class="property">height</span>);<span class="keyword">delete</span> out.<span class="property">compress</span>;<span class="keyword">delete</span> out.<span class="property">interlace</span>;<span class="keyword">delete</span> out.<span class="property">filter</span>;<span class="keyword">return</span> out&#125;<span class="keyword">function</span> <span class="title function_">_decompress</span>(<span class="params">out,dd,w,h</span>)&#123;<span class="keyword">var</span> time=<span class="title class_">Date</span>.<span class="title function_">now</span>();<span class="keyword">var</span> bpp=<span class="title function_">_getBPP</span>(out),bpl=<span class="title class_">Math</span>.<span class="title function_">ceil</span>((w*bpp)/<span class="number">8</span>),buff=<span class="keyword">new</span> <span class="title class_">Uint8Array</span>((bpl+<span class="number">1</span>+out.<span class="property">interlace</span>)*h);<span class="keyword">if</span>(out.<span class="property">tabs</span>[<span class="string">&#x27;CgBI&#x27;</span>])dd=<span class="title function_">inflateRaw</span>(dd,buff);<span class="keyword">else</span> dd=<span class="title function_">_inflate</span>(dd,buff);<span class="keyword">var</span> time=<span class="title class_">Date</span>.<span class="title function_">now</span>();<span class="keyword">if</span>(out.<span class="property">interlace</span>==<span class="number">0</span>)dd=<span class="title function_">_filterZero</span>(dd,out,<span class="number">0</span>,w,h);<span class="keyword">else</span> <span class="keyword">if</span>(out.<span class="property">interlace</span>==<span class="number">1</span>)dd=<span class="title function_">_readInterlace</span>(dd,out);<span class="keyword">return</span> dd&#125;<span class="keyword">function</span> <span class="title function_">_inflate</span>(<span class="params">data,buff</span>)&#123;<span class="keyword">var</span> out=<span class="title function_">inflateRaw</span>(<span class="keyword">new</span> <span class="title class_">Uint8Array</span>(data.<span class="property">buffer</span>,<span class="number">2</span>,data.<span class="property">length</span>-<span class="number">6</span>),buff);<span class="keyword">return</span> out&#125;<span class="keyword">var</span> inflateRaw=(<span class="keyword">function</span>(<span class="params"></span>)&#123;<span class="keyword">var</span> D=(<span class="keyword">function</span>(<span class="params"></span>)&#123;<span class="keyword">var</span> o=<span class="title class_">Uint16Array</span>,j=<span class="title class_">Uint32Array</span>;<span class="keyword">return</span>&#123;<span class="attr">m</span>:<span class="keyword">new</span> <span class="title function_">o</span>(<span class="number">16</span>),<span class="attr">v</span>:<span class="keyword">new</span> <span class="title function_">o</span>(<span class="number">16</span>),<span class="attr">d</span>:[<span class="number">16</span>,<span class="number">17</span>,<span class="number">18</span>,<span class="number">0</span>,<span class="number">8</span>,<span class="number">7</span>,<span class="number">9</span>,<span class="number">6</span>,<span class="number">10</span>,<span class="number">5</span>,<span class="number">11</span>,<span class="number">4</span>,<span class="number">12</span>,<span class="number">3</span>,<span class="number">13</span>,<span class="number">2</span>,<span class="number">14</span>,<span class="number">1</span>,<span class="number">15</span>],<span class="attr">o</span>:[<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">13</span>,<span class="number">15</span>,<span class="number">17</span>,<span class="number">19</span>,<span class="number">23</span>,<span class="number">27</span>,<span class="number">31</span>,<span class="number">35</span>,<span class="number">43</span>,<span class="number">51</span>,<span class="number">59</span>,<span class="number">67</span>,<span class="number">83</span>,<span class="number">99</span>,<span class="number">115</span>,<span class="number">131</span>,<span class="number">163</span>,<span class="number">195</span>,<span class="number">227</span>,<span class="number">258</span>,<span class="number">999</span>,<span class="number">999</span>,<span class="number">999</span>],<span class="attr">z</span>:[<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">4</span>,<span class="number">4</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">5</span>,<span class="number">5</span>,<span class="number">5</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>],<span class="attr">B</span>:<span class="keyword">new</span> <span class="title function_">o</span>(<span class="number">32</span>),<span class="attr">p</span>:[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">7</span>,<span class="number">9</span>,<span class="number">13</span>,<span class="number">17</span>,<span class="number">25</span>,<span class="number">33</span>,<span class="number">49</span>,<span class="number">65</span>,<span class="number">97</span>,<span class="number">129</span>,<span class="number">193</span>,<span class="number">257</span>,<span class="number">385</span>,<span class="number">513</span>,<span class="number">769</span>,<span class="number">1025</span>,<span class="number">1537</span>,<span class="number">2049</span>,<span class="number">3073</span>,<span class="number">4097</span>,<span class="number">6145</span>,<span class="number">8193</span>,<span class="number">12289</span>,<span class="number">16385</span>,<span class="number">24577</span>,<span class="number">65535</span>,<span class="number">65535</span>],<span class="attr">w</span>:[<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">11</span>,<span class="number">12</span>,<span class="number">12</span>,<span class="number">13</span>,<span class="number">13</span>,<span class="number">0</span>,<span class="number">0</span>],<span class="attr">h</span>:<span class="keyword">new</span> <span class="title function_">j</span>(<span class="number">32</span>),<span class="attr">g</span>:<span class="keyword">new</span> <span class="title function_">o</span>(<span class="number">512</span>),<span class="attr">s</span>:[],<span class="attr">A</span>:<span class="keyword">new</span> <span class="title function_">o</span>(<span class="number">32</span>),<span class="attr">t</span>:[],<span class="attr">k</span>:<span class="keyword">new</span> <span class="title function_">o</span>(<span class="number">32768</span>),<span class="attr">c</span>:[],<span class="attr">a</span>:[],<span class="attr">n</span>:<span class="keyword">new</span> <span class="title function_">o</span>(<span class="number">32768</span>),<span class="attr">e</span>:[],<span class="attr">C</span>:<span class="keyword">new</span> <span class="title function_">o</span>(<span class="number">512</span>),<span class="attr">b</span>:[],<span class="attr">i</span>:<span class="keyword">new</span> <span class="title function_">o</span>(<span class="number">1</span>&lt;&lt;<span class="number">15</span>),<span class="attr">r</span>:<span class="keyword">new</span> <span class="title function_">j</span>(<span class="number">286</span>),<span class="attr">f</span>:<span class="keyword">new</span> <span class="title function_">j</span>(<span class="number">30</span>),<span class="attr">l</span>:<span class="keyword">new</span> <span class="title function_">j</span>(<span class="number">19</span>),<span class="attr">u</span>:<span class="keyword">new</span> <span class="title function_">j</span>(<span class="number">15e3</span>),<span class="attr">q</span>:<span class="keyword">new</span> <span class="title function_">o</span>(<span class="number">1</span>&lt;&lt;<span class="number">16</span>),<span class="attr">j</span>:<span class="keyword">new</span> <span class="title function_">o</span>(<span class="number">1</span>&lt;&lt;<span class="number">15</span>)&#125;&#125;)();<span class="keyword">function</span> <span class="title function_">C</span>(<span class="params">o,j</span>)&#123;<span class="keyword">var</span> I=o.<span class="property">length</span>,A,r,i,y,G,f=D.<span class="property">v</span>;<span class="keyword">for</span>(<span class="keyword">var</span> y=<span class="number">0</span>;y&lt;=j;y++)f[y]=<span class="number">0</span>;<span class="keyword">for</span>(y=<span class="number">1</span>;y&lt;I;y+=<span class="number">2</span>)f[o[y]]++;<span class="keyword">var</span> a=D.<span class="property">m</span>;A=<span class="number">0</span>;f[<span class="number">0</span>]=<span class="number">0</span>;<span class="keyword">for</span>(r=<span class="number">1</span>;r&lt;=j;r++)&#123;A=(A+f[r-<span class="number">1</span>])&lt;&lt;<span class="number">1</span>;a[r]=A&#125;<span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;I;i+=<span class="number">2</span>)&#123;G=o[i+<span class="number">1</span>];<span class="keyword">if</span>(G!=<span class="number">0</span>)&#123;o[i]=a[G];a[G]++&#125;&#125;&#125;<span class="keyword">function</span> <span class="title function_">t</span>(<span class="params">o,j,I</span>)&#123;<span class="keyword">var</span> A=o.<span class="property">length</span>,r=D.<span class="property">i</span>;<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;A;i+=<span class="number">2</span>)<span class="keyword">if</span>(o[i+<span class="number">1</span>]!=<span class="number">0</span>)&#123;<span class="keyword">var</span> y=i&gt;&gt;<span class="number">1</span>,G=o[i+<span class="number">1</span>],f=(y&lt;&lt;<span class="number">4</span>)|G,a=j-G,k=o[i]&lt;&lt;a,N=k+(<span class="number">1</span>&lt;&lt;a);<span class="keyword">while</span>(k!=N)&#123;<span class="keyword">var</span> x=r[k]&gt;&gt;&gt;(<span class="number">15</span>-j);I[x]=f;k++&#125;&#125;&#125;<span class="keyword">function</span> <span class="title function_">g</span>(<span class="params">o,j</span>)&#123;<span class="keyword">var</span> I=D.<span class="property">i</span>,A=<span class="number">15</span>-j;<span class="keyword">for</span>(<span class="keyword">var</span> r=<span class="number">0</span>;r&lt;o.<span class="property">length</span>;r+=<span class="number">2</span>)&#123;<span class="keyword">var</span> i=o[r]&lt;&lt;(j-o[r+<span class="number">1</span>]);o[r]=I[i]&gt;&gt;&gt;A&#125;&#125;(<span class="keyword">function</span>(<span class="params"></span>)&#123;<span class="keyword">var</span> o=<span class="number">1</span>&lt;&lt;<span class="number">15</span>;<span class="keyword">for</span>(<span class="keyword">var</span> j=<span class="number">0</span>;j&lt;o;j++)&#123;<span class="keyword">var</span> I=j;I=((I&amp;<span class="number">2863311530</span>)&gt;&gt;&gt;<span class="number">1</span>)|((I&amp;<span class="number">1431655765</span>)&lt;&lt;<span class="number">1</span>);I=((I&amp;<span class="number">3435973836</span>)&gt;&gt;&gt;<span class="number">2</span>)|((I&amp;<span class="number">858993459</span>)&lt;&lt;<span class="number">2</span>);I=((I&amp;<span class="number">4042322160</span>)&gt;&gt;&gt;<span class="number">4</span>)|((I&amp;<span class="number">252645135</span>)&lt;&lt;<span class="number">4</span>);I=((I&amp;<span class="number">4278255360</span>)&gt;&gt;&gt;<span class="number">8</span>)|((I&amp;<span class="number">16711935</span>)&lt;&lt;<span class="number">8</span>);D.<span class="property">i</span>[j]=((I&gt;&gt;&gt;<span class="number">16</span>)|(I&lt;&lt;<span class="number">16</span>))&gt;&gt;&gt;<span class="number">17</span>&#125;<span class="keyword">function</span> <span class="title function_">A</span>(<span class="params">r,i,y</span>)&#123;<span class="keyword">while</span>(i--!=<span class="number">0</span>)r.<span class="title function_">push</span>(<span class="number">0</span>,y)&#125;<span class="keyword">for</span>(<span class="keyword">var</span> j=<span class="number">0</span>;j&lt;<span class="number">32</span>;j++)&#123;D.<span class="property">B</span>[j]=(D.<span class="property">o</span>[j]&lt;&lt;<span class="number">3</span>)|D.<span class="property">z</span>[j];D.<span class="property">h</span>[j]=(D.<span class="property">p</span>[j]&lt;&lt;<span class="number">4</span>)|D.<span class="property">w</span>[j]&#125;<span class="title function_">A</span>(D.<span class="property">s</span>,<span class="number">144</span>,<span class="number">8</span>);<span class="title function_">A</span>(D.<span class="property">s</span>,<span class="number">255</span>-<span class="number">143</span>,<span class="number">9</span>);<span class="title function_">A</span>(D.<span class="property">s</span>,<span class="number">279</span>-<span class="number">255</span>,<span class="number">7</span>);<span class="title function_">A</span>(D.<span class="property">s</span>,<span class="number">287</span>-<span class="number">279</span>,<span class="number">8</span>);<span class="title function_">C</span>(D.<span class="property">s</span>,<span class="number">9</span>);<span class="title function_">t</span>(D.<span class="property">s</span>,<span class="number">9</span>,D.<span class="property">g</span>);<span class="title function_">g</span>(D.<span class="property">s</span>,<span class="number">9</span>);<span class="title function_">A</span>(D.<span class="property">t</span>,<span class="number">32</span>,<span class="number">5</span>);<span class="title function_">C</span>(D.<span class="property">t</span>,<span class="number">5</span>);<span class="title function_">t</span>(D.<span class="property">t</span>,<span class="number">5</span>,D.<span class="property">A</span>);<span class="title function_">g</span>(D.<span class="property">t</span>,<span class="number">5</span>);<span class="title function_">A</span>(D.<span class="property">b</span>,<span class="number">19</span>,<span class="number">0</span>);<span class="title function_">A</span>(D.<span class="property">c</span>,<span class="number">286</span>,<span class="number">0</span>);<span class="title function_">A</span>(D.<span class="property">e</span>,<span class="number">30</span>,<span class="number">0</span>);<span class="title function_">A</span>(D.<span class="property">a</span>,<span class="number">320</span>,<span class="number">0</span>)&#125;)();<span class="keyword">function</span> <span class="title function_">F</span>(<span class="params">o,j,I</span>)&#123;<span class="keyword">return</span>(((o[j&gt;&gt;&gt;<span class="number">3</span>]|(o[(j&gt;&gt;&gt;<span class="number">3</span>)+<span class="number">1</span>]&lt;&lt;<span class="number">8</span>))&gt;&gt;&gt;(j&amp;<span class="number">7</span>))&amp;((<span class="number">1</span>&lt;&lt;I)-<span class="number">1</span>))&#125;<span class="keyword">function</span> <span class="title function_">s</span>(<span class="params">o,j,I</span>)&#123;<span class="keyword">return</span>(((o[j&gt;&gt;&gt;<span class="number">3</span>]|(o[(j&gt;&gt;&gt;<span class="number">3</span>)+<span class="number">1</span>]&lt;&lt;<span class="number">8</span>)|(o[(j&gt;&gt;&gt;<span class="number">3</span>)+<span class="number">2</span>]&lt;&lt;<span class="number">16</span>))&gt;&gt;&gt;(j&amp;<span class="number">7</span>))&amp;((<span class="number">1</span>&lt;&lt;I)-<span class="number">1</span>))&#125;<span class="keyword">function</span> <span class="title function_">w</span>(<span class="params">o,j</span>)&#123;<span class="keyword">return</span>((o[j&gt;&gt;&gt;<span class="number">3</span>]|(o[(j&gt;&gt;&gt;<span class="number">3</span>)+<span class="number">1</span>]&lt;&lt;<span class="number">8</span>)|(o[(j&gt;&gt;&gt;<span class="number">3</span>)+<span class="number">2</span>]&lt;&lt;<span class="number">16</span>))&gt;&gt;&gt;(j&amp;<span class="number">7</span>))&#125;<span class="keyword">function</span> <span class="title function_">b</span>(<span class="params">o,j</span>)&#123;<span class="keyword">return</span>((o[j&gt;&gt;&gt;<span class="number">3</span>]|(o[(j&gt;&gt;&gt;<span class="number">3</span>)+<span class="number">1</span>]&lt;&lt;<span class="number">8</span>)|(o[(j&gt;&gt;&gt;<span class="number">3</span>)+<span class="number">2</span>]&lt;&lt;<span class="number">16</span>)|(o[(j&gt;&gt;&gt;<span class="number">3</span>)+<span class="number">3</span>]&lt;&lt;<span class="number">24</span>))&gt;&gt;&gt;(j&amp;<span class="number">7</span>))&#125;<span class="keyword">function</span> <span class="title function_">v</span>(<span class="params">o,j</span>)&#123;<span class="keyword">var</span> I=<span class="title class_">Uint8Array</span>,r=<span class="number">0</span>,i=<span class="number">0</span>,y=<span class="number">0</span>,G=<span class="number">0</span>,f=<span class="number">0</span>,a=<span class="number">0</span>,k=<span class="number">0</span>,N=<span class="number">0</span>,x=<span class="number">0</span>,P,J;<span class="keyword">if</span>(o[<span class="number">0</span>]==<span class="number">3</span>&amp;&amp;o[<span class="number">1</span>]==<span class="number">0</span>)<span class="keyword">return</span> j?<span class="attr">j</span>:<span class="keyword">new</span> <span class="title function_">I</span>(<span class="number">0</span>);<span class="keyword">var</span> A=j==<span class="literal">null</span>;<span class="keyword">if</span>(A)j=<span class="keyword">new</span> <span class="title function_">I</span>((o.<span class="property">length</span>&gt;&gt;&gt;<span class="number">2</span>)&lt;&lt;<span class="number">3</span>);<span class="keyword">while</span>(r==<span class="number">0</span>)&#123;r=<span class="title function_">s</span>(o,x,<span class="number">1</span>);i=<span class="title function_">s</span>(o,x+<span class="number">1</span>,<span class="number">2</span>);x+=<span class="number">3</span>;<span class="keyword">if</span>(i==<span class="number">0</span>)&#123;<span class="keyword">if</span>((x&amp;<span class="number">7</span>)!=<span class="number">0</span>)x+=<span class="number">8</span>-(x&amp;<span class="number">7</span>);<span class="keyword">var</span> K=(x&gt;&gt;&gt;<span class="number">3</span>)+<span class="number">4</span>,m=o[K-<span class="number">4</span>]|(o[K-<span class="number">3</span>]&lt;&lt;<span class="number">8</span>);<span class="keyword">if</span>(A)j=<span class="title function_">H</span>(j,N+m);j.<span class="title function_">set</span>(<span class="keyword">new</span> <span class="title function_">I</span>(o.<span class="property">buffer</span>,o.<span class="property">byteOffset</span>+K,m),N);x=(K+m)&lt;&lt;<span class="number">3</span>;N+=m;<span class="keyword">continue</span>&#125;<span class="keyword">if</span>(A)j=<span class="title function_">H</span>(j,N+(<span class="number">1</span>&lt;&lt;<span class="number">17</span>));<span class="keyword">if</span>(i==<span class="number">1</span>)&#123;P=D.<span class="property">g</span>;J=D.<span class="property">A</span>;a=(<span class="number">1</span>&lt;&lt;<span class="number">9</span>)-<span class="number">1</span>;k=(<span class="number">1</span>&lt;&lt;<span class="number">5</span>)-<span class="number">1</span>&#125;<span class="keyword">if</span>(i==<span class="number">2</span>)&#123;y=<span class="title function_">F</span>(o,x,<span class="number">5</span>)+<span class="number">257</span>;G=<span class="title function_">F</span>(o,x+<span class="number">5</span>,<span class="number">5</span>)+<span class="number">1</span>;f=<span class="title function_">F</span>(o,x+<span class="number">10</span>,<span class="number">4</span>)+<span class="number">4</span>;x+=<span class="number">14</span>;<span class="keyword">var</span> O=x,Q=<span class="number">1</span>;<span class="keyword">for</span>(<span class="keyword">var</span> p=<span class="number">0</span>;p&lt;<span class="number">38</span>;p+=<span class="number">2</span>)&#123;D.<span class="property">b</span>[p]=<span class="number">0</span>;D.<span class="property">b</span>[p+<span class="number">1</span>]=<span class="number">0</span>&#125;<span class="keyword">for</span>(<span class="keyword">var</span> p=<span class="number">0</span>;p&lt;f;p++)&#123;<span class="keyword">var</span> l=<span class="title function_">F</span>(o,x+p*<span class="number">3</span>,<span class="number">3</span>);D.<span class="property">b</span>[(D.<span class="property">d</span>[p]&lt;&lt;<span class="number">1</span>)+<span class="number">1</span>]=l;<span class="keyword">if</span>(l&gt;Q)Q=l&#125;x+=<span class="number">3</span>*f;<span class="title function_">C</span>(D.<span class="property">b</span>,Q);<span class="title function_">t</span>(D.<span class="property">b</span>,Q,D.<span class="property">C</span>);P=D.<span class="property">k</span>;J=D.<span class="property">n</span>;x=<span class="title function_">B</span>(D.<span class="property">C</span>,(<span class="number">1</span>&lt;&lt;Q)-<span class="number">1</span>,y+G,o,x,D.<span class="property">a</span>);<span class="keyword">var</span> u=<span class="title function_">d</span>(D.<span class="property">a</span>,<span class="number">0</span>,y,D.<span class="property">c</span>);a=(<span class="number">1</span>&lt;&lt;u)-<span class="number">1</span>;<span class="keyword">var</span> n=<span class="title function_">d</span>(D.<span class="property">a</span>,y,G,D.<span class="property">e</span>);k=(<span class="number">1</span>&lt;&lt;n)-<span class="number">1</span>;<span class="title function_">C</span>(D.<span class="property">c</span>,u);<span class="title function_">t</span>(D.<span class="property">c</span>,u,P);<span class="title function_">C</span>(D.<span class="property">e</span>,n);<span class="title function_">t</span>(D.<span class="property">e</span>,n,J)&#125;<span class="keyword">while</span>(!<span class="number">0</span>)&#123;<span class="keyword">var</span> h=P[<span class="title function_">w</span>(o,x)&amp;a];x+=h&amp;<span class="number">15</span>;<span class="keyword">var</span> L=h&gt;&gt;&gt;<span class="number">4</span>;<span class="keyword">if</span>(L&gt;&gt;&gt;<span class="number">8</span>==<span class="number">0</span>)&#123;j[N++]=L&#125;<span class="keyword">else</span> <span class="keyword">if</span>(L==<span class="number">256</span>)&#123;<span class="keyword">break</span>&#125;<span class="keyword">else</span>&#123;<span class="keyword">var</span> M=N+L-<span class="number">254</span>;<span class="keyword">if</span>(L&gt;<span class="number">264</span>)&#123;<span class="keyword">var</span> z=D.<span class="property">B</span>[L-<span class="number">257</span>];M=N+(z&gt;&gt;&gt;<span class="number">3</span>)+<span class="title function_">F</span>(o,x,z&amp;<span class="number">7</span>);x+=z&amp;<span class="number">7</span>&#125;<span class="keyword">var</span> e=J[<span class="title function_">w</span>(o,x)&amp;k];x+=e&amp;<span class="number">15</span>;<span class="keyword">var</span> E=e&gt;&gt;&gt;<span class="number">4</span>,c=D.<span class="property">h</span>[E],q=(c&gt;&gt;&gt;<span class="number">4</span>)+<span class="title function_">s</span>(o,x,c&amp;<span class="number">15</span>);x+=c&amp;<span class="number">15</span>;<span class="keyword">if</span>(A)j=<span class="title function_">H</span>(j,N+(<span class="number">1</span>&lt;&lt;<span class="number">17</span>));<span class="keyword">while</span>(N&lt;M)&#123;j[N]=j[N++ -q];j[N]=j[N++ -q];j[N]=j[N++ -q];j[N]=j[N++ -q]&#125;N=M&#125;&#125;&#125;<span class="keyword">return</span> j.<span class="property">length</span>==N?<span class="attr">j</span>:j.<span class="title function_">slice</span>(<span class="number">0</span>,N)&#125;<span class="keyword">function</span> <span class="title function_">H</span>(<span class="params">o,j</span>)&#123;<span class="keyword">var</span> I=o.<span class="property">length</span>;<span class="keyword">if</span>(j&lt;=I)<span class="keyword">return</span> o;<span class="keyword">var</span> A=<span class="keyword">new</span> <span class="title class_">Uint8Array</span>(<span class="title class_">Math</span>.<span class="title function_">max</span>(I&lt;&lt;<span class="number">1</span>,j));A.<span class="title function_">set</span>(o,<span class="number">0</span>);<span class="keyword">return</span> A&#125;<span class="keyword">function</span> <span class="title function_">B</span>(<span class="params">o,j,I,A,r,i</span>)&#123;<span class="keyword">var</span> y=<span class="number">0</span>;<span class="keyword">while</span>(y&lt;I)&#123;<span class="keyword">var</span> G=o[<span class="title function_">w</span>(A,r)&amp;j];r+=G&amp;<span class="number">15</span>;<span class="keyword">var</span> f=G&gt;&gt;&gt;<span class="number">4</span>;<span class="keyword">if</span>(f&lt;=<span class="number">15</span>)&#123;i[y]=f;y++&#125;<span class="keyword">else</span>&#123;<span class="keyword">var</span> a=<span class="number">0</span>,k=<span class="number">0</span>;<span class="keyword">if</span>(f==<span class="number">16</span>)&#123;k=<span class="number">3</span>+<span class="title function_">F</span>(A,r,<span class="number">2</span>);r+=<span class="number">2</span>;a=i[y-<span class="number">1</span>]&#125;<span class="keyword">else</span> <span class="keyword">if</span>(f==<span class="number">17</span>)&#123;k=<span class="number">3</span>+<span class="title function_">F</span>(A,r,<span class="number">3</span>);r+=<span class="number">3</span>&#125;<span class="keyword">else</span> <span class="keyword">if</span>(f==<span class="number">18</span>)&#123;k=<span class="number">11</span>+<span class="title function_">F</span>(A,r,<span class="number">7</span>);r+=<span class="number">7</span>&#125;<span class="keyword">var</span> N=y+k;<span class="keyword">while</span>(y&lt;N)&#123;i[y]=a;y++&#125;&#125;&#125;<span class="keyword">return</span> r&#125;<span class="keyword">function</span> <span class="title function_">d</span>(<span class="params">o,j,I,A</span>)&#123;<span class="keyword">var</span> r=<span class="number">0</span>,i=<span class="number">0</span>,y=A.<span class="property">length</span>&gt;&gt;&gt;<span class="number">1</span>;<span class="keyword">while</span>(i&lt;I)&#123;<span class="keyword">var</span> G=o[i+j];A[i&lt;&lt;<span class="number">1</span>]=<span class="number">0</span>;A[(i&lt;&lt;<span class="number">1</span>)+<span class="number">1</span>]=G;<span class="keyword">if</span>(G&gt;r)r=G;i++&#125;<span class="keyword">while</span>(i&lt;y)&#123;A[i&lt;&lt;<span class="number">1</span>]=<span class="number">0</span>;A[(i&lt;&lt;<span class="number">1</span>)+<span class="number">1</span>]=<span class="number">0</span>;i++&#125;<span class="keyword">return</span> r&#125;<span class="keyword">return</span> v&#125;)();<span class="keyword">function</span> <span class="title function_">_readInterlace</span>(<span class="params">data,out</span>)&#123;<span class="keyword">var</span> w=out.<span class="property">width</span>,h=out.<span class="property">height</span>;<span class="keyword">var</span> bpp=<span class="title function_">_getBPP</span>(out),cbpp=bpp&gt;&gt;<span class="number">3</span>,bpl=<span class="title class_">Math</span>.<span class="title function_">ceil</span>((w*bpp)/<span class="number">8</span>);<span class="keyword">var</span> img=<span class="keyword">new</span> <span class="title class_">Uint8Array</span>(h*bpl);<span class="keyword">var</span> di=<span class="number">0</span>;<span class="keyword">var</span> starting_row=[<span class="number">0</span>,<span class="number">0</span>,<span class="number">4</span>,<span class="number">0</span>,<span class="number">2</span>,<span class="number">0</span>,<span class="number">1</span>];<span class="keyword">var</span> starting_col=[<span class="number">0</span>,<span class="number">4</span>,<span class="number">0</span>,<span class="number">2</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>];<span class="keyword">var</span> row_increment=[<span class="number">8</span>,<span class="number">8</span>,<span class="number">8</span>,<span class="number">4</span>,<span class="number">4</span>,<span class="number">2</span>,<span class="number">2</span>];<span class="keyword">var</span> col_increment=[<span class="number">8</span>,<span class="number">8</span>,<span class="number">4</span>,<span class="number">4</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">1</span>];<span class="keyword">var</span> pass=<span class="number">0</span>;<span class="keyword">while</span>(pass&lt;<span class="number">7</span>)&#123;<span class="keyword">var</span> ri=row_increment[pass],ci=col_increment[pass];<span class="keyword">var</span> sw=<span class="number">0</span>,sh=<span class="number">0</span>;<span class="keyword">var</span> cr=starting_row[pass];<span class="keyword">while</span>(cr&lt;h)&#123;cr+=ri;sh++&#125;<span class="keyword">var</span> cc=starting_col[pass];<span class="keyword">while</span>(cc&lt;w)&#123;cc+=ci;sw++&#125;<span class="keyword">var</span> bpll=<span class="title class_">Math</span>.<span class="title function_">ceil</span>((sw*bpp)/<span class="number">8</span>);<span class="title function_">_filterZero</span>(data,out,di,sw,sh);<span class="keyword">var</span> y=<span class="number">0</span>,row=starting_row[pass];<span class="keyword">while</span>(row&lt;h)&#123;<span class="keyword">var</span> col=starting_col[pass];<span class="keyword">var</span> cdi=(di+y*bpll)&lt;&lt;<span class="number">3</span>;<span class="keyword">while</span>(col&lt;w)&#123;<span class="keyword">if</span>(bpp==<span class="number">1</span>)&#123;<span class="keyword">var</span> val=data[cdi&gt;&gt;<span class="number">3</span>];val=(val&gt;&gt;(<span class="number">7</span>-(cdi&amp;<span class="number">7</span>)))&amp;<span class="number">1</span>;img[row*bpl+(col&gt;&gt;<span class="number">3</span>)]|=val&lt;&lt;(<span class="number">7</span>-((col&amp;<span class="number">7</span>)&lt;&lt;<span class="number">0</span>))&#125;<span class="keyword">if</span>(bpp==<span class="number">2</span>)&#123;<span class="keyword">var</span> val=data[cdi&gt;&gt;<span class="number">3</span>];val=(val&gt;&gt;(<span class="number">6</span>-(cdi&amp;<span class="number">7</span>)))&amp;<span class="number">3</span>;img[row*bpl+(col&gt;&gt;<span class="number">2</span>)]|=val&lt;&lt;(<span class="number">6</span>-((col&amp;<span class="number">3</span>)&lt;&lt;<span class="number">1</span>))&#125;<span class="keyword">if</span>(bpp==<span class="number">4</span>)&#123;<span class="keyword">var</span> val=data[cdi&gt;&gt;<span class="number">3</span>];val=(val&gt;&gt;(<span class="number">4</span>-(cdi&amp;<span class="number">7</span>)))&amp;<span class="number">15</span>;img[row*bpl+(col&gt;&gt;<span class="number">1</span>)]|=val&lt;&lt;(<span class="number">4</span>-((col&amp;<span class="number">1</span>)&lt;&lt;<span class="number">2</span>))&#125;<span class="keyword">if</span>(bpp&gt;=<span class="number">8</span>)&#123;<span class="keyword">var</span> ii=row*bpl+col*cbpp;<span class="keyword">for</span>(<span class="keyword">var</span> j=<span class="number">0</span>;j&lt;cbpp;j++)img[ii+j]=data[(cdi&gt;&gt;<span class="number">3</span>)+j]&#125;cdi+=bpp;col+=ci&#125;y++;row+=ri&#125;<span class="keyword">if</span>(sw*sh!=<span class="number">0</span>)di+=sh*(<span class="number">1</span>+bpll);pass=pass+<span class="number">1</span>&#125;<span class="keyword">return</span> img&#125;<span class="keyword">function</span> <span class="title function_">_getBPP</span>(<span class="params">out</span>)&#123;<span class="keyword">var</span> noc=[<span class="number">1</span>,<span class="literal">null</span>,<span class="number">3</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="literal">null</span>,<span class="number">4</span>][out.<span class="property">ctype</span>];<span class="keyword">return</span> noc*out.<span class="property">depth</span>&#125;<span class="keyword">function</span> <span class="title function_">_filterZero</span>(<span class="params">data,out,off,w,h</span>)&#123;<span class="keyword">var</span> bpp=<span class="title function_">_getBPP</span>(out),bpl=<span class="title class_">Math</span>.<span class="title function_">ceil</span>((w*bpp)/<span class="number">8</span>);bpp=<span class="title class_">Math</span>.<span class="title function_">ceil</span>(bpp/<span class="number">8</span>);<span class="keyword">var</span> i,di,type=data[off],x=<span class="number">0</span>;<span class="keyword">if</span>(type&gt;<span class="number">1</span>)data[off]=[<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>][type-<span class="number">2</span>];<span class="keyword">if</span>(type==<span class="number">3</span>)<span class="keyword">for</span>(x=bpp;x&lt;bpl;x++)data[x+<span class="number">1</span>]=(data[x+<span class="number">1</span>]+(data[x+<span class="number">1</span>-bpp]&gt;&gt;&gt;<span class="number">1</span>))&amp;<span class="number">255</span>;<span class="keyword">for</span>(<span class="keyword">var</span> y=<span class="number">0</span>;y&lt;h;y++)&#123;i=off+y*bpl;di=i+y+<span class="number">1</span>;type=data[di-<span class="number">1</span>];x=<span class="number">0</span>;<span class="keyword">if</span>(type==<span class="number">0</span>)<span class="keyword">for</span>(;x&lt;bpl;x++)data[i+x]=data[di+x];<span class="keyword">else</span> <span class="keyword">if</span>(type==<span class="number">1</span>)&#123;<span class="keyword">for</span>(;x&lt;bpp;x++)data[i+x]=data[di+x];<span class="keyword">for</span>(;x&lt;bpl;x++)data[i+x]=data[di+x]+data[i+x-bpp]&#125;<span class="keyword">else</span> <span class="keyword">if</span>(type==<span class="number">2</span>)&#123;<span class="keyword">for</span>(;x&lt;bpl;x++)data[i+x]=data[di+x]+data[i+x-bpl]&#125;<span class="keyword">else</span> <span class="keyword">if</span>(type==<span class="number">3</span>)&#123;<span class="keyword">for</span>(;x&lt;bpp;x++)data[i+x]=data[di+x]+(data[i+x-bpl]&gt;&gt;&gt;<span class="number">1</span>);<span class="keyword">for</span>(;x&lt;bpl;x++)data[i+x]=data[di+x]+((data[i+x-bpl]+data[i+x-bpp])&gt;&gt;&gt;<span class="number">1</span>)&#125;<span class="keyword">else</span>&#123;<span class="keyword">for</span>(;x&lt;bpp;x++)data[i+x]=data[di+x]+<span class="title function_">_paeth</span>(<span class="number">0</span>,data[i+x-bpl],<span class="number">0</span>);<span class="keyword">for</span>(;x&lt;bpl;x++)data[i+x]=data[di+x]+<span class="title function_">_paeth</span>(data[i+x-bpp],data[i+x-bpl],data[i+x-bpp-bpl])&#125;&#125;<span class="keyword">return</span> data&#125;<span class="keyword">function</span> <span class="title function_">_paeth</span>(<span class="params">a,b,c</span>)&#123;<span class="keyword">var</span> p=a+b-c,pa=p-a,pb=p-b,pc=p-c;<span class="keyword">if</span>(pa*pa&lt;=pb*pb&amp;&amp;pa*pa&lt;=pc*pc)<span class="keyword">return</span> a;<span class="keyword">else</span> <span class="keyword">if</span>(pb*pb&lt;=pc*pc)<span class="keyword">return</span> b;<span class="keyword">return</span> c&#125;<span class="keyword">function</span> <span class="title function_">_IHDR</span>(<span class="params">data,offset,out</span>)&#123;out.<span class="property">width</span>=_bin.<span class="title function_">readUint</span>(data,offset);offset+=<span class="number">4</span>;out.<span class="property">height</span>=_bin.<span class="title function_">readUint</span>(data,offset);offset+=<span class="number">4</span>;out.<span class="property">depth</span>=data[offset];offset++;out.<span class="property">ctype</span>=data[offset];offset++;out.<span class="property">compress</span>=data[offset];offset++;out.<span class="property">filter</span>=data[offset];offset++;out.<span class="property">interlace</span>=data[offset];offset++&#125;<span class="keyword">function</span> <span class="title function_">_copyTile</span>(<span class="params">sb,sw,sh,tb,tw,th,xoff,yoff,mode</span>)&#123;<span class="keyword">var</span> w=<span class="title class_">Math</span>.<span class="title function_">min</span>(sw,tw),h=<span class="title class_">Math</span>.<span class="title function_">min</span>(sh,th);<span class="keyword">var</span> si=<span class="number">0</span>,ti=<span class="number">0</span>;<span class="keyword">for</span>(<span class="keyword">var</span> y=<span class="number">0</span>;y&lt;h;y++)<span class="keyword">for</span>(<span class="keyword">var</span> x=<span class="number">0</span>;x&lt;w;x++)&#123;<span class="keyword">if</span>(xoff&gt;=<span class="number">0</span>&amp;&amp;yoff&gt;=<span class="number">0</span>)&#123;si=(y*sw+x)&lt;&lt;<span class="number">2</span>;ti=((yoff+y)*tw+xoff+x)&lt;&lt;<span class="number">2</span>&#125;<span class="keyword">else</span>&#123;si=((-yoff+y)*sw-xoff+x)&lt;&lt;<span class="number">2</span>;ti=(y*tw+x)&lt;&lt;<span class="number">2</span>&#125;<span class="keyword">if</span>(mode==<span class="number">0</span>)&#123;tb[ti]=sb[si];tb[ti+<span class="number">1</span>]=sb[si+<span class="number">1</span>];tb[ti+<span class="number">2</span>]=sb[si+<span class="number">2</span>];tb[ti+<span class="number">3</span>]=sb[si+<span class="number">3</span>]&#125;<span class="keyword">else</span> <span class="keyword">if</span>(mode==<span class="number">1</span>)&#123;<span class="keyword">var</span> fa=sb[si+<span class="number">3</span>]*(<span class="number">1</span>/<span class="number">255</span>),fr=sb[si]*fa,fg=sb[si+<span class="number">1</span>]*fa,fb=sb[si+<span class="number">2</span>]*fa;<span class="keyword">var</span> ba=tb[ti+<span class="number">3</span>]*(<span class="number">1</span>/<span class="number">255</span>),br=tb[ti]*ba,bg=tb[ti+<span class="number">1</span>]*ba,bb=tb[ti+<span class="number">2</span>]*ba;<span class="keyword">var</span> ifa=<span class="number">1</span>-fa,oa=fa+ba*ifa,ioa=oa==<span class="number">0</span>?<span class="number">0</span>:<span class="number">1</span>/oa;tb[ti+<span class="number">3</span>]=<span class="number">255</span>*oa;tb[ti+<span class="number">0</span>]=(fr+br*ifa)*ioa;tb[ti+<span class="number">1</span>]=(fg+bg*ifa)*ioa;tb[ti+<span class="number">2</span>]=(fb+bb*ifa)*ioa&#125;<span class="keyword">else</span> <span class="keyword">if</span>(mode==<span class="number">2</span>)&#123;<span class="keyword">var</span> fa=sb[si+<span class="number">3</span>],fr=sb[si],fg=sb[si+<span class="number">1</span>],fb=sb[si+<span class="number">2</span>];<span class="keyword">var</span> ba=tb[ti+<span class="number">3</span>],br=tb[ti],bg=tb[ti+<span class="number">1</span>],bb=tb[ti+<span class="number">2</span>];<span class="keyword">if</span>(fa==ba&amp;&amp;fr==br&amp;&amp;fg==bg&amp;&amp;fb==bb)&#123;tb[ti]=<span class="number">0</span>;tb[ti+<span class="number">1</span>]=<span class="number">0</span>;tb[ti+<span class="number">2</span>]=<span class="number">0</span>;tb[ti+<span class="number">3</span>]=<span class="number">0</span>&#125;<span class="keyword">else</span>&#123;tb[ti]=fr;tb[ti+<span class="number">1</span>]=fg;tb[ti+<span class="number">2</span>]=fb;tb[ti+<span class="number">3</span>]=fa&#125;&#125;<span class="keyword">else</span> <span class="keyword">if</span>(mode==<span class="number">3</span>)&#123;<span class="keyword">var</span> fa=sb[si+<span class="number">3</span>],fr=sb[si],fg=sb[si+<span class="number">1</span>],fb=sb[si+<span class="number">2</span>];<span class="keyword">var</span> ba=tb[ti+<span class="number">3</span>],br=tb[ti],bg=tb[ti+<span class="number">1</span>],bb=tb[ti+<span class="number">2</span>];<span class="keyword">if</span>(fa==ba&amp;&amp;fr==br&amp;&amp;fg==bg&amp;&amp;fb==bb)<span class="keyword">continue</span>;<span class="keyword">if</span>(fa&lt;<span class="number">220</span>&amp;&amp;ba&gt;<span class="number">20</span>)<span class="keyword">return</span> <span class="literal">false</span>&#125;&#125;<span class="keyword">return</span> <span class="literal">true</span>&#125;<span class="keyword">return</span>&#123;<span class="attr">decode</span>:decode,<span class="attr">toRGBA8</span>:toRGBA8,<span class="attr">_paeth</span>:_paeth,<span class="attr">_copyTile</span>:_copyTile,<span class="attr">_bin</span>:_bin&#125;&#125;)();(<span class="keyword">function</span>(<span class="params"></span>)&#123;<span class="keyword">var</span> _copyTile=<span class="variable constant_">UPNG</span>.<span class="property">_copyTile</span>,_bin=<span class="variable constant_">UPNG</span>.<span class="property">_bin</span>,paeth=<span class="variable constant_">UPNG</span>.<span class="property">_paeth</span>;<span class="keyword">var</span> crcLib=&#123;<span class="attr">table</span>:(<span class="keyword">function</span>(<span class="params"></span>)&#123;<span class="keyword">var</span> tab=<span class="keyword">new</span> <span class="title class_">Uint32Array</span>(<span class="number">256</span>);<span class="keyword">for</span>(<span class="keyword">var</span> n=<span class="number">0</span>;n&lt;<span class="number">256</span>;n++)&#123;<span class="keyword">var</span> c=n;<span class="keyword">for</span>(<span class="keyword">var</span> k=<span class="number">0</span>;k&lt;<span class="number">8</span>;k++)&#123;<span class="keyword">if</span>(c&amp;<span class="number">1</span>)c=<span class="number">0xedb88320</span>^(c&gt;&gt;&gt;<span class="number">1</span>);<span class="keyword">else</span> c=c&gt;&gt;&gt;<span class="number">1</span>&#125;tab[n]=c&#125;<span class="keyword">return</span> tab&#125;)(),<span class="attr">update</span>:<span class="keyword">function</span>(<span class="params">c,buf,off,len</span>)&#123;<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;len;i++)c=crcLib.<span class="property">table</span>[(c^buf[off+i])&amp;<span class="number">0xff</span>]^(c&gt;&gt;&gt;<span class="number">8</span>);<span class="keyword">return</span> c&#125;,<span class="attr">crc</span>:<span class="keyword">function</span>(<span class="params">b,o,l</span>)&#123;<span class="keyword">return</span> crcLib.<span class="title function_">update</span>(<span class="number">0xffffffff</span>,b,o,l)^<span class="number">0xffffffff</span>&#125;&#125;;<span class="keyword">function</span> <span class="title function_">addErr</span>(<span class="params">er,tg,ti,f</span>)&#123;tg[ti]+=(er[<span class="number">0</span>]*f)&gt;&gt;<span class="number">4</span>;tg[ti+<span class="number">1</span>]+=(er[<span class="number">1</span>]*f)&gt;&gt;<span class="number">4</span>;tg[ti+<span class="number">2</span>]+=(er[<span class="number">2</span>]*f)&gt;&gt;<span class="number">4</span>;tg[ti+<span class="number">3</span>]+=(er[<span class="number">3</span>]*f)&gt;&gt;<span class="number">4</span>&#125;<span class="keyword">function</span> <span class="title function_">N</span>(<span class="params">x</span>)&#123;<span class="keyword">return</span> <span class="title class_">Math</span>.<span class="title function_">max</span>(<span class="number">0</span>,<span class="title class_">Math</span>.<span class="title function_">min</span>(<span class="number">255</span>,x))&#125;<span class="keyword">function</span> <span class="title function_">D</span>(<span class="params">a,b</span>)&#123;<span class="keyword">var</span> dr=a[<span class="number">0</span>]-b[<span class="number">0</span>],dg=a[<span class="number">1</span>]-b[<span class="number">1</span>],db=a[<span class="number">2</span>]-b[<span class="number">2</span>],da=a[<span class="number">3</span>]-b[<span class="number">3</span>];<span class="keyword">return</span> dr*dr+dg*dg+db*db+da*da&#125;<span class="keyword">function</span> <span class="title function_">dither</span>(<span class="params">sb,w,h,plte,tb,oind,MTD</span>)&#123;<span class="keyword">if</span>(<span class="variable constant_">MTD</span>==<span class="literal">null</span>)<span class="variable constant_">MTD</span>=<span class="number">1</span>;<span class="keyword">var</span> pc=plte.<span class="property">length</span>,nplt=[],rads=[];<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;pc;i++)&#123;<span class="keyword">var</span> c=plte[i];nplt.<span class="title function_">push</span>([(c&gt;&gt;&gt;<span class="number">0</span>)&amp;<span class="number">255</span>,(c&gt;&gt;&gt;<span class="number">8</span>)&amp;<span class="number">255</span>,(c&gt;&gt;&gt;<span class="number">16</span>)&amp;<span class="number">255</span>,(c&gt;&gt;&gt;<span class="number">24</span>)&amp;<span class="number">255</span>])&#125;<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;pc;i++)&#123;<span class="keyword">var</span> ne=<span class="number">0xffffffff</span>,ni=<span class="number">0</span>;<span class="keyword">for</span>(<span class="keyword">var</span> j=<span class="number">0</span>;j&lt;pc;j++)&#123;<span class="keyword">var</span> ce=<span class="title function_">D</span>(nplt[i],nplt[j]);<span class="keyword">if</span>(j!=i&amp;&amp;ce&lt;ne)&#123;ne=ce;ni=j&#125;&#125;<span class="keyword">var</span> hd=<span class="title class_">Math</span>.<span class="title function_">sqrt</span>(ne)/<span class="number">2</span>;rads[i]=~~(hd*hd)&#125;<span class="keyword">var</span> tb32=<span class="keyword">new</span> <span class="title class_">Uint32Array</span>(tb.<span class="property">buffer</span>);<span class="keyword">var</span> err=<span class="keyword">new</span> <span class="title class_">Int16Array</span>(w*h*<span class="number">4</span>);<span class="keyword">var</span> S=<span class="number">4</span>,M=[<span class="number">0</span>,<span class="number">8</span>,<span class="number">2</span>,<span class="number">10</span>,<span class="number">12</span>,<span class="number">4</span>,<span class="number">14</span>,<span class="number">6</span>,<span class="number">3</span>,<span class="number">11</span>,<span class="number">1</span>,<span class="number">9</span>,<span class="number">15</span>,<span class="number">7</span>,<span class="number">13</span>,<span class="number">5</span>];<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;M.<span class="property">length</span>;i++)M[i]=<span class="number">255</span>*(-<span class="number">0.5</span>+(M[i]+<span class="number">0.5</span>)/(S*S));<span class="keyword">for</span>(<span class="keyword">var</span> y=<span class="number">0</span>;y&lt;h;y++)&#123;<span class="keyword">for</span>(<span class="keyword">var</span> x=<span class="number">0</span>;x&lt;w;x++)&#123;<span class="keyword">var</span> i=(y*w+x)*<span class="number">4</span>;<span class="keyword">var</span> cc;<span class="keyword">if</span>(<span class="variable constant_">MTD</span>!=<span class="number">2</span>)cc=[<span class="title function_">N</span>(sb[i]+err[i]),<span class="title function_">N</span>(sb[i+<span class="number">1</span>]+err[i+<span class="number">1</span>]),<span class="title function_">N</span>(sb[i+<span class="number">2</span>]+err[i+<span class="number">2</span>]),<span class="title function_">N</span>(sb[i+<span class="number">3</span>]+err[i+<span class="number">3</span>])];<span class="keyword">else</span>&#123;<span class="keyword">var</span> ce=M[(y&amp;(S-<span class="number">1</span>))*S+(x&amp;(S-<span class="number">1</span>))];cc=[<span class="title function_">N</span>(sb[i]+ce),<span class="title function_">N</span>(sb[i+<span class="number">1</span>]+ce),<span class="title function_">N</span>(sb[i+<span class="number">2</span>]+ce),<span class="title function_">N</span>(sb[i+<span class="number">3</span>]+ce)]&#125;<span class="keyword">var</span> ni=<span class="number">0</span>,nd=<span class="number">0xffffff</span>;<span class="keyword">for</span>(<span class="keyword">var</span> j=<span class="number">0</span>;j&lt;pc;j++)&#123;<span class="keyword">var</span> cd=<span class="title function_">D</span>(cc,nplt[j]);<span class="keyword">if</span>(cd&lt;nd)&#123;nd=cd;ni=j&#125;&#125;<span class="keyword">var</span> nc=nplt[ni];<span class="keyword">var</span> er=[cc[<span class="number">0</span>]-nc[<span class="number">0</span>],cc[<span class="number">1</span>]-nc[<span class="number">1</span>],cc[<span class="number">2</span>]-nc[<span class="number">2</span>],cc[<span class="number">3</span>]-nc[<span class="number">3</span>]];<span class="keyword">if</span>(<span class="variable constant_">MTD</span>==<span class="number">1</span>)&#123;<span class="keyword">if</span>(x!=w-<span class="number">1</span>)<span class="title function_">addErr</span>(er,err,i+<span class="number">4</span>,<span class="number">7</span>);<span class="keyword">if</span>(y!=h-<span class="number">1</span>)&#123;<span class="keyword">if</span>(x!=<span class="number">0</span>)<span class="title function_">addErr</span>(er,err,i+<span class="number">4</span>*w-<span class="number">4</span>,<span class="number">3</span>);<span class="title function_">addErr</span>(er,err,i+<span class="number">4</span>*w,<span class="number">5</span>);<span class="keyword">if</span>(x!=w-<span class="number">1</span>)<span class="title function_">addErr</span>(er,err,i+<span class="number">4</span>*w+<span class="number">4</span>,<span class="number">1</span>)&#125;&#125;oind[i&gt;&gt;<span class="number">2</span>]=ni;tb32[i&gt;&gt;<span class="number">2</span>]=plte[ni]&#125;&#125;&#125;<span class="keyword">function</span> <span class="title function_">encode</span>(<span class="params">bufs,w,h,ps,dels,tabs,forbidPlte</span>)&#123;<span class="keyword">if</span>(ps==<span class="literal">null</span>)ps=<span class="number">0</span>;<span class="keyword">if</span>(forbidPlte==<span class="literal">null</span>)forbidPlte=<span class="literal">false</span>;<span class="keyword">var</span> nimg=<span class="title function_">compress</span>(bufs,w,h,ps,[<span class="literal">false</span>,<span class="literal">false</span>,<span class="literal">false</span>,<span class="number">0</span>,forbidPlte,<span class="literal">false</span>]);<span class="title function_">compressPNG</span>(nimg,-<span class="number">1</span>);<span class="keyword">return</span> <span class="title function_">_main</span>(nimg,w,h,dels,tabs)&#125;<span class="keyword">function</span> <span class="title function_">encodeLL</span>(<span class="params">bufs,w,h,cc,ac,depth,dels,tabs</span>)&#123;<span class="keyword">var</span> nimg=&#123;<span class="attr">ctype</span>:<span class="number">0</span>+(cc==<span class="number">1</span>?<span class="number">0</span>:<span class="number">2</span>)+(ac==<span class="number">0</span>?<span class="number">0</span>:<span class="number">4</span>),<span class="attr">depth</span>:depth,<span class="attr">frames</span>:[]&#125;;<span class="keyword">var</span> time=<span class="title class_">Date</span>.<span class="title function_">now</span>();<span class="keyword">var</span> bipp=(cc+ac)*depth,bipl=bipp*w;<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;bufs.<span class="property">length</span>;i++)nimg.<span class="property">frames</span>.<span class="title function_">push</span>(&#123;<span class="attr">rect</span>:&#123;<span class="attr">x</span>:<span class="number">0</span>,<span class="attr">y</span>:<span class="number">0</span>,<span class="attr">width</span>:w,<span class="attr">height</span>:h&#125;,<span class="attr">img</span>:<span class="keyword">new</span> <span class="title class_">Uint8Array</span>(bufs[i]),<span class="attr">blend</span>:<span class="number">0</span>,<span class="attr">dispose</span>:<span class="number">1</span>,<span class="attr">bpp</span>:<span class="title class_">Math</span>.<span class="title function_">ceil</span>(bipp/<span class="number">8</span>),<span class="attr">bpl</span>:<span class="title class_">Math</span>.<span class="title function_">ceil</span>(bipl/<span class="number">8</span>)&#125;);<span class="title function_">compressPNG</span>(nimg,<span class="number">0</span>,<span class="literal">true</span>);<span class="keyword">var</span> out=<span class="title function_">_main</span>(nimg,w,h,dels,tabs);<span class="keyword">return</span> out&#125;<span class="keyword">function</span> <span class="title function_">_main</span>(<span class="params">nimg,w,h,dels,tabs</span>)&#123;<span class="keyword">if</span>(tabs==<span class="literal">null</span>)tabs=&#123;&#125;;<span class="keyword">var</span> crc=crcLib.<span class="property">crc</span>,wUi=_bin.<span class="property">writeUint</span>,wUs=_bin.<span class="property">writeUshort</span>,wAs=_bin.<span class="property">writeASCII</span>;<span class="keyword">var</span> offset=<span class="number">8</span>,anim=nimg.<span class="property">frames</span>.<span class="property">length</span>&gt;<span class="number">1</span>,pltAlpha=<span class="literal">false</span>;<span class="keyword">var</span> cicc;<span class="keyword">var</span> leng=<span class="number">8</span>+(<span class="number">16</span>+<span class="number">5</span>+<span class="number">4</span>)+(anim?<span class="number">20</span>:<span class="number">0</span>);<span class="keyword">if</span>(tabs[<span class="string">&#x27;sRGB&#x27;</span>]!=<span class="literal">null</span>)leng+=<span class="number">8</span>+<span class="number">1</span>+<span class="number">4</span>;<span class="keyword">if</span>(tabs[<span class="string">&#x27;pHYs&#x27;</span>]!=<span class="literal">null</span>)leng+=<span class="number">8</span>+<span class="number">9</span>+<span class="number">4</span>;<span class="keyword">if</span>(tabs[<span class="string">&#x27;iCCP&#x27;</span>]!=<span class="literal">null</span>)&#123;cicc=pako.<span class="title function_">deflate</span>(tabs[<span class="string">&#x27;iCCP&#x27;</span>]);leng+=<span class="number">8</span>+<span class="number">11</span>+<span class="number">2</span>+cicc.<span class="property">length</span>+<span class="number">4</span>&#125;<span class="keyword">if</span>(nimg.<span class="property">ctype</span>==<span class="number">3</span>)&#123;<span class="keyword">var</span> dl=nimg.<span class="property">plte</span>.<span class="property">length</span>;<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;dl;i++)<span class="keyword">if</span>(nimg.<span class="property">plte</span>[i]&gt;&gt;&gt;<span class="number">24</span>!=<span class="number">255</span>)pltAlpha=<span class="literal">true</span>;leng+=<span class="number">8</span>+dl*<span class="number">3</span>+<span class="number">4</span>+(pltAlpha?<span class="number">8</span>+dl*<span class="number">1</span>+<span class="number">4</span>:<span class="number">0</span>)&#125;<span class="keyword">for</span>(<span class="keyword">var</span> j=<span class="number">0</span>;j&lt;nimg.<span class="property">frames</span>.<span class="property">length</span>;j++)&#123;<span class="keyword">var</span> fr=nimg.<span class="property">frames</span>[j];<span class="keyword">if</span>(anim)leng+=<span class="number">38</span>;leng+=fr.<span class="property">cimg</span>.<span class="property">length</span>+<span class="number">12</span>;<span class="keyword">if</span>(j!=<span class="number">0</span>)leng+=<span class="number">4</span>&#125;leng+=<span class="number">12</span>;<span class="keyword">var</span> data=<span class="keyword">new</span> <span class="title class_">Uint8Array</span>(leng);<span class="keyword">var</span> wr=[<span class="number">0x89</span>,<span class="number">0x50</span>,<span class="number">0x4e</span>,<span class="number">0x47</span>,<span class="number">0x0d</span>,<span class="number">0x0a</span>,<span class="number">0x1a</span>,<span class="number">0x0a</span>];<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;<span class="number">8</span>;i++)data[i]=wr[i];<span class="title function_">wUi</span>(data,offset,<span class="number">13</span>);offset+=<span class="number">4</span>;<span class="title function_">wAs</span>(data,offset,<span class="string">&#x27;IHDR&#x27;</span>);offset+=<span class="number">4</span>;<span class="title function_">wUi</span>(data,offset,w);offset+=<span class="number">4</span>;<span class="title function_">wUi</span>(data,offset,h);offset+=<span class="number">4</span>;data[offset]=nimg.<span class="property">depth</span>;offset++;data[offset]=nimg.<span class="property">ctype</span>;offset++;data[offset]=<span class="number">0</span>;offset++;data[offset]=<span class="number">0</span>;offset++;data[offset]=<span class="number">0</span>;offset++;<span class="title function_">wUi</span>(data,offset,<span class="title function_">crc</span>(data,offset-<span class="number">17</span>,<span class="number">17</span>));offset+=<span class="number">4</span>;<span class="keyword">if</span>(tabs[<span class="string">&#x27;sRGB&#x27;</span>]!=<span class="literal">null</span>)&#123;<span class="title function_">wUi</span>(data,offset,<span class="number">1</span>);offset+=<span class="number">4</span>;<span class="title function_">wAs</span>(data,offset,<span class="string">&#x27;sRGB&#x27;</span>);offset+=<span class="number">4</span>;data[offset]=tabs[<span class="string">&#x27;sRGB&#x27;</span>];offset++;<span class="title function_">wUi</span>(data,offset,<span class="title function_">crc</span>(data,offset-<span class="number">5</span>,<span class="number">5</span>));offset+=<span class="number">4</span>&#125;<span class="keyword">if</span>(tabs[<span class="string">&#x27;iCCP&#x27;</span>]!=<span class="literal">null</span>)&#123;<span class="keyword">var</span> sl=<span class="number">11</span>+<span class="number">2</span>+cicc.<span class="property">length</span>;<span class="title function_">wUi</span>(data,offset,sl);offset+=<span class="number">4</span>;<span class="title function_">wAs</span>(data,offset,<span class="string">&#x27;iCCP&#x27;</span>);offset+=<span class="number">4</span>;<span class="title function_">wAs</span>(data,offset,<span class="string">&#x27;ICC profile&#x27;</span>);offset+=<span class="number">11</span>;offset+=<span class="number">2</span>;data.<span class="title function_">set</span>(cicc,offset);offset+=cicc.<span class="property">length</span>;<span class="title function_">wUi</span>(data,offset,<span class="title function_">crc</span>(data,offset-(sl+<span class="number">4</span>),sl+<span class="number">4</span>));offset+=<span class="number">4</span>&#125;<span class="keyword">if</span>(tabs[<span class="string">&#x27;pHYs&#x27;</span>]!=<span class="literal">null</span>)&#123;<span class="title function_">wUi</span>(data,offset,<span class="number">9</span>);offset+=<span class="number">4</span>;<span class="title function_">wAs</span>(data,offset,<span class="string">&#x27;pHYs&#x27;</span>);offset+=<span class="number">4</span>;<span class="title function_">wUi</span>(data,offset,tabs[<span class="string">&#x27;pHYs&#x27;</span>][<span class="number">0</span>]);offset+=<span class="number">4</span>;<span class="title function_">wUi</span>(data,offset,tabs[<span class="string">&#x27;pHYs&#x27;</span>][<span class="number">1</span>]);offset+=<span class="number">4</span>;data[offset]=tabs[<span class="string">&#x27;pHYs&#x27;</span>][<span class="number">2</span>];offset++;<span class="title function_">wUi</span>(data,offset,<span class="title function_">crc</span>(data,offset-<span class="number">13</span>,<span class="number">13</span>));offset+=<span class="number">4</span>&#125;<span class="keyword">if</span>(anim)&#123;<span class="title function_">wUi</span>(data,offset,<span class="number">8</span>);offset+=<span class="number">4</span>;<span class="title function_">wAs</span>(data,offset,<span class="string">&#x27;acTL&#x27;</span>);offset+=<span class="number">4</span>;<span class="title function_">wUi</span>(data,offset,nimg.<span class="property">frames</span>.<span class="property">length</span>);offset+=<span class="number">4</span>;<span class="title function_">wUi</span>(data,offset,tabs[<span class="string">&#x27;loop&#x27;</span>]!=<span class="literal">null</span>?tabs[<span class="string">&#x27;loop&#x27;</span>]:<span class="number">0</span>);offset+=<span class="number">4</span>;<span class="title function_">wUi</span>(data,offset,<span class="title function_">crc</span>(data,offset-<span class="number">12</span>,<span class="number">12</span>));offset+=<span class="number">4</span>&#125;<span class="keyword">if</span>(nimg.<span class="property">ctype</span>==<span class="number">3</span>)&#123;<span class="keyword">var</span> dl=nimg.<span class="property">plte</span>.<span class="property">length</span>;<span class="title function_">wUi</span>(data,offset,dl*<span class="number">3</span>);offset+=<span class="number">4</span>;<span class="title function_">wAs</span>(data,offset,<span class="string">&#x27;PLTE&#x27;</span>);offset+=<span class="number">4</span>;<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;dl;i++)&#123;<span class="keyword">var</span> ti=i*<span class="number">3</span>,c=nimg.<span class="property">plte</span>[i],r=c&amp;<span class="number">255</span>,g=(c&gt;&gt;&gt;<span class="number">8</span>)&amp;<span class="number">255</span>,b=(c&gt;&gt;&gt;<span class="number">16</span>)&amp;<span class="number">255</span>;data[offset+ti+<span class="number">0</span>]=r;data[offset+ti+<span class="number">1</span>]=g;data[offset+ti+<span class="number">2</span>]=b&#125;offset+=dl*<span class="number">3</span>;<span class="title function_">wUi</span>(data,offset,<span class="title function_">crc</span>(data,offset-dl*<span class="number">3</span>-<span class="number">4</span>,dl*<span class="number">3</span>+<span class="number">4</span>));offset+=<span class="number">4</span>;<span class="keyword">if</span>(pltAlpha)&#123;<span class="title function_">wUi</span>(data,offset,dl);offset+=<span class="number">4</span>;<span class="title function_">wAs</span>(data,offset,<span class="string">&#x27;tRNS&#x27;</span>);offset+=<span class="number">4</span>;<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;dl;i++)data[offset+i]=(nimg.<span class="property">plte</span>[i]&gt;&gt;&gt;<span class="number">24</span>)&amp;<span class="number">255</span>;offset+=dl;<span class="title function_">wUi</span>(data,offset,<span class="title function_">crc</span>(data,offset-dl-<span class="number">4</span>,dl+<span class="number">4</span>));offset+=<span class="number">4</span>&#125;&#125;<span class="keyword">var</span> fi=<span class="number">0</span>;<span class="keyword">for</span>(<span class="keyword">var</span> j=<span class="number">0</span>;j&lt;nimg.<span class="property">frames</span>.<span class="property">length</span>;j++)&#123;<span class="keyword">var</span> fr=nimg.<span class="property">frames</span>[j];<span class="keyword">if</span>(anim)&#123;<span class="title function_">wUi</span>(data,offset,<span class="number">26</span>);offset+=<span class="number">4</span>;<span class="title function_">wAs</span>(data,offset,<span class="string">&#x27;fcTL&#x27;</span>);offset+=<span class="number">4</span>;<span class="title function_">wUi</span>(data,offset,fi++);offset+=<span class="number">4</span>;<span class="title function_">wUi</span>(data,offset,fr.<span class="property">rect</span>.<span class="property">width</span>);offset+=<span class="number">4</span>;<span class="title function_">wUi</span>(data,offset,fr.<span class="property">rect</span>.<span class="property">height</span>);offset+=<span class="number">4</span>;<span class="title function_">wUi</span>(data,offset,fr.<span class="property">rect</span>.<span class="property">x</span>);offset+=<span class="number">4</span>;<span class="title function_">wUi</span>(data,offset,fr.<span class="property">rect</span>.<span class="property">y</span>);offset+=<span class="number">4</span>;<span class="title function_">wUs</span>(data,offset,dels[j]);offset+=<span class="number">2</span>;<span class="title function_">wUs</span>(data,offset,<span class="number">1000</span>);offset+=<span class="number">2</span>;data[offset]=fr.<span class="property">dispose</span>;offset++;data[offset]=fr.<span class="property">blend</span>;offset++;<span class="title function_">wUi</span>(data,offset,<span class="title function_">crc</span>(data,offset-<span class="number">30</span>,<span class="number">30</span>));offset+=<span class="number">4</span>&#125;<span class="keyword">var</span> imgd=fr.<span class="property">cimg</span>,dl=imgd.<span class="property">length</span>;<span class="title function_">wUi</span>(data,offset,dl+(j==<span class="number">0</span>?<span class="number">0</span>:<span class="number">4</span>));offset+=<span class="number">4</span>;<span class="keyword">var</span> ioff=offset;<span class="title function_">wAs</span>(data,offset,j==<span class="number">0</span>?<span class="string">&#x27;IDAT&#x27;</span>:<span class="string">&#x27;fdAT&#x27;</span>);offset+=<span class="number">4</span>;<span class="keyword">if</span>(j!=<span class="number">0</span>)&#123;<span class="title function_">wUi</span>(data,offset,fi++);offset+=<span class="number">4</span>&#125;data.<span class="title function_">set</span>(imgd,offset);offset+=dl;<span class="title function_">wUi</span>(data,offset,<span class="title function_">crc</span>(data,ioff,offset-ioff));offset+=<span class="number">4</span>&#125;<span class="title function_">wUi</span>(data,offset,<span class="number">0</span>);offset+=<span class="number">4</span>;<span class="title function_">wAs</span>(data,offset,<span class="string">&#x27;IEND&#x27;</span>);offset+=<span class="number">4</span>;<span class="title function_">wUi</span>(data,offset,<span class="title function_">crc</span>(data,offset-<span class="number">4</span>,<span class="number">4</span>));offset+=<span class="number">4</span>;<span class="keyword">return</span> data.<span class="property">buffer</span>&#125;<span class="keyword">function</span> <span class="title function_">compressPNG</span>(<span class="params">out,filter,levelZero</span>)&#123;<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;out.<span class="property">frames</span>.<span class="property">length</span>;i++)&#123;<span class="keyword">var</span> frm=out.<span class="property">frames</span>[i],nw=frm.<span class="property">rect</span>.<span class="property">width</span>,nh=frm.<span class="property">rect</span>.<span class="property">height</span>;<span class="keyword">var</span> fdata=<span class="keyword">new</span> <span class="title class_">Uint8Array</span>(nh*frm.<span class="property">bpl</span>+nh);frm.<span class="property">cimg</span>=<span class="title function_">_filterZero</span>(frm.<span class="property">img</span>,nh,frm.<span class="property">bpp</span>,frm.<span class="property">bpl</span>,fdata,filter,levelZero)&#125;&#125;<span class="keyword">function</span> <span class="title function_">compress</span>(<span class="params">bufs,w,h,ps,prms</span>)&#123;<span class="keyword">var</span> onlyBlend=prms[<span class="number">0</span>],evenCrd=prms[<span class="number">1</span>],forbidPrev=prms[<span class="number">2</span>],minBits=prms[<span class="number">3</span>],forbidPlte=prms[<span class="number">4</span>],dith=prms[<span class="number">5</span>];<span class="keyword">var</span> ctype=<span class="number">6</span>,depth=<span class="number">8</span>,alphaAnd=<span class="number">255</span>;<span class="keyword">for</span>(<span class="keyword">var</span> j=<span class="number">0</span>;j&lt;bufs.<span class="property">length</span>;j++)&#123;<span class="keyword">var</span> img=<span class="keyword">new</span> <span class="title class_">Uint8Array</span>(bufs[j]),ilen=img.<span class="property">length</span>;<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;ilen;i+=<span class="number">4</span>)alphaAnd&amp;=img[i+<span class="number">3</span>]&#125;<span class="keyword">var</span> gotAlpha=alphaAnd!=<span class="number">255</span>;<span class="keyword">var</span> frms=<span class="title function_">framize</span>(bufs,w,h,onlyBlend,evenCrd,forbidPrev);<span class="keyword">var</span> cmap=&#123;&#125;,plte=[],inds=[];<span class="keyword">if</span>(ps!=<span class="number">0</span>)&#123;<span class="keyword">var</span> nbufs=[];<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;frms.<span class="property">length</span>;i++)nbufs.<span class="title function_">push</span>(frms[i].<span class="property">img</span>.<span class="property">buffer</span>);<span class="keyword">var</span> abuf=<span class="title function_">concatRGBA</span>(nbufs),qres=<span class="title function_">quantize</span>(abuf,ps);<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;qres.<span class="property">plte</span>.<span class="property">length</span>;i++)plte.<span class="title function_">push</span>(qres.<span class="property">plte</span>[i].<span class="property">est</span>.<span class="property">rgba</span>);<span class="keyword">var</span> cof=<span class="number">0</span>;<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;frms.<span class="property">length</span>;i++)&#123;<span class="keyword">var</span> frm=frms[i],bln=frm.<span class="property">img</span>.<span class="property">length</span>,ind=<span class="keyword">new</span> <span class="title class_">Uint8Array</span>(qres.<span class="property">inds</span>.<span class="property">buffer</span>,cof&gt;&gt;<span class="number">2</span>,bln&gt;&gt;<span class="number">2</span>);inds.<span class="title function_">push</span>(ind);<span class="keyword">var</span> bb=<span class="keyword">new</span> <span class="title class_">Uint8Array</span>(qres.<span class="property">abuf</span>,cof,bln);<span class="keyword">if</span>(dith)<span class="title function_">dither</span>(frm.<span class="property">img</span>,frm.<span class="property">rect</span>.<span class="property">width</span>,frm.<span class="property">rect</span>.<span class="property">height</span>,plte,bb,ind);frm.<span class="property">img</span>.<span class="title function_">set</span>(bb);cof+=bln&#125;&#125;<span class="keyword">else</span>&#123;<span class="keyword">for</span>(<span class="keyword">var</span> j=<span class="number">0</span>;j&lt;frms.<span class="property">length</span>;j++)&#123;<span class="keyword">var</span> frm=frms[j],img32=<span class="keyword">new</span> <span class="title class_">Uint32Array</span>(frm.<span class="property">img</span>.<span class="property">buffer</span>),nw=frm.<span class="property">rect</span>.<span class="property">width</span>,ilen=img32.<span class="property">length</span>;<span class="keyword">var</span> ind=<span class="keyword">new</span> <span class="title class_">Uint8Array</span>(ilen);inds.<span class="title function_">push</span>(ind);<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;ilen;i++)&#123;<span class="keyword">var</span> c=img32[i];<span class="keyword">if</span>(i!=<span class="number">0</span>&amp;&amp;c==img32[i-<span class="number">1</span>])ind[i]=ind[i-<span class="number">1</span>];<span class="keyword">else</span> <span class="keyword">if</span>(i&gt;nw&amp;&amp;c==img32[i-nw])ind[i]=ind[i-nw];<span class="keyword">else</span>&#123;<span class="keyword">var</span> cmc=cmap[c];<span class="keyword">if</span>(cmc==<span class="literal">null</span>)&#123;cmap[c]=cmc=plte.<span class="property">length</span>;plte.<span class="title function_">push</span>(c);<span class="keyword">if</span>(plte.<span class="property">length</span>&gt;=<span class="number">300</span>)<span class="keyword">break</span>&#125;ind[i]=cmc&#125;&#125;&#125;&#125;<span class="keyword">var</span> cc=plte.<span class="property">length</span>;<span class="keyword">if</span>(cc&lt;=<span class="number">256</span>&amp;&amp;forbidPlte==<span class="literal">false</span>)&#123;<span class="keyword">if</span>(cc&lt;=<span class="number">2</span>)depth=<span class="number">1</span>;<span class="keyword">else</span> <span class="keyword">if</span>(cc&lt;=<span class="number">4</span>)depth=<span class="number">2</span>;<span class="keyword">else</span> <span class="keyword">if</span>(cc&lt;=<span class="number">16</span>)depth=<span class="number">4</span>;<span class="keyword">else</span> depth=<span class="number">8</span>;depth=<span class="title class_">Math</span>.<span class="title function_">max</span>(depth,minBits)&#125;<span class="keyword">for</span>(<span class="keyword">var</span> j=<span class="number">0</span>;j&lt;frms.<span class="property">length</span>;j++)&#123;<span class="keyword">var</span> frm=frms[j],nx=frm.<span class="property">rect</span>.<span class="property">x</span>,ny=frm.<span class="property">rect</span>.<span class="property">y</span>,nw=frm.<span class="property">rect</span>.<span class="property">width</span>,nh=frm.<span class="property">rect</span>.<span class="property">height</span>;<span class="keyword">var</span> cimg=frm.<span class="property">img</span>,cimg32=<span class="keyword">new</span> <span class="title class_">Uint32Array</span>(cimg.<span class="property">buffer</span>);<span class="keyword">var</span> bpl=<span class="number">4</span>*nw,bpp=<span class="number">4</span>;<span class="keyword">if</span>(cc&lt;=<span class="number">256</span>&amp;&amp;forbidPlte==<span class="literal">false</span>)&#123;bpl=<span class="title class_">Math</span>.<span class="title function_">ceil</span>((depth*nw)/<span class="number">8</span>);<span class="keyword">var</span> nimg=<span class="keyword">new</span> <span class="title class_">Uint8Array</span>(bpl*nh);<span class="keyword">var</span> inj=inds[j];<span class="keyword">for</span>(<span class="keyword">var</span> y=<span class="number">0</span>;y&lt;nh;y++)&#123;<span class="keyword">var</span> i=y*bpl,ii=y*nw;<span class="keyword">if</span>(depth==<span class="number">8</span>)<span class="keyword">for</span>(<span class="keyword">var</span> x=<span class="number">0</span>;x&lt;nw;x++)nimg[i+x]=inj[ii+x];<span class="keyword">else</span> <span class="keyword">if</span>(depth==<span class="number">4</span>)<span class="keyword">for</span>(<span class="keyword">var</span> x=<span class="number">0</span>;x&lt;nw;x++)nimg[i+(x&gt;&gt;<span class="number">1</span>)]|=inj[ii+x]&lt;&lt;(<span class="number">4</span>-(x&amp;<span class="number">1</span>)*<span class="number">4</span>);<span class="keyword">else</span> <span class="keyword">if</span>(depth==<span class="number">2</span>)<span class="keyword">for</span>(<span class="keyword">var</span> x=<span class="number">0</span>;x&lt;nw;x++)nimg[i+(x&gt;&gt;<span class="number">2</span>)]|=inj[ii+x]&lt;&lt;(<span class="number">6</span>-(x&amp;<span class="number">3</span>)*<span class="number">2</span>);<span class="keyword">else</span> <span class="keyword">if</span>(depth==<span class="number">1</span>)<span class="keyword">for</span>(<span class="keyword">var</span> x=<span class="number">0</span>;x&lt;nw;x++)nimg[i+(x&gt;&gt;<span class="number">3</span>)]|=inj[ii+x]&lt;&lt;(<span class="number">7</span>-(x&amp;<span class="number">7</span>)*<span class="number">1</span>)&#125;cimg=nimg;ctype=<span class="number">3</span>;bpp=<span class="number">1</span>&#125;<span class="keyword">else</span> <span class="keyword">if</span>(gotAlpha==<span class="literal">false</span>&amp;&amp;frms.<span class="property">length</span>==<span class="number">1</span>)&#123;<span class="keyword">var</span> nimg=<span class="keyword">new</span> <span class="title class_">Uint8Array</span>(nw*nh*<span class="number">3</span>),area=nw*nh;<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;area;i++)&#123;<span class="keyword">var</span> ti=i*<span class="number">3</span>,qi=i*<span class="number">4</span>;nimg[ti]=cimg[qi];nimg[ti+<span class="number">1</span>]=cimg[qi+<span class="number">1</span>];nimg[ti+<span class="number">2</span>]=cimg[qi+<span class="number">2</span>]&#125;cimg=nimg;ctype=<span class="number">2</span>;bpp=<span class="number">3</span>;bpl=<span class="number">3</span>*nw&#125;frm.<span class="property">img</span>=cimg;frm.<span class="property">bpl</span>=bpl;frm.<span class="property">bpp</span>=bpp&#125;<span class="keyword">return</span>&#123;<span class="attr">ctype</span>:ctype,<span class="attr">depth</span>:depth,<span class="attr">plte</span>:plte,<span class="attr">frames</span>:frms&#125;&#125;<span class="keyword">function</span> <span class="title function_">framize</span>(<span class="params">bufs,w,h,alwaysBlend,evenCrd,forbidPrev</span>)&#123;<span class="keyword">var</span> frms=[];<span class="keyword">for</span>(<span class="keyword">var</span> j=<span class="number">0</span>;j&lt;bufs.<span class="property">length</span>;j++)&#123;<span class="keyword">var</span> cimg=<span class="keyword">new</span> <span class="title class_">Uint8Array</span>(bufs[j]),cimg32=<span class="keyword">new</span> <span class="title class_">Uint32Array</span>(cimg.<span class="property">buffer</span>);<span class="keyword">var</span> nimg;<span class="keyword">var</span> nx=<span class="number">0</span>,ny=<span class="number">0</span>,nw=w,nh=h,blend=alwaysBlend?<span class="number">1</span>:<span class="number">0</span>;<span class="keyword">if</span>(j!=<span class="number">0</span>)&#123;<span class="keyword">var</span> tlim=forbidPrev||alwaysBlend||j==<span class="number">1</span>||frms[j-<span class="number">2</span>].<span class="property">dispose</span>!=<span class="number">0</span>?<span class="number">1</span>:<span class="number">2</span>,tstp=<span class="number">0</span>,tarea=<span class="number">1e9</span>;<span class="keyword">for</span>(<span class="keyword">var</span> it=<span class="number">0</span>;it&lt;tlim;it++)&#123;<span class="keyword">var</span> pimg=<span class="keyword">new</span> <span class="title class_">Uint8Array</span>(bufs[j-<span class="number">1</span>-it]),p32=<span class="keyword">new</span> <span class="title class_">Uint32Array</span>(bufs[j-<span class="number">1</span>-it]);<span class="keyword">var</span> mix=w,miy=h,max=-<span class="number">1</span>,may=-<span class="number">1</span>;<span class="keyword">for</span>(<span class="keyword">var</span> y=<span class="number">0</span>;y&lt;h;y++)<span class="keyword">for</span>(<span class="keyword">var</span> x=<span class="number">0</span>;x&lt;w;x++)&#123;<span class="keyword">var</span> i=y*w+x;<span class="keyword">if</span>(cimg32[i]!=p32[i])&#123;<span class="keyword">if</span>(x&lt;mix)mix=x;<span class="keyword">if</span>(x&gt;max)max=x;<span class="keyword">if</span>(y&lt;miy)miy=y;<span class="keyword">if</span>(y&gt;may)may=y&#125;&#125;<span class="keyword">if</span>(max==-<span class="number">1</span>)mix=miy=max=may=<span class="number">0</span>;<span class="keyword">if</span>(evenCrd)&#123;<span class="keyword">if</span>((mix&amp;<span class="number">1</span>)==<span class="number">1</span>)mix--;<span class="keyword">if</span>((miy&amp;<span class="number">1</span>)==<span class="number">1</span>)miy--&#125;<span class="keyword">var</span> sarea=(max-mix+<span class="number">1</span>)*(may-miy+<span class="number">1</span>);<span class="keyword">if</span>(sarea&lt;tarea)&#123;tarea=sarea;tstp=it;nx=mix;ny=miy;nw=max-mix+<span class="number">1</span>;nh=may-miy+<span class="number">1</span>&#125;&#125;<span class="keyword">var</span> pimg=<span class="keyword">new</span> <span class="title class_">Uint8Array</span>(bufs[j-<span class="number">1</span>-tstp]);<span class="keyword">if</span>(tstp==<span class="number">1</span>)frms[j-<span class="number">1</span>].<span class="property">dispose</span>=<span class="number">2</span>;nimg=<span class="keyword">new</span> <span class="title class_">Uint8Array</span>(nw*nh*<span class="number">4</span>);<span class="title function_">_copyTile</span>(pimg,w,h,nimg,nw,nh,-nx,-ny,<span class="number">0</span>);blend=<span class="title function_">_copyTile</span>(cimg,w,h,nimg,nw,nh,-nx,-ny,<span class="number">3</span>)?<span class="number">1</span>:<span class="number">0</span>;<span class="keyword">if</span>(blend==<span class="number">1</span>)<span class="title function_">_prepareDiff</span>(cimg,w,h,nimg,&#123;<span class="attr">x</span>:nx,<span class="attr">y</span>:ny,<span class="attr">width</span>:nw,<span class="attr">height</span>:nh&#125;);<span class="keyword">else</span> <span class="title function_">_copyTile</span>(cimg,w,h,nimg,nw,nh,-nx,-ny,<span class="number">0</span>)&#125;<span class="keyword">else</span> nimg=cimg.<span class="title function_">slice</span>(<span class="number">0</span>);frms.<span class="title function_">push</span>(&#123;<span class="attr">rect</span>:&#123;<span class="attr">x</span>:nx,<span class="attr">y</span>:ny,<span class="attr">width</span>:nw,<span class="attr">height</span>:nh&#125;,<span class="attr">img</span>:nimg,<span class="attr">blend</span>:blend,<span class="attr">dispose</span>:<span class="number">0</span>&#125;)&#125;<span class="keyword">if</span>(alwaysBlend)<span class="keyword">for</span>(<span class="keyword">var</span> j=<span class="number">0</span>;j&lt;frms.<span class="property">length</span>;j++)&#123;<span class="keyword">var</span> frm=frms[j];<span class="keyword">if</span>(frm.<span class="property">blend</span>==<span class="number">1</span>)<span class="keyword">continue</span>;<span class="keyword">var</span> r0=frm.<span class="property">rect</span>,r1=frms[j-<span class="number">1</span>].<span class="property">rect</span>;<span class="keyword">var</span> miX=<span class="title class_">Math</span>.<span class="title function_">min</span>(r0.<span class="property">x</span>,r1.<span class="property">x</span>),miY=<span class="title class_">Math</span>.<span class="title function_">min</span>(r0.<span class="property">y</span>,r1.<span class="property">y</span>);<span class="keyword">var</span> maX=<span class="title class_">Math</span>.<span class="title function_">max</span>(r0.<span class="property">x</span>+r0.<span class="property">width</span>,r1.<span class="property">x</span>+r1.<span class="property">width</span>),maY=<span class="title class_">Math</span>.<span class="title function_">max</span>(r0.<span class="property">y</span>+r0.<span class="property">height</span>,r1.<span class="property">y</span>+r1.<span class="property">height</span>);<span class="keyword">var</span> r=&#123;<span class="attr">x</span>:miX,<span class="attr">y</span>:miY,<span class="attr">width</span>:maX-miX,<span class="attr">height</span>:maY-miY&#125;;frms[j-<span class="number">1</span>].<span class="property">dispose</span>=<span class="number">1</span>;<span class="keyword">if</span>(j-<span class="number">1</span>!=<span class="number">0</span>)<span class="title function_">_updateFrame</span>(bufs,w,h,frms,j-<span class="number">1</span>,r,evenCrd);<span class="title function_">_updateFrame</span>(bufs,w,h,frms,j,r,evenCrd)&#125;<span class="keyword">var</span> area=<span class="number">0</span>;<span class="keyword">if</span>(bufs.<span class="property">length</span>!=<span class="number">1</span>)<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;frms.<span class="property">length</span>;i++)&#123;<span class="keyword">var</span> frm=frms[i];area+=frm.<span class="property">rect</span>.<span class="property">width</span>*frm.<span class="property">rect</span>.<span class="property">height</span>&#125;<span class="keyword">return</span> frms&#125;<span class="keyword">function</span> <span class="title function_">_updateFrame</span>(<span class="params">bufs,w,h,frms,i,r,evenCrd</span>)&#123;<span class="keyword">var</span> <span class="variable constant_">U8</span>=<span class="title class_">Uint8Array</span>,<span class="variable constant_">U32</span>=<span class="title class_">Uint32Array</span>;<span class="keyword">var</span> pimg=<span class="keyword">new</span> <span class="title function_">U8</span>(bufs[i-<span class="number">1</span>]),pimg32=<span class="keyword">new</span> <span class="title function_">U32</span>(bufs[i-<span class="number">1</span>]),nimg=i+<span class="number">1</span>&lt;bufs.<span class="property">length</span>?<span class="keyword">new</span> <span class="title function_">U8</span>(bufs[i+<span class="number">1</span>]):<span class="literal">null</span>;<span class="keyword">var</span> cimg=<span class="keyword">new</span> <span class="title function_">U8</span>(bufs[i]),cimg32=<span class="keyword">new</span> <span class="title function_">U32</span>(cimg.<span class="property">buffer</span>);<span class="keyword">var</span> mix=w,miy=h,max=-<span class="number">1</span>,may=-<span class="number">1</span>;<span class="keyword">for</span>(<span class="keyword">var</span> y=<span class="number">0</span>;y&lt;r.<span class="property">height</span>;y++)<span class="keyword">for</span>(<span class="keyword">var</span> x=<span class="number">0</span>;x&lt;r.<span class="property">width</span>;x++)&#123;<span class="keyword">var</span> cx=r.<span class="property">x</span>+x,cy=r.<span class="property">y</span>+y;<span class="keyword">var</span> j=cy*w+cx,cc=cimg32[j];<span class="keyword">if</span>(cc==<span class="number">0</span>||(frms[i-<span class="number">1</span>].<span class="property">dispose</span>==<span class="number">0</span>&amp;&amp;pimg32[j]==cc&amp;&amp;(nimg==<span class="literal">null</span>||nimg[j*<span class="number">4</span>+<span class="number">3</span>]!=<span class="number">0</span>)))&#123;&#125;<span class="keyword">else</span>&#123;<span class="keyword">if</span>(cx&lt;mix)mix=cx;<span class="keyword">if</span>(cx&gt;max)max=cx;<span class="keyword">if</span>(cy&lt;miy)miy=cy;<span class="keyword">if</span>(cy&gt;may)may=cy&#125;&#125;<span class="keyword">if</span>(max==-<span class="number">1</span>)mix=miy=max=may=<span class="number">0</span>;<span class="keyword">if</span>(evenCrd)&#123;<span class="keyword">if</span>((mix&amp;<span class="number">1</span>)==<span class="number">1</span>)mix--;<span class="keyword">if</span>((miy&amp;<span class="number">1</span>)==<span class="number">1</span>)miy--&#125;r=&#123;<span class="attr">x</span>:mix,<span class="attr">y</span>:miy,<span class="attr">width</span>:max-mix+<span class="number">1</span>,<span class="attr">height</span>:may-miy+<span class="number">1</span>&#125;;<span class="keyword">var</span> fr=frms[i];fr.<span class="property">rect</span>=r;fr.<span class="property">blend</span>=<span class="number">1</span>;fr.<span class="property">img</span>=<span class="keyword">new</span> <span class="title class_">Uint8Array</span>(r.<span class="property">width</span>*r.<span class="property">height</span>*<span class="number">4</span>);<span class="keyword">if</span>(frms[i-<span class="number">1</span>].<span class="property">dispose</span>==<span class="number">0</span>)&#123;<span class="title function_">_copyTile</span>(pimg,w,h,fr.<span class="property">img</span>,r.<span class="property">width</span>,r.<span class="property">height</span>,-r.<span class="property">x</span>,-r.<span class="property">y</span>,<span class="number">0</span>);<span class="title function_">_prepareDiff</span>(cimg,w,h,fr.<span class="property">img</span>,r)&#125;<span class="keyword">else</span> <span class="title function_">_copyTile</span>(cimg,w,h,fr.<span class="property">img</span>,r.<span class="property">width</span>,r.<span class="property">height</span>,-r.<span class="property">x</span>,-r.<span class="property">y</span>,<span class="number">0</span>)&#125;<span class="keyword">function</span> <span class="title function_">_prepareDiff</span>(<span class="params">cimg,w,h,nimg,rec</span>)&#123;<span class="title function_">_copyTile</span>(cimg,w,h,nimg,rec.<span class="property">width</span>,rec.<span class="property">height</span>,-rec.<span class="property">x</span>,-rec.<span class="property">y</span>,<span class="number">2</span>)&#125;<span class="keyword">function</span> <span class="title function_">_filterZero</span>(<span class="params">img,h,bpp,bpl,data,filter,levelZero</span>)&#123;<span class="keyword">var</span> fls=[],ftry=[<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>];<span class="keyword">if</span>(filter!=-<span class="number">1</span>)ftry=[filter];<span class="keyword">else</span> <span class="keyword">if</span>(h*bpl&gt;<span class="number">500000</span>||bpp==<span class="number">1</span>)ftry=[<span class="number">0</span>];<span class="keyword">var</span> opts;<span class="keyword">if</span>(levelZero)opts=&#123;<span class="attr">level</span>:<span class="number">0</span>&#125;;<span class="keyword">var</span> <span class="variable constant_">CMPR</span>=data.<span class="property">length</span>&gt;<span class="number">10e6</span>&amp;&amp;<span class="variable language_">window</span>.<span class="property">UZIP</span>!=<span class="literal">null</span>?<span class="variable language_">window</span>.<span class="property">UZIP</span>:pako;<span class="keyword">var</span> time=<span class="title class_">Date</span>.<span class="title function_">now</span>();<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;ftry.<span class="property">length</span>;i++)&#123;<span class="keyword">for</span>(<span class="keyword">var</span> y=<span class="number">0</span>;y&lt;h;y++)<span class="title function_">_filterLine</span>(data,img,y,bpl,bpp,ftry[i]);fls.<span class="title function_">push</span>(<span class="variable constant_">CMPR</span>[<span class="string">&#x27;deflate&#x27;</span>](data,opts))&#125;<span class="keyword">var</span> ti,tsize=<span class="number">1e9</span>;<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;fls.<span class="property">length</span>;i++)<span class="keyword">if</span>(fls[i].<span class="property">length</span>&lt;tsize)&#123;ti=i;tsize=fls[i].<span class="property">length</span>&#125;<span class="keyword">return</span> fls[ti]&#125;<span class="keyword">function</span> <span class="title function_">_filterLine</span>(<span class="params">data,img,y,bpl,bpp,type</span>)&#123;<span class="keyword">var</span> i=y*bpl,di=i+y;data[di]=type;di++;<span class="keyword">if</span>(type==<span class="number">0</span>)&#123;<span class="keyword">if</span>(bpl&lt;<span class="number">500</span>)<span class="keyword">for</span>(<span class="keyword">var</span> x=<span class="number">0</span>;x&lt;bpl;x++)data[di+x]=img[i+x];<span class="keyword">else</span> data.<span class="title function_">set</span>(<span class="keyword">new</span> <span class="title class_">Uint8Array</span>(img.<span class="property">buffer</span>,i,bpl),di)&#125;<span class="keyword">else</span> <span class="keyword">if</span>(type==<span class="number">1</span>)&#123;<span class="keyword">for</span>(<span class="keyword">var</span> x=<span class="number">0</span>;x&lt;bpp;x++)data[di+x]=img[i+x];<span class="keyword">for</span>(<span class="keyword">var</span> x=bpp;x&lt;bpl;x++)data[di+x]=(img[i+x]-img[i+x-bpp]+<span class="number">256</span>)&amp;<span class="number">255</span>&#125;<span class="keyword">else</span> <span class="keyword">if</span>(y==<span class="number">0</span>)&#123;<span class="keyword">for</span>(<span class="keyword">var</span> x=<span class="number">0</span>;x&lt;bpp;x++)data[di+x]=img[i+x];<span class="keyword">if</span>(type==<span class="number">2</span>)<span class="keyword">for</span>(<span class="keyword">var</span> x=bpp;x&lt;bpl;x++)data[di+x]=img[i+x];<span class="keyword">if</span>(type==<span class="number">3</span>)<span class="keyword">for</span>(<span class="keyword">var</span> x=bpp;x&lt;bpl;x++)data[di+x]=(img[i+x]-(img[i+x-bpp]&gt;&gt;<span class="number">1</span>)+<span class="number">256</span>)&amp;<span class="number">255</span>;<span class="keyword">if</span>(type==<span class="number">4</span>)<span class="keyword">for</span>(<span class="keyword">var</span> x=bpp;x&lt;bpl;x++)data[di+x]=(img[i+x]-<span class="title function_">paeth</span>(img[i+x-bpp],<span class="number">0</span>,<span class="number">0</span>)+<span class="number">256</span>)&amp;<span class="number">255</span>&#125;<span class="keyword">else</span>&#123;<span class="keyword">if</span>(type==<span class="number">2</span>)&#123;<span class="keyword">for</span>(<span class="keyword">var</span> x=<span class="number">0</span>;x&lt;bpl;x++)data[di+x]=(img[i+x]+<span class="number">256</span>-img[i+x-bpl])&amp;<span class="number">255</span>&#125;<span class="keyword">if</span>(type==<span class="number">3</span>)&#123;<span class="keyword">for</span>(<span class="keyword">var</span> x=<span class="number">0</span>;x&lt;bpp;x++)data[di+x]=(img[i+x]+<span class="number">256</span>-(img[i+x-bpl]&gt;&gt;<span class="number">1</span>))&amp;<span class="number">255</span>;<span class="keyword">for</span>(<span class="keyword">var</span> x=bpp;x&lt;bpl;x++)data[di+x]=(img[i+x]+<span class="number">256</span>-((img[i+x-bpl]+img[i+x-bpp])&gt;&gt;<span class="number">1</span>))&amp;<span class="number">255</span>&#125;<span class="keyword">if</span>(type==<span class="number">4</span>)&#123;<span class="keyword">for</span>(<span class="keyword">var</span> x=<span class="number">0</span>;x&lt;bpp;x++)data[di+x]=(img[i+x]+<span class="number">256</span>-<span class="title function_">paeth</span>(<span class="number">0</span>,img[i+x-bpl],<span class="number">0</span>))&amp;<span class="number">255</span>;<span class="keyword">for</span>(<span class="keyword">var</span> x=bpp;x&lt;bpl;x++)data[di+x]=(img[i+x]+<span class="number">256</span>-<span class="title function_">paeth</span>(img[i+x-bpp],img[i+x-bpl],img[i+x-bpp-bpl]))&amp;<span class="number">255</span>&#125;&#125;&#125;<span class="keyword">function</span> <span class="title function_">quantize</span>(<span class="params">abuf,ps,doKmeans</span>)&#123;<span class="keyword">var</span> time=<span class="title class_">Date</span>.<span class="title function_">now</span>();<span class="keyword">var</span> sb=<span class="keyword">new</span> <span class="title class_">Uint8Array</span>(abuf),tb=sb.<span class="title function_">slice</span>(<span class="number">0</span>),tb32=<span class="keyword">new</span> <span class="title class_">Uint32Array</span>(tb.<span class="property">buffer</span>);<span class="keyword">var</span> <span class="variable constant_">KD</span>=<span class="title function_">getKDtree</span>(tb,ps);<span class="keyword">var</span> root=<span class="variable constant_">KD</span>[<span class="number">0</span>],leafs=<span class="variable constant_">KD</span>[<span class="number">1</span>],K=leafs.<span class="property">length</span>;<span class="keyword">var</span> cl32=<span class="keyword">new</span> <span class="title class_">Uint32Array</span>(K),clr8=<span class="keyword">new</span> <span class="title class_">Uint8Array</span>(cl32.<span class="property">buffer</span>);<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;K;i++)cl32[i]=leafs[i].<span class="property">est</span>.<span class="property">rgba</span>;<span class="keyword">var</span> len=sb.<span class="property">length</span>;<span class="keyword">var</span> inds=<span class="keyword">new</span> <span class="title class_">Uint8Array</span>(len&gt;&gt;<span class="number">2</span>),nd;<span class="keyword">if</span>(K&lt;=<span class="number">60</span>)&#123;<span class="title function_">findNearest</span>(sb,inds,clr8);<span class="title function_">remap</span>(inds,tb32,cl32)&#125;<span class="keyword">else</span> <span class="keyword">if</span>(sb.<span class="property">length</span>&lt;<span class="number">32e6</span>)<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;len;i+=<span class="number">4</span>)&#123;<span class="keyword">var</span> r=sb[i]*(<span class="number">1</span>/<span class="number">255</span>),g=sb[i+<span class="number">1</span>]*(<span class="number">1</span>/<span class="number">255</span>),b=sb[i+<span class="number">2</span>]*(<span class="number">1</span>/<span class="number">255</span>),a=sb[i+<span class="number">3</span>]*(<span class="number">1</span>/<span class="number">255</span>);nd=<span class="title function_">getNearest</span>(root,r,g,b,a);inds[i&gt;&gt;<span class="number">2</span>]=nd.<span class="property">ind</span>;tb32[i&gt;&gt;<span class="number">2</span>]=nd.<span class="property">est</span>.<span class="property">rgba</span>&#125;<span class="keyword">else</span> <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;len;i+=<span class="number">4</span>)&#123;<span class="keyword">var</span> r=sb[i]*(<span class="number">1</span>/<span class="number">255</span>),g=sb[i+<span class="number">1</span>]*(<span class="number">1</span>/<span class="number">255</span>),b=sb[i+<span class="number">2</span>]*(<span class="number">1</span>/<span class="number">255</span>),a=sb[i+<span class="number">3</span>]*(<span class="number">1</span>/<span class="number">255</span>);nd=root;<span class="keyword">while</span>(nd.<span class="property">left</span>)nd=<span class="title function_">planeDst</span>(nd.<span class="property">est</span>,r,g,b,a)&lt;=<span class="number">0</span>?nd.<span class="property">left</span>:nd.<span class="property">right</span>;inds[i&gt;&gt;<span class="number">2</span>]=nd.<span class="property">ind</span>;tb32[i&gt;&gt;<span class="number">2</span>]=nd.<span class="property">est</span>.<span class="property">rgba</span>&#125;<span class="keyword">if</span>(doKmeans||sb.<span class="property">length</span>*K&lt;<span class="number">10</span>*<span class="number">4e6</span>)&#123;<span class="keyword">var</span> le=<span class="number">1e9</span>;<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;<span class="number">10</span>;i++)&#123;<span class="keyword">var</span> ce=<span class="title function_">kmeans</span>(sb,inds,clr8);<span class="keyword">if</span>(ce/le&gt;<span class="number">0.997</span>)<span class="keyword">break</span>;le=ce&#125;<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;K;i++)leafs[i].<span class="property">est</span>.<span class="property">rgba</span>=cl32[i];<span class="title function_">remap</span>(inds,tb32,cl32)&#125;<span class="keyword">return</span>&#123;<span class="attr">abuf</span>:tb.<span class="property">buffer</span>,<span class="attr">inds</span>:inds,<span class="attr">plte</span>:leafs&#125;&#125;<span class="keyword">function</span> <span class="title function_">remap</span>(<span class="params">inds,tb32,pl32</span>)&#123;<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;inds.<span class="property">length</span>;i++)tb32[i]=pl32[inds[i]]&#125;<span class="keyword">function</span> <span class="title function_">kmeans</span>(<span class="params">sb,inds,plte</span>)&#123;<span class="title function_">updatePalette</span>(sb,inds,plte);<span class="keyword">var</span> err=<span class="title function_">findNearest</span>(sb,inds,plte);<span class="keyword">return</span> err&#125;<span class="keyword">function</span> <span class="title function_">updatePalette</span>(<span class="params">sb,inds,plte</span>)&#123;<span class="keyword">var</span> K=plte.<span class="property">length</span>&gt;&gt;&gt;<span class="number">2</span>;<span class="keyword">var</span> sums=<span class="keyword">new</span> <span class="title class_">Uint32Array</span>(K*<span class="number">4</span>),cnts=<span class="keyword">new</span> <span class="title class_">Uint32Array</span>(K);<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;sb.<span class="property">length</span>;i+=<span class="number">4</span>)&#123;<span class="keyword">var</span> ind=inds[i&gt;&gt;&gt;<span class="number">2</span>],qi=ind*<span class="number">4</span>;cnts[ind]++;sums[qi]+=sb[i];sums[qi+<span class="number">1</span>]+=sb[i+<span class="number">1</span>];sums[qi+<span class="number">2</span>]+=sb[i+<span class="number">2</span>];sums[qi+<span class="number">3</span>]+=sb[i+<span class="number">3</span>]&#125;<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;plte.<span class="property">length</span>;i++)plte[i]=<span class="title class_">Math</span>.<span class="title function_">round</span>(sums[i]/cnts[i&gt;&gt;&gt;<span class="number">2</span>])&#125;<span class="keyword">function</span> <span class="title function_">findNearest</span>(<span class="params">sb,inds,plte</span>)&#123;<span class="keyword">var</span> terr=<span class="number">0</span>,K=plte.<span class="property">length</span>&gt;&gt;&gt;<span class="number">2</span>;<span class="keyword">var</span> nd=[];<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;K;i++)&#123;<span class="keyword">var</span> qi=i*<span class="number">4</span>;<span class="keyword">var</span> r=plte[qi],g=plte[qi+<span class="number">1</span>],b=plte[qi+<span class="number">2</span>],a=plte[qi+<span class="number">3</span>],ti=<span class="number">0</span>,te=<span class="number">1e9</span>;<span class="keyword">for</span>(<span class="keyword">var</span> j=<span class="number">0</span>;j&lt;K;j++)&#123;<span class="keyword">if</span>(i==j)<span class="keyword">continue</span>;<span class="keyword">var</span> qj=j*<span class="number">4</span>,dr=r-plte[qj],dg=g-plte[qj+<span class="number">1</span>],db=b-plte[qj+<span class="number">2</span>],da=a-plte[qj+<span class="number">3</span>];<span class="keyword">var</span> err=dr*dr+dg*dg+db*db+da*da;<span class="keyword">if</span>(err&lt;te)&#123;te=err;ti=j&#125;&#125;nd[i]=<span class="title class_">Math</span>.<span class="title function_">sqrt</span>(te)*<span class="number">0.5</span>;nd[i]=nd[i]*nd[i]&#125;<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;sb.<span class="property">length</span>;i+=<span class="number">4</span>)&#123;<span class="keyword">var</span> r=sb[i],g=sb[i+<span class="number">1</span>],b=sb[i+<span class="number">2</span>],a=sb[i+<span class="number">3</span>];<span class="keyword">var</span> ti=inds[i&gt;&gt;&gt;<span class="number">2</span>],qi=ti*<span class="number">4</span>,dr=r-plte[qi],dg=g-plte[qi+<span class="number">1</span>],db=b-plte[qi+<span class="number">2</span>],da=a-plte[qi+<span class="number">3</span>],te=dr*dr+dg*dg+db*db+da*da;<span class="keyword">if</span>(te&gt;nd[ti])<span class="keyword">for</span>(<span class="keyword">var</span> j=<span class="number">0</span>;j&lt;K;j++)&#123;qi=j*<span class="number">4</span>;dr=r-plte[qi];dg=g-plte[qi+<span class="number">1</span>];db=b-plte[qi+<span class="number">2</span>];da=a-plte[qi+<span class="number">3</span>];<span class="keyword">var</span> err=dr*dr+dg*dg+db*db+da*da;<span class="keyword">if</span>(err&lt;te)&#123;te=err;ti=j;<span class="keyword">if</span>(te&lt;nd[j])<span class="keyword">break</span>&#125;&#125;inds[i&gt;&gt;&gt;<span class="number">2</span>]=ti;terr+=te&#125;<span class="keyword">return</span> terr/(sb.<span class="property">length</span>&gt;&gt;&gt;<span class="number">2</span>)&#125;<span class="keyword">function</span> <span class="title function_">getKDtree</span>(<span class="params">nimg,ps,err</span>)&#123;<span class="keyword">if</span>(err==<span class="literal">null</span>)err=<span class="number">0.0001</span>;<span class="keyword">var</span> nimg32=<span class="keyword">new</span> <span class="title class_">Uint32Array</span>(nimg.<span class="property">buffer</span>);<span class="keyword">var</span> root=&#123;<span class="attr">i0</span>:<span class="number">0</span>,<span class="attr">i1</span>:nimg.<span class="property">length</span>,<span class="attr">bst</span>:<span class="literal">null</span>,<span class="attr">est</span>:<span class="literal">null</span>,<span class="attr">tdst</span>:<span class="number">0</span>,<span class="attr">left</span>:<span class="literal">null</span>,<span class="attr">right</span>:<span class="literal">null</span>&#125;;root.<span class="property">bst</span>=<span class="title function_">stats</span>(nimg,root.<span class="property">i0</span>,root.<span class="property">i1</span>);root.<span class="property">est</span>=<span class="title function_">estats</span>(root.<span class="property">bst</span>);<span class="keyword">var</span> leafs=[root];<span class="keyword">while</span>(leafs.<span class="property">length</span>&lt;ps)&#123;<span class="keyword">var</span> maxL=<span class="number">0</span>,mi=<span class="number">0</span>;<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;leafs.<span class="property">length</span>;i++)<span class="keyword">if</span>(leafs[i].<span class="property">est</span>.<span class="property">L</span>&gt;maxL)&#123;maxL=leafs[i].<span class="property">est</span>.<span class="property">L</span>;mi=i&#125;<span class="keyword">if</span>(maxL&lt;err)<span class="keyword">break</span>;<span class="keyword">var</span> node=leafs[mi];<span class="keyword">var</span> s0=<span class="title function_">splitPixels</span>(nimg,nimg32,node.<span class="property">i0</span>,node.<span class="property">i1</span>,node.<span class="property">est</span>.<span class="property">e</span>,node.<span class="property">est</span>.<span class="property">eMq255</span>);<span class="keyword">var</span> s0wrong=node.<span class="property">i0</span>&gt;=s0||node.<span class="property">i1</span>&lt;=s0;<span class="keyword">if</span>(s0wrong)&#123;node.<span class="property">est</span>.<span class="property">L</span>=<span class="number">0</span>;<span class="keyword">continue</span>&#125;<span class="keyword">var</span> ln=&#123;<span class="attr">i0</span>:node.<span class="property">i0</span>,<span class="attr">i1</span>:s0,<span class="attr">bst</span>:<span class="literal">null</span>,<span class="attr">est</span>:<span class="literal">null</span>,<span class="attr">tdst</span>:<span class="number">0</span>,<span class="attr">left</span>:<span class="literal">null</span>,<span class="attr">right</span>:<span class="literal">null</span>&#125;;ln.<span class="property">bst</span>=<span class="title function_">stats</span>(nimg,ln.<span class="property">i0</span>,ln.<span class="property">i1</span>);ln.<span class="property">est</span>=<span class="title function_">estats</span>(ln.<span class="property">bst</span>);<span class="keyword">var</span> rn=&#123;<span class="attr">i0</span>:s0,<span class="attr">i1</span>:node.<span class="property">i1</span>,<span class="attr">bst</span>:<span class="literal">null</span>,<span class="attr">est</span>:<span class="literal">null</span>,<span class="attr">tdst</span>:<span class="number">0</span>,<span class="attr">left</span>:<span class="literal">null</span>,<span class="attr">right</span>:<span class="literal">null</span>&#125;;rn.<span class="property">bst</span>=&#123;<span class="attr">R</span>:[],<span class="attr">m</span>:[],<span class="attr">N</span>:node.<span class="property">bst</span>.<span class="property">N</span>-ln.<span class="property">bst</span>.<span class="property">N</span>&#125;;<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;<span class="number">16</span>;i++)rn.<span class="property">bst</span>.<span class="property">R</span>[i]=node.<span class="property">bst</span>.<span class="property">R</span>[i]-ln.<span class="property">bst</span>.<span class="property">R</span>[i];<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;<span class="number">4</span>;i++)rn.<span class="property">bst</span>.<span class="property">m</span>[i]=node.<span class="property">bst</span>.<span class="property">m</span>[i]-ln.<span class="property">bst</span>.<span class="property">m</span>[i];rn.<span class="property">est</span>=<span class="title function_">estats</span>(rn.<span class="property">bst</span>);node.<span class="property">left</span>=ln;node.<span class="property">right</span>=rn;leafs[mi]=ln;leafs.<span class="title function_">push</span>(rn)&#125;leafs.<span class="title function_">sort</span>(<span class="keyword">function</span>(<span class="params">a,b</span>)&#123;<span class="keyword">return</span> b.<span class="property">bst</span>.<span class="property">N</span>-a.<span class="property">bst</span>.<span class="property">N</span>&#125;);<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;leafs.<span class="property">length</span>;i++)leafs[i].<span class="property">ind</span>=i;<span class="keyword">return</span>[root,leafs]&#125;<span class="keyword">function</span> <span class="title function_">getNearest</span>(<span class="params">nd,r,g,b,a</span>)&#123;<span class="keyword">if</span>(nd.<span class="property">left</span>==<span class="literal">null</span>)&#123;nd.<span class="property">tdst</span>=<span class="title function_">dist</span>(nd.<span class="property">est</span>.<span class="property">q</span>,r,g,b,a);<span class="keyword">return</span> nd&#125;<span class="keyword">var</span> pd=<span class="title function_">planeDst</span>(nd.<span class="property">est</span>,r,g,b,a);<span class="keyword">var</span> node0=nd.<span class="property">left</span>,node1=nd.<span class="property">right</span>;<span class="keyword">if</span>(pd&gt;<span class="number">0</span>)&#123;node0=nd.<span class="property">right</span>;node1=nd.<span class="property">left</span>&#125;<span class="keyword">var</span> ln=<span class="title function_">getNearest</span>(node0,r,g,b,a);<span class="keyword">if</span>(ln.<span class="property">tdst</span>&lt;=pd*pd)<span class="keyword">return</span> ln;<span class="keyword">var</span> rn=<span class="title function_">getNearest</span>(node1,r,g,b,a);<span class="keyword">return</span> rn.<span class="property">tdst</span>&lt;ln.<span class="property">tdst</span>?<span class="attr">rn</span>:ln&#125;<span class="keyword">function</span> <span class="title function_">planeDst</span>(<span class="params">est,r,g,b,a</span>)&#123;<span class="keyword">var</span> e=est.<span class="property">e</span>;<span class="keyword">return</span> e[<span class="number">0</span>]*r+e[<span class="number">1</span>]*g+e[<span class="number">2</span>]*b+e[<span class="number">3</span>]*a-est.<span class="property">eMq</span>&#125;<span class="keyword">function</span> <span class="title function_">dist</span>(<span class="params">q,r,g,b,a</span>)&#123;<span class="keyword">var</span> d0=r-q[<span class="number">0</span>],d1=g-q[<span class="number">1</span>],d2=b-q[<span class="number">2</span>],d3=a-q[<span class="number">3</span>];<span class="keyword">return</span> d0*d0+d1*d1+d2*d2+d3*d3&#125;<span class="keyword">function</span> <span class="title function_">splitPixels</span>(<span class="params">nimg,nimg32,i0,i1,e,eMq</span>)&#123;i1-=<span class="number">4</span>;<span class="keyword">var</span> shfs=<span class="number">0</span>;<span class="keyword">while</span>(i0&lt;i1)&#123;<span class="keyword">while</span>(<span class="title function_">vecDot</span>(nimg,i0,e)&lt;=eMq)i0+=<span class="number">4</span>;<span class="keyword">while</span>(<span class="title function_">vecDot</span>(nimg,i1,e)&gt;eMq)i1-=<span class="number">4</span>;<span class="keyword">if</span>(i0&gt;=i1)<span class="keyword">break</span>;<span class="keyword">var</span> t=nimg32[i0&gt;&gt;<span class="number">2</span>];nimg32[i0&gt;&gt;<span class="number">2</span>]=nimg32[i1&gt;&gt;<span class="number">2</span>];nimg32[i1&gt;&gt;<span class="number">2</span>]=t;i0+=<span class="number">4</span>;i1-=<span class="number">4</span>&#125;<span class="keyword">while</span>(<span class="title function_">vecDot</span>(nimg,i0,e)&gt;eMq)i0-=<span class="number">4</span>;<span class="keyword">return</span> i0+<span class="number">4</span>&#125;<span class="keyword">function</span> <span class="title function_">vecDot</span>(<span class="params">nimg,i,e</span>)&#123;<span class="keyword">return</span>(nimg[i]*e[<span class="number">0</span>]+nimg[i+<span class="number">1</span>]*e[<span class="number">1</span>]+nimg[i+<span class="number">2</span>]*e[<span class="number">2</span>]+nimg[i+<span class="number">3</span>]*e[<span class="number">3</span>])&#125;<span class="keyword">function</span> <span class="title function_">stats</span>(<span class="params">nimg,i0,i1</span>)&#123;<span class="keyword">var</span> R=[<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>];<span class="keyword">var</span> m=[<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>];<span class="keyword">var</span> N=(i1-i0)&gt;&gt;<span class="number">2</span>;<span class="keyword">for</span>(<span class="keyword">var</span> i=i0;i&lt;i1;i+=<span class="number">4</span>)&#123;<span class="keyword">var</span> r=nimg[i]*(<span class="number">1</span>/<span class="number">255</span>),g=nimg[i+<span class="number">1</span>]*(<span class="number">1</span>/<span class="number">255</span>),b=nimg[i+<span class="number">2</span>]*(<span class="number">1</span>/<span class="number">255</span>),a=nimg[i+<span class="number">3</span>]*(<span class="number">1</span>/<span class="number">255</span>);m[<span class="number">0</span>]+=r;m[<span class="number">1</span>]+=g;m[<span class="number">2</span>]+=b;m[<span class="number">3</span>]+=a;R[<span class="number">0</span>]+=r*r;R[<span class="number">1</span>]+=r*g;R[<span class="number">2</span>]+=r*b;R[<span class="number">3</span>]+=r*a;R[<span class="number">5</span>]+=g*g;R[<span class="number">6</span>]+=g*b;R[<span class="number">7</span>]+=g*a;R[<span class="number">10</span>]+=b*b;R[<span class="number">11</span>]+=b*a;R[<span class="number">15</span>]+=a*a&#125;R[<span class="number">4</span>]=R[<span class="number">1</span>];R[<span class="number">8</span>]=R[<span class="number">2</span>];R[<span class="number">9</span>]=R[<span class="number">6</span>];R[<span class="number">12</span>]=R[<span class="number">3</span>];R[<span class="number">13</span>]=R[<span class="number">7</span>];R[<span class="number">14</span>]=R[<span class="number">11</span>];<span class="keyword">return</span>&#123;<span class="attr">R</span>:R,<span class="attr">m</span>:m,<span class="attr">N</span>:N&#125;&#125;<span class="keyword">function</span> <span class="title function_">estats</span>(<span class="params">stats</span>)&#123;<span class="keyword">var</span> R=stats.<span class="property">R</span>,m=stats.<span class="property">m</span>,N=stats.<span class="property">N</span>;<span class="keyword">var</span> m0=m[<span class="number">0</span>],m1=m[<span class="number">1</span>],m2=m[<span class="number">2</span>],m3=m[<span class="number">3</span>],iN=N==<span class="number">0</span>?<span class="number">0</span>:<span class="number">1</span>/N;<span class="keyword">var</span> <span class="title class_">Rj</span>=[R[<span class="number">0</span>]-m0*m0*iN,R[<span class="number">1</span>]-m0*m1*iN,R[<span class="number">2</span>]-m0*m2*iN,R[<span class="number">3</span>]-m0*m3*iN,R[<span class="number">4</span>]-m1*m0*iN,R[<span class="number">5</span>]-m1*m1*iN,R[<span class="number">6</span>]-m1*m2*iN,R[<span class="number">7</span>]-m1*m3*iN,R[<span class="number">8</span>]-m2*m0*iN,R[<span class="number">9</span>]-m2*m1*iN,R[<span class="number">10</span>]-m2*m2*iN,R[<span class="number">11</span>]-m2*m3*iN,R[<span class="number">12</span>]-m3*m0*iN,R[<span class="number">13</span>]-m3*m1*iN,R[<span class="number">14</span>]-m3*m2*iN,R[<span class="number">15</span>]-m3*m3*iN];<span class="keyword">var</span> A=<span class="title class_">Rj</span>,M=<span class="variable constant_">M4</span>;<span class="keyword">var</span> b=[<span class="title class_">Math</span>.<span class="title function_">random</span>(),<span class="title class_">Math</span>.<span class="title function_">random</span>(),<span class="title class_">Math</span>.<span class="title function_">random</span>(),<span class="title class_">Math</span>.<span class="title function_">random</span>()],mi=<span class="number">0</span>,tmi=<span class="number">0</span>;<span class="keyword">if</span>(N!=<span class="number">0</span>)<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;<span class="number">16</span>;i++)&#123;b=M.<span class="title function_">multVec</span>(A,b);tmi=<span class="title class_">Math</span>.<span class="title function_">sqrt</span>(M.<span class="title function_">dot</span>(b,b));b=M.<span class="title function_">sml</span>(<span class="number">1</span>/tmi,b);<span class="keyword">if</span>(i!=<span class="number">0</span>&amp;&amp;<span class="title class_">Math</span>.<span class="title function_">abs</span>(tmi-mi)&lt;<span class="number">1e-9</span>)<span class="keyword">break</span>;mi=tmi&#125;<span class="keyword">var</span> q=[m0*iN,m1*iN,m2*iN,m3*iN];<span class="keyword">var</span> eMq255=M.<span class="title function_">dot</span>(M.<span class="title function_">sml</span>(<span class="number">255</span>,q),b);<span class="keyword">return</span>&#123;<span class="title class_">Cov</span>:<span class="title class_">Rj</span>,<span class="attr">q</span>:q,<span class="attr">e</span>:b,<span class="attr">L</span>:mi,<span class="attr">eMq255</span>:eMq255,<span class="attr">eMq</span>:M.<span class="title function_">dot</span>(b,q),<span class="attr">rgba</span>:((<span class="title class_">Math</span>.<span class="title function_">round</span>(<span class="number">255</span>*q[<span class="number">3</span>])&lt;&lt;<span class="number">24</span>)|(<span class="title class_">Math</span>.<span class="title function_">round</span>(<span class="number">255</span>*q[<span class="number">2</span>])&lt;&lt;<span class="number">16</span>)|(<span class="title class_">Math</span>.<span class="title function_">round</span>(<span class="number">255</span>*q[<span class="number">1</span>])&lt;&lt;<span class="number">8</span>)|(<span class="title class_">Math</span>.<span class="title function_">round</span>(<span class="number">255</span>*q[<span class="number">0</span>])&lt;&lt;<span class="number">0</span>))&gt;&gt;&gt;<span class="number">0</span>&#125;&#125;<span class="keyword">var</span> <span class="variable constant_">M4</span>=&#123;<span class="attr">multVec</span>:<span class="keyword">function</span>(<span class="params">m,v</span>)&#123;<span class="keyword">return</span>[m[<span class="number">0</span>]*v[<span class="number">0</span>]+m[<span class="number">1</span>]*v[<span class="number">1</span>]+m[<span class="number">2</span>]*v[<span class="number">2</span>]+m[<span class="number">3</span>]*v[<span class="number">3</span>],m[<span class="number">4</span>]*v[<span class="number">0</span>]+m[<span class="number">5</span>]*v[<span class="number">1</span>]+m[<span class="number">6</span>]*v[<span class="number">2</span>]+m[<span class="number">7</span>]*v[<span class="number">3</span>],m[<span class="number">8</span>]*v[<span class="number">0</span>]+m[<span class="number">9</span>]*v[<span class="number">1</span>]+m[<span class="number">10</span>]*v[<span class="number">2</span>]+m[<span class="number">11</span>]*v[<span class="number">3</span>],m[<span class="number">12</span>]*v[<span class="number">0</span>]+m[<span class="number">13</span>]*v[<span class="number">1</span>]+m[<span class="number">14</span>]*v[<span class="number">2</span>]+m[<span class="number">15</span>]*v[<span class="number">3</span>]]&#125;,<span class="attr">dot</span>:<span class="keyword">function</span>(<span class="params">x,y</span>)&#123;<span class="keyword">return</span> x[<span class="number">0</span>]*y[<span class="number">0</span>]+x[<span class="number">1</span>]*y[<span class="number">1</span>]+x[<span class="number">2</span>]*y[<span class="number">2</span>]+x[<span class="number">3</span>]*y[<span class="number">3</span>]&#125;,<span class="attr">sml</span>:<span class="keyword">function</span>(<span class="params">a,y</span>)&#123;<span class="keyword">return</span>[a*y[<span class="number">0</span>],a*y[<span class="number">1</span>],a*y[<span class="number">2</span>],a*y[<span class="number">3</span>]]&#125;&#125;;<span class="keyword">function</span> <span class="title function_">concatRGBA</span>(<span class="params">bufs</span>)&#123;<span class="keyword">var</span> tlen=<span class="number">0</span>;<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;bufs.<span class="property">length</span>;i++)tlen+=bufs[i].<span class="property">byteLength</span>;<span class="keyword">var</span> nimg=<span class="keyword">new</span> <span class="title class_">Uint8Array</span>(tlen),noff=<span class="number">0</span>;<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;bufs.<span class="property">length</span>;i++)&#123;<span class="keyword">var</span> img=<span class="keyword">new</span> <span class="title class_">Uint8Array</span>(bufs[i]),il=img.<span class="property">length</span>;<span class="keyword">for</span>(<span class="keyword">var</span> j=<span class="number">0</span>;j&lt;il;j+=<span class="number">4</span>)&#123;<span class="keyword">var</span> r=img[j],g=img[j+<span class="number">1</span>],b=img[j+<span class="number">2</span>],a=img[j+<span class="number">3</span>];<span class="keyword">if</span>(a==<span class="number">0</span>)r=g=b=<span class="number">0</span>;nimg[noff+j]=r;nimg[noff+j+<span class="number">1</span>]=g;nimg[noff+j+<span class="number">2</span>]=b;nimg[noff+j+<span class="number">3</span>]=a&#125;noff+=il&#125;<span class="keyword">return</span> nimg.<span class="property">buffer</span>&#125;<span class="variable constant_">UPNG</span>.<span class="property">encode</span>=encode;<span class="variable constant_">UPNG</span>.<span class="property">encodeLL</span>=encodeLL;<span class="variable constant_">UPNG</span>.<span class="property">encode</span>.<span class="property">compress</span>=compress;<span class="variable constant_">UPNG</span>.<span class="property">encode</span>.<span class="property">dither</span>=dither;<span class="variable constant_">UPNG</span>.<span class="property">quantize</span>=quantize;<span class="variable constant_">UPNG</span>.<span class="property">quantize</span>.<span class="property">findNearest</span>=findNearest;<span class="variable constant_">UPNG</span>.<span class="property">quantize</span>.<span class="property">getKDtree</span>=getKDtree;<span class="variable constant_">UPNG</span>.<span class="property">quantize</span>.<span class="property">getNearest</span>=getNearest&#125;)();</span><br></pre></td></tr></table></figure>

<h3 id="业务代码"><a href="#业务代码" class="headerlink" title="业务代码"></a>业务代码</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- onchagne是上传调用，onclick是先提前清空之前的上传数据 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span></span></span><br><span class="line"><span class="tag">  <span class="attr">ref</span>=<span class="string">&quot;file&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">type</span>=<span class="string">&quot;file&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">accept</span>=<span class="string">&quot;image/*&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">onChange</span>=<span class="string">&#123;(e)</span> =&gt;</span> this.handleCheckFile.call(this, $(e.target))&#125;</span><br><span class="line">  onClick=&#123;(e) =&gt; this.handleFileClick(e)&#125;</span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">handleFileClick</span>(<span class="params">event</span>) &#123;</span><br><span class="line">    <span class="comment">// 重置input值以确保onChange事件在下次选择相同文件时触发</span></span><br><span class="line">    event.<span class="property">target</span>.<span class="property">value</span> = <span class="string">&#x27;&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">photoCompress</span>(<span class="params">file, w, objDiv</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> ready = <span class="keyword">new</span> <span class="title class_">FileReader</span>()</span><br><span class="line">  <span class="comment">/*开始读取指定的Blob对象或File对象中的内容. 当读取操作完成时,readyState属性的值会成为DONE,如果设置了onloadend事件处理程序,则调用之.同时,result属性中将包含一个data: URL格式的字符串以表示所读取文件的内容.*/</span></span><br><span class="line">  ready.<span class="title function_">readAsDataURL</span>(file)</span><br><span class="line">  <span class="keyword">const</span> that = <span class="variable language_">this</span></span><br><span class="line">  ready.<span class="property">onload</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> re = <span class="variable language_">this</span>.<span class="property">result</span></span><br><span class="line">    that.<span class="title function_">canvasDataURL</span>(re, w, <span class="regexp">/jpeg/g</span>.<span class="title function_">test</span>(file.<span class="property">type</span>), objDiv)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">canvasDataURL</span>(<span class="params">path, obj, isjpg, callback</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> img = <span class="keyword">new</span> <span class="title class_">Image</span>()</span><br><span class="line">  img.<span class="property">src</span> = path</span><br><span class="line">  <span class="keyword">const</span> self = <span class="variable language_">this</span></span><br><span class="line">  img.<span class="property">onload</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> that = <span class="variable language_">this</span></span><br><span class="line">    <span class="comment">// 默认按比例压缩</span></span><br><span class="line">    <span class="keyword">var</span> w = that.<span class="property">width</span>,</span><br><span class="line">      h = that.<span class="property">height</span>,</span><br><span class="line">      scale = w / h</span><br><span class="line">      w = <span class="title class_">Math</span>.<span class="title function_">round</span>(obj.<span class="property">width</span> || w);</span><br><span class="line">      h = <span class="title class_">Math</span>.<span class="title function_">round</span>(obj.<span class="property">height</span> || h);</span><br><span class="line">    <span class="keyword">var</span> quality = <span class="number">0.7</span> <span class="comment">// 默认图片质量为0.7</span></span><br><span class="line">    <span class="comment">//生成canvas</span></span><br><span class="line">    <span class="keyword">var</span> canvas = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;canvas&#x27;</span>)</span><br><span class="line">    <span class="keyword">var</span> ctx = canvas.<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>)</span><br><span class="line">    <span class="comment">// 创建属性节点</span></span><br><span class="line">    <span class="keyword">var</span> anw = <span class="variable language_">document</span>.<span class="title function_">createAttribute</span>(<span class="string">&#x27;width&#x27;</span>)</span><br><span class="line">    anw.<span class="property">nodeValue</span> = w</span><br><span class="line">    <span class="keyword">var</span> anh = <span class="variable language_">document</span>.<span class="title function_">createAttribute</span>(<span class="string">&#x27;height&#x27;</span>)</span><br><span class="line">    anh.<span class="property">nodeValue</span> = h</span><br><span class="line">    canvas.<span class="title function_">setAttributeNode</span>(anw)</span><br><span class="line">    canvas.<span class="title function_">setAttributeNode</span>(anh)</span><br><span class="line">    ctx.<span class="title function_">drawImage</span>(that, <span class="number">0</span>, <span class="number">0</span>, w, h)</span><br><span class="line">    <span class="keyword">if</span> (isjpg) &#123;</span><br><span class="line">      <span class="comment">// 图像质量</span></span><br><span class="line">      <span class="keyword">if</span> (obj.<span class="property">quality</span> &amp;&amp; obj.<span class="property">quality</span> &lt;= <span class="number">1</span> &amp;&amp; obj.<span class="property">quality</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        quality = obj.<span class="property">quality</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// quality值越小，所绘制出的图像越模糊</span></span><br><span class="line">      <span class="keyword">var</span> base64 = canvas.<span class="title function_">toDataURL</span>(<span class="string">&#x27;image/jpeg&#x27;</span>, quality)</span><br><span class="line">      <span class="comment">// 回调函数返回base64的值</span></span><br><span class="line">      <span class="comment">// console.log(&quot;fileObj1==&gt;&quot;, base64);</span></span><br><span class="line">      <span class="title function_">callback</span>(base64)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> dta = ctx.<span class="title function_">getImageData</span>(<span class="number">0</span>, <span class="number">0</span>, w, h).<span class="property">data</span></span><br><span class="line">        <span class="keyword">var</span> pngData = <span class="variable constant_">UPNG</span>.<span class="title function_">encode</span>(</span><br><span class="line">          [dta.<span class="property">buffer</span>],</span><br><span class="line">          w,</span><br><span class="line">          h,</span><br><span class="line">          self.<span class="property">state</span>.<span class="property">inputValue</span> &gt; <span class="number">99</span></span><br><span class="line">            ? <span class="number">0</span></span><br><span class="line">            : <span class="title class_">Math</span>.<span class="title function_">max</span>(<span class="number">1</span>, <span class="title class_">Math</span>.<span class="title function_">ceil</span>((<span class="number">256</span> * self.<span class="property">state</span>.<span class="property">inputValue</span>) / <span class="number">100</span>))</span><br><span class="line">        )</span><br><span class="line">        <span class="title function_">callback</span>(pngData)</span><br><span class="line">      &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        message.<span class="title function_">warn</span>(<span class="string">&#x27;压缩此图片失败，建议去tinypng压缩后再重新上传&#x27;</span>)</span><br><span class="line">        <span class="keyword">var</span> base64 = canvas.<span class="title function_">toDataURL</span>(<span class="string">&#x27;image/png&#x27;</span>, quality)</span><br><span class="line">        <span class="comment">// 回调函数返回base64的值</span></span><br><span class="line">        <span class="comment">// console.log(&quot;fileObj1==&gt;&quot;, base64);</span></span><br><span class="line">        <span class="title function_">callback</span>(base64)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">convertToBlob</span>(<span class="params">buff, type</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> data = <span class="literal">null</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> buff == <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">    data = <span class="variable language_">this</span>.<span class="title function_">dataURItoBuffer</span>(buff, type)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> arrayBuffer = <span class="keyword">new</span> <span class="title class_">Uint8Array</span>(buff).<span class="property">buffer</span></span><br><span class="line">    data = <span class="keyword">new</span> <span class="title class_">File</span>([arrayBuffer], <span class="string">&#x27;filename.png&#x27;</span>, &#123; type &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> data</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">handleCheckFile</span>(<span class="params">$node</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> input = <span class="variable language_">this</span>.<span class="property">refs</span>.<span class="property">file</span></span><br><span class="line">  <span class="keyword">let</span> _file = input.<span class="property">files</span>[<span class="number">0</span>]</span><br><span class="line">  <span class="keyword">if</span> (!_file) <span class="keyword">return</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">photoCompress</span>(</span><br><span class="line">    _file,</span><br><span class="line">    &#123; <span class="attr">quality</span>: <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">inputValue</span> / <span class="number">100</span> &#125;,</span><br><span class="line">    <span class="function">(<span class="params">filecodes</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">var</span> filecode = <span class="variable language_">this</span>.<span class="title function_">convertToBlob</span>(filecodes, _file.<span class="property">type</span>)</span><br><span class="line">      <span class="comment">//将filecode的block数据上传到业务接口中</span></span><br><span class="line">      <span class="comment">// .......</span></span><br><span class="line">    &#125;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


</article>
    
    <div class="trm-reward">
        
            <span class="trm-reward-btn trm-glow" onclick='var qr = document.getElementById("qr"); qr.style.display = (qr.style.display === "none") ? "block" : "none";'>
                <i class="iconfont fas fa-hand-holding-usd"></i>
            </span>
        
        <p class="trm-reward-comment">支持我，让我有更多动力写出更好的文章</p>
        <div id="qr" style="display:none;">
            
                <div style="display:inline-block">
                    <a rel="noopener noreferrer" href='/img/pay.jpg' target='_blank' >
                       <img src="/img/pay.jpg" alt="支付宝" loading="lazy">
                    </a>
                    <p>支付宝</p>
                </div>
            
        </div>
    </div>

    

</div>
<div class="trm-post-next-prev row">
    <div class="col-lg-12">
        <!-- title -->
        <h5 class="trm-title-with-divider">
            其他文章
            <span data-number="02"></span>
        </h5>
    </div>
    
        <div class="col-lg-6">
    <div class="trm-blog-card trm-scroll-animation">
        <a href="/2024/07/11/fed13/" class="trm-cover-frame trm-anima-link">
            
            
                <img alt="cover" class="no-fancybox" src="/img/blog/petloading.png">
            
        </a>
        
        <div class="trm-card-descr">
            <div class="trm-label trm-category trm-mb-20">
                <a href=" /categories/%E5%89%8D%E7%AB%AF/">
                    前端
                </a>
            </div>
            <h5>
                <a href="/2024/07/11/fed13/" class="trm-anima-link">
                    分享一个可爱的loading小仓鼠
                </a>
            </h5>
            <div class="trm-divider trm-mb-20 trm-mt-20"></div>
            <ul class="trm-card-data trm-label">
                <li>24/07/11</li>
                <li>18:29</li>
                
                
            </ul>
        </div>
    </div>
</div>
    
    
        <div class="col-lg-6">
    <div class="trm-blog-card trm-scroll-animation">
        <a href="/2023/04/04/fed11/" class="trm-cover-frame trm-anima-link">
            
            
                <img alt="cover" class="no-fancybox" src="/img/blog/fed5.jpg">
            
        </a>
        
        <div class="trm-card-descr">
            <div class="trm-label trm-category trm-mb-20">
                <a href=" /categories/%E5%89%8D%E7%AB%AF/">
                    前端
                </a>
            </div>
            <h5>
                <a href="/2023/04/04/fed11/" class="trm-anima-link">
                    WakaTime Dashboard Pro - 更新日志
                </a>
            </h5>
            <div class="trm-divider trm-mb-20 trm-mt-20"></div>
            <ul class="trm-card-data trm-label">
                <li>23/04/04</li>
                <li>14:17</li>
                
                
            </ul>
        </div>
    </div>
</div>
    
</div>

    



                    <div class="trm-divider footer-divider"></div>

                    <!-- footer -->
                    <footer class="trm-footer-card trm-scroll-animation">

    

    

    
        <div class="trm-footer-item">
            <span>
                由 <a href="https://hexo.io" target="_blank" rel="noopener">Hexo</a> 驱动 v7.3.0
            </span>
            <span class="footer-separator" data-separator=" | "></span>
            <span> 
                主题 - 
                <a rel="noopener" href='https://github.com/MaLuns/hexo-theme-async' target='_blank'>Async</a>
                v2.2.6
            </span>
        </div>
      

     

     
</footer>
                    <!-- footer end -->

                </div>
            </div>
        </div>
    </div>
</div>
            <!-- body end -->

            

    <div id="post-toc" class="trm-post-toc">
      <div class="trm-post-toc-header">
        目录导航
				<span id="post-toc-top">
					置顶
				</span>
      </div>
      <div class="trm-post-toc-content">
        <ol class="trm-toc"><li class="trm-toc-item trm-toc-level-2" title="压缩原理"><a rel="nofollow" class="trm-toc-link" href="#压缩原理"><span class="trm-toc-number">1.</span> <span class="trm-toc-text">压缩原理</span></a><ol class="trm-toc-child"><li class="trm-toc-item trm-toc-level-3" title="JPG 前端压缩"><a rel="nofollow" class="trm-toc-link" href="#JPG-前端压缩"><span class="trm-toc-number">1.1.</span> <span class="trm-toc-text">JPG 前端压缩</span></a></li><li class="trm-toc-item trm-toc-level-3" title="PNG 前端压缩"><a rel="nofollow" class="trm-toc-link" href="#PNG-前端压缩"><span class="trm-toc-number">1.2.</span> <span class="trm-toc-text">PNG 前端压缩</span></a></li></ol></li><li class="trm-toc-item trm-toc-level-2" title="压缩流程"><a rel="nofollow" class="trm-toc-link" href="#压缩流程"><span class="trm-toc-number">2.</span> <span class="trm-toc-text">压缩流程</span></a></li><li class="trm-toc-item trm-toc-level-2" title="代码示例"><a rel="nofollow" class="trm-toc-link" href="#代码示例"><span class="trm-toc-number">3.</span> <span class="trm-toc-text">代码示例</span></a></li><li class="trm-toc-item trm-toc-level-2" title="UPNG代码"><a rel="nofollow" class="trm-toc-link" href="#UPNG代码"><span class="trm-toc-number">4.</span> <span class="trm-toc-text">UPNG代码</span></a><ol class="trm-toc-child"><li class="trm-toc-item trm-toc-level-3" title="业务代码"><a rel="nofollow" class="trm-toc-link" href="#业务代码"><span class="trm-toc-number">4.1.</span> <span class="trm-toc-text">业务代码</span></a></li></ol></li></ol>
      </div>
    </div>

            
<div class="trm-fixed-container">
    
        <div class="trm-fixed-btn post-toc-btn" data-title="目录">
            <i class="iconfont fas fa-th-list"></i>
        </div>
    
    
        <div class="trm-fixed-btn" data-title="阅读模式" onclick="asyncFun.switchReadMode()">
            <i class="iconfont fas fa-book-reader"></i>
        </div>
    
    
    <div id="trm-back-top" class="trm-fixed-btn" data-title="回到顶部">
        <i class="iconfont fas fa-arrow-up"></i>
    </div>
</div>
        </div>
      </div>
      <!-- scroll container end -->
  </div>
  <!-- app wrapper end -->

  
  <!-- Plugin -->




    
    
<script src="https://unpkg.com/@fancyapps/ui@4.0/dist/fancybox.umd.js"></script>

    

    

    

    <!-- 数学公式 -->
    

    <!-- 评论插件 -->
    
        

        
    

		




    <!-- Service Worker -->
    
    <!-- baidu push -->
    


<script id="async-script" src="/js/main.js?v=2.2.6"></script>

<!-- CDN -->


    

    

    



</body>

</html>